{"version":3,"file":"chat.cjs.development.js","sources":["../src/types/index.ts","../src/components/Emoji.tsx","../src/components/Typing.tsx","../src/components/Entry.tsx","../src/components/ContactStatus.tsx","../src/utils/common.ts","../src/components/ContactList.tsx","../src/components/AddContact.tsx","../src/hooks/useCounter.ts","../src/components/AlertDialog.tsx","../src/components/ConferenceTime.tsx","../src/components/ConfirmDialogSlide.tsx","../src/components/ConferenceButton.tsx","../src/components/RoomHeader.tsx","../src/components/MessageContent/File.tsx","../src/components/MessageContent/Video.tsx","../src/components/MessageContent/Image.tsx","../src/components/MessageContent/index.tsx","../src/components/styles.ts","../src/components/Message.tsx","../src/components/RoomMessageList.tsx","../src/components/Room.tsx","../src/components/RoomListItem.tsx","../src/components/RoomList.tsx","../src/components/Conference.tsx","../src/components/ConferenceCall.tsx","../node_modules/regenerator-runtime/runtime.js","../src/context/ChatContext.tsx","../src/context/RestContext.tsx","../src/hooks/useSocket.ts","../src/context/SocketContext.tsx","../src/components/CheckAudiVideoPerm.tsx","../src/components/Alert.tsx","../src/pages/chat.tsx","../src/translations/index.ts","../src/context/LanguageContext.tsx","../src/components/ChatIndex/index.tsx"],"sourcesContent":["export interface ChatProps {\r\n  activeGroupId?: number;\r\n  activeChatUserId?: number;\r\n  lang: 'ru' | 'en' | 'fr';\r\n  chatBaseURLApi: string;\r\n  chatWsUrl: string;\r\n  chatWsPath: string;\r\n  inModale?: boolean;\r\n  token: string;\r\n  refreshToken: string;\r\n}\r\nexport interface ChatPageProps {\r\n  activeGroupId?: number;\r\n  activeChatUserId?: number;\r\n  inModale?: boolean;\r\n}\r\n\r\n// Тип сообщения\r\nexport type MessageType =\r\n  | 'text'\r\n  | 'image'\r\n  | 'file'\r\n  | 'video'\r\n  | 'notify'\r\n  | 'video_conference';\r\n\r\nexport enum MessageStatus {\r\n  sent = 0,\r\n  read = 1,\r\n}\r\n\r\nexport enum Role {\r\n  Unknown = 0,\r\n  Client = 1,\r\n  Agent = 2,\r\n  Specialist = 3,\r\n  Operator = 4,\r\n}\r\n\r\nexport interface User {\r\n  userId: number;\r\n  username: string;\r\n  password: string;\r\n  avatar: string;\r\n  role?: Role;\r\n  online?: 1 | 0; // В сети\r\n  langCode?: string;\r\n}\r\n\r\n// Приватные сообщения\r\nexport interface PrivateMessage {\r\n  _id?: number;\r\n  userId: number;\r\n  contactId: number;\r\n  content: string;\r\n  messageType: MessageType;\r\n  status: MessageStatus;\r\n  cdate: string;\r\n  type?: string;\r\n  isRevoke?: boolean;\r\n  revokeUserName?: string;\r\n}\r\n\r\n// Контакт\r\nexport interface Contact {\r\n  userId: number;\r\n  groupId?: number;\r\n  username: string;\r\n  avatar?: string;\r\n  role?: Role;\r\n  messages?: PrivateMessage[];\r\n  unreadCount?: number;\r\n  isTop?: boolean;\r\n  online?: 1 | 0;\r\n  isManager?: 1 | 0;\r\n  noMoreData?: boolean;\r\n}\r\nexport interface VisitData {\r\n  chatFrom: Date;\r\n  conferenceStatus: 'started' | 'finished' | 'none';\r\n  contactId: number;\r\n  duration: number;\r\n  plExamName: string;\r\n  planningId: number;\r\n  visitDate: Date;\r\n  visitId: number;\r\n}\r\n\r\n// Информация о друзьях\r\nexport interface ContactGather {\r\n  [userId: number]: Contact;\r\n}\r\n\r\n// Групповое сообщение\r\nexport interface GroupMessage {\r\n  _id?: number;\r\n  userId: number;\r\n  groupId: number;\r\n  content: string;\r\n  messageType: MessageType;\r\n  cdate: string;\r\n  isRevoke?: boolean;\r\n  revokeUserName?: string;\r\n}\r\n\r\n// Группа\r\nexport interface Group {\r\n  groupId: number;\r\n  userId: number; // владелец\r\n  name: string;\r\n  notice: string;\r\n  messages?: GroupMessage[];\r\n  unreadCount?: number;\r\n  cdate: string;\r\n  isTop?: boolean;\r\n  members?: Contact[];\r\n  noMoreData?: boolean;\r\n}\r\n\r\n// Группы\r\nexport interface GroupGather {\r\n  [groupId: number]: Group;\r\n}\r\n\r\n// Ассоциации групп и пользователей\r\nexport interface GroupMap {\r\n  groupId: number;\r\n  userId: number;\r\n}\r\n\r\n// Ассоциации пользователей и друзей\r\nexport interface ContactMap {\r\n  contactId: number;\r\n  userId: number;\r\n}\r\n\r\nexport interface SendMessage {\r\n  message: string | File;\r\n  width?: number;\r\n  height?: number;\r\n  fileName?: string;\r\n  messageType: MessageType[0] | MessageType[1];\r\n  size?: number;\r\n}\r\n\r\n// Размер изображения\r\nexport interface ImageSize {\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\n// Непрочитанные сообщения\r\nexport interface UnReadGather {\r\n  [key: string]: number;\r\n}\r\n\r\n// Получить сообщения постранично\r\nexport interface PagingParams {\r\n  groupId?: number;\r\n  userId?: number;\r\n  contactId?: number;\r\n  current: number;\r\n  pageSize: number;\r\n}\r\n\r\n// Постраничный ответ для групповых сообщений\r\nexport interface PagingResponse {\r\n  // messageArr: GroupMessage[]; - fix on messages\r\n  messages: GroupMessage[];\r\n  userArr: User[];\r\n}\r\n\r\nexport interface ContactUserMap {\r\n  contactId: number;\r\n  contactUserName: string;\r\n}\r\n\r\n// информация о том, что контакт печатает текст\r\nexport interface SetTyping {\r\n  userId?: number;\r\n  groupId?: number;\r\n  contactId?: number;\r\n}\r\n\r\n// Операция с сообщением\r\nexport interface MessageOperation {\r\n  userId?: number;\r\n  username: string;\r\n  groupId?: number;\r\n  contactId?: number;\r\n  _id: number;\r\n}\r\n\r\n// Данные конференции\r\nexport interface ConferenceData {\r\n  userId: number;\r\n  contactId: number;\r\n  id: string;\r\n  url?: string;\r\n  serverAddress?: string;\r\n  user?: string;\r\n  password?: string;\r\n  currentDate?: Date;\r\n  finishDate?: Date;\r\n}\r\n\r\n// Данные чата\r\nexport interface ChatData {\r\n  user: User;\r\n  groupData: Group[];\r\n  contactData: Contact[];\r\n  userData: User[];\r\n  operatorData: Contact[];\r\n  conferenceData: ConferenceData;\r\n  visitData: VisitData[];\r\n}\r\n\r\nexport interface GroupMember {\r\n  groupId: number;\r\n  members: Contact[];\r\n}\r\n\r\nexport interface AddPrivateMessages {\r\n  pageSize: number;\r\n  contactId: number;\r\n  messages: PrivateMessage[];\r\n}\r\n\r\nexport interface AddGroupMessages extends PagingResponse {\r\n  pageSize: number;\r\n  groupId: number;\r\n}\r\n\r\nexport interface SetActiveRoom {\r\n  groupId?: number;\r\n  contactId?: number;\r\n}\r\n\r\nexport interface JoinGroup {\r\n  group: Group;\r\n  user: Contact;\r\n}\r\n\r\nexport interface SetUser {\r\n  user: User;\r\n  token: string;\r\n}\r\n\r\nexport type ChatRoom = Group | Contact;\r\nexport type ChatMessage = GroupMessage | PrivateMessage;\r\n\r\n// Операции контекстного меню\r\nexport enum ContextMenuType {\r\n  COPY = 'COPY', // Скопировать\r\n  REVOKE = 'REVOKE', // Удалить сообщение\r\n  TOP_REVERT = 'TOP_REVERT', // Открепить\r\n  TOP = 'TOP', // Закрепить\r\n  READ = 'READ', // Прочесть всё\r\n  DELETE = 'DELETE', // Удалить\r\n}\r\n","import * as React from \"react\";\r\nimport { Box,  } from \"@mui/material\";\r\nimport { makeStyles,createStyles } from '@mui/styles';\r\n\r\nconst useStyles = makeStyles(() =>\r\n  createStyles({\r\n    item: {\r\n      cursor: \"pointer\",\r\n    },\r\n  })\r\n);\r\n\r\ntype EmojiProps = {\r\n  onSelect?: (emoji: string) => void;\r\n};\r\n\r\ntype EmojiItemProps = {\r\n  emoji: string;\r\n};\r\n\r\nconst Emoji: React.FC<EmojiProps> = (props: EmojiProps) => {\r\n  const classes = useStyles();\r\n  const emojiClick = (e: React.MouseEvent<HTMLDivElement>) => {\r\n    if (props.onSelect) {\r\n      props.onSelect((e.target as HTMLDivElement).innerText);\r\n    }\r\n  };\r\n\r\n  const Item = (itemProps: EmojiItemProps) => {\r\n    return (\r\n      <Box\r\n        m={0.5}\r\n        component=\"span\"\r\n        onClick={emojiClick}\r\n        className={classes.item}\r\n      >\r\n        {itemProps.emoji}\r\n      </Box>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <Box>\r\n      <Box display=\"flex\" flexDirection=\"row\">\r\n        <Item emoji=\"😃\" />\r\n        <Item emoji=\"😁\" />\r\n        <Item emoji=\"😂\" />\r\n        <Item emoji=\"😄\" />\r\n        <Item emoji=\"😅\" />\r\n        <Item emoji=\"😆\" />\r\n        <Item emoji=\"😇\" />\r\n        <Item emoji=\"😈\" />\r\n        <Item emoji=\"😉\" />\r\n      </Box>\r\n      <Box display=\"flex\" flexDirection=\"row\">\r\n        <Item emoji=\"😊\" />\r\n        <Item emoji=\"😋\" />\r\n        <Item emoji=\"😌\" />\r\n        <Item emoji=\"😍\" />\r\n        <Item emoji=\"😎\" />\r\n        <Item emoji=\"😏\" />\r\n        <Item emoji=\"😐\" />\r\n        <Item emoji=\"😒\" />\r\n        <Item emoji=\"😓\" />\r\n      </Box>\r\n      <Box display=\"flex\" flexDirection=\"row\">\r\n        <Item emoji=\"❓\" />\r\n        <Item emoji=\"😕\" />\r\n        <Item emoji=\"😖\" />\r\n        <Item emoji=\"😗\" />\r\n        <Item emoji=\"😘\" />\r\n        <Item emoji=\"😙\" />\r\n        <Item emoji=\"😚\" />\r\n        <Item emoji=\"😜\" />\r\n        <Item emoji=\"😝\" />\r\n      </Box>\r\n      <Box display=\"flex\" flexDirection=\"row\">\r\n        <Item emoji=\"😞\" />\r\n        <Item emoji=\"😟\" />\r\n        <Item emoji=\"😠\" />\r\n        <Item emoji=\"😡\" />\r\n        <Item emoji=\"😢\" />\r\n        <Item emoji=\"😣\" />\r\n        <Item emoji=\"😤\" />\r\n        <Item emoji=\"😥\" />\r\n        <Item emoji=\"😦\" />\r\n      </Box>\r\n      <Box display=\"flex\" flexDirection=\"row\">\r\n        <Item emoji=\"😨\" />\r\n        <Item emoji=\"😩\" />\r\n        <Item emoji=\"😪\" />\r\n        <Item emoji=\"😫\" />\r\n        <Item emoji=\"😬\" />\r\n        <Item emoji=\"😭\" />\r\n        <Item emoji=\"😮\" />\r\n        <Item emoji=\"😯\" />\r\n        <Item emoji=\"😰\" />\r\n      </Box>\r\n      <Box display=\"flex\" flexDirection=\"row\">\r\n        <Item emoji=\"😲\" />\r\n        <Item emoji=\"😳\" />\r\n        <Item emoji=\"😴\" />\r\n        <Item emoji=\"😵\" />\r\n        <Item emoji=\"🧐\" />\r\n        <Item emoji=\"😷\" />\r\n        <Item emoji=\"🙁\" />\r\n        <Item emoji=\"🙂\" />\r\n        <Item emoji=\"🙃\" />\r\n      </Box>\r\n      <Box display=\"flex\" flexDirection=\"row\">\r\n        <Item emoji=\"🤐\" />\r\n        <Item emoji=\"🤑\" />\r\n        <Item emoji=\"🤒\" />\r\n        <Item emoji=\"🤓\" />\r\n        <Item emoji=\"🤔\" />\r\n        <Item emoji=\"🤕\" />\r\n        <Item emoji=\"🤠\" />\r\n        <Item emoji=\"🤡\" />\r\n        <Item emoji=\"🤢\" />\r\n      </Box>\r\n      <Box display=\"flex\" flexDirection=\"row\">\r\n        <Item emoji=\"🤤\" />\r\n        <Item emoji=\"🤥\" />\r\n        <Item emoji=\"🤧\" />\r\n        <Item emoji=\"🤨\" />\r\n        <Item emoji=\"🤩\" />\r\n        <Item emoji=\"🤪\" />\r\n        <Item emoji=\"🤫\" />\r\n        <Item emoji=\"🤬\" />\r\n        <Item emoji=\"🤭\" />\r\n      </Box>\r\n    </Box>\r\n  );\r\n};\r\nexport default Emoji;\r\n","import React from \"react\";\r\nimport { Typography } from \"@mui/material\";\r\nimport { Theme } from '@mui/material/styles';\r\nimport { makeStyles, createStyles } from '@mui/styles';\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    typingText: {\r\n      paddingLeft: theme.spacing(0.5),\r\n    },\r\n    typingDot: {\r\n      display: \"inline-block\",\r\n      verticalAlign: \"middle\",\r\n      width: 4,\r\n      height: 4,\r\n      margin: \"0px 2px\",\r\n      background: theme.palette.primary.main,\r\n      borderRadius: \"50%\",\r\n      opacity: \"0\",\r\n      animation: \"$loadingFade 1s infinite\",\r\n      \"&:nth-child(1)\": {\r\n        animationDelay: \"0s\",\r\n      },\r\n      \"&:nth-child(2)\": {\r\n        animationDelay: \"0.2s\",\r\n      },\r\n      \"&:nth-child(3)\": {\r\n        animationDelay: \"0.4s\",\r\n      },\r\n    },\r\n    \"@keyframes loadingFade\": {\r\n      \"0%\": {\r\n        opacity: 0,\r\n      },\r\n      \"50%\": {\r\n        opacity: 0.8,\r\n      },\r\n      \"100%\": {\r\n        opacity: 0,\r\n      },\r\n    },\r\n  })\r\n);\r\n\r\ntype TypingProps = {\r\n  message: string;\r\n};\r\n\r\nconst Typing: React.FC<TypingProps> = (props: TypingProps) => {\r\n  const classes = useStyles();\r\n  return (\r\n    <Typography color=\"primary\" variant=\"body2\" component=\"span\">\r\n      <span className={classes.typingDot} />\r\n      <span className={classes.typingDot} />\r\n      <span className={classes.typingDot} />\r\n      <span className={classes.typingText}>{props.message}</span>\r\n    </Typography>\r\n  );\r\n};\r\nexport default Typing;\r\n","import React, { ChangeEvent, KeyboardEvent } from \"react\";\r\nimport {\r\n  Box,\r\n  IconButton,\r\n  InputAdornment,\r\n  TextField,\r\n  Popover,\r\n  SvgIcon\r\n} from \"@mui/material\";\r\n\r\nimport { makeStyles } from \"@mui/styles\";\r\nimport { Send, InsertEmoticon } from \"@mui/icons-material\";\r\nimport Emoji from \"./Emoji\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { ChatRoom, ImageSize, SendMessage } from \"../types\";\r\n\r\nconst useStyles = makeStyles(() => ({\r\n  input: {\r\n    flex: \"auto\"\r\n  },\r\n  inputUpload: {\r\n    display: \"none\"\r\n  },\r\n  attachmentIcon: {\r\n    fill: \"none\",\r\n    stroke: \"currentColor\"\r\n  }\r\n}));\r\n\r\ntype EntryProps = {\r\n  chat: ChatRoom | null;\r\n  onTyping?: (chat: ChatRoom) => void;\r\n  onSendMessage?: (chat: ChatRoom, data: SendMessage) => void;\r\n};\r\n\r\n/**\r\n * Рассчитать пропорции изображения\r\n */\r\nconst getImageSize = (data: ImageSize) => {\r\n  let { width, height } = data;\r\n  if (width > 335 || height > 335) {\r\n    if (width > height) {\r\n      height = 335 * (height / width);\r\n      width = 335;\r\n    } else {\r\n      width = 335 * (width / height);\r\n      height = 335;\r\n    }\r\n  }\r\n  return {\r\n    width,\r\n    height\r\n  };\r\n};\r\n\r\nconst Entry: React.FC<EntryProps> = (props: EntryProps) => {\r\n  const classes = useStyles();\r\n  const { chat } = props;\r\n\r\n  const { t } = useTranslation();\r\n\r\n  const [empjiEl, setEmojiEl] = React.useState<HTMLButtonElement | null>(null);\r\n  const [text, setText] = React.useState(\"\");\r\n  const [lastTyping, setLastTyping] = React.useState({\r\n    chat,\r\n    time: 0\r\n  });\r\n\r\n  const handleEmojiClick = (event: React.MouseEvent<HTMLButtonElement>) => {\r\n    setEmojiEl(event.currentTarget);\r\n  };\r\n\r\n  const handleEmojiClose = () => {\r\n    setEmojiEl(null);\r\n  };\r\n\r\n  const emojiSelect = (emoji: string) => {\r\n    setText(`${text}${emoji}`);\r\n    handleEmojiClose();\r\n  };\r\n\r\n  const onChange = ({ target }: ChangeEvent<HTMLInputElement>) => {\r\n    setText(target.value);\r\n    if (\r\n      chat &&\r\n      props.onTyping &&\r\n      (lastTyping.chat !== chat || Date.now() - lastTyping.time >= 500)\r\n    ) {\r\n      setLastTyping({\r\n        chat,\r\n        time: Date.now()\r\n      });\r\n      props.onTyping(chat);\r\n    }\r\n  };\r\n\r\n  const sendMessage = (data: SendMessage) => {\r\n    if (chat && props.onSendMessage) props.onSendMessage(chat, data);\r\n  };\r\n\r\n  const submit = () => {\r\n    if (text.trim().length === 0) {\r\n      return;\r\n    }\r\n\r\n    sendMessage({ message: text, messageType: \"text\" });\r\n    setText(\"\");\r\n  };\r\n\r\n  const onSubmitClick = (event: React.MouseEvent<HTMLButtonElement>) => {\r\n    event.preventDefault();\r\n    submit();\r\n  };\r\n\r\n  const onKeyPress = (event: KeyboardEvent<HTMLInputElement>) => {\r\n    if (event.key === \"Enter\") {\r\n      event.preventDefault();\r\n      submit();\r\n    }\r\n  };\r\n\r\n  const onSubmitFile = (event: React.FormEvent<HTMLInputElement>) => {\r\n    if (!event.currentTarget.files) return;\r\n    const file = event.currentTarget.files[0];\r\n    let messageType: string;\r\n    if (file.type.includes(\"image\")) {\r\n      messageType = \"image\";\r\n    } else if (file.type.includes(\"video\")) {\r\n      messageType = \"video\";\r\n    } else {\r\n      messageType = \"file\";\r\n    }\r\n    if (messageType === \"image\") {\r\n      const image = new Image();\r\n      const url = window.URL || window.webkitURL;\r\n      image.src = url.createObjectURL(file);\r\n      image.onload = () => {\r\n        const imageSize: ImageSize = getImageSize({\r\n          width: image.width,\r\n          height: image.height\r\n        });\r\n        sendMessage({\r\n          message: file,\r\n          width: imageSize.width,\r\n          height: imageSize.height,\r\n          messageType\r\n        });\r\n      };\r\n    } else {\r\n      sendMessage({\r\n        message: file,\r\n        messageType,\r\n        fileName: file.name,\r\n        size: file.size\r\n      });\r\n    }\r\n  };\r\n\r\n  const emojiOpen = Boolean(empjiEl);\r\n  const enojiId = emojiOpen ? \"simple-popover\" : undefined;\r\n  return (\r\n    <Box display=\"flex\" flexDirection=\"row\">\r\n      <TextField\r\n        className={classes.input}\r\n        placeholder={t(\"CHAT.INPUT_MESSAGE\") || \"\"}\r\n        autoFocus={true}\r\n        variant=\"standard\"\r\n        InputProps={{\r\n          disableUnderline: true,\r\n          startAdornment: (\r\n            <InputAdornment position={\"start\"}>\r\n              <input\r\n                accept=\".pdf,.jpg,.jpeg,.bmp,.gif,.png,application/pdf,image/jpeg,image/bmp,image/gif,image/png\"\r\n                className={classes.inputUpload}\r\n                id=\"icon-button-file\"\r\n                type=\"file\"\r\n                onChange={onSubmitFile}\r\n              />\r\n              <label htmlFor=\"icon-button-file\">\r\n                <IconButton\r\n                  color=\"primary\"\r\n                  aria-label=\"upload\"\r\n                  component=\"span\"\r\n                  size=\"small\"\r\n                >\r\n                  <SvgIcon fill=\"none\" className={classes.attachmentIcon}>\r\n                    <path\r\n                      d=\"M16.768 13.5767L11.6961 18.6486C9.35886 20.9859 5.56937 20.9859 3.23208 18.6486V18.6486C0.894789 16.3114 0.894789 12.5219 3.23208 10.1846L10.4479 2.96872C12.0875 1.32914 14.7458 1.32914 16.3854 2.96873V2.96873C18.025 4.60831 18.025 7.26659 16.3854 8.90617L9.16515 16.1264C8.23032 17.0612 6.71466 17.0612 5.77982 16.1264V16.1264C4.84499 15.1916 4.84499 13.6759 5.77982 12.7411L10.8896 7.63131\"\r\n                      strokeWidth=\"1.6\"\r\n                      strokeLinecap=\"round\"\r\n                      strokeLinejoin=\"round\"\r\n                    />\r\n                  </SvgIcon>\r\n                </IconButton>\r\n              </label>{\" \"}\r\n              <IconButton\r\n                aria-describedby={enojiId}\r\n                onClick={handleEmojiClick}\r\n                color=\"primary\"\r\n                size=\"small\"\r\n              >\r\n                <InsertEmoticon />\r\n              </IconButton>\r\n            </InputAdornment>\r\n          ),\r\n          endAdornment: (\r\n            <IconButton\r\n              edge=\"end\"\r\n              color=\"inherit\"\r\n              size=\"small\"\r\n              onClick={onSubmitClick}\r\n            >\r\n              <Send />\r\n            </IconButton>\r\n          )\r\n        }}\r\n        value={text}\r\n        onChange={onChange}\r\n        onKeyPress={onKeyPress}\r\n      />\r\n      <Popover\r\n        id={enojiId}\r\n        open={emojiOpen}\r\n        anchorEl={empjiEl}\r\n        onClose={handleEmojiClose}\r\n        anchorOrigin={{\r\n          vertical: \"top\",\r\n          horizontal: \"center\"\r\n        }}\r\n        transformOrigin={{\r\n          vertical: \"bottom\",\r\n          horizontal: \"left\"\r\n        }}\r\n      >\r\n        <Emoji onSelect={emojiSelect} />\r\n      </Popover>\r\n    </Box>\r\n  );\r\n};\r\nexport default Entry;\r\n","import React from 'react';\r\nimport { Typography } from '@mui/material';\r\nimport Typing from './Typing';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { Contact } from '../types';\r\n\r\ntype ContactStatusProps = {\r\n  contact: Contact;\r\n  isTyping: boolean;\r\n};\r\n\r\nconst ContactStatus: React.FC<ContactStatusProps> = (\r\n  props: ContactStatusProps,\r\n) => {\r\n  const { t } = useTranslation();\r\n\r\n  if (props.isTyping)\r\n    return <Typing message={t('CHAT.STATUS.TYPING')} />;\r\n  if (props.contact.online === 1)\r\n    return (\r\n      <Typography variant=\"body2\" color=\"primary\" component=\"span\">\r\n        {t('CHAT.STATUS.ONLINE')}\r\n      </Typography>\r\n    );\r\n  return (\r\n    <Typography\r\n      variant=\"body2\"\r\n      color=\"textSecondary\"\r\n      component=\"span\"\r\n    >\r\n      {t('CHAT.STATUS.OFFLINE')}\r\n    </Typography>\r\n  );\r\n};\r\n\r\nexport default ContactStatus;\r\n","import dayjs from 'dayjs';\r\nimport {\r\n  ChatRoom,\r\n  Contact,\r\n  ContactGather,\r\n  Group,\r\n  GroupGather,\r\n} from '../types';\r\n\r\nexport function isEmpty(value: unknown): boolean {\r\n  return (\r\n    value == null ||\r\n    (typeof value === 'object' && Object.keys(value).length === 0) ||\r\n    (typeof value === 'string' && value.trim().length === 0)\r\n  );\r\n}\r\n\r\n// string contains string\r\nexport function isContainStr(str1: string, str2: string): boolean {\r\n  return str2.indexOf(str1) >= 0;\r\n}\r\n\r\n/**\r\n * check URL\r\n * @param text\r\n */\r\nexport function isUrl(text: string): boolean {\r\n  // parse url\r\n  const UrlReg = new RegExp(\r\n    /http(s)?:\\/\\/([\\w-]+\\.)+[\\w-]+(\\/[\\w- ./?%&=]*)?/,\r\n  );\r\n  return UrlReg.test(text);\r\n}\r\n\r\n/**\r\n * Формитирование времени сообщения\r\n * @param time\r\n */\r\nexport function formatTime(\r\n  time: Date | string | undefined,\r\n  format = 'DD.MM.YYYY HH:mm',\r\n) {\r\n  if (typeof time === 'undefined') return null;\r\n  if (typeof time === 'string') time = new Date(time);\r\n  // больше чем вчера\r\n  if (\r\n    dayjs()\r\n      .add(-1, 'days')\r\n      .startOf('day')\r\n      .isAfter(time)\r\n  ) {\r\n    return dayjs(time).format(format);\r\n  }\r\n  // вчера\r\n  if (\r\n    dayjs()\r\n      .startOf('day')\r\n      .isAfter(time)\r\n  ) {\r\n    return `Вчера в ${dayjs(time).format('HH:mm')}`;\r\n  }\r\n\r\n  return dayjs(time).format('HH:mm');\r\n}\r\n\r\n/**\r\n * Раскрыть содержимое\r\n * @param content - данные в строке\r\n */\r\nexport function getFileMeta(\r\n  content: string,\r\n): {\r\n  date: string;\r\n  userId: string;\r\n  size: string;\r\n  name: string;\r\n} {\r\n  // Формат  [date]$[userId]$[size]$[fileName]\r\n  // Например fileName = 1606980397047$1a01e20f-3780-4227-84b5-5c69ca766ee5$15.41KB$123.docx\r\n  const meta = content.split('$');\r\n  const [date, userId, size, name] = meta;\r\n  return {\r\n    date,\r\n    userId,\r\n    size,\r\n    name,\r\n  };\r\n}\r\n\r\nexport function getImageMeta(\r\n  content: string,\r\n): {\r\n  date: string;\r\n  userId: string;\r\n  width: string;\r\n  height: string;\r\n} {\r\n  // Формат [date]$[userId]$[width]$[height]$...\r\n  const meta = content.split('$');\r\n  const [date, userId, width, height] = meta;\r\n  return {\r\n    date,\r\n    userId,\r\n    width,\r\n    height,\r\n  };\r\n}\r\n\r\nexport function splitFileName(\r\n  name: string,\r\n): { name: string; ext: string } {\r\n  const idx = name.lastIndexOf('.');\r\n  if (idx === -1)\r\n    return {\r\n      name,\r\n      ext: '',\r\n    };\r\n  return {\r\n    name: name.slice(0, idx),\r\n    ext: name.slice(idx + 1),\r\n  };\r\n}\r\n\r\nexport const getChatId = (chat: ChatRoom | null): string | null => {\r\n  if (!chat) return null;\r\n  return (chat as Group).groupId\r\n    ? `group:${(chat as Group).groupId}`\r\n    : `user:${chat.userId}`;\r\n};\r\n\r\nexport const getChatName = (chat: ChatRoom): string => {\r\n  return (chat as Group).groupId\r\n    ? (chat as Group).name\r\n    : (chat as Contact).username;\r\n};\r\n\r\nexport const allMessCount = (chats: GroupGather | ContactGather) => {\r\n  return Object.values(chats)\r\n    .map(it => (it?.messages != null ? it?.messages.length : 0))\r\n    .reduce((a: number, b: number) => a + b, 0);\r\n};\r\n\r\nexport const chatRoomComparer = (\r\n  a: ChatRoom,\r\n  b: ChatRoom,\r\n): number => {\r\n  const hasMessagesA =\r\n    Array.isArray(a.messages) && a.messages.length > 0;\r\n  const hasMessagesB =\r\n    Array.isArray(b.messages) && b.messages.length > 0;\r\n  if (\r\n    hasMessagesA &&\r\n    hasMessagesB &&\r\n    b.messages != null &&\r\n    a.messages != null\r\n  ) {\r\n    // !!! if cdate === undefined !!!\r\n    const bb =\r\n      b.messages[b.messages.length - 1].cdate != null\r\n        ? new Date(b.messages[b.messages.length - 1].cdate).getTime()\r\n        : new Date().getTime();\r\n\r\n    const aa =\r\n      a.messages[a.messages.length - 1].cdate != null\r\n        ? new Date(a.messages[a.messages.length - 1].cdate).getTime()\r\n        : new Date().getTime() - 1;\r\n    const res = bb - aa;\r\n\r\n    //console.log('res', res);\r\n    return res;\r\n  }\r\n  if (hasMessagesA) {\r\n    return -1;\r\n  }\r\n  return 1;\r\n};\r\n\r\nexport const getParam = (param: string) => {\r\n  const QueryString = window.location.search;\r\n  const urlParams = new URLSearchParams(QueryString);\r\n  return urlParams.get(param);\r\n};\r\n\r\nexport const combineURLs = (\r\n  baseURL: string,\r\n  relativeURL: string,\r\n  queryParams?: Record<string, string>,\r\n): string => {\r\n  const url = relativeURL\r\n    ? baseURL.replace(/\\/?\\/$/, '') +\r\n      '/' +\r\n      relativeURL.replace(/^\\/+/, '')\r\n    : baseURL;\r\n  if (!queryParams) return url;\r\n\r\n  return (\r\n    url +\r\n    (url.includes('?') ? '&' : '?') +\r\n    new URLSearchParams(queryParams).toString()\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport {\r\n  Avatar,\r\n  List,\r\n  ListItem,\r\n  ListItemAvatar,\r\n  ListItemText,\r\n} from \"@mui/material\";\r\nimport StarIcon from \"@mui/icons-material/Star\";\r\nimport ContactStatus from \"./ContactStatus\";\r\nimport { makeStyles } from \"@mui/styles\";\r\nimport { Contact } from \"../types\";\r\nimport { combineURLs } from \"../utils/common\";\r\n\r\nconst useStyles = makeStyles(() => ({\r\n  star: {\r\n    fontSize: \"0.85rem\",\r\n    verticalAlign: \"middle\",\r\n  },\r\n}));\r\n\r\ntype ContactListProps = {\r\n  apiUrl: string;\r\n  contacts: Contact[];\r\n  owner?: number;\r\n  onClick?: (contact: Contact) => void;\r\n};\r\n\r\nconst ContactList: React.FC<ContactListProps> = (props: ContactListProps) => {\r\n  const classes = useStyles();\r\n  const { apiUrl, contacts, owner } = props;\r\n\r\n  return (\r\n    <List aria-label=\"contacts\">\r\n      {contacts.map((contact) => (\r\n        <ListItem\r\n          button\r\n          key={contact.userId}\r\n          onClick={() => props.onClick && props.onClick(contact)}\r\n        >\r\n          <ListItemAvatar>\r\n            <Avatar alt={contact.username} src={contact.avatar ? combineURLs(apiUrl, contact.avatar) : \"\"} />\r\n          </ListItemAvatar>\r\n          <ListItemText\r\n            primary={\r\n              <span>\r\n                {contact.username}{\" \"}\r\n                {owner === contact.userId && (\r\n                  <StarIcon className={classes.star} color=\"primary\" />\r\n                )}\r\n              </span>\r\n            }\r\n            secondary={<ContactStatus contact={contact} isTyping={false} />}\r\n          />\r\n        </ListItem>\r\n      ))}\r\n    </List>\r\n  );\r\n};\r\nexport default ContactList;\r\n","import { Dialog, DialogTitle } from \"@mui/material\";\r\nimport React from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Contact } from \"../types\";\r\nimport ContactList from \"./ContactList\";\r\n\r\ninterface AddContactProps {\r\n  open: boolean;\r\n  apiUrl: string;\r\n  contacts: Contact[];\r\n  onClose: (value?: Contact) => void;\r\n}\r\n\r\nconst AddContact: React.FC<AddContactProps> = (\r\n  props: AddContactProps\r\n) => {\r\n  const { onClose, open, apiUrl, contacts } = props;\r\n  const { t } = useTranslation();\r\n\r\n  const handleClose = () => {\r\n    onClose();\r\n  };\r\n\r\n  const handleListItemClick = (contact: Contact) => {\r\n    onClose(contact);\r\n  };\r\n\r\n  return (\r\n    <Dialog\r\n      onClose={handleClose}\r\n      aria-labelledby=\"add-contact-title\"\r\n      open={open}\r\n    >\r\n      <DialogTitle id=\"switch-operator-title\">\r\n        {t(\"CHAT.ADD_CONTACT\")}\r\n      </DialogTitle>\r\n      <ContactList\r\n        apiUrl={apiUrl}\r\n        contacts={contacts}\r\n        onClick={handleListItemClick}\r\n      />\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default AddContact;","import { useEffect, useRef, useState } from \"react\";\r\n\r\nexport default function useCounter(max = 30000) {\r\n  const [counter, setCounter] = useState(max);\r\n  const counterRef = useRef<ReturnType<typeof setInterval> | null>(null);\r\n\r\n  const handlerRefresh = () => {\r\n    setCounter(max);\r\n  };\r\n\r\n  // Counter\r\n  useEffect(() => {\r\n    if (counter > 0)\r\n      counterRef.current = setInterval(\r\n        () => setCounter(prev => prev - 1),\r\n        1000\r\n      );\r\n\r\n    return () => {\r\n      if (counterRef.current) clearInterval(counterRef.current);\r\n    };\r\n  }, [counter]);\r\n\r\n  return { counter, handlerRefresh };\r\n}\r\n","/* eslint-disable @typescript-eslint/no-explicit-any */\r\nimport React from 'react';\r\nimport {\r\n  Alert,\r\n  Dialog,\r\n  DialogContent,\r\n  Slide,\r\n  Button,\r\n  DialogActions,\r\n  Typography,\r\n  AlertColor,\r\n} from '@mui/material';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nimport { TransitionProps } from '@mui/material/transitions';\r\n\r\nconst Transition = React.forwardRef(function Transition(\r\n  props: TransitionProps & {\r\n    children: React.ReactElement<any, any>;\r\n  },\r\n  ref: React.Ref<unknown>,\r\n) {\r\n  return <Slide direction=\"up\" ref={ref} {...props} />;\r\n});\r\n\r\ntype AlertDialogProps = {\r\n  children: JSX.Element | JSX.Element[] | string;\r\n  open: boolean;\r\n  setOpen: (value: boolean) => void;\r\n  severity: AlertColor;\r\n};\r\n\r\nexport default function AlertDialog({\r\n  children,\r\n  open,\r\n  setOpen,\r\n  severity = 'warning',\r\n}: AlertDialogProps) {\r\n  const { t } = useTranslation();\r\n\r\n  const handleClose = () => {\r\n    setOpen(false);\r\n  };\r\n  return (\r\n    <Dialog\r\n      open={open}\r\n      TransitionComponent={Transition}\r\n      keepMounted\r\n      onClose={handleClose}\r\n      aria-labelledby=\"alert-dialog-title\"\r\n      aria-describedby=\"alert-dialog-description\"\r\n    >\r\n      <DialogContent>\r\n        <Alert severity={severity}>\r\n          {typeof children === 'string' ? (\r\n            <Typography variant=\"body2\">{children}</Typography>\r\n          ) : (\r\n            children\r\n          )}\r\n        </Alert>\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button onClick={handleClose} variant=\"text\">\r\n          {t('CHAT.BUT_CLOSE')}\r\n        </Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n  );\r\n}\r\n","import React, { useEffect, useMemo, useState } from \"react\";\r\nimport { Box, Typography } from \"@mui/material\";\r\nimport useCounter from \"../hooks/useCounter\";\r\nimport AlertDialog from \"./AlertDialog\";\r\nimport { useTranslation } from \"react-i18next\";\r\n//import { useTranslation } from \"react-i18next\";\r\n\r\nconst hhMmSs = (totalSeconds: number) => {\r\n  const hours = Math.floor(totalSeconds / 3600);\r\n  const strHours = hours < 10 ? `0${hours}` : hours;\r\n  totalSeconds %= 3600;\r\n  const minutes = Math.floor(totalSeconds / 60);\r\n  const strMinutes = minutes < 10 ? `0${minutes}` : minutes;\r\n  const seconds = totalSeconds % 60;\r\n  const strSeconds = seconds < 10 ? `0${seconds}` : seconds;\r\n\r\n  const strTime = `${strHours}:${strMinutes}:${strSeconds}`;\r\n  return { hours, minutes, seconds, strTime };\r\n};\r\ntype AlertModaleProps = {\r\n  modaleInfo: boolean;\r\n  setModaleInfo: (vars: boolean) => void;\r\n  strTime: string;\r\n};\r\nconst AlertModale: React.FC<AlertModaleProps> = ({\r\n  modaleInfo,\r\n  setModaleInfo,\r\n  strTime\r\n}) => {\r\n  const { t } = useTranslation();\r\n  return useMemo(\r\n    () => (\r\n      <AlertDialog open={modaleInfo} setOpen={setModaleInfo} severity=\"info\">\r\n        <Typography variant=\"body1\" textAlign=\"center\">\r\n          {t(\"CHAT.CONFERENCE.UntillTheEnd\")}:\r\n        </Typography>\r\n        <Typography variant=\"h6\" textAlign=\"center\">\r\n          {strTime}\r\n        </Typography>\r\n      </AlertDialog>\r\n    ),\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    [modaleInfo]\r\n  );\r\n};\r\n\r\ntype ConferenceTimeProps = {\r\n  finishDate: Date;\r\n};\r\nconst ConferenceTime: React.FC<ConferenceTimeProps> = ({\r\n  finishDate\r\n}: ConferenceTimeProps) => {\r\n  const { t } = useTranslation();\r\n  const [modaleInfo, setModaleInfo] = useState(false);\r\n  const currTime = Date.now();\r\n  // console.log(\"currentDate server\", currentDate);\r\n  // console.log(\"currTime client\", currTime);\r\n  const finTime = new Date(finishDate).getTime();\r\n\r\n  //const diffTimeMin = Math.round((finTime - currTime) / (1000 * 60));\r\n  const diffTimeSec = Math.round((finTime - currTime) / 1000);\r\n\r\n  const { counter } = useCounter(diffTimeSec);\r\n  useEffect(() => {\r\n    if (minutes != null && minutes === 3 && seconds != null && seconds === 0) {\r\n      setModaleInfo(true);\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [counter]);\r\n\r\n  if (diffTimeSec < 1) return null;\r\n\r\n  const { minutes, seconds, strTime } = hhMmSs(diffTimeSec);\r\n\r\n  return (\r\n    <Box textAlign=\"center\">\r\n      <Typography variant=\"body2\" component=\"span\">\r\n        {t(\"CHAT.CONFERENCE.LEFT_TIME\")}:{\" \"}\r\n      </Typography>\r\n      <Typography variant=\"button\" component=\"span\">\r\n        {strTime}\r\n      </Typography>\r\n      <AlertModale\r\n        modaleInfo={modaleInfo}\r\n        setModaleInfo={setModaleInfo}\r\n        strTime={strTime}\r\n      />\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default ConferenceTime;\r\n","import * as React from 'react';\r\nimport Button from '@mui/material/Button';\r\nimport Dialog from '@mui/material/Dialog';\r\nimport DialogActions from '@mui/material/DialogActions';\r\nimport DialogContent from '@mui/material/DialogContent';\r\nimport Slide from '@mui/material/Slide';\r\nimport { TransitionProps } from '@mui/material/transitions';\r\nimport { Typography } from '@mui/material';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nconst Transition = React.forwardRef(function Transition(\r\n  props: TransitionProps & {\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    children: React.ReactElement<any, any>;\r\n  },\r\n  ref: React.Ref<unknown>,\r\n) {\r\n  return <Slide direction=\"up\" ref={ref} {...props} />;\r\n});\r\n\r\ntype ConfirmDialogSlideProps = {\r\n  open: boolean;\r\n  contentText: string;\r\n  setOpen: (open: boolean) => void;\r\n  callback: () => void;\r\n};\r\nexport default function ConfirmDialogSlide({\r\n  open,\r\n  setOpen,\r\n  contentText,\r\n  callback,\r\n}: ConfirmDialogSlideProps) {\r\n  const { t } = useTranslation();\r\n\r\n  const handleClose = () => {\r\n    setOpen(false);\r\n  };\r\n  const handleCloseOk = () => {\r\n    setOpen(false);\r\n    callback();\r\n  };\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <Dialog\r\n        open={open}\r\n        TransitionComponent={Transition}\r\n        keepMounted\r\n        onClose={handleClose}\r\n        aria-describedby=\"alert-dialog-slide-description\"\r\n      >\r\n        <DialogContent>\r\n          <Typography variant=\"h6\">{contentText}</Typography>\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button onClick={handleClose} color=\"primary\">\r\n            {t('CHAT.BUT_CLOSE')}\r\n          </Button>\r\n          <Button onClick={handleCloseOk} color=\"warning\">\r\n            {t('CHAT.BUT_CONFIRM')}\r\n          </Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n    </React.Fragment>\r\n  );\r\n}\r\n","import * as React from 'react';\r\nimport { styled, alpha } from '@mui/material/styles';\r\nimport Button from '@mui/material/Button';\r\nimport Menu, { MenuProps } from '@mui/material/Menu';\r\nimport MenuItem from '@mui/material/MenuItem';\r\nimport PlayArrowIcon from '@mui/icons-material/PlayArrow';\r\nimport RestartAltIcon from '@mui/icons-material/RestartAlt';\r\nimport VideoCallIcon from '@mui/icons-material/VideoCall';\r\nimport KeyboardArrowDownIcon from '@mui/icons-material/KeyboardArrowDown';\r\nimport { ChatRoom, VisitData } from '../types';\r\nimport { formatTime } from '../utils/common';\r\nimport { useTranslation } from 'react-i18next';\r\nimport ConfirmDialogSlide from './ConfirmDialogSlide';\r\n\r\nconst StyledMenu = styled((props: MenuProps) => (\r\n  <Menu\r\n    elevation={0}\r\n    anchorOrigin={{\r\n      vertical: 'bottom',\r\n      horizontal: 'right',\r\n    }}\r\n    transformOrigin={{\r\n      vertical: 'top',\r\n      horizontal: 'right',\r\n    }}\r\n    {...props}\r\n  />\r\n))(({ theme }) => ({\r\n  '& .MuiPaper-root': {\r\n    borderRadius: 6,\r\n    marginTop: theme.spacing(1),\r\n    minWidth: 180,\r\n    color:\r\n      theme.palette.mode === 'light'\r\n        ? 'rgb(55, 65, 81)'\r\n        : theme.palette.grey[300],\r\n    boxShadow:\r\n      'rgb(255, 255, 255) 0px 0px 0px 0px, rgba(0, 0, 0, 0.05) 0px 0px 0px 1px, rgba(0, 0, 0, 0.1) 0px 10px 15px -3px, rgba(0, 0, 0, 0.05) 0px 4px 6px -2px',\r\n    '& .MuiMenu-list': {\r\n      padding: '4px 0',\r\n    },\r\n    '& .MuiMenuItem-root': {\r\n      '& .MuiSvgIcon-root': {\r\n        fontSize: 18,\r\n        color: theme.palette.text.secondary,\r\n        marginRight: theme.spacing(1.5),\r\n      },\r\n      '&:active': {\r\n        backgroundColor: alpha(\r\n          theme.palette.primary.main,\r\n          theme.palette.action.selectedOpacity,\r\n        ),\r\n      },\r\n    },\r\n  },\r\n}));\r\n\r\ntype ConferenceButtonProps = {\r\n  visitData: VisitData[];\r\n  chat: ChatRoom;\r\n  onVideoCall: (\r\n    chat: ChatRoom,\r\n    visitId?: number,\r\n    recreate?: boolean,\r\n  ) => void;\r\n};\r\n\r\nconst getVisitMessage = (visit: VisitData) => {\r\n  const visitDate = new Date(visit.visitDate);\r\n\r\n  return `${visit.plExamName} (${formatTime(\r\n    visitDate,\r\n    'HH:mm',\r\n  )} - ${formatTime(\r\n    new Date(visitDate.getTime() + visit.duration * 60_000),\r\n    'HH:mm',\r\n  )})`;\r\n};\r\n\r\nexport default function ConferenceButton(\r\n  props: ConferenceButtonProps,\r\n) {\r\n  const { t } = useTranslation();\r\n  const [anchorEl, setAnchorEl] = React.useState<null | HTMLElement>(\r\n    null,\r\n  );\r\n\r\n  const [visitId, setVisitId] = React.useState<number | null>(null);\r\n  const [confirmReCreateVisit, setConfirmReCreateVisit] =\r\n    React.useState(false);\r\n  const open = Boolean(anchorEl);\r\n  const handleClick = (event: React.MouseEvent<HTMLElement>) => {\r\n    setAnchorEl(event.currentTarget);\r\n  };\r\n  const handleClose = () => {\r\n    setAnchorEl(null);\r\n  };\r\n\r\n  const handleStart = (item: VisitData) => {\r\n    setAnchorEl(null);\r\n    setVisitId(item.visitId);\r\n    if (item.conferenceStatus === 'finished') {\r\n      setConfirmReCreateVisit(true);\r\n    } else {\r\n      props.onVideoCall(props.chat, item.visitId);\r\n    }\r\n  };\r\n\r\n  const visitData = React.useMemo(() => {\r\n    return props.visitData.filter(\r\n      (it) => it.contactId === props.chat.userId,\r\n    );\r\n  }, [props.visitData, props.chat]);\r\n\r\n  /**\r\n   * <Button\r\n                  aria-label=\"video call\"\r\n                  variant=\"contained\"\r\n                  color=\"primary\"\r\n                  size=\"small\"\r\n                  startIcon={<VideoCallIcon />}\r\n                  onClick={() =>\r\n                    visitId &&\r\n                    !isEmpty(\r\n                      visitData.find(\r\n                        (it) =>\r\n                          it.conferenceStatus === 'finished' &&\r\n                          it.visitId === Number(visitId),\r\n                      ),\r\n                    )\r\n                      ? setConfirmReCreateVisit(true)\r\n                      : onVideoCall(contact, null)\r\n                  }\r\n                  fullWidth\r\n                >\r\n                  {t(\r\n                    visitId\r\n                      ? 'CHAT.CONFERENCE.RESTART'\r\n                      : 'CHAT.CONFERENCE.START',\r\n                  )}\r\n                </Button>              \r\n   */\r\n\r\n  return (\r\n    <div>\r\n      <Button\r\n        id=\"conference-button\"\r\n        aria-controls={open ? 'conference-menu' : undefined}\r\n        aria-haspopup=\"true\"\r\n        aria-expanded={open ? 'true' : undefined}\r\n        color=\"primary\"\r\n        size=\"small\"\r\n        variant=\"contained\"\r\n        disableElevation\r\n        onClick={handleClick}\r\n        startIcon={<VideoCallIcon />}\r\n        endIcon={<KeyboardArrowDownIcon />}\r\n        disabled={visitData.length === 0}\r\n      >\r\n        {t('CHAT.CONFERENCE.START')}\r\n      </Button>\r\n      <ConfirmDialogSlide\r\n        open={confirmReCreateVisit}\r\n        setOpen={setConfirmReCreateVisit}\r\n        contentText={t('CHAT.CONFERENCE.CONFIRM_RECREATE_CONF')}\r\n        callback={() => {\r\n          if (visitId && confirmReCreateVisit) {\r\n            props.onVideoCall(props.chat, visitId, true);\r\n          }\r\n        }}\r\n      />\r\n      <StyledMenu\r\n        id=\"conference-menu\"\r\n        MenuListProps={{\r\n          'aria-labelledby': 'conference-button',\r\n        }}\r\n        anchorEl={anchorEl}\r\n        open={open}\r\n        onClose={handleClose}\r\n      >\r\n        {visitData.map((item) => {\r\n          return (\r\n            <MenuItem\r\n              onClick={() => handleStart(item)}\r\n              key={item.visitId}\r\n              value={item.visitId}\r\n              disableRipple\r\n            >\r\n              {item.conferenceStatus === 'finished' ? (\r\n                <RestartAltIcon />\r\n              ) : (\r\n                <PlayArrowIcon />\r\n              )}\r\n              {getVisitMessage(item)}\r\n            </MenuItem>\r\n          );\r\n        })}\r\n      </StyledMenu>\r\n    </div>\r\n  );\r\n}\r\n","import React, { useState } from 'react';\r\nimport {\r\n  Avatar,\r\n  CardHeader,\r\n  Button,\r\n  Popover,\r\n  IconButton,\r\n} from '@mui/material';\r\nimport { Theme } from '@mui/material/styles';\r\nimport GroupIcon from '@mui/icons-material/Group';\r\nimport { useTranslation } from 'react-i18next';\r\nimport CallEndIcon from '@mui/icons-material/CallEnd';\r\nimport PersonAddIcon from '@mui/icons-material/PersonAdd';\r\nimport DeleteIcon from '@mui/icons-material/Delete';\r\nimport ContactStatus from './ContactStatus';\r\nimport ContactList from './ContactList';\r\nimport AddContact from './AddContact';\r\nimport {\r\n  ChatRoom,\r\n  Contact,\r\n  Group,\r\n  SetTyping,\r\n  User,\r\n  ConferenceData,\r\n  VisitData,\r\n} from '../types';\r\nimport { makeStyles, createStyles } from '@mui/styles';\r\nimport { combineURLs, formatTime, isEmpty } from '../utils/common';\r\nimport ConferenceTime from './ConferenceTime';\r\nimport ConfirmDialogSlide from './ConfirmDialogSlide';\r\nimport ConferenceButton from './ConferenceButton';\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    popover: {\r\n      pointerEvents: 'none',\r\n    },\r\n    paper: {\r\n      padding: theme.spacing(1),\r\n    },\r\n    avatarGroup: {\r\n      backgroundColor: '#28B7C6',\r\n      color: '#fff',\r\n    },\r\n  }),\r\n);\r\n\r\ntype RoomHeaderProps = {\r\n  apiUrl: string;\r\n  user: User;\r\n  chat: ChatRoom | null;\r\n  typing: SetTyping | null;\r\n  conference: ConferenceData | null;\r\n  conferenceJoined: boolean;\r\n  className: string;\r\n  operators: Contact[];\r\n  visitData: VisitData[];\r\n  onVideoCall?: (\r\n    chat: ChatRoom,\r\n    visitId?: number,\r\n    recreate?: boolean,\r\n  ) => void;\r\n  onVideoEnd?: (conference: ConferenceData) => void;\r\n  onConferencePause?: (conference: ConferenceData) => void;\r\n  onOperatorAdd?: (chat: Group, operator: Contact) => void;\r\n  onLeaveGroup?: (chat: Group) => void;\r\n};\r\n\r\nconst getGroupStatus = (group: Group, t: (key: string) => string) => {\r\n  const status = [`${group.members?.length} ${t('CHAT.MEMBERS')}`];\r\n  const onlineCount = (group.members || []).reduce(\r\n    (sum: number, contact) => (contact.online ? sum + 1 : sum),\r\n    0,\r\n  );\r\n  if (onlineCount)\r\n    status.push(`${onlineCount} ${t('CHAT.STATUS.ONLINE')}`);\r\n  return status.join(', ');\r\n};\r\n\r\nconst getVisitMessage = (visit: VisitData) => {\r\n  const visitDate = new Date(visit.visitDate);\r\n\r\n  return `${formatTime(visitDate, 'HH:mm')} - ${formatTime(\r\n    new Date(visitDate.getTime() + visit.duration * 60_000),\r\n    'HH:mm',\r\n  )} ${visit.conferenceStatus}`;\r\n};\r\n\r\nconst RoomHeader: React.FC<RoomHeaderProps> = ({\r\n  apiUrl,\r\n  user,\r\n  chat,\r\n  typing,\r\n  conference,\r\n  visitData,\r\n  conferenceJoined,\r\n  className,\r\n  operators,\r\n  onVideoCall,\r\n  onVideoEnd,\r\n  onConferencePause,\r\n  onOperatorAdd,\r\n  onLeaveGroup,\r\n}: RoomHeaderProps) => {\r\n  const classes = useStyles();\r\n  const { t } = useTranslation();\r\n  const [anchorEl, setAnchorEl] = useState<HTMLElement | null>(null);\r\n  const [addOperatorOpen, setAddOperatorOpen] = useState(false);\r\n\r\n  if (!chat)\r\n    return (\r\n      <CardHeader\r\n        avatar={<Avatar />}\r\n        title=\"\"\r\n        subheader=\"\"\r\n        className={className}\r\n      />\r\n    );\r\n\r\n  const handlePopoverOpen = (\r\n    event: React.MouseEvent<HTMLElement, MouseEvent>,\r\n  ) => {\r\n    setAnchorEl(event.currentTarget);\r\n  };\r\n\r\n  const handlePopoverClose = () => {\r\n    setAnchorEl(null);\r\n  };\r\n\r\n  const handleAddOperatorOpen = () => {\r\n    setAddOperatorOpen(true);\r\n  };\r\n\r\n  const handleAddOperatorClose = (operator?: Contact) => {\r\n    setAddOperatorOpen(false);\r\n    if (onOperatorAdd && operator && chat)\r\n      onOperatorAdd(chat as Group, operator);\r\n  };\r\n\r\n  const group = chat as Group;\r\n  if (group.groupId) {\r\n    // группа\r\n    return (\r\n      <CardHeader\r\n        avatar={\r\n          <Avatar alt={group.name} className={classes.avatarGroup}>\r\n            <GroupIcon />\r\n          </Avatar>\r\n        }\r\n        title={group.name}\r\n        subheader={\r\n          <React.Fragment>\r\n            <span\r\n              aria-owns={anchorEl ? 'mouse-over-popover' : undefined}\r\n              aria-haspopup=\"true\"\r\n              onMouseEnter={handlePopoverOpen}\r\n              onMouseLeave={handlePopoverClose}\r\n            >\r\n              {getGroupStatus(group, t)}\r\n            </span>\r\n            <Popover\r\n              id=\"mouse-over-popover\"\r\n              className={classes.popover}\r\n              classes={{\r\n                paper: classes.paper,\r\n              }}\r\n              open={!!anchorEl}\r\n              anchorEl={anchorEl}\r\n              anchorOrigin={{\r\n                vertical: 'bottom',\r\n                horizontal: 'left',\r\n              }}\r\n              transformOrigin={{\r\n                vertical: 'top',\r\n                horizontal: 'left',\r\n              }}\r\n              onClose={handlePopoverClose}\r\n              disableRestoreFocus\r\n            >\r\n              <ContactList\r\n                apiUrl={apiUrl}\r\n                contacts={group.members as Contact[]}\r\n                owner={group.userId}\r\n              />\r\n            </Popover>\r\n          </React.Fragment>\r\n        }\r\n        className={className}\r\n        action={\r\n          <React.Fragment>\r\n            {user.role === 4 && (\r\n              <React.Fragment>\r\n                <IconButton\r\n                  aria-label=\"add user\"\r\n                  onClick={handleAddOperatorOpen}\r\n                >\r\n                  <PersonAddIcon />\r\n                </IconButton>\r\n                <AddContact\r\n                  apiUrl={apiUrl}\r\n                  open={addOperatorOpen}\r\n                  contacts={operators}\r\n                  onClose={handleAddOperatorClose}\r\n                />\r\n              </React.Fragment>\r\n            )}\r\n            {user.role === 4 &&\r\n              group.members?.find(\r\n                (it) => it.userId !== user.userId && it.role === 4,\r\n              ) &&\r\n              onLeaveGroup && (\r\n                <IconButton\r\n                  aria-label=\"leave group\"\r\n                  onClick={() => onLeaveGroup(group)}\r\n                >\r\n                  <DeleteIcon />\r\n                </IconButton>\r\n              )}\r\n          </React.Fragment>\r\n        }\r\n      />\r\n    );\r\n  }\r\n  const contact = chat as Contact;\r\n  const isTyping =\r\n    !!typing?.contactId && typing?.userId === contact.userId;\r\n\r\n  return (\r\n    <CardHeader\r\n      avatar={\r\n        <Avatar\r\n          alt={contact.username}\r\n          src={\r\n            contact.avatar ? combineURLs(apiUrl, contact.avatar) : ''\r\n          }\r\n        />\r\n      }\r\n      title={contact.username}\r\n      subheader={\r\n        <ContactStatus contact={contact} isTyping={isTyping} />\r\n      }\r\n      className={className}\r\n      action={\r\n        <React.Fragment>\r\n          {user.role !== 1 &&\r\n            conferenceJoined &&\r\n            conference &&\r\n            !isEmpty(conference) &&\r\n            onConferencePause != null && (\r\n              <Button\r\n                aria-label=\"cancel call\"\r\n                variant=\"contained\"\r\n                color=\"secondary\"\r\n                size=\"small\"\r\n                startIcon={<CallEndIcon color=\"error\" />}\r\n                onClick={() => onConferencePause(conference)}\r\n              >\r\n                {t('CHAT.CONFERENCE.PAUSE')}\r\n              </Button>\r\n            )}\r\n\r\n          {conference &&\r\n            !isEmpty(conference) &&\r\n            onVideoEnd != null &&\r\n            user.role != null &&\r\n            [3, 4].includes(user.role) && (\r\n              <Button\r\n                aria-label=\"cancel call\"\r\n                variant=\"contained\"\r\n                color=\"primary\"\r\n                size=\"small\"\r\n                startIcon={<CallEndIcon color=\"error\" />}\r\n                onClick={() => onVideoEnd(conference)}\r\n                style={{ marginLeft: 8 }}\r\n              >\r\n                {t('CHAT.CONFERENCE.FINISH')}\r\n              </Button>\r\n            )}\r\n\r\n          {isEmpty(conference) &&\r\n            onVideoCall != null &&\r\n            user.role &&\r\n            [3, 4].includes(user.role) && (\r\n              <ConferenceButton\r\n                visitData={visitData}\r\n                chat={contact}\r\n                onVideoCall={onVideoCall}\r\n              />\r\n            )}\r\n\r\n          {conference?.finishDate != null && (\r\n            <ConferenceTime finishDate={conference.finishDate} />\r\n          )}\r\n        </React.Fragment>\r\n      }\r\n    />\r\n  );\r\n};\r\n\r\nexport default RoomHeader;\r\n","import React from \"react\";\r\nimport { Avatar, Box } from \"@mui/material\";\r\nimport { Theme } from \"@mui/material/styles\";\r\nimport { makeStyles, createStyles } from \"@mui/styles\";\r\nimport { getFileMeta, splitFileName } from \"../../utils/common\";\r\nimport { ChatMessage } from \"../../types\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    fileIcon: {\r\n      fontSize: \"0.75rem\"\r\n    },\r\n    fileBody: {\r\n      paddingLeft: theme.spacing(1.2)\r\n    }\r\n  })\r\n);\r\ntype FileProps = {\r\n  message: ChatMessage;\r\n};\r\n\r\nconst File: React.FC<FileProps> = ({ message }: FileProps) => {\r\n  const classes = useStyles();\r\n  const meta = getFileMeta(message.content);\r\n  const { name, ext } = splitFileName(meta.name);\r\n  return (\r\n    <Box display=\"flex\" flexDirection=\"row\">\r\n      <Avatar className={classes.fileIcon}>{ext.toUpperCase()}</Avatar>\r\n      <Box display=\"flex\" flexDirection=\"column\" className={classes.fileBody}>\r\n        {name}\r\n        <span>{`${ext} ${meta.size}`}</span>\r\n      </Box>\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default File;\r\n","import React from 'react';\r\nimport { makeStyles } from '@mui/styles';\r\nimport { Theme } from '@mui/material/styles';\r\nimport { ChatMessage } from '../../types';\r\nimport { combineURLs } from '../../utils/common';\r\n\r\nconst useStyles = makeStyles((theme: Theme) => ({\r\n  mediaContent: {\r\n    maxWidth: 284,\r\n    maxHeight: 190,\r\n    backgroundColor: theme.palette.secondary.main,\r\n    borderRadius: theme.spacing(1.2),\r\n    [theme.breakpoints.down('sm')]: {\r\n      maxWidth: 250,\r\n      maxHeight: 210,\r\n    },\r\n  },\r\n}));\r\n\r\ntype VideoProps = {\r\n  apiUrl: string;\r\n  message: ChatMessage;\r\n  isConference: boolean;\r\n};\r\n\r\nconst Video: React.FC<VideoProps> = ({\r\n  apiUrl,\r\n  message,\r\n  isConference,\r\n}: VideoProps) => {\r\n  const classes = useStyles();\r\n  let src = '';\r\n  if (isConference) {\r\n    const meta = JSON.parse(message.content);\r\n    src = combineURLs(\r\n      apiUrl,\r\n      `/static/conf/${meta.visitId}/${meta.name}`,\r\n    );\r\n  } else src = combineURLs(apiUrl, `/static/file/${message.content}`);\r\n  return (\r\n    <video\r\n      src={src}\r\n      className={classes.mediaContent}\r\n      controls\r\n      muted\r\n      preload=\"none\"\r\n    >\r\n      Ваш браузер не поддерживает тег video.\r\n    </video>\r\n  );\r\n};\r\n\r\nexport default Video;\r\n","import React from 'react';\r\n\r\nimport { Theme } from '@mui/material/styles';\r\n//import { getImageMeta } from \"../../utils/common\";\r\nimport { ChatMessage } from '../../types';\r\nimport { makeStyles, createStyles } from '@mui/styles';\r\nimport { AspectRatio } from 'react-aspect-ratio';\r\nimport { combineURLs } from '../../utils/common';\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    img: {\r\n      cursor: 'pointer',\r\n      borderRadius: theme.spacing(1.2),\r\n      maxWidth: 284,\r\n      maxHeight: 190,\r\n      [theme.breakpoints.down('sm')]: {\r\n        maxWidth: 250,\r\n        maxHeight: 170,\r\n      },\r\n    },\r\n    aspect: {\r\n      maxWidth: 284,\r\n      maxHeight: 190,\r\n      [theme.breakpoints.down('sm')]: {\r\n        maxWidth: 250,\r\n        maxHeight: 170,\r\n      },\r\n    },\r\n  }),\r\n);\r\ntype ImageProrps = {\r\n  apiUrl: string;\r\n  message: ChatMessage;\r\n  setViewerData: (value: { visible: boolean; src: string }) => void;\r\n};\r\n\r\nconst Image: React.FC<ImageProrps> = ({\r\n  apiUrl,\r\n  message,\r\n  setViewerData,\r\n}: ImageProrps) => {\r\n  const classes = useStyles();\r\n  //const meta = getImageMeta(message.content);\r\n\r\n  return (\r\n    <AspectRatio ratio=\"3/4\" className={classes.aspect}>\r\n      <img\r\n        src={combineURLs(apiUrl, `/static/image/${message.content}`)}\r\n        onClick={() => {\r\n          setViewerData({\r\n            visible: true,\r\n\r\n            src: combineURLs(\r\n              apiUrl,\r\n              `/static/image/${message.content}`,\r\n            ),\r\n          });\r\n        }}\r\n        className={classes.img}\r\n        alt={message.cdate}\r\n      />\r\n    </AspectRatio>\r\n  );\r\n};\r\n\r\nexport default Image;\r\n","import React from 'react';\r\nimport File from './File';\r\nimport Video from './Video';\r\nimport Image from './Image';\r\nimport { ChatMessage } from '../../types';\r\n\r\ntype MessageProps = {\r\n  apiUrl: string;\r\n  message: ChatMessage;\r\n  setViewerData: (value: { visible: boolean; src: string }) => void;\r\n};\r\nconst MessageContent: React.FC<MessageProps> = ({\r\n  apiUrl,\r\n  message,\r\n  setViewerData,\r\n}: MessageProps) => {\r\n  switch (message.messageType) {\r\n    case 'text':\r\n      return <React.Fragment>{message.content}</React.Fragment>;\r\n    case 'video':\r\n    case 'video_conference':\r\n      return (\r\n        <Video\r\n          message={message}\r\n          apiUrl={apiUrl}\r\n          isConference={message.messageType === 'video_conference'}\r\n        />\r\n      );\r\n    case 'image':\r\n      return (\r\n        <Image\r\n          message={message}\r\n          apiUrl={apiUrl}\r\n          setViewerData={setViewerData}\r\n        />\r\n      );\r\n    case 'file':\r\n      return <File message={message} />;\r\n  }\r\n  return null;\r\n};\r\n\r\nexport default MessageContent;\r\n","import { Theme } from \"@mui/material/styles\";\r\nimport { makeStyles, createStyles } from \"@mui/styles\";\r\n\r\nexport default makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    rootContact: {\r\n      padding: 1,\r\n      paddingLeft: theme.spacing(2),\r\n      \"& span\": {\r\n        float: \"right\",\r\n        color: theme.palette.text.secondary,\r\n        fontSize: \"0.8rem\"\r\n      },\r\n      \"& $message\": {\r\n        backgroundColor: theme.palette.grey[200],\r\n        color: theme.palette.text.primary,\r\n        borderTopRightRadius: theme.spacing(3),\r\n        borderBottomRightRadius: theme.spacing(3)\r\n      },\r\n      \"& $firstMessage\": {\r\n        borderTopLeftRadius: theme.spacing(3),\r\n        marginTop: 10\r\n      },\r\n      \"& $lastMessage\": {\r\n        borderTopRightRadius: theme.spacing(3),\r\n        borderBottomLeftRadius: 0,\r\n        borderBottomRightRadius: theme.spacing(3),\r\n        marginBottom: 10\r\n      }\r\n    },\r\n    rootUser: {\r\n      padding: 1,\r\n      paddingRight: theme.spacing(2),\r\n      justifyContent: \"flex-end\",\r\n      \"& span\": {\r\n        float: \"right\",\r\n        color: \"#D9DEEC\",\r\n        fontSize: \"0.8rem\"\r\n      },\r\n      \"& $message\": {\r\n        backgroundColor: theme.palette.primary.main,\r\n        color: theme.palette.primary.contrastText,\r\n        borderTopLeftRadius: theme.spacing(3),\r\n        borderBottomLeftRadius: theme.spacing(3)\r\n      },\r\n      \"& $firstMessage\": {\r\n        borderTopRightRadius: theme.spacing(3),\r\n        marginTop: 10\r\n      },\r\n      \"& $lastMessage\": {\r\n        borderTopLeftRadius: theme.spacing(3),\r\n        borderBottomRightRadius: 0,\r\n        marginBottom: 10\r\n      }\r\n    },\r\n    rootNotify: {\r\n      justifyContent: \"center\",\r\n      \"& span\": {\r\n        float: \"right\",\r\n        color: theme.palette.text.secondary,\r\n        fontSize: \"0.8rem\"\r\n      },\r\n      \"& > *\": {\r\n        //padding: `0px ${theme.spacing(1)}`,\r\n        borderRadius: theme.spacing(3),\r\n        fontWeight: 500\r\n      }\r\n    },\r\n    message: {\r\n      //maxWidth: \"55%\",\r\n      //minWidth: \"50%\",\r\n      maxWidth: \"65%\",\r\n\r\n      [theme.breakpoints.down(\"md\")]: {\r\n        maxWidth: \"95%\"\r\n      },\r\n      [theme.breakpoints.down(\"sm\")]: {\r\n        maxWidth: \"85%\"\r\n      },\r\n      borderRadius: theme.spacing(0.6),\r\n      padding: theme.spacing(0.9),\r\n      paddingLeft: theme.spacing(1.8),\r\n      paddingRight: theme.spacing(1.8)\r\n    },\r\n    firstMessage: {},\r\n    lastMessage: {},\r\n\r\n    file: {\r\n      display: \"flex\",\r\n      flexDirection: \"row\",\r\n      flexWrap: \"wrap\",\r\n      cursor: \"pointer\"\r\n    },\r\n    header: {\r\n      flex: \"0 0 100%\",\r\n      overflow: \"hidden\",\r\n      fontWeight: \"bold\"\r\n    },\r\n    body: {\r\n      flex: \"1 1 auto\",\r\n      wordBreak: \"break-word\",\r\n      overflow: \"hidden\"\r\n    },\r\n    status: {\r\n      paddingLeft: theme.spacing(1),\r\n      flex: \"1 1 auto\",\r\n      alignSelf: \"flex-end\"\r\n    },\r\n    statusImage: {\r\n      fontSize: \"1rem\",\r\n      marginRight: theme.spacing(0.5),\r\n      verticalAlign: \"middle\"\r\n    }\r\n  })\r\n);\r\n","import * as React from 'react';\r\nimport { Box, Link, ListItem, Typography } from '@mui/material';\r\n\r\nimport { DoneAll, Done } from '@mui/icons-material';\r\nimport { combineURLs, formatTime } from '../utils/common';\r\nimport MessageContent from './MessageContent';\r\nimport { Alert } from '@mui/material';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { ChatMessage, Contact, PrivateMessage, User } from '../types';\r\n\r\n/* styles */\r\nimport useStyles from './styles';\r\n\r\ntype MessageProps = {\r\n  apiUrl: string;\r\n  user: User;\r\n  message: ChatMessage;\r\n  owner: Contact;\r\n  isGroupMessage: boolean; // сообщение в группу\r\n  isUserFirst: boolean; // начинает группу сообщений от одного пользователя\r\n  isUserLast: boolean; // завершает группу сообщений от одного пользователя\r\n  onContextMenu: (event: React.MouseEvent<HTMLElement>) => void;\r\n  setViewerData: (value: { visible: boolean; src: string }) => void;\r\n  //refOnMess: React.RefObject<HTMLDivElement> | null;\r\n};\r\n\r\nconst wrapMessage = (\r\n  apiUrl: string,\r\n  message: ChatMessage,\r\n  classes: ReturnType<typeof useStyles>,\r\n  isUserFirst: boolean,\r\n  isUserLast: boolean,\r\n  onContextMenu:\r\n    | ((event: React.MouseEvent<HTMLElement>) => void)\r\n    | undefined,\r\n  child: JSX.Element,\r\n) => {\r\n  const { messageType } = message;\r\n\r\n  const className =\r\n    isUserFirst && isUserLast\r\n      ? `${classes.message} ${classes.firstMessage} ${classes.lastMessage}`\r\n      : isUserFirst\r\n      ? `${classes.message} ${classes.firstMessage}`\r\n      : isUserLast\r\n      ? `${classes.message} ${classes.lastMessage}`\r\n      : classes.message;\r\n\r\n  if (messageType === 'file') {\r\n    return (\r\n      <Link\r\n        className={`${className} ${classes.file}`}\r\n        underline=\"none\"\r\n        href={combineURLs(apiUrl, `/static/file/${message.content}`)}\r\n        target=\"_blank\"\r\n        download\r\n        onContextMenu={onContextMenu}\r\n      >\r\n        {child}\r\n      </Link>\r\n    );\r\n  }\r\n  const isMedia =\r\n    messageType === 'image' ||\r\n    messageType === 'video' ||\r\n    messageType === 'video_conference';\r\n  return (\r\n    <Box\r\n      display=\"flex\"\r\n      flexDirection={isMedia ? 'column' : 'row'}\r\n      flexWrap=\"wrap\"\r\n      className={className}\r\n      onContextMenu={onContextMenu}\r\n    >\r\n      {child}\r\n    </Box>\r\n  );\r\n};\r\n\r\nconst Message: React.FC<MessageProps> = (props: MessageProps) => {\r\n  const classes = useStyles();\r\n  const { t } = useTranslation();\r\n\r\n  const {\r\n    apiUrl,\r\n    message,\r\n    owner,\r\n\r\n    user,\r\n    isGroupMessage,\r\n    isUserFirst,\r\n    isUserLast,\r\n    setViewerData,\r\n    //refOnMess,\r\n  } = props;\r\n  //console.log('message', message);\r\n\r\n  if (message.messageType === 'notify') {\r\n    // Уведомление - особый случай\r\n    const content =\r\n      message.content[0] === '{'\r\n        ? JSON.parse(message.content)\r\n        : message.content;\r\n    return (\r\n      <ListItem className={classes.rootNotify}>\r\n        <Alert\r\n          //ref={refOnMess}\r\n          severity={\r\n            typeof content === 'string' ? 'info' : content.severity\r\n          }\r\n        >\r\n          {typeof content === 'string' ? content : content.message}\r\n        </Alert>\r\n      </ListItem>\r\n    );\r\n  }\r\n\r\n  if (message.isRevoke) {\r\n    // Удаленное сообщение\r\n    return (\r\n      <ListItem className={classes.rootNotify}>\r\n        <Typography\r\n          variant=\"body2\"\r\n          align=\"center\"\r\n          //ref={refOnMess}\r\n        >\r\n          {message.userId === user.userId\r\n            ? t('CHAT.MESSAGE.REVOKED.YOU')\r\n            : `${message.revokeUserName} ${t(\r\n                'CHAT.MESSAGE.REVOKED.CONTACT',\r\n              )}`}\r\n        </Typography>\r\n      </ListItem>\r\n    );\r\n  }\r\n\r\n  const isMine = user.userId === message.userId;\r\n\r\n  return (\r\n    <ListItem\r\n      className={\r\n        message.messageType === 'video_conference'\r\n          ? classes.rootNotify\r\n          : isMine\r\n          ? classes.rootUser\r\n          : classes.rootContact\r\n      }\r\n    >\r\n      {wrapMessage(\r\n        apiUrl,\r\n        message,\r\n        classes,\r\n        isUserFirst,\r\n        isUserLast,\r\n        props.onContextMenu,\r\n        <React.Fragment>\r\n          {!isMine && isGroupMessage && owner && isUserFirst && (\r\n            <div className={classes.header}>{owner.username}</div>\r\n          )}\r\n          <div\r\n            className={classes.body}\r\n            //ref={refOnMess}\r\n          >\r\n            <MessageContent\r\n              message={message}\r\n              apiUrl={apiUrl}\r\n              setViewerData={setViewerData}\r\n            />\r\n          </div>\r\n          <div className={classes.status}>\r\n            <span>\r\n              {isMine ? (\r\n                (message as PrivateMessage).status === 0 ? (\r\n                  <Done className={classes.statusImage} />\r\n                ) : (\r\n                  <DoneAll className={classes.statusImage} />\r\n                )\r\n              ) : null}\r\n              {formatTime(message.cdate)}\r\n            </span>\r\n          </div>\r\n        </React.Fragment>,\r\n      )}\r\n    </ListItem>\r\n  );\r\n};\r\nexport default Message;\r\n","import React from 'react';\r\nimport {\r\n  Box,\r\n  CardContent,\r\n  CircularProgress,\r\n  List,\r\n  Backdrop,\r\n  Fab,\r\n} from '@mui/material';\r\nimport { Theme } from '@mui/material/styles';\r\nimport { makeStyles, createStyles } from '@mui/styles';\r\nimport KeyboardArrowDown from '@mui/icons-material/KeyboardArrowDown';\r\n\r\nimport Message from './Message';\r\nimport InfiniteScroll from 'react-infinite-scroller';\r\nimport { getChatId } from '../utils/common';\r\nimport { ChatMessage, ChatRoom, User, ContactGather } from '../types';\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    messageListOuter: {\r\n      flex: 1,\r\n      overflowY: 'auto',\r\n      margin: 0,\r\n      padding: 0,\r\n    },\r\n    messageList: {\r\n      height: '100%',\r\n      overflowY: 'auto',\r\n      scrollbarWidth: 'thin',\r\n      scrollbarColor: `${theme.palette.primary.light} #fff`,\r\n    },\r\n    img: {\r\n      cursor: 'pointer',\r\n      borderRadius: theme.spacing(1.2),\r\n\r\n      maxWidth: 'auto',\r\n      maxHeight: '95%',\r\n      [theme.breakpoints.down('sm')]: {\r\n        maxWidth: 'auto',\r\n        maxHeight: '95%',\r\n      },\r\n    },\r\n\r\n    arrowDown: {\r\n      position: 'absolute',\r\n      left: '94.5%',\r\n      bottom: 105,\r\n      [theme.breakpoints.down('md')]: {\r\n        left: '91.5%',\r\n        bottom: 95,\r\n      },\r\n      [theme.breakpoints.down('sm')]: {\r\n        left: '84%',\r\n        bottom: 95,\r\n      },\r\n    },\r\n  }),\r\n);\r\n\r\ntype InitialMenuState = {\r\n  message: ChatMessage | null;\r\n  mouseX: null | number;\r\n  mouseY: null | number;\r\n  canCopy: boolean;\r\n  canDelete: boolean;\r\n};\r\n\r\ntype RoomMessageListProps = {\r\n  apiUrl: string;\r\n  user: User;\r\n  users: ContactGather;\r\n  chat: ChatRoom | null;\r\n  loading: boolean;\r\n  pageSize: number;\r\n\r\n  initialMenuState: InitialMenuState;\r\n\r\n  onNeedMoreMessages: (chat: ChatRoom) => Promise<void>;\r\n  onMeesageDelete?: (chat: ChatRoom, message: ChatMessage) => void;\r\n  setMenuState: React.Dispatch<\r\n    React.SetStateAction<InitialMenuState>\r\n  >;\r\n};\r\n\r\nconst Loading = ({ loading }: { loading: boolean }) => {\r\n  return (\r\n    loading && (\r\n      <Box sx={{ width: '100%', mx: 'auto', textAlign: 'center' }}>\r\n        <CircularProgress />\r\n      </Box>\r\n    )\r\n  );\r\n};\r\n\r\nconst RoomMessageList: React.FC<RoomMessageListProps> = (\r\n  props: RoomMessageListProps,\r\n) => {\r\n  const {\r\n    apiUrl,\r\n    user,\r\n    users,\r\n    chat,\r\n    loading,\r\n    pageSize,\r\n    setMenuState,\r\n    initialMenuState,\r\n  } = props;\r\n  const classes = useStyles();\r\n\r\n  const [scrollDownButton, setScrollDownButton] = React.useState(\r\n    false,\r\n  );\r\n  const [scrollDo, setScrollDo] = React.useState(true);\r\n\r\n  const messages = chat?.messages;\r\n  const messageCount = messages?.length || 0;\r\n  const lastMessage =\r\n    chat?.messages && chat.messages[messageCount - 1];\r\n\r\n  // const refOnMess = React.useRef<HTMLDivElement>(null);\r\n  // const refOnLastMess = React.useRef<HTMLDivElement>(null);\r\n  const refList = React.useRef<HTMLUListElement>(null);\r\n\r\n  const handleMenuPopup = (\r\n    message: ChatMessage,\r\n    event: React.MouseEvent<HTMLElement>,\r\n  ) => {\r\n    const canCopy = message.messageType === 'text';\r\n    const canDelete =\r\n      user.userId === message.userId &&\r\n      !!props.onMeesageDelete &&\r\n      new Date().getTime() - new Date(message.cdate).getTime() <=\r\n        1000 * 60 * 2;\r\n    if (!canCopy && !canDelete) {\r\n      setMenuState(initialMenuState);\r\n      return;\r\n    }\r\n    event.preventDefault();\r\n    setMenuState({\r\n      message,\r\n      mouseX: event.clientX - 2,\r\n      mouseY: event.clientY - 4,\r\n      canCopy,\r\n      canDelete,\r\n    });\r\n  };\r\n\r\n  const [viewerData, setViewerData] = React.useState<{\r\n    visible: boolean;\r\n    src: string;\r\n  }>({\r\n    visible: false,\r\n    src: '',\r\n  });\r\n  React.useEffect(() => {\r\n    setTimeout(() => {\r\n      setScrollDo(true);\r\n      scrollDown();\r\n    }, 500);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  React.useEffect(() => {\r\n    setScrollDo(true);\r\n    scrollDown();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [getChatId(chat)]);\r\n\r\n  React.useEffect(() => {\r\n    if (lastMessage && user.userId === lastMessage.userId) {\r\n      scrollDown();\r\n      setScrollDo(true);\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [messageCount]);\r\n\r\n  const scrollDown = () => {\r\n    if (refList.current && scrollDo) {\r\n      refList.current.scrollTop = refList.current.scrollHeight;\r\n    }\r\n  };\r\n  //sconsole.log('--user', user, 'lastMessage', lastMessage);\r\n  const handlerScrollDown = () => {\r\n    scrollDown();\r\n  };\r\n\r\n  return (\r\n    <CardContent className={classes.messageListOuter}>\r\n      <List className={classes.messageList} ref={refList}>\r\n        <InfiniteScroll\r\n          pageStart={0}\r\n          loadMore={() => {\r\n            if (\r\n              messageCount >= pageSize &&\r\n              !loading &&\r\n              props.onNeedMoreMessages &&\r\n              chat\r\n            ) {\r\n              setScrollDo(false);\r\n              props.onNeedMoreMessages(chat);\r\n            }\r\n          }}\r\n          hasMore={chat && !chat.noMoreData ? true : false}\r\n          loader={<Loading loading={loading} key={0} />}\r\n          isReverse\r\n          useCapture\r\n          useWindow={false}\r\n          getScrollParent={() => {\r\n            if (refList.current) {\r\n              const gap = 1540;\r\n              const isShowButton =\r\n                refList.current.scrollTop <\r\n                refList.current.scrollHeight - gap;\r\n              setScrollDownButton(isShowButton);\r\n\r\n              //\r\n            }\r\n            return refList.current;\r\n          }}\r\n        >\r\n          {messages &&\r\n            (messages as ChatMessage[]).map((message, inx) => (\r\n              <Message\r\n                key={inx}\r\n                apiUrl={apiUrl}\r\n                user={user}\r\n                message={message}\r\n                owner={users[message.userId]}\r\n                isGroupMessage={!!chat?.groupId}\r\n                isUserFirst={\r\n                  inx === 0 ||\r\n                  messages[inx - 1].messageType === 'notify' ||\r\n                  messages[inx - 1].userId !== messages[inx].userId\r\n                }\r\n                isUserLast={\r\n                  inx === messages.length - 1 ||\r\n                  messages[inx + 1].messageType === 'notify' ||\r\n                  messages[inx + 1].userId !== messages[inx].userId\r\n                }\r\n                onContextMenu={event =>\r\n                  handleMenuPopup(message, event)\r\n                }\r\n                //refOnMess={defineRefOnMess(inx)}\r\n                setViewerData={setViewerData}\r\n              />\r\n            ))}\r\n        </InfiniteScroll>\r\n      </List>\r\n      {scrollDownButton && (\r\n        <Box className={classes.arrowDown}>\r\n          <Fab\r\n            color=\"info\"\r\n            aria-label=\"add\"\r\n            size=\"medium\"\r\n            onClick={handlerScrollDown}\r\n          >\r\n            <KeyboardArrowDown />\r\n          </Fab>\r\n        </Box>\r\n      )}\r\n      {viewerData.visible && (\r\n        <Backdrop\r\n          sx={{\r\n            color: '#fff',\r\n            zIndex: (theme: Theme) => theme.zIndex.drawer + 1,\r\n          }}\r\n          open={viewerData.visible}\r\n          onClick={() => {\r\n            setViewerData({ visible: false, src: '' });\r\n          }}\r\n        >\r\n          <img src={viewerData.src} className={classes.img} alt=\"\" />\r\n        </Backdrop>\r\n      )}\r\n    </CardContent>\r\n  );\r\n};\r\n\r\nexport default RoomMessageList;\r\n","import React, { useCallback } from 'react';\r\nimport {\r\n  Box,\r\n  Card,\r\n  CardContent,\r\n  Divider,\r\n  ListItemIcon,\r\n  Menu,\r\n  MenuItem,\r\n  IconButton,\r\n  useMediaQuery,\r\n  Tooltip,\r\n} from '@mui/material';\r\nimport { Theme } from '@mui/material/styles';\r\nimport { makeStyles, createStyles } from '@mui/styles';\r\nimport FileCopyIcon from '@mui/icons-material/FileCopy';\r\nimport DeleteIcon from '@mui/icons-material/Delete';\r\nimport ArrowBackIcon from '@mui/icons-material/ArrowBack';\r\nimport Entry from './Entry';\r\nimport RoomHeader from './RoomHeader';\r\nimport RoomMessageList from './RoomMessageList';\r\nimport { useTranslation } from 'react-i18next';\r\nimport {\r\n  ChatMessage,\r\n  ChatRoom,\r\n  SendMessage,\r\n  SetTyping,\r\n  User,\r\n  Contact,\r\n  ConferenceData,\r\n  Group,\r\n  ContactGather,\r\n  VisitData,\r\n} from '../types';\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    root: {\r\n      width: '100%',\r\n      minWidth: 360,\r\n      height: '100%',\r\n      display: 'flex',\r\n      flexDirection: 'column',\r\n    },\r\n\r\n    roomHeader: {\r\n      flex: 1,\r\n    },\r\n\r\n    flexAll: {\r\n      flex: '1 1 auto',\r\n    },\r\n    flexEnd: {\r\n      justifyContent: 'flex-end',\r\n    },\r\n  }),\r\n);\r\n\r\nconst initialMenuState = {\r\n  message: null,\r\n  mouseX: null,\r\n  mouseY: null,\r\n  canCopy: false,\r\n  canDelete: false,\r\n};\r\n\r\ntype RoomProps = {\r\n  apiUrl: string;\r\n  user: User;\r\n  users: ContactGather;\r\n  chat: ChatRoom | null;\r\n  typing: SetTyping | null;\r\n  conference: ConferenceData | null;\r\n  visitData: VisitData[];\r\n  conferenceJoined: boolean;\r\n  loading: boolean;\r\n  pageSize: number;\r\n  operators: Contact[];\r\n  onExitRoom?: (chat: ChatRoom) => void;\r\n  onEnterRoom?: (chat: ChatRoom) => void;\r\n  onNeedMoreMessages: (chat: ChatRoom) => Promise<void>;\r\n  onMeesageDelete?: (chat: ChatRoom, message: ChatMessage) => void;\r\n  onTyping?: (chat: ChatRoom) => void;\r\n  onSendMessage?: (chat: ChatRoom, data: SendMessage) => void;\r\n  onVideoCall?: (\r\n    chat: ChatRoom,\r\n    visitId?: number,\r\n    recreate?: boolean,\r\n  ) => void;\r\n  onVideoEnd?: (chat: ConferenceData) => void;\r\n  onConferencePause?: (conference: ConferenceData) => void;\r\n  onOperatorAdd?: (chat: Group, operator: Contact) => void;\r\n  onLeaveGroup?: (chat: Group) => void;\r\n};\r\n\r\nconst Room: React.FC<RoomProps> = (props: RoomProps) => {\r\n  const {\r\n    apiUrl,\r\n    user,\r\n    users,\r\n    chat,\r\n    typing,\r\n    conference,\r\n    visitData,\r\n    conferenceJoined,\r\n    loading,\r\n    pageSize,\r\n  } = props;\r\n  const classes = useStyles();\r\n  const { t } = useTranslation();\r\n  const isMobile = useMediaQuery((theme: Theme) =>\r\n    theme.breakpoints.down('sm'),\r\n  );\r\n\r\n  const [menuState, setMenuState] = React.useState<{\r\n    message: ChatMessage | null;\r\n    mouseX: null | number;\r\n    mouseY: null | number;\r\n    canCopy: boolean;\r\n    canDelete: boolean;\r\n  }>(initialMenuState);\r\n\r\n  const handleMenuClose = () => {\r\n    setMenuState(initialMenuState);\r\n  };\r\n\r\n  const handleCopy = useCallback(() => {\r\n    const { message } = menuState;\r\n    setMenuState(initialMenuState);\r\n    if (!message) return;\r\n    navigator.clipboard.writeText(message.content);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [menuState.message]);\r\n\r\n  const handleDelete = useCallback(() => {\r\n    const { message } = menuState;\r\n    setMenuState(initialMenuState);\r\n    if (props.onMeesageDelete && chat && message)\r\n      props.onMeesageDelete(chat, message);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [menuState.message]);\r\n\r\n  return (\r\n    <Card elevation={1} className={classes.root}>\r\n      <Box display=\"flex\" flexDirection=\"row\">\r\n        {chat && isMobile && (\r\n          <Tooltip title=\"Вернуться в конференцию\">\r\n            <IconButton\r\n              aria-label=\"exit room\"\r\n              onClick={() =>\r\n                props.onExitRoom && props.onExitRoom(chat)\r\n              }\r\n            >\r\n              <ArrowBackIcon />\r\n            </IconButton>\r\n          </Tooltip>\r\n        )}\r\n        {/* {!isMobile && <CheckAudiVideoPerm />} */}\r\n\r\n        <RoomHeader\r\n          apiUrl={apiUrl}\r\n          user={user}\r\n          chat={chat}\r\n          typing={typing}\r\n          conference={conference}\r\n          visitData={visitData}\r\n          conferenceJoined={conferenceJoined}\r\n          operators={props.operators}\r\n          className={classes.roomHeader}\r\n          onVideoCall={props.onVideoCall}\r\n          onVideoEnd={props.onVideoEnd}\r\n          onConferencePause={props.onConferencePause}\r\n          onOperatorAdd={props.onOperatorAdd}\r\n          onLeaveGroup={props.onLeaveGroup}\r\n        />\r\n      </Box>\r\n      <Divider />\r\n      <RoomMessageList\r\n        apiUrl={apiUrl}\r\n        user={user}\r\n        users={users}\r\n        chat={chat}\r\n        loading={loading}\r\n        pageSize={pageSize}\r\n        initialMenuState={initialMenuState}\r\n        onNeedMoreMessages={props.onNeedMoreMessages}\r\n        onMeesageDelete={props.onMeesageDelete}\r\n        setMenuState={setMenuState}\r\n      />\r\n      <Divider />\r\n      <CardContent>\r\n        <Entry\r\n          chat={chat}\r\n          onTyping={props.onTyping}\r\n          onSendMessage={props.onSendMessage}\r\n        />\r\n      </CardContent>\r\n      <Menu\r\n        keepMounted\r\n        open={menuState.mouseY !== null}\r\n        onClose={handleMenuClose}\r\n        anchorReference=\"anchorPosition\"\r\n        anchorPosition={\r\n          menuState.mouseY !== null && menuState.mouseX !== null\r\n            ? { top: menuState.mouseY, left: menuState.mouseX }\r\n            : undefined\r\n        }\r\n      >\r\n        <MenuItem onClick={handleCopy} disabled={!menuState.canCopy}>\r\n          <span className={classes.flexAll}>\r\n            {t('CHAT.MESSAGE.MENU.COPY')}\r\n          </span>\r\n          <ListItemIcon className={classes.flexEnd}>\r\n            <FileCopyIcon fontSize=\"small\" />\r\n          </ListItemIcon>\r\n        </MenuItem>\r\n        <MenuItem\r\n          onClick={handleDelete}\r\n          disabled={!menuState.canDelete}\r\n        >\r\n          <span className={classes.flexAll}>\r\n            {t('CHAT.MESSAGE.MENU.DELETE')}\r\n          </span>\r\n          <ListItemIcon className={classes.flexEnd}>\r\n            <DeleteIcon fontSize=\"small\" />\r\n          </ListItemIcon>\r\n        </MenuItem>\r\n      </Menu>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default Room;\r\n","import React from \"react\";\r\nimport {\r\n  Avatar,\r\n  Badge,\r\n  Box,\r\n  Chip,\r\n  ListItem,\r\n  ListItemAvatar,\r\n  ListItemText\r\n} from \"@mui/material\";\r\nimport { Theme } from \"@mui/material/styles\";\r\nimport { makeStyles, createStyles, withStyles } from \"@mui/styles\";\r\n\r\nimport GroupIcon from \"@mui/icons-material/Group\";\r\nimport { combineURLs, formatTime, getChatName } from \"../utils/common\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { ChatMessage, ChatRoom, Contact, Group, SetTyping } from \"../types\";\r\n\r\ntype RoomListItemProps = {\r\n  apiUrl: string;\r\n  chat: ChatRoom;\r\n  active: boolean;\r\n  typing: SetTyping | null;\r\n  onClick: React.MouseEventHandler<HTMLDivElement> | undefined;\r\n};\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    main: {\r\n      flex: \"1 1 auto\",\r\n      whiteSpace: \"nowrap\",\r\n      overflow: \"hidden\",\r\n      textOverflow: \"ellipsis\"\r\n    },\r\n    time: {\r\n      paddingLeft: theme.spacing(1),\r\n      justifyContent: \"flex-end\",\r\n      whiteSpace: \"nowrap\"\r\n    },\r\n    unread: {\r\n      justifyContent: \"flex-end\",\r\n      maxHeight: 20\r\n    },\r\n    avatarGroup: {\r\n      backgroundColor: \"#28B7C6\",\r\n      color: \"#fff\"\r\n    }\r\n  })\r\n);\r\n\r\nconst getMessageText = (\r\n  message: ChatMessage | null,\r\n  t: (key: string) => string\r\n) => {\r\n  if (!message) return null;\r\n  switch (message.messageType) {\r\n    case \"text\":\r\n      return message.content;\r\n    case \"image\":\r\n      return `[${t(\"CHAT.MESSAGE.TYPE.IMAGE\")}]`;\r\n    case \"video\":\r\n      return `[${t(\"CHAT.MESSAGE.TYPE.VIDEO\")}]`;\r\n    case \"file\":\r\n      return `[${t(\"CHAT.MESSAGE.TYPE.FILE\")}]`;\r\n    case \"notify\":\r\n      return `[${t(\"CHAT.MESSAGE.TYPE.NOTIFY\")}]`;\r\n    default:\r\n      return null;\r\n  }\r\n};\r\n\r\nconst TypingBadge = withStyles((theme: Theme) =>\r\n  createStyles({\r\n    badge: {\r\n      backgroundColor: \"#44b700\",\r\n      color: \"#44b700\",\r\n      boxShadow: `0 0 0 2px ${theme.palette.background.paper}`,\r\n      \"&::after\": {\r\n        position: \"absolute\",\r\n        top: 0,\r\n        left: 0,\r\n        width: \"100%\",\r\n        height: \"100%\",\r\n        borderRadius: \"50%\",\r\n        animation: \"$ripple 1.2s infinite ease-in-out\",\r\n        border: \"1px solid currentColor\",\r\n        content: '\"\"'\r\n      }\r\n    },\r\n    \"@keyframes ripple\": {\r\n      \"0%\": {\r\n        transform: \"scale(.8)\",\r\n        opacity: 1\r\n      },\r\n      \"100%\": {\r\n        transform: \"scale(2.4)\",\r\n        opacity: 0\r\n      }\r\n    }\r\n  })\r\n)(Badge);\r\n\r\nconst OnlineBadge = withStyles((theme: Theme) =>\r\n  createStyles({\r\n    badge: {\r\n      backgroundColor: theme.palette.primary.main,\r\n      boxShadow: `0 0 0 2px ${theme.palette.background.paper}`\r\n    }\r\n  })\r\n)(Badge);\r\n\r\nconst contactAvatar = (\r\n  apiUrl: string,\r\n  contact: Contact,\r\n  typing: SetTyping | null\r\n): JSX.Element => {\r\n  const avatar = (\r\n    <Avatar\r\n      alt={contact.username}\r\n      src={contact.avatar ? combineURLs(apiUrl, contact.avatar) : \"\"}\r\n    />\r\n  );\r\n\r\n  const isTyping = !!typing?.contactId && typing?.userId === contact.userId;\r\n  if (isTyping)\r\n    return (\r\n      <TypingBadge\r\n        overlap=\"circular\"\r\n        anchorOrigin={{\r\n          vertical: \"bottom\",\r\n          horizontal: \"right\"\r\n        }}\r\n        variant=\"dot\"\r\n      >\r\n        {avatar}\r\n      </TypingBadge>\r\n    );\r\n\r\n  if (contact?.online)\r\n    return (\r\n      <OnlineBadge\r\n        overlap=\"circular\"\r\n        anchorOrigin={{\r\n          vertical: \"bottom\",\r\n          horizontal: \"right\"\r\n        }}\r\n        variant=\"dot\"\r\n      >\r\n        {avatar}\r\n      </OnlineBadge>\r\n    );\r\n\r\n  return avatar;\r\n};\r\n\r\nconst RoomListItem: React.FC<RoomListItemProps> = (\r\n  props: RoomListItemProps\r\n) => {\r\n  const classes = useStyles();\r\n  const { t } = useTranslation();\r\n  const { apiUrl, chat, typing } = props;\r\n  const roomName = getChatName(chat);\r\n\r\n  const avatar = (chat as Group).groupId ? (\r\n    <Avatar alt={roomName} className={classes.avatarGroup}>\r\n      <GroupIcon />{\" \"}\r\n    </Avatar>\r\n  ) : (\r\n    contactAvatar(apiUrl, chat as Contact, typing)\r\n  );\r\n\r\n  const lastMessage =\r\n    chat.messages && chat.messages.length > 0\r\n      ? chat.messages[chat.messages.length - 1]\r\n      : null;\r\n\r\n  const roomText = getMessageText(lastMessage, t);\r\n  const roomTime = lastMessage?.cdate;\r\n\r\n  return (\r\n    <ListItem button selected={props.active} onClick={props.onClick}>\r\n      <ListItemAvatar>{avatar}</ListItemAvatar>\r\n      <ListItemText\r\n        secondaryTypographyProps={{ component: \"span\" }}\r\n        primary={\r\n          <Box display=\"flex\" flexDirection=\"row\">\r\n            <span className={classes.main}>{roomName}</span>\r\n            <span className={classes.time}>{formatTime(roomTime)}</span>\r\n          </Box>\r\n        }\r\n        secondary={\r\n          <Box display=\"flex\" flexDirection=\"row\">\r\n            <span className={classes.main}>{roomText}</span>\r\n            {chat.unreadCount ? (\r\n              <Chip\r\n                className={classes.unread}\r\n                component=\"span\"\r\n                size=\"small\"\r\n                color=\"primary\"\r\n                label={chat.unreadCount}\r\n              />\r\n            ) : null}\r\n          </Box>\r\n        }\r\n      />\r\n    </ListItem>\r\n  );\r\n};\r\nexport default RoomListItem;\r\n","import React from \"react\";\r\nimport List from \"@mui/material/List\";\r\nimport { Theme } from \"@mui/material/styles\";\r\n\r\nimport { Card, CardHeader, Divider, TextField } from \"@mui/material\";\r\nimport RoomListItem from \"./RoomListItem\";\r\nimport {\r\n  chatRoomComparer,\r\n  getChatId,\r\n  getChatName,\r\n  isEmpty\r\n} from \"../utils/common\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { ChatRoom, Contact, Group, SetTyping, User } from \"../types\";\r\nimport { makeStyles } from \"@mui/styles\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) => ({\r\n  root: {\r\n    width: \"100%\",\r\n    height: \"100%\"\r\n  },\r\n  searchField: {\r\n    width: \"100%\"\r\n  },\r\n  listStyle: {\r\n    height: \"89.5%\",\r\n    overflowY: \"auto\",\r\n    scrollbarWidth: \"thin\",\r\n    scrollbarColor: `${theme.palette.primary.light} #fff`\r\n  }\r\n}));\r\n\r\ntype RoomListProps = {\r\n  apiUrl: string;\r\n  user: User;\r\n  activeRoom: ChatRoom | null;\r\n  groups: Group[];\r\n  contacts: Contact[];\r\n  typing: SetTyping | null;\r\n  onChangeChat?: (chat: ChatRoom) => void;\r\n};\r\n\r\nconst filterChats = (chats: ChatRoom[], filter: string | null): ChatRoom[] => {\r\n  if (filter === null) return chats;\r\n  const lowerFilter = filter.toLowerCase();\r\n  return chats.filter(\r\n    chat =>\r\n      getChatName(chat)\r\n        .toLowerCase()\r\n        .indexOf(lowerFilter.toLowerCase()) !== -1\r\n  );\r\n};\r\n\r\nconst sortChats = (\r\n  userId: number,\r\n  groups: ChatRoom[],\r\n  contacts: ChatRoom[]\r\n) => {\r\n  let roomArr = [...groups, ...contacts];\r\n  //console.log('groups', groups, 'contacts', contacts);\r\n\r\n  // Сортировать окно чата (по времени последних сообщений)\r\n  roomArr = roomArr.sort(chatRoomComparer);\r\n\r\n  // Проверяем, есть ли список, который нужно закрепить\r\n  const topChatId = localStorage.getItem(`${userId}-topChatId`) as string;\r\n  if (topChatId) {\r\n    const chat = roomArr.find(c => getChatId(c) === topChatId);\r\n    if (chat) {\r\n      // На первое место\r\n      roomArr = roomArr.filter(k => getChatId(k) !== topChatId);\r\n      chat.isTop = true;\r\n      roomArr.unshift(chat);\r\n    }\r\n  }\r\n\r\n  return roomArr;\r\n};\r\n\r\nconst RoomList: React.FC<RoomListProps> = (props: RoomListProps) => {\r\n  const classes = useStyles();\r\n  const { t } = useTranslation();\r\n\r\n  const [chats, setChats] = React.useState<ChatRoom[]>(\r\n    sortChats(\r\n      props.user.userId,\r\n      filterChats(props.groups, null),\r\n      filterChats(props.contacts, null)\r\n    )\r\n  );\r\n\r\n  const onSearchChange = (e: React.ChangeEvent<HTMLInputElement>): void => {\r\n    //console.log(\"e.target.value\", e.target.value);\r\n\r\n    setChats(\r\n      sortChats(\r\n        props.user.userId,\r\n        filterChats(props.groups, e.target.value),\r\n        filterChats(props.contacts, e.target.value)\r\n      )\r\n    );\r\n  };\r\n  //const activeItem = (id: number) => id === props.activeRoom?.userId;\r\n\r\n  //console.log(\"chats\", chats);\r\n\r\n  return (\r\n    <Card elevation={1} className={classes.root}>\r\n      <CardHeader\r\n        title={\r\n          <TextField\r\n            className={classes.searchField}\r\n            label={t(\"CHAT.INPUT_SEARCH_CONTACT\")}\r\n            variant=\"outlined\"\r\n            size=\"small\"\r\n            fullWidth\r\n            onChange={onSearchChange}\r\n          />\r\n        }\r\n      />\r\n      <Divider />\r\n      <List aria-label=\"rooms\" className={classes.listStyle}>\r\n        {!isEmpty(chats) &&\r\n          chats.map(\r\n            chat =>\r\n              !isEmpty(chat) && (\r\n                <RoomListItem\r\n                  key={getChatId(chat)}\r\n                  apiUrl={props.apiUrl}\r\n                  chat={chat}\r\n                  active={chat === props.activeRoom}\r\n                  typing={props.typing}\r\n                  onClick={() =>\r\n                    props.onChangeChat != null && props.onChangeChat(chat)\r\n                  }\r\n                />\r\n              )\r\n          )}\r\n      </List>\r\n    </Card>\r\n  );\r\n};\r\nexport default RoomList;\r\n","import React, { useEffect } from \"react\";\r\nimport { makeStyles } from \"@mui/styles\";\r\nimport { ConferenceData } from \"../types\";\r\nfunction updateUrlParameter(url: string, param: string, value: string) {\r\n  const regex = new RegExp(\"(\" + param + \"=)[^&]+\");\r\n  return url.replace(regex, \"$1\" + value);\r\n}\r\nconst transLang = (lang: string) =>\r\n  lang === \"ru\" ? \"rus\" : lang === \"fr\" ? \"fra\" : lang === \"en\" ? \"eng\" : \"\";\r\n\r\nconst useStyles = makeStyles(() => ({\r\n  root: {\r\n    width: \"100%\",\r\n    height: \"100%\",\r\n    borderRadius: 4\r\n  }\r\n}));\r\n\r\ntype ConferenceProps = {\r\n  conference: ConferenceData | null;\r\n  onClose: (conference: ConferenceData | null) => void;\r\n  langCode?: string | null;\r\n};\r\n\r\nconst Conference: React.FC<ConferenceProps> = ({\r\n  conference,\r\n  onClose,\r\n  langCode = \"en\"\r\n}: ConferenceProps) => {\r\n  const classes = useStyles();\r\n  const ref = React.useRef<HTMLIFrameElement>(null);\r\n  const confUrl =\r\n    conference?.url && langCode\r\n      ? updateUrlParameter(conference?.url, \"lang\", transLang(langCode))\r\n      : \"\";\r\n\r\n  useEffect(() => {\r\n    const listener = ({ source, data }: MessageEvent) => {\r\n      if (source === ref.current?.contentWindow) {\r\n        const { type } = data;\r\n\r\n        if (\r\n          [\r\n            \"notSupported\",\r\n            \"connectionFail\",\r\n            // \"loginFail\",\r\n            \"callFail\",\r\n            \"hangUp\",\r\n            \"remoteHangUp\"\r\n            // \"onParticipantLeft\"\r\n          ].includes(type)\r\n        )\r\n          onClose(conference);\r\n      }\r\n    };\r\n    window.addEventListener(\"message\", listener);\r\n    return () => {\r\n      window.removeEventListener(\"message\", listener);\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [conference?.id, langCode]);\r\n\r\n  return (\r\n    <iframe\r\n      title=\"conference\"\r\n      className={classes.root}\r\n      src={confUrl}\r\n      allowFullScreen\r\n      allow=\"microphone; camera; autoplay; display-capture\"\r\n      ref={ref}\r\n    />\r\n  );\r\n};\r\nexport default Conference;\r\n","import React from \"react\";\r\nimport { Avatar, Button, Paper } from \"@mui/material\";\r\nimport { ConferenceData, Contact } from \"../types\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { makeStyles } from \"@mui/styles\";\r\nimport { combineURLs } from \"../utils/common\";\r\n\r\nconst useStyles = makeStyles(() => ({\r\n  root: {\r\n    width: \"100%\",\r\n    height: \"100%\",\r\n    borderRadius: 8,\r\n    display: \"flex\",\r\n    flexDirection: \"column\",\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\"\r\n  },\r\n  pulse: {\r\n    height: 100,\r\n    width: 100,\r\n    borderRadius: \"50%\",\r\n    display: \"flex\",\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n    position: \"relative\",\r\n    \"&::before\": {\r\n      content: \"''\",\r\n      position: \"absolute\",\r\n      border: \"1px solid green\",\r\n      width: \"calc(100% + 40px)\",\r\n      height: \"calc(100% + 40px)\",\r\n      borderRadius: \"50%\",\r\n      animation: \"$pulse 1s linear infinite\"\r\n    },\r\n    \"&::after\": {\r\n      content: \"''\",\r\n      position: \"absolute\",\r\n      border: \"1px solid green\",\r\n      width: \"calc(100% + 40px)\",\r\n      height: \"calc(100% + 40px)\",\r\n      borderRadius: \"50%\",\r\n      animation: \"$pulse 1s linear infinite\",\r\n      animationDelay: \"0.3s\"\r\n    }\r\n  },\r\n  avatar: {\r\n    width: \"80%\",\r\n    height: \"80%\"\r\n  },\r\n  footer: {\r\n    width: \"100%\",\r\n    alignSelf: \"flex-end\",\r\n    paddingTop: 64,\r\n    display: \"flex\",\r\n    justifyContent: \"center\"\r\n  },\r\n  \"@keyframes pulse\": {\r\n    \"0%\": {\r\n      transform: \"scale(0.5)\",\r\n      opacity: 0\r\n    },\r\n    \"50%\": {\r\n      transform: \"scale(1)\",\r\n      opacity: 1\r\n    },\r\n    \"100%\": {\r\n      transform: \"scale(1.3)\",\r\n      opacity: 0\r\n    }\r\n  }\r\n}));\r\n\r\ntype ConferenceCallProps = {\r\n  conference: ConferenceData;\r\n  contact: Contact;\r\n  apiUrl: string;\r\n  onAccept: (conference: ConferenceData) => void;\r\n};\r\n\r\nconst ConferenceCall: React.FC<ConferenceCallProps> = ({\r\n  conference,\r\n  contact,\r\n  apiUrl,\r\n  onAccept\r\n}: ConferenceCallProps) => {\r\n  const classes = useStyles();\r\n  const { t } = useTranslation();\r\n\r\n  return (\r\n    <Paper className={classes.root}>\r\n      <div className={classes.pulse}>\r\n        {contact ? (\r\n          <Avatar\r\n            className={classes.avatar}\r\n            alt={contact.username}\r\n            src={contact.avatar ? combineURLs(apiUrl, contact.avatar) : \"\"}\r\n          />\r\n        ) : (\r\n          <Avatar className={classes.avatar} />\r\n        )}\r\n      </div>\r\n      <div className={classes.footer}>\r\n        <Button\r\n          variant=\"contained\"\r\n          color=\"primary\"\r\n          onClick={() => onAccept(conference)}\r\n        >\r\n          {t(\"CHAT.CONFERENCE.JOIN\")}\r\n        </Button>\r\n      </div>\r\n    </Paper>\r\n  );\r\n};\r\n\r\nexport default ConferenceCall;\r\n","/**\n * Copyright (c) 2014-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nvar runtime = (function (exports) {\n  \"use strict\";\n\n  var Op = Object.prototype;\n  var hasOwn = Op.hasOwnProperty;\n  var undefined; // More compressible than void 0.\n  var $Symbol = typeof Symbol === \"function\" ? Symbol : {};\n  var iteratorSymbol = $Symbol.iterator || \"@@iterator\";\n  var asyncIteratorSymbol = $Symbol.asyncIterator || \"@@asyncIterator\";\n  var toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\";\n\n  function define(obj, key, value) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n    return obj[key];\n  }\n  try {\n    // IE 8 has a broken Object.defineProperty that only works on DOM objects.\n    define({}, \"\");\n  } catch (err) {\n    define = function(obj, key, value) {\n      return obj[key] = value;\n    };\n  }\n\n  function wrap(innerFn, outerFn, self, tryLocsList) {\n    // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.\n    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;\n    var generator = Object.create(protoGenerator.prototype);\n    var context = new Context(tryLocsList || []);\n\n    // The ._invoke method unifies the implementations of the .next,\n    // .throw, and .return methods.\n    generator._invoke = makeInvokeMethod(innerFn, self, context);\n\n    return generator;\n  }\n  exports.wrap = wrap;\n\n  // Try/catch helper to minimize deoptimizations. Returns a completion\n  // record like context.tryEntries[i].completion. This interface could\n  // have been (and was previously) designed to take a closure to be\n  // invoked without arguments, but in all the cases we care about we\n  // already have an existing method we want to call, so there's no need\n  // to create a new function object. We can even get away with assuming\n  // the method takes exactly one argument, since that happens to be true\n  // in every case, so we don't have to touch the arguments object. The\n  // only additional allocation required is the completion record, which\n  // has a stable shape and so hopefully should be cheap to allocate.\n  function tryCatch(fn, obj, arg) {\n    try {\n      return { type: \"normal\", arg: fn.call(obj, arg) };\n    } catch (err) {\n      return { type: \"throw\", arg: err };\n    }\n  }\n\n  var GenStateSuspendedStart = \"suspendedStart\";\n  var GenStateSuspendedYield = \"suspendedYield\";\n  var GenStateExecuting = \"executing\";\n  var GenStateCompleted = \"completed\";\n\n  // Returning this object from the innerFn has the same effect as\n  // breaking out of the dispatch switch statement.\n  var ContinueSentinel = {};\n\n  // Dummy constructor functions that we use as the .constructor and\n  // .constructor.prototype properties for functions that return Generator\n  // objects. For full spec compliance, you may wish to configure your\n  // minifier not to mangle the names of these two functions.\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n\n  // This is a polyfill for %IteratorPrototype% for environments that\n  // don't natively support it.\n  var IteratorPrototype = {};\n  define(IteratorPrototype, iteratorSymbol, function () {\n    return this;\n  });\n\n  var getProto = Object.getPrototypeOf;\n  var NativeIteratorPrototype = getProto && getProto(getProto(values([])));\n  if (NativeIteratorPrototype &&\n      NativeIteratorPrototype !== Op &&\n      hasOwn.call(NativeIteratorPrototype, iteratorSymbol)) {\n    // This environment has a native %IteratorPrototype%; use it instead\n    // of the polyfill.\n    IteratorPrototype = NativeIteratorPrototype;\n  }\n\n  var Gp = GeneratorFunctionPrototype.prototype =\n    Generator.prototype = Object.create(IteratorPrototype);\n  GeneratorFunction.prototype = GeneratorFunctionPrototype;\n  define(Gp, \"constructor\", GeneratorFunctionPrototype);\n  define(GeneratorFunctionPrototype, \"constructor\", GeneratorFunction);\n  GeneratorFunction.displayName = define(\n    GeneratorFunctionPrototype,\n    toStringTagSymbol,\n    \"GeneratorFunction\"\n  );\n\n  // Helper for defining the .next, .throw, and .return methods of the\n  // Iterator interface in terms of a single ._invoke method.\n  function defineIteratorMethods(prototype) {\n    [\"next\", \"throw\", \"return\"].forEach(function(method) {\n      define(prototype, method, function(arg) {\n        return this._invoke(method, arg);\n      });\n    });\n  }\n\n  exports.isGeneratorFunction = function(genFun) {\n    var ctor = typeof genFun === \"function\" && genFun.constructor;\n    return ctor\n      ? ctor === GeneratorFunction ||\n        // For the native GeneratorFunction constructor, the best we can\n        // do is to check its .name property.\n        (ctor.displayName || ctor.name) === \"GeneratorFunction\"\n      : false;\n  };\n\n  exports.mark = function(genFun) {\n    if (Object.setPrototypeOf) {\n      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);\n    } else {\n      genFun.__proto__ = GeneratorFunctionPrototype;\n      define(genFun, toStringTagSymbol, \"GeneratorFunction\");\n    }\n    genFun.prototype = Object.create(Gp);\n    return genFun;\n  };\n\n  // Within the body of any async function, `await x` is transformed to\n  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test\n  // `hasOwn.call(value, \"__await\")` to determine if the yielded value is\n  // meant to be awaited.\n  exports.awrap = function(arg) {\n    return { __await: arg };\n  };\n\n  function AsyncIterator(generator, PromiseImpl) {\n    function invoke(method, arg, resolve, reject) {\n      var record = tryCatch(generator[method], generator, arg);\n      if (record.type === \"throw\") {\n        reject(record.arg);\n      } else {\n        var result = record.arg;\n        var value = result.value;\n        if (value &&\n            typeof value === \"object\" &&\n            hasOwn.call(value, \"__await\")) {\n          return PromiseImpl.resolve(value.__await).then(function(value) {\n            invoke(\"next\", value, resolve, reject);\n          }, function(err) {\n            invoke(\"throw\", err, resolve, reject);\n          });\n        }\n\n        return PromiseImpl.resolve(value).then(function(unwrapped) {\n          // When a yielded Promise is resolved, its final value becomes\n          // the .value of the Promise<{value,done}> result for the\n          // current iteration.\n          result.value = unwrapped;\n          resolve(result);\n        }, function(error) {\n          // If a rejected Promise was yielded, throw the rejection back\n          // into the async generator function so it can be handled there.\n          return invoke(\"throw\", error, resolve, reject);\n        });\n      }\n    }\n\n    var previousPromise;\n\n    function enqueue(method, arg) {\n      function callInvokeWithMethodAndArg() {\n        return new PromiseImpl(function(resolve, reject) {\n          invoke(method, arg, resolve, reject);\n        });\n      }\n\n      return previousPromise =\n        // If enqueue has been called before, then we want to wait until\n        // all previous Promises have been resolved before calling invoke,\n        // so that results are always delivered in the correct order. If\n        // enqueue has not been called before, then it is important to\n        // call invoke immediately, without waiting on a callback to fire,\n        // so that the async generator function has the opportunity to do\n        // any necessary setup in a predictable way. This predictability\n        // is why the Promise constructor synchronously invokes its\n        // executor callback, and why async functions synchronously\n        // execute code before the first await. Since we implement simple\n        // async functions in terms of async generators, it is especially\n        // important to get this right, even though it requires care.\n        previousPromise ? previousPromise.then(\n          callInvokeWithMethodAndArg,\n          // Avoid propagating failures to Promises returned by later\n          // invocations of the iterator.\n          callInvokeWithMethodAndArg\n        ) : callInvokeWithMethodAndArg();\n    }\n\n    // Define the unified helper method that is used to implement .next,\n    // .throw, and .return (see defineIteratorMethods).\n    this._invoke = enqueue;\n  }\n\n  defineIteratorMethods(AsyncIterator.prototype);\n  define(AsyncIterator.prototype, asyncIteratorSymbol, function () {\n    return this;\n  });\n  exports.AsyncIterator = AsyncIterator;\n\n  // Note that simple async functions are implemented on top of\n  // AsyncIterator objects; they just return a Promise for the value of\n  // the final result produced by the iterator.\n  exports.async = function(innerFn, outerFn, self, tryLocsList, PromiseImpl) {\n    if (PromiseImpl === void 0) PromiseImpl = Promise;\n\n    var iter = new AsyncIterator(\n      wrap(innerFn, outerFn, self, tryLocsList),\n      PromiseImpl\n    );\n\n    return exports.isGeneratorFunction(outerFn)\n      ? iter // If outerFn is a generator, return the full iterator.\n      : iter.next().then(function(result) {\n          return result.done ? result.value : iter.next();\n        });\n  };\n\n  function makeInvokeMethod(innerFn, self, context) {\n    var state = GenStateSuspendedStart;\n\n    return function invoke(method, arg) {\n      if (state === GenStateExecuting) {\n        throw new Error(\"Generator is already running\");\n      }\n\n      if (state === GenStateCompleted) {\n        if (method === \"throw\") {\n          throw arg;\n        }\n\n        // Be forgiving, per 25.3.3.3.3 of the spec:\n        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume\n        return doneResult();\n      }\n\n      context.method = method;\n      context.arg = arg;\n\n      while (true) {\n        var delegate = context.delegate;\n        if (delegate) {\n          var delegateResult = maybeInvokeDelegate(delegate, context);\n          if (delegateResult) {\n            if (delegateResult === ContinueSentinel) continue;\n            return delegateResult;\n          }\n        }\n\n        if (context.method === \"next\") {\n          // Setting context._sent for legacy support of Babel's\n          // function.sent implementation.\n          context.sent = context._sent = context.arg;\n\n        } else if (context.method === \"throw\") {\n          if (state === GenStateSuspendedStart) {\n            state = GenStateCompleted;\n            throw context.arg;\n          }\n\n          context.dispatchException(context.arg);\n\n        } else if (context.method === \"return\") {\n          context.abrupt(\"return\", context.arg);\n        }\n\n        state = GenStateExecuting;\n\n        var record = tryCatch(innerFn, self, context);\n        if (record.type === \"normal\") {\n          // If an exception is thrown from innerFn, we leave state ===\n          // GenStateExecuting and loop back for another invocation.\n          state = context.done\n            ? GenStateCompleted\n            : GenStateSuspendedYield;\n\n          if (record.arg === ContinueSentinel) {\n            continue;\n          }\n\n          return {\n            value: record.arg,\n            done: context.done\n          };\n\n        } else if (record.type === \"throw\") {\n          state = GenStateCompleted;\n          // Dispatch the exception by looping back around to the\n          // context.dispatchException(context.arg) call above.\n          context.method = \"throw\";\n          context.arg = record.arg;\n        }\n      }\n    };\n  }\n\n  // Call delegate.iterator[context.method](context.arg) and handle the\n  // result, either by returning a { value, done } result from the\n  // delegate iterator, or by modifying context.method and context.arg,\n  // setting context.delegate to null, and returning the ContinueSentinel.\n  function maybeInvokeDelegate(delegate, context) {\n    var method = delegate.iterator[context.method];\n    if (method === undefined) {\n      // A .throw or .return when the delegate iterator has no .throw\n      // method always terminates the yield* loop.\n      context.delegate = null;\n\n      if (context.method === \"throw\") {\n        // Note: [\"return\"] must be used for ES3 parsing compatibility.\n        if (delegate.iterator[\"return\"]) {\n          // If the delegate iterator has a return method, give it a\n          // chance to clean up.\n          context.method = \"return\";\n          context.arg = undefined;\n          maybeInvokeDelegate(delegate, context);\n\n          if (context.method === \"throw\") {\n            // If maybeInvokeDelegate(context) changed context.method from\n            // \"return\" to \"throw\", let that override the TypeError below.\n            return ContinueSentinel;\n          }\n        }\n\n        context.method = \"throw\";\n        context.arg = new TypeError(\n          \"The iterator does not provide a 'throw' method\");\n      }\n\n      return ContinueSentinel;\n    }\n\n    var record = tryCatch(method, delegate.iterator, context.arg);\n\n    if (record.type === \"throw\") {\n      context.method = \"throw\";\n      context.arg = record.arg;\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    var info = record.arg;\n\n    if (! info) {\n      context.method = \"throw\";\n      context.arg = new TypeError(\"iterator result is not an object\");\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    if (info.done) {\n      // Assign the result of the finished delegate to the temporary\n      // variable specified by delegate.resultName (see delegateYield).\n      context[delegate.resultName] = info.value;\n\n      // Resume execution at the desired location (see delegateYield).\n      context.next = delegate.nextLoc;\n\n      // If context.method was \"throw\" but the delegate handled the\n      // exception, let the outer generator proceed normally. If\n      // context.method was \"next\", forget context.arg since it has been\n      // \"consumed\" by the delegate iterator. If context.method was\n      // \"return\", allow the original .return call to continue in the\n      // outer generator.\n      if (context.method !== \"return\") {\n        context.method = \"next\";\n        context.arg = undefined;\n      }\n\n    } else {\n      // Re-yield the result returned by the delegate method.\n      return info;\n    }\n\n    // The delegate iterator is finished, so forget it and continue with\n    // the outer generator.\n    context.delegate = null;\n    return ContinueSentinel;\n  }\n\n  // Define Generator.prototype.{next,throw,return} in terms of the\n  // unified ._invoke helper method.\n  defineIteratorMethods(Gp);\n\n  define(Gp, toStringTagSymbol, \"Generator\");\n\n  // A Generator should always return itself as the iterator object when the\n  // @@iterator function is called on it. Some browsers' implementations of the\n  // iterator prototype chain incorrectly implement this, causing the Generator\n  // object to not be returned from this call. This ensures that doesn't happen.\n  // See https://github.com/facebook/regenerator/issues/274 for more details.\n  define(Gp, iteratorSymbol, function() {\n    return this;\n  });\n\n  define(Gp, \"toString\", function() {\n    return \"[object Generator]\";\n  });\n\n  function pushTryEntry(locs) {\n    var entry = { tryLoc: locs[0] };\n\n    if (1 in locs) {\n      entry.catchLoc = locs[1];\n    }\n\n    if (2 in locs) {\n      entry.finallyLoc = locs[2];\n      entry.afterLoc = locs[3];\n    }\n\n    this.tryEntries.push(entry);\n  }\n\n  function resetTryEntry(entry) {\n    var record = entry.completion || {};\n    record.type = \"normal\";\n    delete record.arg;\n    entry.completion = record;\n  }\n\n  function Context(tryLocsList) {\n    // The root entry object (effectively a try statement without a catch\n    // or a finally block) gives us a place to store values thrown from\n    // locations where there is no enclosing try statement.\n    this.tryEntries = [{ tryLoc: \"root\" }];\n    tryLocsList.forEach(pushTryEntry, this);\n    this.reset(true);\n  }\n\n  exports.keys = function(object) {\n    var keys = [];\n    for (var key in object) {\n      keys.push(key);\n    }\n    keys.reverse();\n\n    // Rather than returning an object with a next method, we keep\n    // things simple and return the next function itself.\n    return function next() {\n      while (keys.length) {\n        var key = keys.pop();\n        if (key in object) {\n          next.value = key;\n          next.done = false;\n          return next;\n        }\n      }\n\n      // To avoid creating an additional object, we just hang the .value\n      // and .done properties off the next function object itself. This\n      // also ensures that the minifier will not anonymize the function.\n      next.done = true;\n      return next;\n    };\n  };\n\n  function values(iterable) {\n    if (iterable) {\n      var iteratorMethod = iterable[iteratorSymbol];\n      if (iteratorMethod) {\n        return iteratorMethod.call(iterable);\n      }\n\n      if (typeof iterable.next === \"function\") {\n        return iterable;\n      }\n\n      if (!isNaN(iterable.length)) {\n        var i = -1, next = function next() {\n          while (++i < iterable.length) {\n            if (hasOwn.call(iterable, i)) {\n              next.value = iterable[i];\n              next.done = false;\n              return next;\n            }\n          }\n\n          next.value = undefined;\n          next.done = true;\n\n          return next;\n        };\n\n        return next.next = next;\n      }\n    }\n\n    // Return an iterator with no values.\n    return { next: doneResult };\n  }\n  exports.values = values;\n\n  function doneResult() {\n    return { value: undefined, done: true };\n  }\n\n  Context.prototype = {\n    constructor: Context,\n\n    reset: function(skipTempReset) {\n      this.prev = 0;\n      this.next = 0;\n      // Resetting context._sent for legacy support of Babel's\n      // function.sent implementation.\n      this.sent = this._sent = undefined;\n      this.done = false;\n      this.delegate = null;\n\n      this.method = \"next\";\n      this.arg = undefined;\n\n      this.tryEntries.forEach(resetTryEntry);\n\n      if (!skipTempReset) {\n        for (var name in this) {\n          // Not sure about the optimal order of these conditions:\n          if (name.charAt(0) === \"t\" &&\n              hasOwn.call(this, name) &&\n              !isNaN(+name.slice(1))) {\n            this[name] = undefined;\n          }\n        }\n      }\n    },\n\n    stop: function() {\n      this.done = true;\n\n      var rootEntry = this.tryEntries[0];\n      var rootRecord = rootEntry.completion;\n      if (rootRecord.type === \"throw\") {\n        throw rootRecord.arg;\n      }\n\n      return this.rval;\n    },\n\n    dispatchException: function(exception) {\n      if (this.done) {\n        throw exception;\n      }\n\n      var context = this;\n      function handle(loc, caught) {\n        record.type = \"throw\";\n        record.arg = exception;\n        context.next = loc;\n\n        if (caught) {\n          // If the dispatched exception was caught by a catch block,\n          // then let that catch block handle the exception normally.\n          context.method = \"next\";\n          context.arg = undefined;\n        }\n\n        return !! caught;\n      }\n\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        var record = entry.completion;\n\n        if (entry.tryLoc === \"root\") {\n          // Exception thrown outside of any try block that could handle\n          // it, so set the completion value of the entire function to\n          // throw the exception.\n          return handle(\"end\");\n        }\n\n        if (entry.tryLoc <= this.prev) {\n          var hasCatch = hasOwn.call(entry, \"catchLoc\");\n          var hasFinally = hasOwn.call(entry, \"finallyLoc\");\n\n          if (hasCatch && hasFinally) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            } else if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else if (hasCatch) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            }\n\n          } else if (hasFinally) {\n            if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else {\n            throw new Error(\"try statement without catch or finally\");\n          }\n        }\n      }\n    },\n\n    abrupt: function(type, arg) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc <= this.prev &&\n            hasOwn.call(entry, \"finallyLoc\") &&\n            this.prev < entry.finallyLoc) {\n          var finallyEntry = entry;\n          break;\n        }\n      }\n\n      if (finallyEntry &&\n          (type === \"break\" ||\n           type === \"continue\") &&\n          finallyEntry.tryLoc <= arg &&\n          arg <= finallyEntry.finallyLoc) {\n        // Ignore the finally entry if control is not jumping to a\n        // location outside the try/catch block.\n        finallyEntry = null;\n      }\n\n      var record = finallyEntry ? finallyEntry.completion : {};\n      record.type = type;\n      record.arg = arg;\n\n      if (finallyEntry) {\n        this.method = \"next\";\n        this.next = finallyEntry.finallyLoc;\n        return ContinueSentinel;\n      }\n\n      return this.complete(record);\n    },\n\n    complete: function(record, afterLoc) {\n      if (record.type === \"throw\") {\n        throw record.arg;\n      }\n\n      if (record.type === \"break\" ||\n          record.type === \"continue\") {\n        this.next = record.arg;\n      } else if (record.type === \"return\") {\n        this.rval = this.arg = record.arg;\n        this.method = \"return\";\n        this.next = \"end\";\n      } else if (record.type === \"normal\" && afterLoc) {\n        this.next = afterLoc;\n      }\n\n      return ContinueSentinel;\n    },\n\n    finish: function(finallyLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.finallyLoc === finallyLoc) {\n          this.complete(entry.completion, entry.afterLoc);\n          resetTryEntry(entry);\n          return ContinueSentinel;\n        }\n      }\n    },\n\n    \"catch\": function(tryLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc === tryLoc) {\n          var record = entry.completion;\n          if (record.type === \"throw\") {\n            var thrown = record.arg;\n            resetTryEntry(entry);\n          }\n          return thrown;\n        }\n      }\n\n      // The context.catch method must only be called with a location\n      // argument that corresponds to a known catch block.\n      throw new Error(\"illegal catch attempt\");\n    },\n\n    delegateYield: function(iterable, resultName, nextLoc) {\n      this.delegate = {\n        iterator: values(iterable),\n        resultName: resultName,\n        nextLoc: nextLoc\n      };\n\n      if (this.method === \"next\") {\n        // Deliberately forget the last sent value so that we don't\n        // accidentally pass it on to the delegate.\n        this.arg = undefined;\n      }\n\n      return ContinueSentinel;\n    }\n  };\n\n  // Regardless of whether this script is executing as a CommonJS module\n  // or not, return the runtime object so that we can declare the variable\n  // regeneratorRuntime in the outer scope, which allows this module to be\n  // injected easily by `bin/regenerator --include-runtime script.js`.\n  return exports;\n\n}(\n  // If this script is executing as a CommonJS module, use module.exports\n  // as the regeneratorRuntime namespace. Otherwise create a new empty\n  // object. Either way, the resulting object will be used to initialize\n  // the regeneratorRuntime variable at the top of this file.\n  typeof module === \"object\" ? module.exports : {}\n));\n\ntry {\n  regeneratorRuntime = runtime;\n} catch (accidentalStrictMode) {\n  // This module should not be running in strict mode, so the above\n  // assignment should always work unless something is misconfigured. Just\n  // in case runtime.js accidentally runs in strict mode, in modern engines\n  // we can explicitly access globalThis. In older engines we can escape\n  // strict mode using a global Function call. This could conceivably fail\n  // if a Content Security Policy forbids using Function, but in that case\n  // the proper solution is to fix the accidental strict mode problem. If\n  // you've misconfigured your bundler to force strict mode and applied a\n  // CSP to forbid Function, and you're not willing to fix either of those\n  // problems, please detail your unique predicament in a GitHub issue.\n  if (typeof globalThis === \"object\") {\n    globalThis.regeneratorRuntime = runtime;\n  } else {\n    Function(\"r\", \"regeneratorRuntime = r\")(runtime);\n  }\n}\n","import React from 'react';\r\nimport {\r\n  AddGroupMessages,\r\n  AddPrivateMessages,\r\n  ChatRoom,\r\n  Contact,\r\n  ContactGather,\r\n  Group,\r\n  GroupGather,\r\n  GroupMember,\r\n  GroupMessage,\r\n  MessageOperation,\r\n  PrivateMessage,\r\n  SetActiveRoom,\r\n  //SetUser,\r\n  SetTyping,\r\n  User,\r\n  ConferenceData,\r\n  GroupMap,\r\n  VisitData,\r\n} from '../types';\r\nimport { chatRoomComparer } from '../utils/common';\r\n\r\nexport interface ChatState {\r\n  user: User;\r\n  token: string;\r\n  refreshToken: string;\r\n  activeRoom: ChatRoom | null;\r\n  chatOld: ChatRoom | null;\r\n\r\n  groupGather: GroupGather;\r\n  userGather: ContactGather;\r\n  contactGather: ContactGather;\r\n  operators: Contact[];\r\n  initialContactId: number | null;\r\n  conference: {\r\n    data: ConferenceData | null;\r\n    joined: boolean;\r\n    ringPlayed: boolean;\r\n  };\r\n  typing: SetTyping | null;\r\n  loading: boolean;\r\n  error?: string;\r\n  success?: string;\r\n  visitData: VisitData[];\r\n}\r\n\r\nconst emptyUser: User = {\r\n  userId: 0,\r\n  username: '',\r\n  password: '',\r\n  avatar: '',\r\n  langCode: '',\r\n};\r\n\r\nconst emptyChatState: ChatState = {\r\n  user: emptyUser, // пользователь\r\n  token: '', // токен\r\n  refreshToken: '',\r\n  activeRoom: null, // активная комната\r\n  chatOld: null, // активная комната\r\n\r\n  groupGather: {}, // список групп\r\n  userGather: {}, // список онлайн\r\n  contactGather: {}, // контакты\r\n  operators: [], // операторы\r\n  initialContactId: null, // начальный контакт\r\n  conference: {\r\n    data: null, // данные конференции\r\n    joined: false,\r\n    ringPlayed: false,\r\n  },\r\n  typing: null, // кто печатает текст\r\n  loading: false, // загрузка данных\r\n  error: undefined, // ошибка\r\n  success: undefined, // НЕ ошибка\r\n  visitData: [],\r\n};\r\n\r\ntype ChatActionType =\r\n  | 'ADD_GROUP_MEMBER'\r\n  | 'ADD_GROUP_MESSAGE'\r\n  | 'ADD_GROUP_MESSAGES'\r\n  | 'SET_GROUP_MESSAGES'\r\n  | 'ADD_PRIVATE_MESSAGE'\r\n  | 'ADD_PRIVATE_MESSAGES'\r\n  | 'SET_PRIVATE_MESSAGES'\r\n  | 'SET_ACTIVE_ROOM'\r\n  | 'UPDATE_ACTIVE_ROOM'\r\n  | 'SET_GROUP_GATHER'\r\n  | 'SET_CONTACT_GATHER'\r\n  | 'SET_USER_GATHER'\r\n  | 'DEL_GROUP'\r\n  | 'DEL_GROUP_MEMBER'\r\n  | 'DEL_CONTACT'\r\n  | 'ADD_CONTACT_UNREAD_GATHER'\r\n  | 'LOSE_CONTACT_UNREAD_GATHER'\r\n  | 'ADD_GROUP_UNREAD_GATHER'\r\n  | 'LOSE_GROUP_UNREAD_GATHER'\r\n  | 'REVOKE_MESSAGE'\r\n  | 'USER_ONLINE'\r\n  | 'USER_OFFLINE'\r\n  | 'UPDATE_USER_INFO'\r\n  | 'SET_INITIAL_CONTACT_ID'\r\n  | 'SET_CONFERENCE'\r\n  | 'JOIN_CONFERENCE'\r\n  | 'PAUSE_CONFERENCE'\r\n  | 'STOP_CONFERENCE'\r\n  | 'SET_TYPING'\r\n  | 'MARK_AS_READ'\r\n  | 'UPDATE_GROUP_INFO'\r\n  | 'MARK_PRIVATE_MESSAGES_READ'\r\n  | 'SET_LOADING'\r\n  | 'SET_ERROR'\r\n  | 'SET_SUCCES'\r\n  | 'SET_USER'\r\n  | 'SET_TOKEN'\r\n  | 'CLEAR_USER'\r\n  | 'CLEAR_CHAT_DATA'\r\n  | 'SET_OPERATORS'\r\n  | 'SET_VISIT_DATA';\r\n\r\ntype Action = {\r\n  type: ChatActionType;\r\n  payload?:\r\n    | null\r\n    | boolean\r\n    | number\r\n    | string\r\n    | Group\r\n    | Contact\r\n    | User\r\n    | PrivateMessage\r\n    | GroupMessage\r\n    | SetTyping\r\n    | MessageOperation\r\n    | GroupMember\r\n    | AddPrivateMessages\r\n    | AddGroupMessages\r\n    | SetActiveRoom\r\n    | ConferenceData\r\n    | Contact[]\r\n    | GroupMap\r\n    | VisitData[];\r\n};\r\n\r\nconst getFreshActiveRoom = (state: ChatState) => {\r\n  if (state.activeRoom)\r\n    return (\r\n      state.groupGather[(state.activeRoom as Group).groupId] ||\r\n      state.contactGather[state.activeRoom.userId]\r\n    );\r\n  return null;\r\n};\r\n\r\nconst getActiveRoom = (state: ChatState) => {\r\n  const { activeRoom, initialContactId, contactGather } = state;\r\n  let newActiveRoom: ChatRoom | null = null;\r\n  if (initialContactId) {\r\n    newActiveRoom = contactGather[initialContactId];\r\n  } else if (activeRoom) {\r\n    newActiveRoom = getFreshActiveRoom(state);\r\n  } else {\r\n    // ищем комнату с самым свежим сообщением\r\n    const rooms = [\r\n      ...Object.values(state.contactGather),\r\n      ...Object.values(state.groupGather),\r\n    ].sort(chatRoomComparer);\r\n    if (rooms.length > 0) newActiveRoom = rooms[0];\r\n  }\r\n  return newActiveRoom;\r\n};\r\n\r\nconst setUserOnline = (\r\n  state: ChatState,\r\n  userId: number,\r\n  online: 0 | 1,\r\n): ChatState => {\r\n  const newState = { ...state };\r\n  // Обновить статусы приватных чатов\r\n  if (state.contactGather[userId])\r\n    newState.contactGather[userId] = {\r\n      ...newState.contactGather[userId],\r\n      online,\r\n    };\r\n\r\n  // Обновить статус участника в группах\r\n  for (const group of Object.values(state.groupGather) as Group[]) {\r\n    if (!group.members) continue;\r\n    const member = group.members.find(m => m.userId === userId);\r\n    if (member) {\r\n      const index = group.members.indexOf(member);\r\n      group.members[index] = { ...member, online };\r\n    }\r\n  }\r\n  // Обновить статус операторов\r\n  const idx = newState.operators.findIndex(\r\n    it => it.userId === userId,\r\n  );\r\n  if (idx !== -1)\r\n    newState.operators[idx] = { ...newState.operators[idx], online };\r\n  // обновляем активный чат\r\n  newState.activeRoom = getFreshActiveRoom(newState);\r\n  return newState;\r\n};\r\n\r\nconst addGroupMessage = (state: ChatState, payload: GroupMessage) => {\r\n  const newState = { ...state };\r\n  const { groupId } = payload;\r\n  if (newState.groupGather[groupId]) {\r\n    if (newState.groupGather[groupId].messages) {\r\n      newState.groupGather[groupId].messages = [\r\n        ...(newState.groupGather[groupId].messages as GroupMessage[]),\r\n        payload,\r\n      ];\r\n    } else {\r\n      newState.groupGather[groupId] = {\r\n        ...state.groupGather[groupId],\r\n        messages: [payload],\r\n      };\r\n    }\r\n  }\r\n\r\n  // увеличиваем счетчик новых сообщений, если это не активная комната и сообщение не от нас\r\n  const { activeRoom } = newState;\r\n  if (\r\n    activeRoom &&\r\n    (activeRoom as Group).groupId !== groupId &&\r\n    payload.userId !== state.user.userId\r\n  ) {\r\n    return groupUnreadGather(\r\n      newState,\r\n      groupId,\r\n      (x?: number) => (x || 0) + 1,\r\n    );\r\n  }\r\n\r\n  // обновляем активный чат\r\n  newState.activeRoom = getFreshActiveRoom(newState);\r\n  return newState;\r\n};\r\n\r\nconst addPrivateMessage = (\r\n  state: ChatState,\r\n  payload: PrivateMessage,\r\n) => {\r\n  const newState = { ...state };\r\n  const contactId =\r\n    payload.contactId === state.user.userId\r\n      ? payload.userId\r\n      : payload.contactId;\r\n\r\n  // 1 добавляем сообщение\r\n  if (newState.contactGather[contactId].messages) {\r\n    newState.contactGather[contactId].messages = [\r\n      ...(newState.contactGather[contactId]\r\n        .messages as PrivateMessage[]),\r\n      payload,\r\n    ];\r\n  } else {\r\n    newState.contactGather[contactId] = {\r\n      ...newState.contactGather[contactId],\r\n      messages: [payload],\r\n    };\r\n  }\r\n\r\n  // 2 если это сообщение в неактивной комнате и источник не мы (в соседней вкладке), то увеличиваем счетчик непрочитанных\r\n  if (\r\n    newState.activeRoom?.userId !== contactId &&\r\n    payload.userId !== state.user.userId\r\n  ) {\r\n    return contactUnreadGather(\r\n      newState,\r\n      contactId,\r\n      (x?: number) => (x || 0) + 1,\r\n    );\r\n  }\r\n\r\n  // обновляем активный чат\r\n  newState.activeRoom = getFreshActiveRoom(newState);\r\n  return newState;\r\n};\r\n\r\nconst contactUnreadGather = (\r\n  state: ChatState,\r\n  userId: number,\r\n  predicate: (x?: number) => number,\r\n) => {\r\n  const newState = { ...state };\r\n\r\n  if (newState.contactGather[userId]) {\r\n    newState.contactGather[userId] = {\r\n      ...newState.contactGather[userId],\r\n      unreadCount: predicate(\r\n        newState.contactGather[userId].unreadCount,\r\n      ),\r\n    };\r\n  }\r\n\r\n  // обновляем активный чат\r\n  newState.activeRoom = getFreshActiveRoom(newState);\r\n\r\n  return newState;\r\n};\r\n\r\nconst groupUnreadGather = (\r\n  state: ChatState,\r\n  groupId: number,\r\n  predicate: (x?: number) => number,\r\n) => {\r\n  const newState = { ...state };\r\n\r\n  if (newState.groupGather[groupId]) {\r\n    newState.groupGather[groupId] = {\r\n      ...newState.groupGather[groupId],\r\n      unreadCount: predicate(\r\n        newState.groupGather[groupId].unreadCount,\r\n      ),\r\n    };\r\n  }\r\n\r\n  // обновляем активный чат\r\n  newState.activeRoom = getFreshActiveRoom(newState);\r\n\r\n  return newState;\r\n};\r\n\r\nconst revokeMessage = (\r\n  state: ChatState,\r\n  payload: MessageOperation,\r\n) => {\r\n  const { userId } = state.user;\r\n  const newState = { ...state };\r\n  const userName =\r\n    payload.username ||\r\n    newState.userGather[payload.userId as number].username;\r\n  if (payload.groupId) {\r\n    const { messages } = newState.groupGather[payload.groupId];\r\n    // задаем isRevoke\r\n    if (messages) {\r\n      const msg = messages.find(\r\n        message => message._id === payload._id,\r\n      );\r\n      if (msg) {\r\n        const index = messages.indexOf(msg);\r\n        messages[index] = {\r\n          ...msg,\r\n          isRevoke: true,\r\n          revokeUserName: userName,\r\n        };\r\n      }\r\n    }\r\n  } else {\r\n    const { messages } = newState.contactGather[\r\n      payload.contactId === userId\r\n        ? (payload.userId as number)\r\n        : (payload.contactId as number)\r\n    ];\r\n    // задаем isRevoke\r\n    if (messages) {\r\n      const msg = messages.find(\r\n        message => message._id === payload._id,\r\n      );\r\n      if (msg) {\r\n        const index = messages.indexOf(msg);\r\n        messages[index] = {\r\n          ...msg,\r\n          isRevoke: true,\r\n          revokeUserName: userName,\r\n        };\r\n      }\r\n    }\r\n  }\r\n  // обновляем активный чат\r\n  newState.activeRoom = getFreshActiveRoom(newState);\r\n  return newState;\r\n};\r\n\r\nconst delContact = (state: ChatState, userId: number) => {\r\n  const newState = { ...state };\r\n  const updateActiveRoom =\r\n    newState.activeRoom === newState.contactGather[userId];\r\n  delete newState.contactGather[userId];\r\n  if (updateActiveRoom) newState.activeRoom = getActiveRoom(newState);\r\n\r\n  return newState;\r\n};\r\n\r\nconst delGroup = (state: ChatState, groupId: number) => {\r\n  const newState = { ...state };\r\n  const updateActiveRoom =\r\n    newState.activeRoom === newState.groupGather[groupId];\r\n  delete newState.groupGather[groupId];\r\n  if (updateActiveRoom) newState.activeRoom = getActiveRoom(newState);\r\n\r\n  return newState;\r\n};\r\n\r\nconst delGroupMember = (state: ChatState, data: GroupMap) => {\r\n  const newState = { ...state };\r\n\r\n  const group = newState.groupGather[data.groupId];\r\n  if (group) {\r\n    group.members = group.members?.filter(\r\n      it => it.userId !== data.userId,\r\n    );\r\n  }\r\n\r\n  return newState;\r\n};\r\n\r\nconst updateGroupInfo = (state: ChatState, group: Group) => {\r\n  const newState = { ...state };\r\n\r\n  const { groupId, name, notice } = group;\r\n  const info = newState.groupGather[groupId];\r\n  if (info) {\r\n    newState.groupGather[groupId] = { ...info, name, notice };\r\n  }\r\n\r\n  // обновляем активный чат\r\n  newState.activeRoom = getFreshActiveRoom(newState);\r\n\r\n  return newState;\r\n};\r\n\r\nconst updateUserInfo = (state: ChatState, user: User) => {\r\n  const newState = { ...state };\r\n\r\n  const { userId, username, avatar } = user;\r\n\r\n  if (newState.userGather[userId]) {\r\n    newState.userGather[userId] = {\r\n      ...newState.userGather[userId],\r\n      username,\r\n      avatar,\r\n    };\r\n  }\r\n\r\n  if (newState.contactGather[userId]) {\r\n    newState.contactGather[userId] = {\r\n      ...newState.contactGather[userId],\r\n      username,\r\n      avatar,\r\n    };\r\n  }\r\n\r\n  // обновляем активный чат\r\n  newState.activeRoom = getFreshActiveRoom(newState);\r\n\r\n  return newState;\r\n};\r\n\r\nconst addGroupMember = (state: ChatState, payload: GroupMember) => {\r\n  const members: Contact[] = payload.members.map(member => ({\r\n    ...member,\r\n    isManager: 0,\r\n  }));\r\n\r\n  const newState = { ...state };\r\n\r\n  if (newState.groupGather[payload.groupId].members && members) {\r\n    newState.groupGather[payload.groupId].members = [\r\n      ...(state.groupGather[payload.groupId].members as Contact[]),\r\n      ...members,\r\n    ];\r\n  } else {\r\n    newState.groupGather[payload.groupId] = {\r\n      ...newState.groupGather[payload.groupId],\r\n      members,\r\n    };\r\n  }\r\n\r\n  // обновляем активный чат\r\n  newState.activeRoom = getFreshActiveRoom(newState);\r\n  return newState;\r\n};\r\n\r\nconst markPrivateMessagesRead = (\r\n  state: ChatState,\r\n  userId: number,\r\n) => {\r\n  const newState = { ...state };\r\n\r\n  if (newState.contactGather[userId]) {\r\n    const updatedValue = { ...newState.contactGather[userId] };\r\n\r\n    if (updatedValue.messages) {\r\n      for (let i = 0; i < updatedValue.messages.length; i++)\r\n        updatedValue.messages[i] = {\r\n          ...updatedValue.messages[i],\r\n          status: 1,\r\n        };\r\n    }\r\n    newState.contactGather[userId] = updatedValue;\r\n  }\r\n\r\n  // обновляем активный чат\r\n  newState.activeRoom = getFreshActiveRoom(newState);\r\n\r\n  return newState;\r\n};\r\n\r\nconst addPrivateMessages = (\r\n  state: ChatState,\r\n  data: AddPrivateMessages,\r\n) => {\r\n  const newState = { ...state };\r\n\r\n  const { messages, contactId } = data;\r\n\r\n  if (newState.contactGather[contactId]) {\r\n    newState.contactGather[contactId] = {\r\n      ...newState.contactGather[contactId],\r\n      messages: [\r\n        ...(messages || []),\r\n        ...(newState.contactGather[contactId].messages || []),\r\n      ],\r\n      noMoreData: messages?.length\r\n        ? messages?.length < data.pageSize\r\n        : false,\r\n    };\r\n  }\r\n\r\n  // обновляем активный чат\r\n  newState.activeRoom = getFreshActiveRoom(newState);\r\n\r\n  return newState;\r\n};\r\n\r\nconst addGroupMessages = (\r\n  state: ChatState,\r\n  data: AddGroupMessages,\r\n) => {\r\n  const newState = { ...state };\r\n\r\n  const { groupId, messages, userArr: users } = data;\r\n  if (newState.groupGather[groupId]) {\r\n    newState.groupGather[groupId] = {\r\n      ...newState.groupGather[groupId],\r\n      messages: [\r\n        ...(messages || []),\r\n        ...(newState.groupGather[groupId].messages || []),\r\n      ],\r\n      noMoreData: messages?.length\r\n        ? messages?.length < data.pageSize\r\n        : false,\r\n    };\r\n  }\r\n\r\n  newState.userGather = { ...newState.userGather };\r\n  for (const user of users) {\r\n    if (!newState.userGather[user.userId]) {\r\n      newState.userGather[user.userId] = user;\r\n    }\r\n  }\r\n\r\n  // обновляем активный чат\r\n  newState.activeRoom = getFreshActiveRoom(newState);\r\n\r\n  return newState;\r\n};\r\n\r\nconst setActiveRoom = (state: ChatState, data: SetActiveRoom) => {\r\n  //if (state.activeRoom && data.ifNotExists) return state;\r\n  return {\r\n    ...state,\r\n    chatOld:\r\n      state.activeRoom != null ? { ...state.activeRoom } : null,\r\n    activeRoom: data.groupId\r\n      ? state.groupGather[data.groupId]\r\n      : data.contactId\r\n      ? state.contactGather[data.contactId]\r\n      : null,\r\n  };\r\n};\r\n\r\nconst setToken = (state: ChatState, token: string): ChatState => {\r\n  return {\r\n    ...state,\r\n    token,\r\n  };\r\n};\r\n\r\nconst clearUser = (state: ChatState): ChatState => {\r\n  return {\r\n    ...state,\r\n    token: '',\r\n    user: emptyUser,\r\n  };\r\n};\r\n\r\nconst setConference = (\r\n  state: ChatState,\r\n  conference: ConferenceData,\r\n): ChatState => {\r\n  return {\r\n    ...state,\r\n    conference: {\r\n      data: { ...conference },\r\n      joined: conference?.userId === state.user.userId,\r\n      ringPlayed: conference?.userId !== state.user.userId,\r\n    },\r\n  };\r\n};\r\n\r\nconst pauseConference = (\r\n  state: ChatState,\r\n  conference: ConferenceData,\r\n): ChatState => {\r\n  if (state.conference.data?.id !== conference?.id) return state;\r\n  return {\r\n    ...state,\r\n    conference: {\r\n      data: { ...state.conference.data },\r\n      joined: false,\r\n      ringPlayed: false,\r\n    },\r\n  };\r\n};\r\n\r\nconst stopConference = (\r\n  state: ChatState,\r\n  conference: ConferenceData,\r\n): ChatState => {\r\n  if (state.conference.data?.id !== conference?.id) return state;\r\n  return {\r\n    ...state,\r\n    conference: { data: null, joined: false, ringPlayed: false },\r\n  };\r\n};\r\n\r\nfunction chatReducer(state: ChatState, action: Action): ChatState {\r\n  switch (action.type) {\r\n    case 'SET_GROUP_GATHER':\r\n      return {\r\n        ...state,\r\n        groupGather: {\r\n          ...state.groupGather,\r\n          [(action.payload as Group)\r\n            .groupId]: action.payload as Group,\r\n        },\r\n      };\r\n    case 'SET_CONTACT_GATHER':\r\n      return {\r\n        ...state,\r\n        contactGather: {\r\n          ...state.contactGather,\r\n          [(action.payload as Contact)\r\n            .userId]: action.payload as Contact,\r\n        },\r\n      };\r\n    case 'DEL_GROUP':\r\n      return delGroup(state, action.payload as number);\r\n    case 'DEL_GROUP_MEMBER':\r\n      return delGroupMember(state, action.payload as GroupMap);\r\n    case 'DEL_CONTACT':\r\n      return delContact(state, (action.payload as Contact).userId);\r\n    case 'SET_USER_GATHER':\r\n      return {\r\n        ...state,\r\n        userGather: {\r\n          ...state.userGather,\r\n          [(action.payload as User).userId]: action.payload as User,\r\n        },\r\n      };\r\n    case 'UPDATE_ACTIVE_ROOM':\r\n      return { ...state, activeRoom: getActiveRoom(state) };\r\n    case 'SET_ACTIVE_ROOM':\r\n      return setActiveRoom(state, action.payload as SetActiveRoom);\r\n    case 'USER_ONLINE':\r\n      return setUserOnline(state, action.payload as number, 1);\r\n    case 'USER_OFFLINE':\r\n      return setUserOnline(state, action.payload as number, 0);\r\n    case 'ADD_GROUP_MESSAGE':\r\n      return addGroupMessage(state, action.payload as GroupMessage);\r\n    case 'ADD_PRIVATE_MESSAGE':\r\n      return addPrivateMessage(\r\n        state,\r\n        action.payload as PrivateMessage,\r\n      );\r\n    case 'ADD_GROUP_UNREAD_GATHER':\r\n      return groupUnreadGather(\r\n        state,\r\n        action.payload as number,\r\n        (x?: number) => (x || 0) + 1,\r\n      );\r\n    case 'ADD_CONTACT_UNREAD_GATHER':\r\n      return contactUnreadGather(\r\n        state,\r\n        action.payload as number,\r\n        (x?: number) => (x || 0) + 1,\r\n      );\r\n    case 'SET_TYPING':\r\n      return { ...state, typing: action.payload as SetTyping };\r\n    case 'LOSE_GROUP_UNREAD_GATHER':\r\n      return groupUnreadGather(\r\n        state,\r\n        action.payload as number,\r\n        () => 0,\r\n      );\r\n    case 'LOSE_CONTACT_UNREAD_GATHER':\r\n      return contactUnreadGather(\r\n        state,\r\n        action.payload as number,\r\n        () => 0,\r\n      );\r\n    case 'REVOKE_MESSAGE':\r\n      return revokeMessage(state, action.payload as MessageOperation);\r\n    case 'UPDATE_GROUP_INFO':\r\n      return updateGroupInfo(state, action.payload as Group);\r\n    case 'UPDATE_USER_INFO':\r\n      return updateUserInfo(state, action.payload as User);\r\n    case 'ADD_GROUP_MEMBER':\r\n      return addGroupMember(state, action.payload as GroupMember);\r\n    case 'SET_CONFERENCE':\r\n      return setConference(state, action.payload as ConferenceData);\r\n    case 'JOIN_CONFERENCE':\r\n      return {\r\n        ...state,\r\n        conference: {\r\n          data: { ...(action.payload as ConferenceData) },\r\n          joined: true,\r\n          ringPlayed: false,\r\n        },\r\n      };\r\n    case 'PAUSE_CONFERENCE':\r\n      return pauseConference(state, action.payload as ConferenceData);\r\n    case 'STOP_CONFERENCE':\r\n      return stopConference(state, action.payload as ConferenceData);\r\n    case 'MARK_PRIVATE_MESSAGES_READ':\r\n      return markPrivateMessagesRead(state, action.payload as number);\r\n    case 'ADD_PRIVATE_MESSAGES':\r\n      return addPrivateMessages(\r\n        state,\r\n        action.payload as AddPrivateMessages,\r\n      );\r\n    case 'ADD_GROUP_MESSAGES':\r\n      return addGroupMessages(\r\n        state,\r\n        action.payload as AddGroupMessages,\r\n      );\r\n    case 'SET_LOADING':\r\n      return {\r\n        ...state,\r\n        loading: action.payload as boolean,\r\n        error: '',\r\n      };\r\n    case 'SET_ERROR':\r\n      return {\r\n        ...state,\r\n        error: action.payload as string,\r\n        success: undefined,\r\n      };\r\n    case 'SET_SUCCES':\r\n      return {\r\n        ...state,\r\n        success: action.payload as string,\r\n        error: undefined,\r\n      };\r\n    case 'SET_TOKEN':\r\n      return setToken(state, action.payload as string);\r\n    case 'SET_USER':\r\n      return {\r\n        ...state,\r\n        user: action.payload as User,\r\n      };\r\n    case 'CLEAR_USER':\r\n      return clearUser(state);\r\n    case 'CLEAR_CHAT_DATA':\r\n      return {\r\n        ...state,\r\n        activeRoom: null,\r\n        groupGather: {},\r\n        userGather: {},\r\n        contactGather: {},\r\n        conference: {\r\n          data: null,\r\n          joined: false,\r\n          ringPlayed: false,\r\n        },\r\n        typing: null,\r\n      };\r\n    case 'SET_OPERATORS':\r\n      return {\r\n        ...state,\r\n        operators: action.payload as Contact[],\r\n      };\r\n    case 'SET_VISIT_DATA':\r\n      return {\r\n        ...state,\r\n        visitData: action.payload as VisitData[],\r\n      };\r\n  }\r\n\r\n  return state;\r\n}\r\n\r\nexport type ChatDispatch = React.Dispatch<Action>;\r\nconst emptyDispatch: ChatDispatch = () => null;\r\n\r\ntype ChatProviderProps = {\r\n  defLang: string | undefined;\r\n  token: string;\r\n  refreshToken: string;\r\n  children: JSX.Element | JSX.Element[];\r\n};\r\n\r\nexport const ChatContext = React.createContext({\r\n  state: emptyChatState,\r\n  dispatch: emptyDispatch,\r\n});\r\n\r\nexport const ChatProvider: React.FC<ChatProviderProps> = (\r\n  props: ChatProviderProps,\r\n) => {\r\n  emptyUser.langCode = props.defLang;\r\n\r\n  const token = props.token;\r\n  const refreshToken = props.token;\r\n  const chatState: ChatState = {\r\n    ...emptyChatState,\r\n    token,\r\n    refreshToken,\r\n  };\r\n\r\n  const [state, dispatch] = React.useReducer(chatReducer, chatState);\r\n\r\n  return (\r\n    <ChatContext.Provider value={{ state, dispatch }}>\r\n      {props.children}\r\n    </ChatContext.Provider>\r\n  );\r\n};\r\n","import React, { createContext, useCallback, useContext } from 'react';\r\nimport { ChatContext, ChatDispatch } from './ChatContext';\r\nimport axios, { AxiosError, AxiosInstance } from 'axios';\r\nimport {\r\n  Contact,\r\n  Group,\r\n  PagingResponse,\r\n  PrivateMessage,\r\n} from '../types';\r\n\r\nexport interface IRestContext {\r\n  apiUrl: string;\r\n  pageSize: number;\r\n  fetch: AxiosInstance | null;\r\n  getPrivateMessages: (chat: Contact) => Promise<void>;\r\n  getGroupMessages: (chat: Group) => Promise<void>;\r\n  getUserByMmk: (\r\n    mmkId: string | null,\r\n    guid: string | null,\r\n  ) => Promise<number | undefined>;\r\n}\r\nconst initialContext = {} as IRestContext;\r\n\r\nexport const RestContext: React.Context<IRestContext> = createContext(\r\n  initialContext,\r\n);\r\n\r\ntype RestProviderProps = {\r\n  baseURLApi: string;\r\n  pageSize: number;\r\n  children: JSX.Element;\r\n};\r\n\r\nexport function clearLocalStorage() {\r\n  localStorage.removeItem('authToken');\r\n  localStorage.removeItem('refreshToken');\r\n  localStorage.removeItem('user');\r\n  localStorage.removeItem('doctor');\r\n  localStorage.removeItem('chatUser');\r\n}\r\nexport const signOut = async () => {\r\n  try {\r\n    await axios.post('auth/logout');\r\n  } catch (error) {\r\n    console.log('ERROR Logout', error);\r\n  }\r\n\r\n  clearLocalStorage();\r\n  window.location.href = '/';\r\n};\r\n\r\nexport const getRefreshToken = async (\r\n  authToken: string,\r\n  refreshToken: string,\r\n  dispatch: ChatDispatch,\r\n) => {\r\n  try {\r\n    const { data } = await axios.post('auth/refreshToken', {\r\n      authToken,\r\n      refreshToken,\r\n    });\r\n    localStorage.setItem('authToken', data?.authToken);\r\n    localStorage.setItem('refreshToken', data?.refreshToken);\r\n    window.location.href = '/';\r\n  } catch (error) {\r\n    console.log('ERROR RefreshToken', error);\r\n    dispatch({ type: 'CLEAR_USER' });\r\n    signOut();\r\n  }\r\n};\r\nexport const RestProvider: React.FC<RestProviderProps> = ({\r\n  baseURLApi,\r\n  pageSize,\r\n  children,\r\n}: RestProviderProps) => {\r\n  const { state, dispatch } = useContext(ChatContext);\r\n  const errorInterceptor = (error: AxiosError) => {\r\n    if (error.response != null && error.response.status === 401) {\r\n      getRefreshToken(state.token, state.refreshToken, dispatch);\r\n    }\r\n  };\r\n\r\n  const fetch: AxiosInstance = axios.create({\r\n    timeout: 60000, // Таймаут минута\r\n    baseURL: baseURLApi,\r\n    headers: {\r\n      'Cache-Control': 'no-cache',\r\n      Pragma: 'no-cache',\r\n      Authorization: `Bearer ${state.token}`,\r\n    },\r\n    withCredentials: false,\r\n  });\r\n\r\n  fetch.interceptors.response.use(\r\n    response => {\r\n      return response;\r\n    },\r\n    (error: AxiosError) => {\r\n      console.log('ERROR AxiosError');\r\n      errorInterceptor(error);\r\n      return Promise.reject(error);\r\n    },\r\n  );\r\n\r\n  const getPrivateMessages = useCallback(\r\n    async (chat: Contact, callback?: () => void) => {\r\n      const contactId = chat.userId;\r\n      const current = chat.messages?.length;\r\n      try {\r\n        dispatch({ type: 'SET_LOADING', payload: true });\r\n        const { data } = await fetch.get('/contact/messages', {\r\n          params: {\r\n            contactId,\r\n            current,\r\n            pageSize,\r\n          },\r\n        });\r\n\r\n        if (data) {\r\n          dispatch({\r\n            type: 'ADD_PRIVATE_MESSAGES',\r\n            payload: {\r\n              pageSize,\r\n              contactId,\r\n              messages: data as PrivateMessage[],\r\n            },\r\n          });\r\n          if (callback) {\r\n            callback();\r\n          }\r\n        }\r\n      } catch (error) {\r\n        const err = error as AxiosError;\r\n        dispatch({ type: 'SET_ERROR', payload: err.message });\r\n      } finally {\r\n        dispatch({ type: 'SET_LOADING', payload: false });\r\n      }\r\n    },\r\n    [dispatch],\r\n  );\r\n\r\n  const getGroupMessages = useCallback(\r\n    async (chat: Group) => {\r\n      const { groupId } = chat;\r\n      const current = chat.messages?.length;\r\n      try {\r\n        dispatch({ type: 'SET_LOADING', payload: true });\r\n        const { data }: { data: PagingResponse } = await fetch.get(\r\n          '/group/messages',\r\n          {\r\n            params: {\r\n              groupId,\r\n              current,\r\n              pageSize,\r\n            },\r\n          },\r\n        );\r\n        if (data) {\r\n          dispatch({\r\n            type: 'ADD_GROUP_MESSAGES',\r\n            payload: {\r\n              pageSize,\r\n              groupId,\r\n              ...data,\r\n            },\r\n          });\r\n        }\r\n      } catch (error) {\r\n        const err = error as AxiosError;\r\n        dispatch({ type: 'SET_ERROR', payload: err.message });\r\n      } finally {\r\n        dispatch({ type: 'SET_LOADING', payload: false });\r\n      }\r\n    },\r\n    [dispatch],\r\n  );\r\n\r\n  const getUserByMmk = async (\r\n    mmkId: string | null,\r\n    guid: string | null,\r\n  ) => {\r\n    try {\r\n      const { data }: { data: number } = await fetch.get(\r\n        '/contact/find',\r\n        {\r\n          params: {\r\n            mmkId,\r\n            guid,\r\n          },\r\n        },\r\n      );\r\n      if (data != null) {\r\n        return data;\r\n      }\r\n    } catch (error) {\r\n      console.log('err getUserByMmk', error);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <RestContext.Provider\r\n      value={{\r\n        apiUrl: baseURLApi,\r\n        pageSize,\r\n        fetch,\r\n        getPrivateMessages,\r\n        getGroupMessages,\r\n        getUserByMmk,\r\n      }}\r\n    >\r\n      {children}\r\n    </RestContext.Provider>\r\n  );\r\n};\r\n","import { useCallback, useEffect, useState } from \"react\";\r\nimport io, { Socket } from \"socket.io-client\";\r\n\r\nexport const useSocket = (\r\n  url: string,\r\n  path: string,\r\n  accessToken: string\r\n): {\r\n  socket: Socket | null;\r\n  online: boolean;\r\n  connectSocket: () => void;\r\n  disconnectSocket: () => void;\r\n} => {\r\n  const [socket, setSocket] = useState<Socket | null>(null);\r\n\r\n  const connectSocket = useCallback(() => {\r\n    // console.log(\"do connect\");\r\n    const socketTemp = io(url, {\r\n      path,\r\n      reconnection: true,\r\n      extraHeaders: {\r\n        Authorization: `Bearer ${accessToken}`,\r\n      },\r\n    });\r\n    setSocket(socketTemp);\r\n  }, [url, path, accessToken]);\r\n\r\n  const disconnectSocket = useCallback(() => {\r\n    // console.log(\"do disconnect\");\r\n    socket?.disconnect();\r\n    setSocket(null);\r\n  }, [socket]);\r\n\r\n  const [online, setOnline] = useState<boolean>(false);\r\n\r\n  useEffect(() => {\r\n    setOnline(socket?.connected ? true : false);\r\n  }, [socket]);\r\n\r\n  useEffect(() => {\r\n    socket?.on(\"connect\", () => {\r\n      // console.log(\"connected\");\r\n      setOnline(true);\r\n      socket.emit(\"chatData\");\r\n    });\r\n  }, [socket]);\r\n\r\n  useEffect(() => {\r\n    socket?.on(\"disconnect\", () => {\r\n      // console.log(\"disconnected\");\r\n      setOnline(false);\r\n    });\r\n  }, [socket]);\r\n\r\n  return {\r\n    socket,\r\n    online,\r\n    disconnectSocket,\r\n    connectSocket,\r\n  };\r\n};\r\n","import React, { createContext, useContext, useEffect } from 'react';\r\nimport { Socket } from 'socket.io-client';\r\nimport { useSocket } from '../hooks/useSocket';\r\nimport {\r\n  ChatData,\r\n  Contact,\r\n  Group,\r\n  GroupMessage,\r\n  JoinGroup,\r\n  MessageOperation,\r\n  PrivateMessage,\r\n  SetTyping,\r\n  User,\r\n  ConferenceData,\r\n  SetActiveRoom,\r\n  GroupMap,\r\n  VisitData,\r\n} from '../types';\r\nimport { ChatContext } from './ChatContext';\r\nimport { getRefreshToken } from './RestContext';\r\n\r\n// Формат ответа сервера\r\ninterface ServerRes {\r\n  code: number;\r\n  msg: string;\r\n  data: unknown;\r\n}\r\n\r\nexport interface ISocketContext {\r\n  socket: Socket | null;\r\n  online: boolean;\r\n}\r\nconst initialContext = {\r\n  online: false,\r\n} as ISocketContext;\r\n\r\nexport const SocketContext: React.Context<ISocketContext> = createContext(\r\n  initialContext,\r\n);\r\n\r\ntype SocketProviderProps = {\r\n  wsUrl: string;\r\n  wsPath: string;\r\n  children: JSX.Element;\r\n};\r\n\r\nexport const SocketProvider: React.FC<SocketProviderProps> = ({\r\n  wsUrl,\r\n  wsPath,\r\n  children,\r\n}: SocketProviderProps) => {\r\n  const { state, dispatch } = useContext(ChatContext);\r\n  const {\r\n    socket,\r\n    online,\r\n    disconnectSocket,\r\n    connectSocket,\r\n  } = useSocket(wsUrl, wsPath, state.token);\r\n\r\n  useEffect(() => {\r\n    if (state.token) {\r\n      connectSocket();\r\n    }\r\n    return () => {\r\n      disconnectSocket();\r\n    };\r\n  }, [state.token, connectSocket]);\r\n\r\n  useEffect(() => {\r\n    if (!state.token) disconnectSocket();\r\n  }, [state.token, disconnectSocket]);\r\n\r\n  // listen unauthorized event\r\n  useEffect(() => {\r\n    const listener = (msg: string) => {\r\n      console.log('unauthorized msg', msg);\r\n      getRefreshToken(state.token, state.refreshToken, dispatch);\r\n    };\r\n\r\n    // attach\r\n    socket?.on('unauthorized', listener);\r\n    // detatch\r\n    return () => {\r\n      socket?.off('unauthorized', listener);\r\n    };\r\n  }, [socket?.id]);\r\n\r\n  // listen chatData event\r\n  useEffect(() => {\r\n    const listener = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      console.log('res.data', res.data);\r\n      const payload = res.data as ChatData;\r\n      const groupArr = payload.groupData;\r\n      const contactArr = payload.contactData;\r\n      const userArr = payload.userData;\r\n      dispatch({ type: 'CLEAR_CHAT_DATA' });\r\n      dispatch({ type: 'SET_USER', payload: payload.user });\r\n      if (groupArr.length) {\r\n        for (const group of groupArr) {\r\n          socket?.emit('joinGroupSocket', {\r\n            groupId: group.groupId,\r\n          });\r\n          dispatch({ type: 'SET_GROUP_GATHER', payload: group });\r\n        }\r\n      }\r\n      if (contactArr.length) {\r\n        for (const contact of contactArr) {\r\n          socket?.emit('joinPrivateSocket', {\r\n            contactId: contact.userId,\r\n          });\r\n          dispatch({ type: 'SET_CONTACT_GATHER', payload: contact });\r\n        }\r\n      }\r\n      dispatch({\r\n        type: 'SET_OPERATORS',\r\n        payload: payload.operatorData,\r\n      });\r\n      if (userArr.length) {\r\n        for (const user_ of userArr) {\r\n          dispatch({ type: 'SET_USER_GATHER', payload: user_ });\r\n        }\r\n      }\r\n      dispatch({ type: 'UPDATE_ACTIVE_ROOM' });\r\n      dispatch({\r\n        type: 'SET_CONFERENCE',\r\n        payload: payload.conferenceData,\r\n      });\r\n      dispatch({\r\n        type: 'SET_VISIT_DATA',\r\n        payload: payload.visitData,\r\n      });\r\n    };\r\n    socket?.on('chatData', listener);\r\n    return () => {\r\n      socket?.off('chatData', listener);\r\n    };\r\n  }, [socket?.id]);\r\n\r\n  // listen user online\r\n  useEffect(() => {\r\n    const listener = (res: ServerRes) => {\r\n      dispatch({ type: 'USER_ONLINE', payload: res.data as number });\r\n    };\r\n    socket?.on('userOnline', listener);\r\n    return () => {\r\n      socket?.off('userOnline', listener);\r\n    };\r\n  }, [socket?.id]);\r\n\r\n  // listen user offline\r\n  useEffect(() => {\r\n    const listener = (res: ServerRes) => {\r\n      dispatch({ type: 'USER_OFFLINE', payload: res.data as number });\r\n    };\r\n    socket?.on('userOffline', listener);\r\n    return () => {\r\n      socket?.off('userOffline', listener);\r\n    };\r\n  }, [socket?.id]);\r\n\r\n  // listen private socket join\r\n  useEffect(() => {\r\n    const listener = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      console.log('Успешно вошел в приватный чат');\r\n    };\r\n    socket?.on('joinPrivateSocket', listener);\r\n    return () => {\r\n      socket?.off('joinPrivateSocket', listener);\r\n    };\r\n  }, [socket?.id]);\r\n\r\n  // listen group socket join\r\n  useEffect(() => {\r\n    const listener = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      const data = res.data as JoinGroup;\r\n      const newUser: Contact = data.user;\r\n      newUser.online = 1;\r\n      const { group } = data;\r\n      const groupObj = state.groupGather[group.groupId];\r\n      // Информация о присоединении к группе новых пользователей\r\n      if (\r\n        groupObj &&\r\n        !groupObj.members?.find(\r\n          member => member.userId === newUser.userId,\r\n        )\r\n      ) {\r\n        newUser.isManager = 0;\r\n        groupObj.members?.push(newUser);\r\n        // Vue.prototype.$message.info(res.msg);\r\n      }\r\n      dispatch({ type: 'SET_USER_GATHER', payload: newUser });\r\n    };\r\n    socket?.on('joinGroupSocket', listener);\r\n    return () => {\r\n      socket?.off('joinGroupSocket', listener);\r\n    };\r\n  }, [socket?.id, state.groupGather]);\r\n\r\n  useEffect(() => {\r\n    const listener = async (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      const data = res.data as GroupMessage;\r\n      dispatch({ type: 'ADD_GROUP_MESSAGE', payload: data });\r\n      const { activeRoom } = state;\r\n      if (\r\n        activeRoom &&\r\n        (activeRoom as Group).groupId === data.groupId &&\r\n        data.userId !== state.user.userId\r\n      ) {\r\n        socket?.emit('markAsRead', {\r\n          groupId: data.groupId,\r\n          _id: data._id,\r\n        });\r\n      }\r\n    };\r\n\r\n    socket?.on('groupMessage', listener);\r\n    return () => {\r\n      socket?.off('groupMessage', listener);\r\n    };\r\n  }, [socket?.id, state.activeRoom]);\r\n\r\n  useEffect(() => {\r\n    const listener = async (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      const data = res.data as PrivateMessage;\r\n      if (\r\n        data.contactId === state.user.userId ||\r\n        data.userId === state.user.userId\r\n      ) {\r\n        dispatch({\r\n          type: 'ADD_PRIVATE_MESSAGE',\r\n          payload: data,\r\n        });\r\n\r\n        // если есть активная комната и это приватная комната (!groupId && userId) с отправителем сообщения (userId)\r\n        if (\r\n          state.activeRoom &&\r\n          !(state.activeRoom as Group).groupId &&\r\n          state.activeRoom?.userId === data.userId\r\n        ) {\r\n          socket?.emit('markAsRead', {\r\n            contactId: data.userId,\r\n            _id: data._id,\r\n          });\r\n        }\r\n      }\r\n    };\r\n\r\n    socket?.on('privateMessage', listener);\r\n    return () => {\r\n      socket?.off('privateMessage', listener);\r\n    };\r\n  }, [socket?.id, state.activeRoom]);\r\n\r\n  useEffect(() => {\r\n    let timer: NodeJS.Timeout;\r\n\r\n    const listener = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      if (timer) clearTimeout(timer);\r\n      dispatch({\r\n        type: 'SET_TYPING',\r\n        payload: res.data as SetTyping,\r\n      });\r\n      timer = setTimeout(() => {\r\n        dispatch({ type: 'SET_TYPING', payload: null });\r\n      }, 1000);\r\n    };\r\n    socket?.on('typing', listener);\r\n    return () => {\r\n      if (timer) clearTimeout(timer);\r\n      socket?.off('typing', listener);\r\n    };\r\n  }, [socket?.id]);\r\n\r\n  useEffect(() => {\r\n    const listener = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      const data = res.data as MessageOperation;\r\n      if (data.userId === state.user.userId) {\r\n        if (data.groupId) {\r\n          dispatch({\r\n            type: 'LOSE_GROUP_UNREAD_GATHER',\r\n            payload: data.groupId,\r\n          });\r\n        } else {\r\n          dispatch({\r\n            type: 'LOSE_CONTACT_UNREAD_GATHER',\r\n            payload: data.contactId,\r\n          });\r\n        }\r\n      } else {\r\n        if (data.contactId)\r\n          dispatch({\r\n            type: 'MARK_PRIVATE_MESSAGES_READ',\r\n            payload: data.userId,\r\n          });\r\n      }\r\n    };\r\n    socket?.on('markAsRead', listener);\r\n    return () => {\r\n      socket?.off('markAsRead', listener);\r\n    };\r\n  }, [socket?.id, state.user.userId]);\r\n\r\n  useEffect(() => {\r\n    const listener = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      const data = res.data as MessageOperation;\r\n      dispatch({ type: 'REVOKE_MESSAGE', payload: data });\r\n    };\r\n    socket?.on('revokeMessage', listener);\r\n    return () => {\r\n      socket?.off('revokeMessage', listener);\r\n    };\r\n  }, [socket?.id]);\r\n\r\n  useEffect(() => {\r\n    const listener = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      dispatch({\r\n        type: 'SET_GROUP_GATHER',\r\n        payload: res.data as Group,\r\n      });\r\n    };\r\n    socket?.on('addGroup', listener);\r\n    return () => {\r\n      socket?.off('addGroup', listener);\r\n    };\r\n  }, [socket?.id]);\r\n\r\n  useEffect(() => {\r\n    const listener = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      const data = res.data as Contact;\r\n      dispatch({ type: 'SET_CONTACT_GATHER', payload: data });\r\n      dispatch({ type: 'SET_USER_GATHER', payload: data });\r\n      socket?.emit('joinPrivateSocket', {\r\n        contactId: data.userId,\r\n      });\r\n    };\r\n    socket?.on('addContact', listener);\r\n    return () => {\r\n      socket?.off('addContact', listener);\r\n    };\r\n  }, [socket?.id]);\r\n\r\n  useEffect(() => {\r\n    const listener = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      const data = res.data as GroupMap;\r\n      if (data.userId === state.user.userId) {\r\n        // если удаляем себя из группы\r\n        dispatch({ type: 'DEL_GROUP', payload: data.groupId });\r\n      } else {\r\n        dispatch({ type: 'DEL_GROUP_MEMBER', payload: data });\r\n      }\r\n    };\r\n    socket?.on('deleteGroup', listener);\r\n    return () => {\r\n      socket?.off('deleteGroup', listener);\r\n    };\r\n  }, [socket?.id, state.user]);\r\n\r\n  useEffect(() => {\r\n    const listener = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      const data = res.data as Contact;\r\n      dispatch({ type: 'DEL_CONTACT', payload: data });\r\n    };\r\n    socket?.on('deleteContact', listener);\r\n    return () => {\r\n      socket?.off('deleteContact', listener);\r\n    };\r\n  }, [socket?.id]);\r\n\r\n  useEffect(() => {\r\n    const listener = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      const data = res.data as Group;\r\n      dispatch({ type: 'UPDATE_GROUP_INFO', payload: data });\r\n    };\r\n    socket?.on('updateGroupInfo', listener);\r\n    return () => {\r\n      socket?.off('updateGroupInfo', listener);\r\n    };\r\n  }, [socket?.id]);\r\n\r\n  useEffect(() => {\r\n    const listener = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      const data = res.data as User;\r\n      dispatch({ type: 'UPDATE_USER_INFO', payload: data });\r\n    };\r\n    socket?.on('updateUserInfo', listener);\r\n    return () => {\r\n      socket?.off('updateUserInfo', listener);\r\n    };\r\n  }, [socket?.id]);\r\n\r\n  useEffect(() => {\r\n    const listener = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      const { group, user: newUser } = res.data as JoinGroup;\r\n\r\n      if (!state.groupGather[group.groupId]) {\r\n        console.log('joined to a new group');\r\n        // Если группы еще у нас нет, то получаем информацию о пользователях в группе\r\n        socket?.emit('chatData');\r\n      } else if (newUser.userId !== state.user.userId) {\r\n        // Новые пользователи присоединяются к группе\r\n        dispatch({\r\n          type: 'ADD_GROUP_MEMBER',\r\n          payload: {\r\n            groupId: group.groupId,\r\n            members: [newUser],\r\n          },\r\n        });\r\n      }\r\n    };\r\n    socket?.on('joinGroup', listener);\r\n    return () => {\r\n      socket?.off('joinGroup', listener);\r\n    };\r\n  }, [socket?.id, state.user, state.groupGather]);\r\n\r\n  useEffect(() => {\r\n    const listener = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      dispatch({\r\n        type: 'SET_CONFERENCE',\r\n        payload: res.data as ConferenceData,\r\n      });\r\n    };\r\n    socket?.on('startConference', listener);\r\n    return () => {\r\n      socket?.off('startConference', listener);\r\n    };\r\n  }, [socket?.id]);\r\n\r\n  useEffect(() => {\r\n    const listener = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      dispatch({\r\n        type: 'PAUSE_CONFERENCE',\r\n        payload: res.data as ConferenceData,\r\n      });\r\n    };\r\n    socket?.on('pauseConference', listener);\r\n    return () => {\r\n      socket?.off('pauseConference', listener);\r\n    };\r\n  }, [socket?.id]);\r\n\r\n  useEffect(() => {\r\n    const listener = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      dispatch({\r\n        type: 'STOP_CONFERENCE',\r\n        payload: res.data as ConferenceData,\r\n      });\r\n    };\r\n    socket?.on('stopConference', listener);\r\n    return () => {\r\n      socket?.off('stopConference', listener);\r\n    };\r\n  }, [socket?.id]);\r\n\r\n  useEffect(() => {\r\n    const listener = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n    };\r\n    socket?.on('addOperator', listener);\r\n    return () => {\r\n      socket?.off('addOperator', listener);\r\n    };\r\n  }, [socket?.id]);\r\n\r\n  useEffect(() => {\r\n    const listener = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      dispatch({\r\n        type: 'SET_ACTIVE_ROOM',\r\n        payload: res.data as SetActiveRoom,\r\n      });\r\n    };\r\n    socket?.on('setActiveRoom', listener);\r\n    return () => {\r\n      socket?.off('setActiveRoom', listener);\r\n    };\r\n  }, [socket?.id]);\r\n\r\n  useEffect(() => {\r\n    const listener = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      const payload = res.data as {visitData: VisitData};\r\n      dispatch({\r\n        type: 'SET_VISIT_DATA',\r\n        payload: payload.visitData,\r\n      });\r\n    };\r\n    socket?.on('visitData', listener);\r\n    return () => {\r\n      socket?.off('visitData', listener);\r\n    };\r\n  }, [socket?.id]);\r\n\r\n  return (\r\n    <SocketContext.Provider value={{ socket, online }}>\r\n      {children}\r\n    </SocketContext.Provider>\r\n  );\r\n};\r\n","import React from 'react';\r\nimport { IconButton, Tooltip } from '@mui/material';\r\nimport SettingsSuggestIcon from '@mui/icons-material/SettingsSuggest';\r\nimport SettingsVoiceIcon from '@mui/icons-material/SettingsVoice';\r\nimport VideoSettingsIcon from '@mui/icons-material/VideoSettings';\r\nimport { ChatContext } from '../context/ChatContext';\r\nimport { useTranslation } from 'react-i18next';\r\ntype CheckAudiVideoPermProps = {\r\n  audio: boolean;\r\n  video: boolean;\r\n};\r\n\r\nconst CheckAudiVideoPerm: React.FC<CheckAudiVideoPermProps> = ({\r\n  audio,\r\n  video,\r\n}: CheckAudiVideoPermProps) => {\r\n  const { t } = useTranslation();\r\n  //const [havePermissions, setHavePermissions] = useState(false);\r\n  const { dispatch } = React.useContext(ChatContext);\r\n  const checkPermissions = () => {\r\n    const permissions = navigator.mediaDevices.getUserMedia({\r\n      audio,\r\n      video,\r\n    });\r\n    permissions\r\n      .then(data => {\r\n        console.log('permissions', data);\r\n        dispatch({\r\n          type: 'SET_SUCCES',\r\n          payload: t('CHAT.CONFERENCE.ALLOK'),\r\n        });\r\n      })\r\n      .catch(err => {\r\n        let payload = t('CHAT.CONFERENCE.ErrorAny');\r\n        if (err.name === 'NotFoundError') {\r\n          payload = t('CHAT.CONFERENCE.NotFoundError');\r\n        }\r\n        if (err.name === 'NotAllowedError') {\r\n          payload = t('CHAT.CONFERENCE.NotAllowedError');\r\n        }\r\n\r\n        dispatch({\r\n          type: 'SET_ERROR',\r\n          payload,\r\n        });\r\n        //setHavePermissions(false);\r\n        console.log('err', `${err.name} : ${err.message}`);\r\n      });\r\n  };\r\n\r\n  const title =\r\n    audio && video\r\n      ? t('CHAT.CONFERENCE.CheckCamMic')\r\n      : audio\r\n      ? t('CHAT.CONFERENCE.CheckMic')\r\n      : t('CHAT.CONFERENCE.CheckCam');\r\n  return (\r\n    <Tooltip title={title}>\r\n      <IconButton\r\n        aria-label=\"check\"\r\n        onClick={() => checkPermissions()}\r\n        size=\"large\"\r\n      >\r\n        {audio && video ? (\r\n          <SettingsSuggestIcon />\r\n        ) : audio ? (\r\n          <SettingsVoiceIcon />\r\n        ) : (\r\n          <VideoSettingsIcon />\r\n        )}\r\n      </IconButton>\r\n    </Tooltip>\r\n  );\r\n};\r\n\r\nexport default CheckAudiVideoPerm;\r\n","import React from \"react\";\r\nimport { ChatContext } from \"../context/ChatContext\";\r\nimport { Alert, Snackbar } from \"@mui/material\";\r\n\r\nconst ChatAlert: React.FC = () => {\r\n  // const { t } = useTranslation();\r\n  //const [havePermissions, setHavePermissions] = useState(false);\r\n  const {\r\n    state: { error, success },\r\n    dispatch\r\n  } = React.useContext(ChatContext);\r\n\r\n  const handleClose = () => {\r\n    dispatch({ type: \"SET_ERROR\", payload: undefined });\r\n    dispatch({ type: \"SET_SUCCES\", payload: undefined });\r\n  };\r\n\r\n  return (\r\n    <Snackbar\r\n      anchorOrigin={{ vertical: \"top\", horizontal: \"center\" }}\r\n      open={!!error || !!success}\r\n      autoHideDuration={6000}\r\n      onClose={handleClose}\r\n    >\r\n      <Alert onClose={handleClose} severity={error ? \"error\" : \"success\"}>\r\n        {error ? error : success}\r\n      </Alert>\r\n    </Snackbar>\r\n  );\r\n};\r\n\r\nexport default ChatAlert;\r\n","import * as React from 'react';\r\nimport {\r\n  Container,\r\n  Box,\r\n  Grid,\r\n  useMediaQuery,\r\n  Paper,\r\n  IconButton,\r\n  Tooltip,\r\n} from '@mui/material';\r\nimport { makeStyles } from '@mui/styles';\r\nimport { Theme } from '@mui/material/styles';\r\nimport { Room, RoomList, Conference } from '../components';\r\nimport { ChatContext } from '../context/ChatContext';\r\nimport { RestContext } from '../context/RestContext';\r\nimport { SocketContext } from '../context/SocketContext';\r\nimport {\r\n  ChatPageProps,\r\n  Group,\r\n  Contact,\r\n  ChatMessage,\r\n  ChatRoom,\r\n  SendMessage,\r\n  ConferenceData,\r\n} from '../types';\r\nimport { getParam, isEmpty, allMessCount } from '../utils/common';\r\nimport ConferenceCall from '../components/ConferenceCall';\r\nimport { ArrowForward } from '@mui/icons-material';\r\nimport { useTranslation } from 'react-i18next';\r\nimport CheckAudiVideoPerm from '../components/CheckAudiVideoPerm';\r\nimport ChatAlert from '../components/Alert';\r\n\r\n// Отключили проигрыш звука\r\n// const getRingAudio = (): HTMLAudioElement => {\r\n//   const audio = new Audio(\r\n//     process.env.PUBLIC_URL + '/audio/ring-in.ogg',\r\n//   );\r\n//   audio.loop = true;\r\n//   return audio;\r\n// };\r\n\r\nconst useStyles = makeStyles((theme: Theme) => ({\r\n  root: {\r\n    height: '100%',\r\n    overflow: 'hidden',\r\n    padding: 0,\r\n  },\r\n  innerGrid: {\r\n    height: '100%',\r\n    width: '100%',\r\n  },\r\n  conAbsOnConf: {\r\n    position: 'absolute',\r\n    top: 42,\r\n    left: 25,\r\n    zIndex: 1000,\r\n\r\n    margin: theme.spacing(3),\r\n  },\r\n}));\r\n\r\nexport const ChatPage: React.FC<ChatPageProps> = ({\r\n  activeGroupId,\r\n  activeChatUserId,\r\n  inModale = true,\r\n}: ChatPageProps) => {\r\n  const classes = useStyles();\r\n  const isMobile = useMediaQuery((theme: Theme) =>\r\n    theme.breakpoints.down('sm'),\r\n  );\r\n  const { t } = useTranslation();\r\n  const { state, dispatch } = React.useContext(ChatContext);\r\n  const { socket } = React.useContext(SocketContext);\r\n\r\n  const {\r\n    apiUrl,\r\n    pageSize,\r\n    getPrivateMessages,\r\n    getGroupMessages,\r\n    getUserByMmk,\r\n  } = React.useContext(RestContext);\r\n\r\n  // const [ringAudio] = React.useState(getRingAudio());\r\n\r\n  const onExitActiveRoom = React.useCallback(() => {\r\n    dispatch({\r\n      type: 'SET_ACTIVE_ROOM',\r\n      payload: {},\r\n    });\r\n  }, [dispatch]);\r\n\r\n  const onNeedMoreMessages = React.useCallback(\r\n    async (chat: ChatRoom) => {\r\n      if ((chat as Group).groupId)\r\n        await getGroupMessages(chat as Group);\r\n      else await getPrivateMessages(chat as Contact);\r\n    },\r\n    [getPrivateMessages, getGroupMessages],\r\n  );\r\n\r\n  const onMessageDelete = React.useCallback(\r\n    (chat: ChatRoom, message: ChatMessage) => {\r\n      socket?.emit('revokeMessage', {\r\n        groupId: (chat as Group).groupId, // Идентификатор группы\r\n        contactId: chat.userId, // Идентификатор контакта\r\n        _id: message._id, // Идентификатор удаленного сообщения\r\n      });\r\n    },\r\n    [socket?.id],\r\n  );\r\n\r\n  const onTyping = React.useCallback(\r\n    (chat: ChatRoom) => {\r\n      socket?.emit('typing', {\r\n        groupId: (chat as Group)?.groupId,\r\n        contactId: chat?.userId,\r\n      });\r\n    },\r\n    [socket?.id],\r\n  );\r\n\r\n  const onSendMessage = React.useCallback(\r\n    (chat: ChatRoom, data: SendMessage) => {\r\n      if ((chat as Group).groupId) {\r\n        socket?.emit('groupMessage', {\r\n          groupId: (chat as Group)?.groupId,\r\n          content: data.message,\r\n          width: data.width,\r\n          height: data.height,\r\n          fileName: data.fileName,\r\n          messageType: data.messageType,\r\n          size: data.size,\r\n        });\r\n      } else {\r\n        socket?.emit('privateMessage', {\r\n          contactId: chat?.userId,\r\n          content: data.message,\r\n          width: data.width,\r\n          height: data.height,\r\n          fileName: data.fileName,\r\n          messageType: data.messageType,\r\n          size: data.size,\r\n        });\r\n      }\r\n    },\r\n    [socket?.id],\r\n  );\r\n\r\n  const onChangeChat = React.useCallback(\r\n    (chat: ChatRoom) => {\r\n      dispatch({\r\n        type: 'SET_ACTIVE_ROOM',\r\n        payload: {\r\n          groupId: (chat as Group)?.groupId,\r\n          contactId: chat?.userId,\r\n        },\r\n      });\r\n      onEnterRoom(chat);\r\n    },\r\n    [socket?.id, dispatch],\r\n  );\r\n\r\n  const onEnterRoom = React.useCallback(\r\n    (chat: ChatRoom) => {\r\n      if (!chat.messages || chat.messages.length === 0) return;\r\n      if ((chat as Group).groupId) {\r\n        socket?.emit('markAsRead', {\r\n          groupId: (chat as Group).groupId,\r\n          _id: chat.messages[chat.messages.length - 1]._id,\r\n        });\r\n      } else {\r\n        socket?.emit('markAsRead', {\r\n          contactId: chat.userId,\r\n          _id: chat.messages[chat.messages.length - 1]._id,\r\n        });\r\n      }\r\n    },\r\n    [socket?.id],\r\n  );\r\n\r\n  const onVideoCall = React.useCallback(\r\n    (chat: ChatRoom, visitId?: number, recreate?: boolean) => {\r\n      // console.log('-----------', {\r\n      //   groupId: (chat as Group).groupId,\r\n      //   contactId: chat.userId,\r\n      //   visitId,\r\n      //   recreate: visitId ? true : false,\r\n      // });\r\n      socket?.emit('startConference', {\r\n        groupId: (chat as Group).groupId,\r\n        contactId: chat.userId,\r\n        visitId,\r\n        recreate,\r\n      });\r\n    },\r\n    [socket?.id],\r\n  );\r\n\r\n  const onVideoEnd = React.useCallback(\r\n    (conference: ConferenceData | null) => {\r\n      if (conference?.id != null)\r\n        socket?.emit('stopConference', {\r\n          id: conference?.id,\r\n        });\r\n    },\r\n    [socket?.id],\r\n  );\r\n\r\n  const onConferencePause = React.useCallback(\r\n    (conference: ConferenceData | null) => {\r\n      if (conference?.id != null)\r\n        socket?.emit('pauseConference', {\r\n          id: conference.id,\r\n        });\r\n    },\r\n    [socket?.id],\r\n  );\r\n\r\n  const onConferenceCallAccept = React.useCallback(\r\n    (conference: ConferenceData) => {\r\n      // отправляем resumeConference чтобы возобновить запись\r\n      if (conference?.id != null)\r\n        socket?.emit('resumeConference', {\r\n          id: conference.id,\r\n        });\r\n      dispatch({ type: 'JOIN_CONFERENCE', payload: conference });\r\n    },\r\n    [socket?.id, dispatch],\r\n  );\r\n\r\n  const onOperatorAdd = React.useCallback(\r\n    (group: Group, operator: Contact) => {\r\n      socket?.emit('addOperator', {\r\n        groupId: group.groupId,\r\n        operatorId: operator.userId,\r\n      });\r\n    },\r\n    [socket?.id],\r\n  );\r\n\r\n  const onLeaveGroup = React.useCallback(\r\n    (group: Group) => {\r\n      socket?.emit('deleteGroup', {\r\n        groupId: group.groupId,\r\n      });\r\n    },\r\n    [socket?.id],\r\n  );\r\n\r\n  React.useEffect(() => {\r\n    if (activeChatUserId != null && !isEmpty(state.contactGather)) {\r\n      const Chat = Object.values(state.contactGather).find(\r\n        (item) => item.userId === activeChatUserId,\r\n      );\r\n      onChangeChat(Chat);\r\n    }\r\n\r\n    const mmkId = getParam('mmk');\r\n    const guid = getParam('guid');\r\n    if (\r\n      (mmkId != null || guid != null) &&\r\n      !isEmpty(state.contactGather)\r\n    ) {\r\n      //console.log(\"mmkId\", mmkId);\r\n      const changeChatByMmkId = async () => {\r\n        const userId = await getUserByMmk(mmkId, guid);\r\n        if (userId != null) {\r\n          const Chat = Object.values(state.contactGather).find(\r\n            (item) => item.userId === userId,\r\n          );\r\n          onChangeChat(Chat);\r\n        }\r\n      };\r\n      changeChatByMmkId();\r\n    }\r\n  }, [state.contactGather]);\r\n\r\n  React.useEffect(() => {\r\n    if (activeGroupId != null && !isEmpty(state.groupGather)) {\r\n      const onlyChat = Object.values(state.groupGather).find(\r\n        (item) => item.groupId === activeGroupId,\r\n      );\r\n\r\n      if (!isEmpty(onlyChat)) {\r\n        onChangeChat(onlyChat);\r\n      }\r\n    }\r\n  }, [state.groupGather]);\r\n\r\n  // Отключили проигрыш звука\r\n  // React.useEffect(() => {\r\n  //   if (\r\n  //     state.conference.data?.id &&\r\n  //     state.conference.ringPlayed &&\r\n  //     !state.conference.joined\r\n  //   )\r\n  //     ringAudio.play();\r\n  //   else ringAudio.pause();\r\n  // }, [state.conference.data?.id, state.conference.ringPlayed]);\r\n\r\n  // console.log('state--', state);\r\n  const renderRoom = state.activeRoom != null && (\r\n    <Room\r\n      apiUrl={apiUrl}\r\n      user={state.user}\r\n      users={state.userGather}\r\n      operators={state.operators}\r\n      chat={state.activeRoom}\r\n      typing={state.typing}\r\n      conference={state.conference.data}\r\n      visitData={state.visitData}\r\n      conferenceJoined={state.conference.joined}\r\n      loading={state.loading}\r\n      pageSize={pageSize}\r\n      onExitRoom={onExitActiveRoom}\r\n      onEnterRoom={onEnterRoom}\r\n      onNeedMoreMessages={onNeedMoreMessages}\r\n      onMeesageDelete={onMessageDelete}\r\n      onTyping={onTyping}\r\n      onSendMessage={onSendMessage}\r\n      onVideoCall={onVideoCall}\r\n      onVideoEnd={onVideoEnd}\r\n      onConferencePause={onConferencePause}\r\n      onOperatorAdd={onOperatorAdd}\r\n      onLeaveGroup={onLeaveGroup}\r\n    />\r\n  );\r\n\r\n  const GetRoomList = () => (\r\n    <RoomList\r\n      apiUrl={apiUrl}\r\n      user={state.user}\r\n      activeRoom={state.activeRoom}\r\n      groups={Object.values(state.groupGather)}\r\n      contacts={Object.values(state.contactGather)}\r\n      typing={state.typing}\r\n      onChangeChat={onChangeChat}\r\n    />\r\n  );\r\n\r\n  const GetConferenceCall = () =>\r\n    state.conference.data && (\r\n      <ConferenceCall\r\n        apiUrl={apiUrl}\r\n        contact={\r\n          state.contactGather[\r\n            state.user.userId === state.conference.data.userId\r\n              ? state.conference.data.contactId\r\n              : state.conference.data.userId\r\n          ]\r\n        }\r\n        conference={state.conference.data}\r\n        onAccept={onConferenceCallAccept}\r\n      />\r\n    );\r\n\r\n  const GetConference = () => (\r\n    <Conference\r\n      conference={state.conference.data}\r\n      onClose={onConferencePause}\r\n      langCode={state.user.langCode}\r\n    />\r\n  );\r\n\r\n  // const getMessCount = (data: GroupGather) => {\r\n  //   const messages = ;\r\n  //   return messages.reduce((a: number, b: number) => a + b, 0);\r\n  // };\r\n\r\n  const depsContats = state.conference.data?.id\r\n    ? [\r\n        state.conference.joined,\r\n        state.conference.data?.id,\r\n        state.conference.data?.contactId,\r\n        state.activeRoom?.groupId,\r\n        state.activeRoom?.userId,\r\n      ]\r\n    : [\r\n        state.activeRoom,\r\n        allMessCount(state.groupGather),\r\n        allMessCount(state.contactGather),\r\n      ];\r\n\r\n  const Contacts = React.useMemo(\r\n    () =>\r\n      state.conference.data?.id != null ? (\r\n        <>\r\n          {state.conference.joined ? (\r\n            <GetConference />\r\n          ) : (\r\n            <GetConferenceCall />\r\n          )}\r\n          <Box className={classes.conAbsOnConf}>\r\n            <Paper style={{ borderRadius: 8 }}>\r\n              <Box display=\"flex\" flexDirection=\"row\" my={3}>\r\n                {((isEmpty(state.activeRoom) && isMobile) ||\r\n                  (!isEmpty(state.activeRoom) && !isMobile)) && (\r\n                  <>\r\n                    <CheckAudiVideoPerm audio={true} video={false} />\r\n                    <CheckAudiVideoPerm audio={false} video={true} />\r\n                  </>\r\n                )}\r\n\r\n                {isEmpty(state.activeRoom) &&\r\n                  state.chatOld != null &&\r\n                  isMobile && (\r\n                    <Tooltip title={t('CHAT.CONFERENCE.BACK')}>\r\n                      <IconButton\r\n                        aria-label=\"check\"\r\n                        onClick={() =>\r\n                          state.chatOld != null &&\r\n                          onChangeChat(state.chatOld)\r\n                        }\r\n                        size=\"large\"\r\n                      >\r\n                        <ArrowForward />\r\n                      </IconButton>\r\n                    </Tooltip>\r\n                  )}\r\n              </Box>\r\n            </Paper>\r\n          </Box>\r\n        </>\r\n      ) : (\r\n        <GetRoomList />\r\n      ),\r\n\r\n    depsContats,\r\n  );\r\n\r\n  console.log('chat state', state);\r\n\r\n  return (\r\n    <Container\r\n      maxWidth=\"lg\"\r\n      className={classes.root}\r\n      sx={(theme) => ({\r\n        width: inModale\r\n          ? `calc(100vw - ${theme.spacing(8)})`\r\n          : '100%',\r\n      })}\r\n    >\r\n      {isMobile ? (\r\n        <>\r\n          {Contacts}\r\n          {renderRoom}\r\n        </>\r\n      ) : (\r\n        <Grid container spacing={1} className={classes.innerGrid}>\r\n          <Grid\r\n            item\r\n            sm={state.conference.data?.id != null ? 6 : 4}\r\n            className={classes.innerGrid}\r\n          >\r\n            {Contacts}\r\n          </Grid>\r\n\r\n          <Grid\r\n            item\r\n            sm={state.conference.data?.id != null ? 6 : 8}\r\n            className={classes.innerGrid}\r\n          >\r\n            {renderRoom}\r\n          </Grid>\r\n        </Grid>\r\n      )}\r\n\r\n      <ChatAlert />\r\n    </Container>\r\n  );\r\n};\r\n","import i18n from 'i18next';\r\nimport { initReactI18next } from 'react-i18next';\r\nimport en from './en.json';\r\nimport fr from './fr.json';\r\nimport ru from './ru.json';\r\n\r\nimport LanguageDetector from 'i18next-browser-languagedetector';\r\nconst getLang = () => {\r\n  const str = localStorage.getItem('user');\r\n  if (str) {\r\n    const user = JSON.parse(str);\r\n    return user?.lang;\r\n  }\r\n  return 'ru';\r\n};\r\n\r\nconst lang = getLang();\r\n\r\ni18n\r\n  .use(LanguageDetector)\r\n  .use(initReactI18next)\r\n  .init({\r\n    resources: {\r\n      ru: { translations: ru },\r\n      en: { translations: en },\r\n      fr: { translations: fr },\r\n    },\r\n    lng: lang,\r\n    load: 'languageOnly',\r\n    fallbackLng: lang,\r\n    debug: true,\r\n\r\n    // have a common namespace used around the full app\r\n    ns: ['translations'],\r\n    defaultNS: 'translations',\r\n    lowerCaseLng: true,\r\n  });\r\n\r\nexport default i18n;\r\n","import React, {\r\n  useContext,\r\n  useReducer,\r\n  Dispatch,\r\n  createContext,\r\n} from 'react';\r\nimport { I18nextProvider } from 'react-i18next';\r\nimport i18n from '../translations';\r\n\r\ninterface LanguageState {\r\n  language: Language;\r\n}\r\n\r\ntype Language = 'ru' | 'fr' | 'en';\r\n\r\ntype Action = {\r\n  type: 'RU' | 'FR' | 'EN';\r\n  payload: Language;\r\n};\r\ninterface LanguageContextI {\r\n  languageState: LanguageState;\r\n  dispatchLanguage: Dispatch<Action>;\r\n}\r\n\r\nconst languageWithoutCountry = (): Language => {\r\n  return i18n.language.substring(0, 2) as Language;\r\n};\r\n\r\nexport const LANGUAGES: Record<string, Language> = {\r\n  RU: 'ru',\r\n  FR: 'fr',\r\n  EN: 'en',\r\n};\r\n\r\nexport const LANGUAGES_ACTIONS = {\r\n  SET_RUSSIAN: 'SET_RUSSIAN',\r\n  SET_ENGLISH: 'SET_ENGLISH',\r\n  SET_FRENCH: 'SET_FRENCH',\r\n};\r\n\r\nconst reducer = (\r\n  state: LanguageState,\r\n  action: Action,\r\n): LanguageState => {\r\n  switch (action.type) {\r\n    case LANGUAGES_ACTIONS.SET_ENGLISH:\r\n      i18n.changeLanguage('en');\r\n      return { language: LANGUAGES.EN };\r\n    case LANGUAGES_ACTIONS.SET_FRENCH:\r\n      i18n.changeLanguage('fr');\r\n      return { language: LANGUAGES.FR };\r\n    case LANGUAGES_ACTIONS.SET_RUSSIAN:\r\n      i18n.changeLanguage('ru');\r\n      return { language: LANGUAGES.RU };\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n\r\nexport const LanguageContext = createContext({} as LanguageContextI);\r\ninterface AppLanguageProviderProps {\r\n  children: React.ReactNode;\r\n}\r\nexport const AppLanguageProvider: React.FC<AppLanguageProviderProps> = props => {\r\n  const [languageState, dispatchLanguage] = useReducer(reducer, {\r\n    language: languageWithoutCountry(),\r\n  });\r\n\r\n  return (\r\n    <LanguageContext.Provider\r\n      value={{\r\n        languageState,\r\n        dispatchLanguage,\r\n      }}\r\n    >\r\n      <I18nextProvider i18n={i18n}>{props.children}</I18nextProvider>\r\n    </LanguageContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useLanguageValue = () => useContext(LanguageContext);\r\n","import React from 'react';\r\nimport { ChatProps } from '../../types'; // TODO: upgrade to latest eslint tooling\r\n\r\nimport { AppLanguageProvider } from '../../context/LanguageContext';\r\nimport { ChatProvider } from '../../context/ChatContext';\r\nimport { RestProvider } from '../../context/RestContext';\r\nimport { SocketProvider } from '../../context/SocketContext';\r\nimport { ChatPage } from '../../pages/chat';\r\n\r\nexport const ChatIndex: React.FC<ChatProps> = ({\r\n  activeGroupId,\r\n  activeChatUserId,\r\n  lang,\r\n  chatBaseURLApi,\r\n  chatWsUrl,\r\n  chatWsPath,\r\n  token,\r\n  inModale = false,\r\n  refreshToken,\r\n}: ChatProps) => {\r\n  return (\r\n    <AppLanguageProvider>\r\n      <ChatProvider\r\n        defLang={lang}\r\n        token={token}\r\n        refreshToken={refreshToken}\r\n      >\r\n        <RestProvider baseURLApi={chatBaseURLApi} pageSize={25}>\r\n          <SocketProvider wsUrl={chatWsUrl} wsPath={chatWsPath}>\r\n            <ChatPage\r\n              activeGroupId={activeGroupId}\r\n              activeChatUserId={activeChatUserId}\r\n              inModale={inModale}\r\n            />\r\n          </SocketProvider>\r\n        </RestProvider>\r\n      </ChatProvider>\r\n    </AppLanguageProvider>\r\n  );\r\n};\r\n"],"names":["MessageStatus","Role","ContextMenuType","useStyles","makeStyles","createStyles","item","cursor","Emoji","props","classes","emojiClick","e","onSelect","target","innerText","Item","itemProps","React.createElement","Box","emoji","theme","typingText","paddingLeft","spacing","typingDot","display","verticalAlign","width","height","margin","background","palette","primary","main","borderRadius","opacity","animation","animationDelay","Typing","React","Typography","message","input","flex","inputUpload","attachmentIcon","fill","stroke","getImageSize","data","Entry","chat","useTranslation","t","useState","empjiEl","setEmojiEl","text","setText","time","lastTyping","setLastTyping","handleEmojiClick","event","currentTarget","handleEmojiClose","emojiSelect","onChange","value","onTyping","Date","now","sendMessage","onSendMessage","submit","trim","length","messageType","onSubmitClick","preventDefault","onKeyPress","key","onSubmitFile","files","file","type","includes","image","Image","url","window","URL","webkitURL","src","createObjectURL","onload","imageSize","fileName","name","size","emojiOpen","Boolean","enojiId","undefined","TextField","disableUnderline","startAdornment","InputAdornment","IconButton","SvgIcon","InsertEmoticon","endAdornment","Send","Popover","vertical","horizontal","ContactStatus","isTyping","contact","online","isEmpty","Object","keys","formatTime","format","dayjs","add","startOf","isAfter","getFileMeta","content","meta","split","date","userId","splitFileName","idx","lastIndexOf","ext","slice","getChatId","groupId","getChatName","username","allMessCount","chats","values","map","it","messages","reduce","a","b","chatRoomComparer","hasMessagesA","Array","isArray","hasMessagesB","bb","cdate","getTime","aa","res","getParam","param","QueryString","location","search","urlParams","URLSearchParams","get","combineURLs","baseURL","relativeURL","queryParams","replace","toString","star","fontSize","ContactList","apiUrl","contacts","owner","List","ListItem","onClick","ListItemAvatar","Avatar","avatar","ListItemText","AddContact","onClose","open","handleClose","handleListItemClick","Dialog","DialogTitle","useCounter","max","counter","setCounter","counterRef","useRef","handlerRefresh","useEffect","current","setInterval","prev","clearInterval","Transition","forwardRef","ref","Slide","AlertDialog","children","setOpen","severity","DialogContent","Alert","DialogActions","Button","hhMmSs","totalSeconds","hours","Math","floor","strHours","minutes","strMinutes","seconds","strSeconds","strTime","AlertModale","modaleInfo","setModaleInfo","useMemo","ConferenceTime","finishDate","currTime","finTime","diffTimeSec","round","ConfirmDialogSlide","contentText","callback","handleCloseOk","React.Fragment","StyledMenu","styled","marginTop","minWidth","color","mode","grey","boxShadow","padding","secondary","marginRight","backgroundColor","alpha","action","selectedOpacity","getVisitMessage","visit","visitDate","plExamName","duration","ConferenceButton","anchorEl","setAnchorEl","visitId","setVisitId","confirmReCreateVisit","setConfirmReCreateVisit","handleClick","handleStart","conferenceStatus","onVideoCall","visitData","filter","contactId","popover","pointerEvents","paper","avatarGroup","getGroupStatus","group","status","members","onlineCount","sum","push","join","RoomHeader","user","typing","conference","conferenceJoined","className","operators","onVideoEnd","onConferencePause","onOperatorAdd","onLeaveGroup","addOperatorOpen","setAddOperatorOpen","CardHeader","handlePopoverOpen","handlePopoverClose","handleAddOperatorOpen","handleAddOperatorClose","operator","role","find","marginLeft","fileIcon","fileBody","File","toUpperCase","mediaContent","maxWidth","maxHeight","breakpoints","down","Video","isConference","JSON","parse","img","aspect","setViewerData","AspectRatio","visible","MessageContent","rootContact","borderTopRightRadius","borderBottomRightRadius","borderTopLeftRadius","borderBottomLeftRadius","marginBottom","rootUser","paddingRight","justifyContent","contrastText","rootNotify","fontWeight","firstMessage","lastMessage","flexDirection","flexWrap","header","overflow","body","wordBreak","alignSelf","statusImage","wrapMessage","isUserFirst","isUserLast","onContextMenu","child","Link","isMedia","Message","isGroupMessage","isRevoke","revokeUserName","isMine","Done","DoneAll","messageListOuter","overflowY","messageList","scrollbarWidth","scrollbarColor","light","arrowDown","position","left","bottom","Loading","loading","mx","textAlign","CircularProgress","RoomMessageList","users","pageSize","setMenuState","initialMenuState","scrollDownButton","setScrollDownButton","scrollDo","setScrollDo","messageCount","refList","handleMenuPopup","canCopy","canDelete","onMeesageDelete","mouseX","clientX","mouseY","clientY","viewerData","setTimeout","scrollDown","scrollTop","scrollHeight","handlerScrollDown","CardContent","onNeedMoreMessages","noMoreData","gap","isShowButton","inx","Fab","KeyboardArrowDown","Backdrop","zIndex","drawer","root","roomHeader","flexAll","flexEnd","Room","isMobile","useMediaQuery","menuState","handleMenuClose","handleCopy","useCallback","navigator","clipboard","writeText","handleDelete","Card","Tooltip","onExitRoom","Divider","Menu","top","MenuItem","ListItemIcon","whiteSpace","textOverflow","unread","getMessageText","TypingBadge","withStyles","badge","border","transform","Badge","OnlineBadge","contactAvatar","RoomListItem","roomName","roomText","roomTime","active","component","unreadCount","Chip","searchField","listStyle","filterChats","lowerFilter","toLowerCase","indexOf","sortChats","groups","roomArr","sort","topChatId","localStorage","getItem","c","k","isTop","unshift","RoomList","setChats","onSearchChange","activeRoom","onChangeChat","updateUrlParameter","regex","RegExp","transLang","lang","Conference","langCode","confUrl","listener","source","contentWindow","addEventListener","removeEventListener","id","alignItems","pulse","footer","paddingTop","ConferenceCall","onAccept","Paper","emptyUser","password","emptyChatState","token","refreshToken","chatOld","groupGather","userGather","contactGather","initialContactId","joined","ringPlayed","error","success","getFreshActiveRoom","state","getActiveRoom","newActiveRoom","rooms","setUserOnline","newState","member","m","index","findIndex","addGroupMessage","payload","groupUnreadGather","x","addPrivateMessage","contactUnreadGather","predicate","revokeMessage","userName","msg","_id","delContact","updateActiveRoom","delGroup","delGroupMember","updateGroupInfo","notice","info","updateUserInfo","addGroupMember","isManager","markPrivateMessagesRead","updatedValue","i","addPrivateMessages","addGroupMessages","userArr","setActiveRoom","setToken","clearUser","setConference","pauseConference","stopConference","chatReducer","emptyDispatch","ChatContext","createContext","dispatch","ChatProvider","defLang","chatState","useReducer","initialContext","RestContext","clearLocalStorage","removeItem","signOut","axios","post","console","log","href","getRefreshToken","authToken","setItem","RestProvider","baseURLApi","useContext","errorInterceptor","response","fetch","create","timeout","headers","Pragma","Authorization","withCredentials","interceptors","use","Promise","reject","getPrivateMessages","params","err","getGroupMessages","getUserByMmk","mmkId","guid","useSocket","path","accessToken","socket","setSocket","connectSocket","socketTemp","io","reconnection","extraHeaders","disconnectSocket","disconnect","setOnline","connected","on","emit","SocketContext","SocketProvider","wsUrl","wsPath","off","code","groupArr","groupData","contactArr","contactData","userData","operatorData","user_","conferenceData","newUser","groupObj","timer","clearTimeout","CheckAudiVideoPerm","audio","video","checkPermissions","permissions","mediaDevices","getUserMedia","then","title","ChatAlert","Snackbar","innerGrid","conAbsOnConf","ChatPage","activeGroupId","activeChatUserId","inModale","onExitActiveRoom","onMessageDelete","onEnterRoom","recreate","onConferenceCallAccept","operatorId","Chat","changeChatByMmkId","onlyChat","renderRoom","GetRoomList","GetConferenceCall","GetConference","depsContats","Contacts","ArrowForward","Container","Grid","getLang","str","i18n","LanguageDetector","initReactI18next","init","resources","ru","translations","en","fr","lng","load","fallbackLng","debug","ns","defaultNS","lowerCaseLng","languageWithoutCountry","language","substring","LANGUAGES","RU","FR","EN","LANGUAGES_ACTIONS","SET_RUSSIAN","SET_ENGLISH","SET_FRENCH","reducer","changeLanguage","LanguageContext","AppLanguageProvider","languageState","dispatchLanguage","I18nextProvider","ChatIndex","chatBaseURLApi","chatWsUrl","chatWsPath"],"mappings":"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"}