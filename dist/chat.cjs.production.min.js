"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t,n,r,a=require("@mui/material"),o=require("react"),i=e(o),l=require("react-i18next"),c=e(require("@mui/icons-material/Star")),s=require("@mui/styles"),u=e(require("dayjs")),d=require("@mui/icons-material"),m=require("react-aspect-ratio"),p=e(require("@mui/icons-material/Delete")),f=e(require("@mui/icons-material/FileCopy")),g=e(require("@mui/icons-material/CallEnd")),E=e(require("@mui/icons-material/Group")),h=e(require("@mui/icons-material/Pause")),v=e(require("@mui/icons-material/PersonAdd")),y=e(require("@mui/icons-material/KeyboardArrowDown")),C=e(require("@mui/icons-material/PlayArrow")),R=e(require("@mui/icons-material/RestartAlt")),T=e(require("@mui/icons-material/VideoCall")),x=e(require("@mui/material/Button")),S=e(require("@mui/material/Menu")),I=e(require("@mui/material/MenuItem")),b=require("@mui/material/styles"),A=e(require("@mui/material/Dialog")),k=e(require("@mui/material/DialogActions")),w=e(require("@mui/material/DialogContent")),O=e(require("@mui/material/Slide")),_=e(require("react-infinite-scroll-hook")),G=e(require("@mui/material/List")),N=e(require("axios")),D=e(require("@mui/icons-material/RecentActors")),M=e(require("@mui/icons-material/Videocam")),j=e(require("@mui/icons-material/SettingsSuggest")),L=e(require("@mui/icons-material/SettingsVoice")),U=e(require("socket.io-client"));function P(e,t,n,r,a,o,i){try{var l=e[o](i),c=l.value}catch(e){return void n(e)}l.done?t(c):Promise.resolve(c).then(r,a)}function F(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){P(o,r,a,i,l,"next",e)}function l(e){P(o,r,a,i,l,"throw",e)}i(void 0)}))}}function H(){return(H=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function B(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t.indexOf(n=o[r])>=0||(a[n]=e[n]);return a}function z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function V(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return z(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?z(e,void 0):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function q(e){return null==e||"object"==typeof e&&0===Object.keys(e).length||"string"==typeof e&&0===e.trim().length}function Y(e,t){return void 0===t&&(t="DD.MM.YYYY HH:mm"),void 0===e?null:("string"==typeof e&&(e=new Date(e)),u().add(-1,"days").startOf("day").isAfter(e)?u(e).format(t):u().startOf("day").isAfter(e)?"Ð’Ñ‡ÐµÑ€Ð° Ð² "+u(e).format("HH:mm"):u(e).format("HH:mm"))}(t=exports.MessageStatus||(exports.MessageStatus={}))[t.sent=0]="sent",t[t.read=1]="read",(n=exports.Role||(exports.Role={}))[n.Unknown=0]="Unknown",n[n.Client=1]="Client",n[n.Agent=2]="Agent",n[n.Specialist=3]="Specialist",n[n.Operator=4]="Operator",(r=exports.ContextMenuType||(exports.ContextMenuType={})).COPY="COPY",r.REVOKE="REVOKE",r.TOP_REVERT="TOP_REVERT",r.TOP="TOP",r.READ="READ",r.DELETE="DELETE";var W=function(e){return e?e.groupId?"group:"+e.groupId:"user:"+e.userId:null},K=function(e){return e.groupId?e.name:e.username},$=function(e){return"groupId"in e},J=function(e,t){var n=Array.isArray(e.messages)&&e.messages.length>0,r=Array.isArray(t.messages)&&t.messages.length>0;return n&&r&&null!=t.messages&&null!=e.messages?(null!=t.messages[t.messages.length-1].cdate?new Date(t.messages[t.messages.length-1].cdate).getTime():(new Date).getTime())-(null!=e.messages[e.messages.length-1].cdate?new Date(e.messages[e.messages.length-1].cdate).getTime():(new Date).getTime()-1):n?-1:1},X=function(e){var t=window.location.search;return new URLSearchParams(t).get(e)},Q=function(e,t,n){var r=t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e;return n?r+(r.includes("?")?"&":"?")+new URLSearchParams(n).toString():r},Z=s.makeStyles((function(e){return s.createStyles({typingText:{paddingLeft:e.spacing(.5)},typingDot:{display:"inline-block",verticalAlign:"middle",width:4,height:4,margin:"0px 2px",background:e.palette.primary.main,borderRadius:"50%",opacity:"0",animation:"$loadingFade 1s infinite","&:nth-child(1)":{animationDelay:"0s"},"&:nth-child(2)":{animationDelay:"0.2s"},"&:nth-child(3)":{animationDelay:"0.4s"}},"@keyframes loadingFade":{"0%":{opacity:0},"50%":{opacity:.8},"100%":{opacity:0}}})})),ee=function(e){var t=Z();return i.createElement(a.Typography,{color:"primary",variant:"body2",component:"span"},i.createElement("span",{className:t.typingDot}),i.createElement("span",{className:t.typingDot}),i.createElement("span",{className:t.typingDot}),i.createElement("span",{className:t.typingText},e.message))},te=function(e){var t=l.useTranslation().t;return e.isTyping?i.createElement(ee,{message:t("CHAT.STATUS.TYPING")}):1===e.contact.online?i.createElement(a.Typography,{variant:"body2",color:"primary",component:"span"},t("CHAT.STATUS.ONLINE")):i.createElement(a.Typography,{variant:"body2",color:"textSecondary",component:"span"},t("CHAT.STATUS.OFFLINE"))},ne=["apiUrl","contacts","owner","onContactClick"],re=s.makeStyles((function(){return{star:{fontSize:"0.85rem",verticalAlign:"middle"}}})),ae=function(e){var t=re(),n=e.apiUrl,r=e.contacts,o=e.owner,l=e.onContactClick,s=B(e,ne);return i.createElement(a.List,H({},s,{"aria-label":"contacts"}),r.map((function(e){return i.createElement(a.ListItemButton,{key:e.userId,onClick:function(){return l&&l(e)}},i.createElement(a.ListItemAvatar,null,i.createElement(a.Avatar,{alt:e.username,src:e.avatar?Q(n,e.avatar):""})),i.createElement(a.ListItemText,{primary:i.createElement("span",null,e.username," ",o===e.userId&&i.createElement(c,{className:t.star,color:"primary"})),secondary:i.createElement(te,{contact:e,isTyping:!1})}))})))},oe=function(e){var t=e.onClose,n=e.open,r=e.apiUrl,o=e.contacts,c=l.useTranslation();return i.createElement(a.Dialog,{onClose:function(){t()},"aria-labelledby":"add-contact-title",open:n},i.createElement(a.DialogTitle,{id:"switch-operator-title"},(0,c.t)("CHAT.ADD_CONTACT")),i.createElement(ae,{apiUrl:r,contacts:o,onContactClick:function(e){t(e)}}))},ie=s.makeStyles((function(){return{root:{width:"100%",height:"100%",borderRadius:4}}})),le=function(e){var t=e.conference,n=e.onClose,r=e.langCode,a=void 0===r?"rus":r,l=ie(),c=i.useRef(null),s=null==t?void 0:t.url;console.log("confUrl",s);var u=["connectionFail","loginFail","callFail","hangUp","remoteHangUp","logout","connectionClosed"];return o.useEffect((function(){var e=function(e){var r;e.source===(null==(r=c.current)?void 0:r.contentWindow)&&u.includes(e.data.type)&&n(t)};return window.addEventListener("message",e),function(){window.removeEventListener("message",e)}}),[null==t?void 0:t.id,a]),i.createElement("iframe",{title:"conference",className:l.root,src:s,allowFullScreen:!0,allow:"microphone; camera; autoplay; display-capture",ref:c})},ce=s.makeStyles((function(){return{root:{width:"100%",height:"100%",borderRadius:8,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},pulse:{height:100,width:100,borderRadius:"50%",display:"flex",justifyContent:"center",alignItems:"center",position:"relative","&::before":{content:"''",position:"absolute",border:"1px solid green",width:"calc(100% + 40px)",height:"calc(100% + 40px)",borderRadius:"50%",animation:"$pulse 1s linear infinite"},"&::after":{content:"''",position:"absolute",border:"1px solid green",width:"calc(100% + 40px)",height:"calc(100% + 40px)",borderRadius:"50%",animation:"$pulse 1s linear infinite",animationDelay:"0.3s"}},avatar:{width:"80%",height:"80%"},footer:{width:"100%",alignSelf:"flex-end",paddingTop:64,display:"flex",justifyContent:"center"},"@keyframes pulse":{"0%":{transform:"scale(0.5)",opacity:0},"50%":{transform:"scale(1)",opacity:1},"100%":{transform:"scale(1.3)",opacity:0}}}})),se=function(e){var t=e.conference,n=e.contact,r=e.apiUrl,o=e.onAccept,c=ce(),s=l.useTranslation().t;return i.createElement(a.Paper,{className:c.root},i.createElement("div",{className:c.pulse},i.createElement(a.Avatar,n?{className:c.avatar,alt:n.username,src:n.avatar?Q(r,n.avatar):""}:{className:c.avatar})),i.createElement("div",{className:c.footer},i.createElement(a.Button,{variant:"contained",color:"primary",onClick:function(){return o(t)}},s("CHAT.CONFERENCE.JOIN"))))},ue=s.makeStyles((function(){return s.createStyles({item:{cursor:"pointer"}})})),de=function(e){var t=ue(),n=function(t){e.onSelect&&e.onSelect(t.target.innerText)},r=function(e){return o.createElement(a.Box,{m:.5,component:"span",onClick:n,className:t.item},e.emoji)};return o.createElement(a.Box,null,o.createElement(a.Box,{display:"flex",flexDirection:"row"},o.createElement(r,{emoji:"ðŸ˜ƒ"}),o.createElement(r,{emoji:"ðŸ˜"}),o.createElement(r,{emoji:"ðŸ˜‚"}),o.createElement(r,{emoji:"ðŸ˜„"}),o.createElement(r,{emoji:"ðŸ˜…"}),o.createElement(r,{emoji:"ðŸ˜†"}),o.createElement(r,{emoji:"ðŸ˜‡"}),o.createElement(r,{emoji:"ðŸ˜ˆ"}),o.createElement(r,{emoji:"ðŸ˜‰"})),o.createElement(a.Box,{display:"flex",flexDirection:"row"},o.createElement(r,{emoji:"ðŸ˜Š"}),o.createElement(r,{emoji:"ðŸ˜‹"}),o.createElement(r,{emoji:"ðŸ˜Œ"}),o.createElement(r,{emoji:"ðŸ˜"}),o.createElement(r,{emoji:"ðŸ˜Ž"}),o.createElement(r,{emoji:"ðŸ˜"}),o.createElement(r,{emoji:"ðŸ˜"}),o.createElement(r,{emoji:"ðŸ˜’"}),o.createElement(r,{emoji:"ðŸ˜“"})),o.createElement(a.Box,{display:"flex",flexDirection:"row"},o.createElement(r,{emoji:"â“"}),o.createElement(r,{emoji:"ðŸ˜•"}),o.createElement(r,{emoji:"ðŸ˜–"}),o.createElement(r,{emoji:"ðŸ˜—"}),o.createElement(r,{emoji:"ðŸ˜˜"}),o.createElement(r,{emoji:"ðŸ˜™"}),o.createElement(r,{emoji:"ðŸ˜š"}),o.createElement(r,{emoji:"ðŸ˜œ"}),o.createElement(r,{emoji:"ðŸ˜"})),o.createElement(a.Box,{display:"flex",flexDirection:"row"},o.createElement(r,{emoji:"ðŸ˜ž"}),o.createElement(r,{emoji:"ðŸ˜Ÿ"}),o.createElement(r,{emoji:"ðŸ˜ "}),o.createElement(r,{emoji:"ðŸ˜¡"}),o.createElement(r,{emoji:"ðŸ˜¢"}),o.createElement(r,{emoji:"ðŸ˜£"}),o.createElement(r,{emoji:"ðŸ˜¤"}),o.createElement(r,{emoji:"ðŸ˜¥"}),o.createElement(r,{emoji:"ðŸ˜¦"})),o.createElement(a.Box,{display:"flex",flexDirection:"row"},o.createElement(r,{emoji:"ðŸ˜¨"}),o.createElement(r,{emoji:"ðŸ˜©"}),o.createElement(r,{emoji:"ðŸ˜ª"}),o.createElement(r,{emoji:"ðŸ˜«"}),o.createElement(r,{emoji:"ðŸ˜¬"}),o.createElement(r,{emoji:"ðŸ˜­"}),o.createElement(r,{emoji:"ðŸ˜®"}),o.createElement(r,{emoji:"ðŸ˜¯"}),o.createElement(r,{emoji:"ðŸ˜°"})),o.createElement(a.Box,{display:"flex",flexDirection:"row"},o.createElement(r,{emoji:"ðŸ˜²"}),o.createElement(r,{emoji:"ðŸ˜³"}),o.createElement(r,{emoji:"ðŸ˜´"}),o.createElement(r,{emoji:"ðŸ˜µ"}),o.createElement(r,{emoji:"ðŸ§"}),o.createElement(r,{emoji:"ðŸ˜·"}),o.createElement(r,{emoji:"ðŸ™"}),o.createElement(r,{emoji:"ðŸ™‚"}),o.createElement(r,{emoji:"ðŸ™ƒ"})),o.createElement(a.Box,{display:"flex",flexDirection:"row"},o.createElement(r,{emoji:"ðŸ¤"}),o.createElement(r,{emoji:"ðŸ¤‘"}),o.createElement(r,{emoji:"ðŸ¤’"}),o.createElement(r,{emoji:"ðŸ¤“"}),o.createElement(r,{emoji:"ðŸ¤”"}),o.createElement(r,{emoji:"ðŸ¤•"}),o.createElement(r,{emoji:"ðŸ¤ "}),o.createElement(r,{emoji:"ðŸ¤¡"}),o.createElement(r,{emoji:"ðŸ¤¢"})),o.createElement(a.Box,{display:"flex",flexDirection:"row"},o.createElement(r,{emoji:"ðŸ¤¤"}),o.createElement(r,{emoji:"ðŸ¤¥"}),o.createElement(r,{emoji:"ðŸ¤§"}),o.createElement(r,{emoji:"ðŸ¤¨"}),o.createElement(r,{emoji:"ðŸ¤©"}),o.createElement(r,{emoji:"ðŸ¤ª"}),o.createElement(r,{emoji:"ðŸ¤«"}),o.createElement(r,{emoji:"ðŸ¤¬"}),o.createElement(r,{emoji:"ðŸ¤­"})))},me=s.makeStyles((function(e){return s.createStyles({fileIcon:{fontSize:"0.75rem"},fileBody:{paddingLeft:e.spacing(1.2)}})})),pe=function(e){var t=e.message,n=me(),r=function(e){var t=e.split("$");return{date:t[0],userId:t[1],size:t[2],name:t[3]}}(t.content),o=function(e){var t=e.lastIndexOf(".");return-1===t?{name:e,ext:""}:{name:e.slice(0,t),ext:e.slice(t+1)}}(r.name),l=o.name,c=o.ext;return i.createElement(a.Box,{display:"flex",flexDirection:"row"},i.createElement(a.Avatar,{className:n.fileIcon},c.toUpperCase()),i.createElement(a.Box,{display:"flex",flexDirection:"column",className:n.fileBody},l,i.createElement("span",null,c+" "+r.size)))},fe=s.makeStyles((function(e){var t,n;return s.createStyles({img:(t={cursor:"pointer",borderRadius:e.spacing(1.2),maxWidth:284,maxHeight:190},t[e.breakpoints.down("sm")]={maxWidth:250,maxHeight:170},t),aspect:(n={maxWidth:284,height:190},n[e.breakpoints.down("sm")]={maxWidth:250,height:170},n)})})),ge=function(e){var t=e.apiUrl,n=e.message,r=e.setViewerData,a=fe();return i.createElement(m.AspectRatio,{ratio:"3/4",className:a.aspect},i.createElement("img",{src:Q(t,"/static/image/"+n.content),onClick:function(){r({visible:!0,src:Q(t,"/static/image/"+n.content)})},className:a.img,alt:n.cdate}))},Ee=s.makeStyles((function(e){var t;return{mediaContent:(t={backgroundColor:e.palette.secondary.main,borderRadius:e.spacing(1.2),maxWidth:284,height:190},t[e.breakpoints.down("sm")]={maxWidth:250,height:170},t)}})),he=function(e){var t=e.apiUrl,n=e.message,r=e.isConference,a=Ee(),o="";if(r){var l=JSON.parse(n.content);o=Q(t,"/static/conf/"+l.visitId+"/"+l.name)}else o=Q(t,"/static/file/"+n.content);return i.createElement("video",{src:o,className:a.mediaContent,controls:!0,muted:!0,preload:"none"},"Ð’Ð°Ñˆ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€ Ð½Ðµ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ Ñ‚ÐµÐ³ video.")},ve=function(e){var t=e.apiUrl,n=e.message,r=e.setViewerData;switch(n.messageType){case"text":return i.createElement(i.Fragment,null,n.content);case"video":case"video_conference":return i.createElement(he,{message:n,apiUrl:t,isConference:"video_conference"===n.messageType});case"image":return i.createElement(ge,{message:n,apiUrl:t,setViewerData:r});case"file":return i.createElement(pe,{message:n})}return null},ye=s.makeStyles((function(e){var t;return s.createStyles({rootContact:{padding:1,paddingLeft:e.spacing(2),"& span":{float:"right",color:e.palette.text.secondary,fontSize:"0.8rem"},"& $message":{backgroundColor:e.palette.grey[200],color:e.palette.text.primary,borderTopRightRadius:e.spacing(3),borderBottomRightRadius:e.spacing(3)},"& $firstMessage":{borderTopLeftRadius:e.spacing(3),marginTop:10},"& $lastMessage":{borderTopRightRadius:e.spacing(3),borderBottomLeftRadius:0,borderBottomRightRadius:e.spacing(3),marginBottom:10}},rootUser:{padding:1,paddingRight:e.spacing(2),justifyContent:"flex-end","& span":{float:"right",color:"#D9DEEC",fontSize:"0.8rem"},"& $message":{backgroundColor:e.palette.primary.main,color:e.palette.primary.contrastText,borderTopLeftRadius:e.spacing(3),borderBottomLeftRadius:e.spacing(3)},"& $firstMessage":{borderTopRightRadius:e.spacing(3),marginTop:10},"& $lastMessage":{borderTopLeftRadius:e.spacing(3),borderBottomRightRadius:0,marginBottom:10}},rootNotify:{justifyContent:"center","& span":{float:"right",color:e.palette.text.secondary,fontSize:"0.8rem"},"& > *":{borderRadius:e.spacing(3),fontWeight:500}},message:(t={maxWidth:"65%"},t[e.breakpoints.down("md")]={maxWidth:"95%"},t[e.breakpoints.down("sm")]={maxWidth:"85%"},t.borderRadius=e.spacing(.6),t.padding=e.spacing(.9),t.paddingLeft=e.spacing(1.8),t.paddingRight=e.spacing(1.8),t),firstMessage:{},lastMessage:{},file:{display:"flex",flexDirection:"row",flexWrap:"wrap",cursor:"pointer"},header:{flex:"0 0 100%",overflow:"hidden",fontWeight:"bold"},body:{flex:"1 1 auto",wordBreak:"break-word",overflow:"hidden"},status:{paddingLeft:e.spacing(1),flex:"1 1 auto",alignSelf:"flex-end"},statusImage:{fontSize:"1rem",marginRight:e.spacing(.5),verticalAlign:"middle"}})})),Ce=o.memo(o.forwardRef((function(e,t){var n=ye(),r=l.useTranslation().t,o=e.apiUrl,c=e.message,s=e.owner,u=e.user,m=e.isGroupMessage,p=e.isUserFirst,f=e.isUserLast,g=e.setViewerData;if("notify"===c.messageType){var E="{"===c.content[0]?JSON.parse(c.content):c.content;return i.createElement(a.ListItem,{className:n.rootNotify,ref:t},i.createElement(a.Alert,{severity:"string"==typeof E?"info":E.severity},"string"==typeof E?E:E.message))}if(c.isRevoke)return i.createElement(a.ListItem,{className:n.rootNotify,ref:t},i.createElement(a.Typography,{variant:"body2",align:"center"},c.userId===u.userId?r("CHAT.MESSAGE.REVOKED.YOU"):c.revokeUserName+" "+r("CHAT.MESSAGE.REVOKED.CONTACT")));var h=u.userId===c.userId;return i.createElement(a.ListItem,{ref:t,className:"video_conference"===c.messageType?n.rootNotify:h?n.rootUser:n.rootContact},function(e,t,n,r,o,l,c){var s=t.messageType,u=r&&o?n.message+" "+n.firstMessage+" "+n.lastMessage:r?n.message+" "+n.firstMessage:o?n.message+" "+n.lastMessage:n.message;return"file"===s?i.createElement(a.Link,{className:u+" "+n.file,underline:"none",href:Q(e,"/static/file/"+t.content),target:"_blank",download:!0,onContextMenu:l},c):i.createElement(a.Box,{display:"flex",flexDirection:"image"===s||"video"===s||"video_conference"===s?"column":"row",flexWrap:"wrap",className:u,onContextMenu:l},c)}(o,c,n,p,f,e.onContextMenu,i.createElement(i.Fragment,null,!h&&m&&s&&p&&i.createElement("div",{className:n.header},s.username),i.createElement("div",{className:n.body},i.createElement(ve,{message:c,apiUrl:o,setViewerData:g})),i.createElement("div",{className:n.status},i.createElement("span",null,h?i.createElement(0===c.status?d.Done:d.DoneAll,{className:n.statusImage}):null,Y(c.cdate))))))})));Ce.displayName="Message";var Re,Te=(function(e){var t=function(e){var t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",i=r.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var a=Object.create((t&&t.prototype instanceof d?t:d).prototype),o=new x(r||[]);return a._invoke=function(e,t,n){var r="suspendedStart";return function(a,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw o;return{value:void 0,done:!0}}for(n.method=a,n.arg=o;;){var i=n.delegate;if(i){var l=C(i,n);if(l){if(l===u)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=s(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}(e,n,o),a}function s(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var u={};function d(){}function m(){}function p(){}var f={};l(f,a,(function(){return this}));var g=Object.getPrototypeOf,E=g&&g(g(S([])));E&&E!==t&&n.call(E,a)&&(f=E);var h=p.prototype=d.prototype=Object.create(f);function v(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){var r;this._invoke=function(a,o){function i(){return new t((function(r,i){!function r(a,o,i,l){var c=s(e[a],e,o);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,i,l)}),(function(e){r("throw",e,i,l)})):t.resolve(d).then((function(e){u.value=e,i(u)}),(function(e){return r("throw",e,i,l)}))}l(c.arg)}(a,o,r,i)}))}return r=r?r.then(i,i):i()}}function C(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,C(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var r=s(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,u;var a=r.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function S(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:I}}function I(){return{value:void 0,done:!0}}return m.prototype=p,l(h,"constructor",p),l(p,"constructor",m),m.displayName=l(p,i,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,l(e,i,"GeneratorFunction")),e.prototype=Object.create(h),e},e.awrap=function(e){return{__await:e}},v(y.prototype),l(y.prototype,o,(function(){return this})),e.AsyncIterator=y,e.async=function(t,n,r,a,o){void 0===o&&(o=Promise);var i=new y(c(t,n,r,a),o);return e.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},v(h),l(h,i,"Generator"),l(h,a,(function(){return this})),l(h,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=S,x.prototype={constructor:x,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return i.type="throw",i.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],i=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var l=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(l&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;T(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:S(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}}(Re={exports:{}}),Re.exports),xe={image:["image/jpeg","image/png","image/gif","image/bmp"],video:["video/mp4","video/webm"],file:["application/pdf"]},Se=s.makeStyles((function(){return{input:{flex:"auto"},inputUpload:{display:"none"},attachmentIcon:{fill:"none",stroke:"currentColor"},error:{color:"red",fontSize:"0.75rem",marginTop:"4px"}}})),Ie=function(e){var t=e.chat,n=e.onTyping,r=e.onSendMessage,c=e.maxMessageLength,s=void 0===c?1e3:c,u=Se(),m=l.useTranslation().t,p=o.useRef(null),f=o.useState(null),g=f[0],E=f[1],h=o.useRef(null),v=o.useRef(""),y=o.useState(""),C=y[0],R=y[1],T=o.useState(!1),x=T[0],S=T[1],I=o.useState({chat:t,time:0}),b=I[0],A=I[1],k=function(){E(null)},w=o.useCallback((function(e){if(h.current){var t=v.current+e;v.current=t,h.current.value=t}k()}),[]),O=o.useCallback((function(e){v.current=e.target.value,t&&n&&(b.chat!==t||Date.now()-b.time>=500)&&(A({chat:t,time:Date.now()}),n(t))}),[t,n,b.chat]),_=o.useCallback((function(e){t&&r&&r(t,e)}),[t,r]),G=o.useCallback((function(){var e,t=v.current;(0===(e=t).trim().length?(R(m("CHAT.ERROR.EMPTY_MESSAGE")),0):e.length>s?(R(m("CHAT.ERROR.MESSAGE_TOO_LONG")),0):(R(""),1))&&(_({message:t,messageType:"text"}),h.current&&(h.current.value="",v.current=""),R(""))}),[_]),N=function(){var e=F(Te.mark((function e(t){var n,r,a,o,i;return Te.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null==(n=t.target.files)?void 0:n[0]){e.next=3;break}return e.abrupt("return");case 3:if(!(r.size>10485760)){e.next=6;break}return R(m("CHAT.ERROR.FILE_TOO_LARGE")),e.abrupt("return");case 6:if(e.prev=6,S(!0),R(""),"image"!==(o=(null==(a=Object.entries(xe).find((function(e){return e[1].includes(r.type)})))?void 0:a[0])||"file")){e.next=17;break}return e.next=13,new Promise((function(e){var t=new Image,n=URL.createObjectURL(r);t.onload=function(){var r,a,o;URL.revokeObjectURL(n),e((o=(r={width:t.width,height:t.height}).height,((a=r.width)>335||o>335)&&(a>o?(o=o/a*335,a=335):(a=a/o*335,o=335)),{width:a,height:o}))},t.src=n}));case 13:_({message:r,width:(i=e.sent).width,height:i.height,messageType:o}),e.next=18;break;case 17:_({message:r,messageType:o,fileName:r.name,size:r.size});case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(6),R(m("CHAT.ERROR.UPLOAD_FAILED"));case 23:return e.prev=23,S(!1),p.current&&(p.current.value=""),e.finish(23);case 27:case"end":return e.stop()}}),e,null,[[6,20,23,27]])})));return function(t){return e.apply(this,arguments)}}();return i.createElement(a.Box,{display:"flex",flexDirection:"column"},i.createElement(a.TextField,{className:u.input,placeholder:m("CHAT.INPUT_MESSAGE")||"",autoFocus:!0,variant:"standard",error:!!C,disabled:x,inputRef:h,slotProps:{input:{autoComplete:"off",inputProps:{maxLength:s},disableUnderline:!0,startAdornment:i.createElement(a.InputAdornment,{position:"start"},i.createElement("input",{ref:p,accept:Object.values(xe).flat().join(","),className:u.inputUpload,id:"icon-button-file",type:"file",onChange:N,disabled:x}),i.createElement("label",{htmlFor:"icon-button-file"},i.createElement(a.IconButton,{color:"primary","aria-label":"upload",component:"span",size:"small",disabled:x},x?i.createElement(a.CircularProgress,{size:24}):i.createElement(a.SvgIcon,{className:u.attachmentIcon},i.createElement("path",{d:"M16.768 13.5767L11.6961 18.6486C9.35886 20.9859 5.56937 20.9859 3.23208 18.6486V18.6486C0.894789 16.3114 0.894789 12.5219 3.23208 10.1846L10.4479 2.96872C12.0875 1.32914 14.7458 1.32914 16.3854 2.96873V2.96873C18.025 4.60831 18.025 7.26659 16.3854 8.90617L9.16515 16.1264C8.23032 17.0612 6.71466 17.0612 5.77982 16.1264V16.1264C4.84499 15.1916 4.84499 13.6759 5.77982 12.7411L10.8896 7.63131",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"})))),i.createElement(a.IconButton,{"aria-describedby":Boolean(g)?"emoji-popover":void 0,onClick:function(e){E(e.currentTarget)},color:"primary",size:"small",disabled:x},i.createElement(d.InsertEmoticon,null))),endAdornment:i.createElement(a.IconButton,{edge:"end",color:"inherit",size:"small",onClick:G,disabled:x||!v.current.trim()},i.createElement(d.Send,null)),onKeyDown:function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),G())}}},onChange:O}),C&&i.createElement("div",{className:u.error},C),i.createElement(a.Popover,{id:"emoji-popover",open:Boolean(g),anchorEl:g,onClose:k,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"left"}},i.createElement(de,{onSelect:w})))},be=o.forwardRef((function(e,t){return o.createElement(O,H({direction:"up",ref:t},e))}));function Ae(e){var t=e.open,n=e.setOpen,r=e.contentText,i=e.callback,c=l.useTranslation().t,s=function(){n(!1)};return o.createElement(o.Fragment,null,o.createElement(A,{open:t,TransitionComponent:be,keepMounted:!0,onClose:s,"aria-describedby":"alert-dialog-slide-description"},o.createElement(w,null,o.createElement(a.Typography,{variant:"h6"},r)),o.createElement(k,null,o.createElement(x,{onClick:s,color:"primary"},c("CHAT.BUT_CLOSE")),o.createElement(x,{onClick:function(){n(!1),i()},color:"warning"},c("CHAT.BUT_CONFIRM")))))}var ke=b.styled((function(e){return i.createElement(S,H({elevation:0,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"}},e))}))((function(e){var t=e.theme;return{"& .MuiPaper-root":{borderRadius:6,marginTop:t.spacing(1),minWidth:180,color:"light"===t.palette.mode?"rgb(55, 65, 81)":t.palette.grey[300],boxShadow:"rgb(255, 255, 255) 0px 0px 0px 0px, rgba(0, 0, 0, 0.05) 0px 0px 0px 1px, rgba(0, 0, 0, 0.1) 0px 10px 15px -3px, rgba(0, 0, 0, 0.05) 0px 4px 6px -2px","& .MuiMenu-list":{padding:"4px 0"},"& .MuiMenuItem-root":{"& .MuiSvgIcon-root":{fontSize:18,color:t.palette.text.secondary,marginRight:t.spacing(1.5)},"&:active":{backgroundColor:b.alpha(t.palette.primary.main,t.palette.action.selectedOpacity)}}}}}));function we(e){var t=l.useTranslation().t,n=i.useState(null),r=n[0],a=n[1],o=i.useState(null),c=o[0],s=o[1],u=i.useState(!1),d=u[0],m=u[1],p=Boolean(r),f=i.useMemo((function(){return e.visitData.filter((function(t){return t.contactId===e.chat.userId}))}),[e.visitData,e.chat]);return i.createElement("div",null,i.createElement(x,{id:"conference-button","aria-controls":p?"conference-menu":void 0,"aria-haspopup":"true","aria-expanded":p?"true":void 0,color:"primary",size:"small",variant:"contained",disableElevation:!0,onClick:function(e){a(e.currentTarget)},startIcon:i.createElement(T,null),endIcon:i.createElement(y,null),disabled:0===f.length},t("CHAT.CONFERENCE.START")),i.createElement(Ae,{open:d,setOpen:m,contentText:t("CHAT.CONFERENCE.CONFIRM_RECREATE_CONF"),callback:function(){c&&d&&e.onVideoCall(e.chat,c,!0)}}),i.createElement(ke,{id:"conference-menu",MenuListProps:{"aria-labelledby":"conference-button"},anchorEl:r,open:p,onClose:function(){a(null)}},f.map((function(t){return i.createElement(I,{onClick:function(){return function(t){a(null),s(t.visitId),"finished"===t.conferenceStatus?m(!0):e.onVideoCall(e.chat,t.visitId)}(t)},key:t.visitId,value:t.visitId,disableRipple:!0},i.createElement("finished"===t.conferenceStatus?R:C,null),(n=t,r=new Date(n.visitDate),n.plExamName+" ("+Y(r,"HH:mm")+" - "+Y(new Date(r.getTime()+6e4*n.duration),"HH:mm")+")"));var n,r}))))}var Oe=i.forwardRef((function(e,t){return i.createElement(a.Slide,H({direction:"up",ref:t},e))}));function _e(e){var t=e.children,n=e.open,r=e.setOpen,o=e.severity,c=void 0===o?"warning":o,s=l.useTranslation().t,u=function(){r(!1)};return i.createElement(a.Dialog,{open:n,TransitionComponent:Oe,keepMounted:!0,onClose:u,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},i.createElement(a.DialogContent,null,i.createElement(a.Alert,{severity:c},"string"==typeof t?i.createElement(a.Typography,{variant:"body2"},t):t)),i.createElement(a.DialogActions,null,i.createElement(a.Button,{onClick:u,variant:"text"},s("CHAT.BUT_CLOSE"))))}var Ge=function(e){var t=e.modaleInfo,n=e.setModaleInfo,r=e.strTime,c=l.useTranslation().t;return o.useMemo((function(){return i.createElement(_e,{open:t,setOpen:n,severity:"info"},i.createElement(a.Typography,{variant:"body1",textAlign:"center"},c("CHAT.CONFERENCE.UntillTheEnd"),":"),i.createElement(a.Typography,{variant:"h6",textAlign:"center"},r))}),[t])},Ne=function(e){var t=e.finishDate,n=l.useTranslation().t,r=o.useState(!1),c=r[0],s=r[1],u=Date.now(),d=new Date(t).getTime(),m=Math.round((d-u)/1e3),p=function(e){void 0===e&&(e=3e4);var t=o.useState(e),n=t[0],r=t[1],a=o.useRef(null);return o.useEffect((function(){return n>0&&(a.current=setInterval((function(){return r((function(e){return e-1}))}),1e3)),function(){a.current&&clearInterval(a.current)}}),[n]),{counter:n,handlerRefresh:function(){r(e)}}}(m).counter,f=function(e){var t=Math.floor(e/3600),n=t<10?"0"+t:t;e%=3600;var r=Math.floor(e/60),a=e%60;return{hours:t,minutes:r,seconds:a,strTime:n+":"+(r<10?"0"+r:r)+":"+(a<10?"0"+a:a)}}(m),g=f.minutes,E=f.seconds,h=f.strTime;return o.useEffect((function(){g&&3===g&&null!=E&&0===E&&s(!0)}),[p]),m<1?null:i.createElement(a.Box,{textAlign:"center"},i.createElement(a.Typography,{variant:"body2",component:"span"},n("CHAT.CONFERENCE.LEFT_TIME"),":"," "),i.createElement(a.Typography,{variant:"button",component:"span"},h),i.createElement(Ge,{modaleInfo:c,setModaleInfo:s,strTime:h}))},De=s.makeStyles((function(e){return s.createStyles({paper:{padding:e.spacing(1)},avatarGroup:{backgroundColor:"#28B7C6",color:"#fff"}})})),Me=function(e,t){var n,r=[(null==(n=e.members)?void 0:n.length)+" "+t("CHAT.MEMBERS")],a=(e.members||[]).reduce((function(e,t){return t.online?e+1:e}),0);return a&&r.push(a+" "+t("CHAT.STATUS.ONLINE")),r.join(", ")},je=function(e){var t=e.apiUrl,n=e.user,r=e.chat,c=e.typing,s=e.conference,u=e.visitData,d=e.conferenceJoined,m=e.className,f=e.operators,y=e.onVideoCall,C=e.onVideoEnd,R=e.onConferencePause,T=e.onOperatorAdd,x=e.onLeaveGroup,S=e.onContactClick,I=De(),b=l.useTranslation().t,A=o.useState(null),k=A[0],w=A[1],O=o.useState(!1),_=O[0],G=O[1],N=i.useState(!1),D=N[0],M=N[1];if(!r)return i.createElement(a.CardHeader,{avatar:i.createElement(a.Avatar,null),title:"",subheader:"",className:m});var j,L=null,U=function(e){k||w(e.currentTarget),L&&(clearTimeout(L),L=null)},P=function(){w(null),L&&(clearTimeout(L),L=null)},F=function(){L||(L=setTimeout((function(){P()}),1e3))},H=r;if(H.groupId)return i.createElement(a.CardHeader,{avatar:i.createElement(a.Avatar,{alt:H.name,className:I.avatarGroup},i.createElement(E,null)),title:H.name,subheader:i.createElement(i.Fragment,null,i.createElement("span",{id:"mouse-over-span","aria-owns":k?"mouse-over-popover":void 0,"aria-haspopup":"true",onMouseEnter:U,onMouseLeave:F},Me(H,b)),i.createElement(a.Popover,{id:"mouse-over-popover",classes:{paper:I.paper},sx:{pointerEvents:"none"},open:!!k,anchorEl:k,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},onClose:P,disableRestoreFocus:!0},i.createElement(ae,{apiUrl:t,contacts:H.members,onContactClick:S,owner:H.userId,onMouseEnter:U,onMouseLeave:F,sx:{pointerEvents:"all"}}))),className:m,action:i.createElement(i.Fragment,null,4===n.role&&i.createElement(i.Fragment,null,i.createElement(a.IconButton,{"aria-label":"add user",onClick:function(){G(!0)}},i.createElement(v,null)),i.createElement(oe,{apiUrl:t,open:_,contacts:f,onClose:function(e){G(!1),T&&e&&r&&T(r,e)}})),4===n.role&&(null==(j=H.members)?void 0:j.find((function(e){return e.userId!==n.userId&&4===e.role})))&&x&&i.createElement(a.IconButton,{"aria-label":"leave group",onClick:function(){return x(H)}},i.createElement(p,null)))});var B=r,z=!(null==c||!c.contactId)&&(null==c?void 0:c.userId)===B.userId;return i.createElement(a.CardHeader,{avatar:i.createElement(a.Avatar,{alt:B.username,src:B.avatar?Q(t,B.avatar):""}),title:i.createElement(a.Typography,{variant:"h6",sx:function(e){var t;return(t={whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",fontSize:"0.9rem"})[e.breakpoints.down("md")]={fontSize:"0.8rem"},t[e.breakpoints.down("sm")]={whiteSpace:"wrap",fontSize:"0.7rem"},t}},B.username),subheader:i.createElement(te,{contact:B,isTyping:z}),className:m,action:i.createElement(i.Fragment,null,1!==n.role&&d&&s&&!q(s)&&null!=R&&i.createElement(a.Button,{"aria-label":"cancel call",variant:"contained",color:"secondary",size:"small",startIcon:i.createElement(h,{color:"primary"}),onClick:function(){return R(s)}},b("CHAT.CONFERENCE.PAUSE")),s&&!q(s)&&null!=C&&null!=n.role&&[3,4].includes(n.role)&&i.createElement(i.Fragment,null,i.createElement(a.Button,{"aria-label":"cancel call",variant:"contained",color:"warning",size:"small",startIcon:i.createElement(g,{color:"inherit"}),onClick:function(){return M(!0)},style:{marginLeft:8}},b("CHAT.CONFERENCE.FINISH")),i.createElement(Ae,{open:D,setOpen:M,contentText:b("CHAT.CONFERENCE.CONFIRM_FINISH_CONF"),callback:function(){C(s)}})),q(s)&&null!=y&&n.role&&[3,4].includes(n.role)&&i.createElement(we,{visitData:u,chat:B,onVideoCall:y}),null!=(null==s?void 0:s.finishDate)&&i.createElement(Ne,{finishDate:s.finishDate}))})},Le=function(e){var t=e.date;return i.createElement(a.Box,{sx:{position:"relative",height:0,margin:"8px 0"}},i.createElement(a.Fade,{in:!!t,timeout:2e3},i.createElement(a.Alert,{severity:"warning",icon:!1,sx:function(){return{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:150,mx:"auto",justifyContent:"center",zIndex:1e3}}},i.createElement(a.Typography,{variant:"h6",textAlign:"center"},t&&u(t).format("DD.MM.YYYY")))))},Ue=s.makeStyles((function(e){var t;return{arrowDown:(t={position:"absolute",left:"94.5%",bottom:105},t[e.breakpoints.down("md")]={left:"91.5%",bottom:95},t[e.breakpoints.down("sm")]={left:"84%",bottom:95},t)}})),Pe=function(e){var t=e.visible,n=e.unreadCount,r=e.onScrollDown,o=Ue();return t?i.createElement(a.Box,{className:o.arrowDown,textAlign:"center"},i.createElement(a.Fab,{color:"info","aria-label":"scroll-down",size:"medium",onClick:r},i.createElement(y,null)),n>0&&i.createElement(a.Fab,{color:"warning",size:"small",sx:{width:24,height:24,minHeight:24,position:"relative",top:-10,pointerEvents:"none"}},i.createElement(a.Typography,{variant:"body2",sx:function(e){return{color:e.palette.background.default}}},n))):null},Fe=s.makeStyles((function(e){var t;return{messageListOuter:{flex:1,overflowY:"auto",margin:0,padding:0,height:"100%",scrollbarWidth:"thin",scrollbarColor:e.palette.primary.light+" #fff"},messageList:{},img:(t={cursor:"pointer",borderRadius:e.spacing(1.2),maxWidth:"auto",maxHeight:"95%"},t[e.breakpoints.down("sm")]={maxWidth:"auto",maxHeight:"95%"},t)}})),He=function(e){var t,n,r,l,c=e.apiUrl,s=e.user,u=e.users,d=e.chat,m=e.loading,p=e.pageSize,f=e.initialMenuState,g=e.onNeedMoreMessages,E=e.onMessageDelete,h=e.setMenuState,v=e.onEnterRoom,y=Fe(),C=i.useRef(null),R=i.useMemo((function(){return W(d)}),[d]),T=i.useState({visible:!1,src:""}),x=T[0],S=T[1],I=i.useState(""),b=I[0],A=I[1],k=(null==d||null==(t=d.messages)?void 0:t.map((function(e){return H({},e,{ref:i.createRef()})})))||[],w=i.useMemo((function(){return null==d||null==(null==d?void 0:d.noMoreData)||!d.noMoreData}),[null==d?void 0:d.noMoreData]),O=function(e){var t=e.chatId,n=e.messages,r=e.scrollableRootRef,a=e.pageSize,i=e.hasNextPage,l=e.chat,c=e.onEnterRoom,s=e.setIsVisible,u=o.useState(!1),d=u[0],m=u[1],p=o.useRef(),f=o.useRef(),g=(null==n?void 0:n.length)||0,E=g&&n[g-1],h=o.useCallback((function(){r.current&&(r.current.scrollTop=r.current.scrollHeight,c&&l&&c(l))}),[t,c]),v=o.useCallback((function(){var e,t,a=r.current;if(a){var o=a.scrollHeight-a.scrollTop;p.current=o,m(i&&o>900);for(var l=0;l<g;l++){var c,u=n[l];if(null==u||null==(c=u.ref)||!c.current)break;if(e=a,(t=u.ref.current.getBoundingClientRect()).top>=150&&t.bottom<=e.clientHeight){s(u.cdate);break}}}}),[n,t]);return o.useEffect((function(){var e,a;t&&r.current&&n.length&&(s(null!=(e=null==(a=n[g-1])?void 0:a.cdate)?e:""),h())}),[t]),o.useEffect((function(){var e,t=r.current,n=null!=(e=p.current)?e:0;t&&E&&l&&(f.current===g-a?t.scrollTop=t.scrollHeight-n:(E.userId!==l.userId||n<=900)&&h()),f.current=g}),[g,t]),{scrollDown:h,handleRootScroll:v,scrollDownButton:d,setScrollDownButton:m,unreadCount:n.filter((function(e){return 0===e.status})).length}}({chatId:R,messages:k,scrollableRootRef:C,pageSize:p,hasNextPage:w,chat:d,onEnterRoom:v,setIsVisible:A}),G=O.scrollDown,N=O.handleRootScroll,D=O.scrollDownButton,M=O.unreadCount,j=_({loading:m,hasNextPage:w,onLoadMore:function(){return d&&g(d)},disabled:!1}),L=j[0],U=j[1].rootRef,P=i.useCallback((function(e){U(e),C.current=e}),[U]);if(n=function(){A("")},r=b,l=o.useRef(),o.useEffect((function(){l.current=n}),[n]),o.useEffect((function(){if(r){var e=setInterval((function(){l.current()}),4700);return function(){return clearInterval(e)}}}),[r]),!R)return null;var F=i.useMemo((function(){return k.map((function(e,t){var n,r;return i.createElement(Ce,{ref:e.ref,key:e._id||t,apiUrl:c,user:s,message:e,owner:u[e.userId],isGroupMessage:!(null==d||!d.groupId),isUserFirst:0===t||"notify"===k[t-1].messageType||k[t-1].userId!==k[t].userId,isUserLast:t===k.length-1||"notify"===(null==(n=k[t+1])?void 0:n.messageType)||(null==(r=k[t+1])?void 0:r.userId)!==k[t].userId,onContextMenu:function(t){return function(e,t){var n="text"===e.messageType,r=s.userId===e.userId&&!!E&&(new Date).getTime()-new Date(e.cdate).getTime()<=12e4;n||r?(t.preventDefault(),h({message:e,mouseX:t.clientX-2,mouseY:t.clientY-4,canCopy:n,canDelete:r})):h(f)}(e,t)},setViewerData:S})}))}),[(k||[]).filter((function(e){return e._id})).length,M,c,s,u,null==d?void 0:d.groupId,D,b]);return i.createElement(i.Fragment,null,i.createElement(Le,{date:b}),i.createElement(a.CardContent,{className:y.messageListOuter,ref:P,onScroll:N},i.createElement(a.List,{className:y.messageList},w&&i.createElement(a.ListItem,{ref:L,sx:{justifyContent:"center"}},i.createElement(a.CircularProgress,null)),F),i.createElement(Pe,{visible:D,unreadCount:M,onScrollDown:G}),x.visible&&i.createElement(a.Backdrop,{sx:{color:"#fff",zIndex:function(e){return e.zIndex.drawer+1}},open:x.visible,onClick:function(){return S({visible:!1,src:""})}},i.createElement("img",{src:x.src,className:y.img,alt:""}))))},Be=s.makeStyles((function(e){return s.createStyles({root:{width:"100%",minWidth:360,height:"100%",display:"flex",flexDirection:"column"},roomHeader:{flex:1},flexAll:{flex:"1 1 auto"},flexEnd:{justifyContent:"flex-end"}})})),ze={message:null,mouseX:null,mouseY:null,canCopy:!1,canDelete:!1},Ve=function(e){var t=e.apiUrl,n=e.user,r=e.users,c=e.chat,s=e.typing,u=e.conference,d=e.visitData,m=e.conferenceJoined,g=e.loading,E=e.pageSize,h=e.onEnterRoom,v=Be(),y=l.useTranslation().t,C=i.useState(ze),R=C[0],T=C[1],x=o.useCallback((function(){var e=R.message;T(ze),e&&navigator.clipboard.writeText(e.content)}),[R.message]),S=o.useCallback((function(){var t=R.message;T(ze),e.onMessageDelete&&c&&t&&e.onMessageDelete(c,t)}),[R.message]);return i.createElement(a.Card,{elevation:1,className:v.root},i.createElement(a.Box,{display:"flex",flexDirection:"row"},i.createElement(je,{apiUrl:t,user:n,chat:c,typing:s,conference:u,visitData:d,conferenceJoined:m,operators:e.operators,className:v.roomHeader,onVideoCall:e.onVideoCall,onVideoEnd:e.onVideoEnd,onConferencePause:e.onConferencePause,onOperatorAdd:e.onOperatorAdd,onLeaveGroup:e.onLeaveGroup,onContactClick:e.onContactClick})),i.createElement(a.Divider,null),i.createElement(He,{apiUrl:t,user:n,users:r,chat:c,loading:g,pageSize:E,initialMenuState:ze,onNeedMoreMessages:e.onNeedMoreMessages,onMessageDelete:e.onMessageDelete,setMenuState:T,onEnterRoom:h}),i.createElement(a.Divider,null),i.createElement(a.CardContent,null,i.createElement(Ie,{chat:c,onTyping:e.onTyping,onSendMessage:e.onSendMessage})),i.createElement(a.Menu,{keepMounted:!0,open:null!==R.mouseY,onClose:function(){T(ze)},anchorReference:"anchorPosition",anchorPosition:null!==R.mouseY&&null!==R.mouseX?{top:R.mouseY,left:R.mouseX}:void 0},i.createElement(a.MenuItem,{onClick:x,disabled:!R.canCopy},i.createElement("span",{className:v.flexAll},y("CHAT.MESSAGE.MENU.COPY")),i.createElement(a.ListItemIcon,{className:v.flexEnd},i.createElement(f,{fontSize:"small"}))),i.createElement(a.MenuItem,{onClick:S,disabled:!R.canDelete},i.createElement("span",{className:v.flexAll},y("CHAT.MESSAGE.MENU.DELETE")),i.createElement(a.ListItemIcon,{className:v.flexEnd},i.createElement(p,{fontSize:"small"})))))},qe={userId:0,username:"",password:"",avatar:"",langCode:""},Ye={user:qe,token:"",refreshToken:"",activeRoom:null,chatOld:null,groupGather:{},userGather:{},contactGather:{},operators:[],initialContactId:null,conference:{data:null,joined:!1,ringPlayed:!1},typing:null,loading:!1,error:void 0,success:void 0,visitData:[]},We=function(e){return e.activeRoom?e.groupGather[e.activeRoom.groupId]||e.contactGather[e.activeRoom.userId]:null},Ke=function(e){var t=e.initialContactId,n=null;if(t)n=e.contactGather[t];else if(e.activeRoom)n=We(e);else{var r=[].concat(Object.values(e.contactGather),Object.values(e.groupGather)).sort(J);r.length>0&&(n=r[0])}return n},$e=function(e,t,n){var r=H({},e);e.contactGather[t]&&(r.contactGather[t]=H({},r.contactGather[t],{online:n}));for(var a=0,o=Object.values(e.groupGather);a<o.length;a++){var i=o[a];if(i.members){var l=i.members.find((function(e){return e.userId===t}));if(l){var c=i.members.indexOf(l);i.members[c]=H({},l,{online:n})}}}var s=r.operators.findIndex((function(e){return e.userId===t}));return-1!==s&&(r.operators[s]=H({},r.operators[s],{online:n})),r.activeRoom=We(r),r},Je=function(e,t,n){var r=H({},e);return r.contactGather[t]&&(r.contactGather[t]=H({},r.contactGather[t],{unreadCount:n(r.contactGather[t].unreadCount)})),r.activeRoom=We(r),r},Xe=function(e,t,n){var r=H({},e);return r.groupGather[t]&&(r.groupGather[t]=H({},r.groupGather[t],{unreadCount:n(r.groupGather[t].unreadCount)})),r.activeRoom=We(r),r};function Qe(e,t){var n,r,a;switch(t.type){case"SET_GROUP_GATHER":return H({},e,{groupGather:H({},e.groupGather,(n={},n[t.payload.groupId]=t.payload,n))});case"SET_CONTACT_GATHER":return H({},e,{contactGather:H({},e.contactGather,(r={},r[t.payload.userId]=t.payload,r))});case"DEL_GROUP":return function(e,t){var n=H({},e),r=n.activeRoom===n.groupGather[t];return delete n.groupGather[t],r&&(n.activeRoom=Ke(n)),n}(e,t.payload);case"DEL_GROUP_MEMBER":return function(e,t){var n,r=H({},e),a=r.groupGather[t.groupId];return a&&(a.members=null==(n=a.members)?void 0:n.filter((function(e){return e.userId!==t.userId}))),r}(e,t.payload);case"DEL_CONTACT":return function(e,t){var n=H({},e),r=n.activeRoom===n.contactGather[t];return delete n.contactGather[t],r&&(n.activeRoom=Ke(n)),n}(e,t.payload.userId);case"SET_USER_GATHER":return H({},e,{userGather:H({},e.userGather,(a={},a[t.payload.userId]=t.payload,a))});case"UPDATE_ACTIVE_ROOM":return H({},e,{activeRoom:Ke(e)});case"SET_ACTIVE_ROOM":return function(e,t){return H({},e,{chatOld:null!=e.activeRoom?H({},e.activeRoom):null,activeRoom:t.groupId?e.groupGather[t.groupId]:t.contactId?e.contactGather[t.contactId]:null})}(e,t.payload);case"USER_ONLINE":return $e(e,t.payload,1);case"USER_OFFLINE":return $e(e,t.payload,0);case"ADD_GROUP_MESSAGE":return function(e,t){var n=H({},e),r=t.groupId;n.groupGather[r]&&(n.groupGather[r].messages?n.groupGather[r].messages=[].concat(n.groupGather[r].messages,[t]):n.groupGather[r]=H({},e.groupGather[r],{messages:[t]}));var a=n.activeRoom;return a&&a.groupId!==r&&t.userId!==e.user.userId?Xe(n,r,(function(e){return(e||0)+1})):(n.activeRoom=We(n),n)}(e,t.payload);case"ADD_PRIVATE_MESSAGE":return function(e,t){var n,r=H({},e),a=t.contactId===e.user.userId?t.userId:t.contactId;return r.contactGather[a].messages?r.contactGather[a].messages=[].concat(r.contactGather[a].messages,[t]):r.contactGather[a]=H({},r.contactGather[a],{messages:[t]}),(null==(n=r.activeRoom)?void 0:n.userId)!==a&&t.userId!==e.user.userId?Je(r,a,(function(e){return(e||0)+1})):(r.activeRoom=We(r),r)}(e,t.payload);case"ADD_GROUP_UNREAD_GATHER":return Xe(e,t.payload,(function(e){return(e||0)+1}));case"ADD_CONTACT_UNREAD_GATHER":return Je(e,t.payload,(function(e){return(e||0)+1}));case"SET_TYPING":return H({},e,{typing:t.payload});case"LOSE_GROUP_UNREAD_GATHER":return Xe(e,t.payload,(function(){return 0}));case"LOSE_CONTACT_UNREAD_GATHER":return Je(e,t.payload,(function(){return 0}));case"REVOKE_MESSAGE":return function(e,t){var n=e.user.userId,r=H({},e),a=t.username||r.userGather[t.userId].username;if(t.groupId){var o=r.groupGather[t.groupId].messages;if(o){var i=o.find((function(e){return e._id===t._id}));if(i){var l=o.indexOf(i);o[l]=H({},i,{isRevoke:!0,revokeUserName:a})}}}else{var c=r.contactGather[t.contactId===n?t.userId:t.contactId].messages;if(c){var s=c.find((function(e){return e._id===t._id}));if(s){var u=c.indexOf(s);c[u]=H({},s,{isRevoke:!0,revokeUserName:a})}}}return r.activeRoom=We(r),r}(e,t.payload);case"UPDATE_GROUP_INFO":return function(e,t){var n=H({},e),r=t.groupId,a=n.groupGather[r];return a&&(n.groupGather[r]=H({},a,{name:t.name,notice:t.notice})),n.activeRoom=We(n),n}(e,t.payload);case"UPDATE_USER_INFO":return function(e,t){var n=H({},e),r=t.userId,a=t.username,o=t.avatar;return n.userGather[r]&&(n.userGather[r]=H({},n.userGather[r],{username:a,avatar:o})),n.contactGather[r]&&(n.contactGather[r]=H({},n.contactGather[r],{username:a,avatar:o})),n.activeRoom=We(n),n}(e,t.payload);case"ADD_GROUP_MEMBER":return function(e,t){var n=t.members.map((function(e){return H({},e,{isManager:0})})),r=H({},e);return r.groupGather[t.groupId].members&&n?r.groupGather[t.groupId].members=[].concat(e.groupGather[t.groupId].members,n):r.groupGather[t.groupId]=H({},r.groupGather[t.groupId],{members:n}),r.activeRoom=We(r),r}(e,t.payload);case"SET_CONFERENCE":return function(e,t){return H({},e,{conference:{data:H({},t),joined:(null==t?void 0:t.userId)===e.user.userId,ringPlayed:(null==t?void 0:t.userId)!==e.user.userId}})}(e,t.payload);case"JOIN_CONFERENCE":return H({},e,{conference:{data:H({},t.payload),joined:!0,ringPlayed:!1}});case"PAUSE_CONFERENCE":return function(e,t){var n;return(null==(n=e.conference.data)?void 0:n.id)!==(null==t?void 0:t.id)?e:H({},e,{conference:{data:H({},e.conference.data),joined:!1,ringPlayed:!1}})}(e,t.payload);case"STOP_CONFERENCE":return function(e,t){var n;return(null==(n=e.conference.data)?void 0:n.id)!==(null==t?void 0:t.id)?e:H({},e,{conference:{data:null,joined:!1,ringPlayed:!1}})}(e,t.payload);case"MARK_PRIVATE_MESSAGES_READ":return function(e,t){var n=H({},e);if(n.contactGather[t]){var r=H({},n.contactGather[t]);if(r.messages)for(var a=0;a<r.messages.length;a++)r.messages[a]=H({},r.messages[a],{status:1});n.contactGather[t]=r}if(n.activeRoom=We(n),null!=n.activeRoom&&n.activeRoom.messages)for(var o=0;o<n.activeRoom.messages.length;o++)n.activeRoom.messages[o]=H({},n.activeRoom.messages[o],{status:1});return n}(e,t.payload);case"ADD_PRIVATE_MESSAGES":return function(e,t){var n=H({},e),r=t.messages,a=t.contactId;return n.contactGather[a]&&(n.contactGather[a]=H({},n.contactGather[a],{messages:[].concat(r||[],n.contactGather[a].messages||[]),noMoreData:null==r||!r.length||(null==r?void 0:r.length)<t.pageSize})),n.activeRoom=We(n),n}(e,t.payload);case"ADD_GROUP_MESSAGES":return function(e,t){var n=H({},e),r=t.groupId,a=t.messages,o=t.userArr;n.groupGather[r]&&(n.groupGather[r]=H({},n.groupGather[r],{messages:[].concat(a||[],n.groupGather[r].messages||[]),noMoreData:null==a||!a.length||(null==a?void 0:a.length)<t.pageSize})),n.userGather=H({},n.userGather);for(var i,l=V(o);!(i=l()).done;){var c=i.value;n.userGather[c.userId]||(n.userGather[c.userId]=c)}return n.activeRoom=We(n),n}(e,t.payload);case"SET_LOADING":return H({},e,{loading:t.payload,error:""});case"SET_ERROR":return H({},e,{error:t.payload,success:void 0});case"SET_SUCCES":return H({},e,{success:t.payload,error:void 0});case"SET_TOKEN":return function(e,t){return H({},e,{token:t})}(e,t.payload);case"SET_USER":return H({},e,{user:t.payload});case"CLEAR_USER":return function(e){return H({},e,{token:"",user:qe})}(e);case"CLEAR_CHAT_DATA":return H({},e,{activeRoom:null,groupGather:{},userGather:{},contactGather:{},conference:{data:null,joined:!1,ringPlayed:!1},typing:null});case"SET_OPERATORS":return H({},e,{operators:t.payload});case"SET_VISIT_DATA":return H({},e,{visitData:t.payload})}return e}var Ze=i.createContext({state:Ye,dispatch:function(){return null}}),et=function(e){qe.langCode=e.defLang;var t=H({},Ye,{token:e.token,refreshToken:e.token}),n=i.useReducer(Qe,t),r=n[0],a=n[1],l=o.useMemo((function(){return{state:r,dispatch:a}}),[r]);return i.createElement(Ze.Provider,{value:l},e.children)},tt=o.createContext({});function nt(e,t,n){return rt.apply(this,arguments)}function rt(){return(rt=F(Te.mark((function e(t,n,r){var a;return Te.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return localStorage.removeItem("authToken"),localStorage.removeItem("refreshToken"),e.prev=2,e.next=5,N.post(r+"/auth/refreshToken",{authToken:t,refreshToken:n});case 5:a=e.sent.data,localStorage.setItem("authToken",null==a?void 0:a.authToken),localStorage.setItem("refreshToken",null==a?void 0:a.refreshToken),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(2),console.log("ERROR RefreshToken",e.t0);case 14:window.location.reload();case 15:case"end":return e.stop()}}),e,null,[[2,11]])})))).apply(this,arguments)}var at=function(e){var t=e.chatBaseURLApi,n=e.pageSize,r=e.children,a=e.baseUrl,l=o.useContext(Ze),c=l.state,s=l.dispatch,u=N.create({timeout:6e4,baseURL:t,headers:{"Cache-Control":"no-cache",Pragma:"no-cache",Authorization:"Bearer "+c.token},withCredentials:!1});u.interceptors.response.use((function(e){return e}),(function(e){return console.log("ERROR AxiosError"),function(e){c.token&&null!=e.response&&401===e.response.status&&nt(c.token,c.refreshToken,a)}(e),Promise.reject(e)}));var d=o.useCallback(function(){var e=F(Te.mark((function e(t,r){var a,o,i,l;return Te.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.userId,i=null==(a=t.messages)?void 0:a.length,e.prev=2,s({type:"SET_LOADING",payload:!0}),e.next=6,u.get("/contact/messages",{params:{contactId:o,current:i,pageSize:n}});case 6:(l=e.sent.data)&&(s({type:"ADD_PRIVATE_MESSAGES",payload:{pageSize:n,contactId:o,messages:l}}),r&&r()),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(2),s({type:"SET_ERROR",payload:e.t0.message});case 15:return e.prev=15,s({type:"SET_LOADING",payload:!1}),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[2,11,15,18]])})));return function(t,n){return e.apply(this,arguments)}}(),[s]),m=o.useCallback(function(){var e=F(Te.mark((function e(t){var r,a,o,i;return Te.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.groupId,o=null==(r=t.messages)?void 0:r.length,e.prev=2,s({type:"SET_LOADING",payload:!0}),e.next=6,u.get("/group/messages",{params:{groupId:a,current:o,pageSize:n}});case 6:(i=e.sent.data)&&s({type:"ADD_GROUP_MESSAGES",payload:H({pageSize:n,groupId:a},i)}),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(2),s({type:"SET_ERROR",payload:e.t0.message});case 15:return e.prev=15,s({type:"SET_LOADING",payload:!1}),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[2,11,15,18]])})));return function(t){return e.apply(this,arguments)}}(),[s]),p=function(){var e=F(Te.mark((function e(t,n){var r;return Te.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.get("/contact/find",{params:{mmkId:t,guid:n}});case 3:if(null==(r=e.sent.data)){e.next=7;break}return e.abrupt("return",r);case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.log("err getUserByMmk",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,n){return e.apply(this,arguments)}}(),f=o.useMemo((function(){return{apiUrl:t,pageSize:n,fetch:u,getPrivateMessages:d,getGroupMessages:m,getUserByMmk:p}}),[t,n]);return i.createElement(tt.Provider,{value:f},r)},ot=s.makeStyles((function(e){return s.createStyles({main:{flex:"1 1 auto",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},time:{paddingLeft:e.spacing(1),justifyContent:"flex-end",whiteSpace:"nowrap"},unread:{justifyContent:"flex-end",maxHeight:20},avatarGroup:{backgroundColor:"#28B7C6",color:"#fff"}})})),it=s.withStyles((function(e){return s.createStyles({badge:{backgroundColor:"#44b700",color:"#44b700",boxShadow:"0 0 0 2px "+e.palette.background.paper,"&::after":{position:"absolute",top:0,left:0,width:"100%",height:"100%",borderRadius:"50%",animation:"$ripple 1.2s infinite ease-in-out",border:"1px solid currentColor",content:'""'}},"@keyframes ripple":{"0%":{transform:"scale(.8)",opacity:1},"100%":{transform:"scale(2.4)",opacity:0}}})}))(a.Badge),lt=s.withStyles((function(e){return s.createStyles({badge:{backgroundColor:e.palette.primary.main,boxShadow:"0 0 0 2px "+e.palette.background.paper}})}))(a.Badge),ct=function(e){var t=ot(),n=l.useTranslation().t,r=e.apiUrl,o=e.chat,c=e.typing,s=K(o),u=o.groupId?i.createElement(a.Avatar,{alt:s,className:t.avatarGroup},i.createElement(E,null)," "):function(e,t,n){var r=i.createElement(a.Avatar,{alt:t.username,src:t.avatar?Q(e,t.avatar):""});return null!=n&&n.contactId&&(null==n?void 0:n.userId)===t.userId?i.createElement(it,{overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"dot"},r):null!=t&&t.online?i.createElement(lt,{overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"dot"},r):r}(r,o,c),d=o.messages&&o.messages.length>0?o.messages[o.messages.length-1]:null,m=function(e,t){if(!e)return null;switch(e.messageType){case"text":return e.content;case"image":return"["+t("CHAT.MESSAGE.TYPE.IMAGE")+"]";case"video":return"["+t("CHAT.MESSAGE.TYPE.VIDEO")+"]";case"file":return"["+t("CHAT.MESSAGE.TYPE.FILE")+"]";case"notify":return"["+t("CHAT.MESSAGE.TYPE.NOTIFY")+"]";default:return null}}(d,n),p=null==d?void 0:d.cdate;return i.createElement(a.ListItemButton,{selected:e.active,onClick:e.onClick},i.createElement(a.ListItemAvatar,null,u),i.createElement(a.ListItemText,{secondaryTypographyProps:{component:"span"},primary:i.createElement(a.Box,{display:"flex",flexDirection:"row"},i.createElement("span",{className:t.main},s),i.createElement("span",{className:t.time},Y(p))),secondary:i.createElement(a.Box,{display:"flex",flexDirection:"row"},i.createElement("span",{className:t.main},m),o.unreadCount?i.createElement(a.Chip,{className:t.unread,component:"span",size:"small",color:"primary",label:o.unreadCount}):null)}))},st=s.makeStyles((function(e){return{root:{width:"100%",height:"100%"},searchField:{width:"100%"},listStyle:{height:"89.5%",overflowY:"auto",scrollbarWidth:"thin",scrollbarColor:e.palette.primary.light+" #fff"}}})),ut=function(e,t){if(!t)return e;var n=t.toLowerCase();return e.filter((function(e){return K(e).toLowerCase().includes(n)}))},dt=function(e){var t=e.user,n=e.activeRoom,r=e.groups,c=e.contacts,s=e.typing,u=e.onChangeChat;console.log(" -- RoomList -- ");var d=st(),m=l.useTranslation().t,p=o.useContext(tt).apiUrl,f=o.useState(""),g=f[0],E=f[1],h=i.useMemo((function(){return function(e,t,n,r){return function(e,t,n){var r=[].concat(t,n);r=r.sort(J);var a=localStorage.getItem(e+"-topChatId");if(a){var o=r.find((function(e){return W(e)===a}));o&&(r=r.filter((function(e){return W(e)!==a})),o.isTop=!0,r.unshift(o))}return r}(e,ut(t,r),ut(n,r))}(t.userId,r,c,g)}),[t.userId,r,c,g]);return i.createElement(a.Card,{elevation:1,className:d.root},i.createElement(a.CardHeader,{title:i.createElement(a.TextField,{className:d.searchField,label:m("CHAT.INPUT_SEARCH_CONTACT"),variant:"outlined",size:"small",fullWidth:!0,onChange:function(e){E(e.target.value)},value:g})}),i.createElement(a.Divider,null),i.createElement(G,{"aria-label":"rooms",className:d.listStyle},h.map((function(e){return i.createElement(ct,{key:W(e),apiUrl:p,chat:e,active:e===n,typing:s,onClick:function(){return u(e)}})}))))},mt=function(){var e=i.useContext(Ze),t=e.state,n=t.error,r=t.success,o=e.dispatch,l=function(){o({type:"SET_ERROR",payload:void 0}),o({type:"SET_SUCCES",payload:void 0})};return i.createElement(a.Snackbar,{anchorOrigin:{vertical:"top",horizontal:"center"},open:!!n||!!r,autoHideDuration:6e3,onClose:l},i.createElement(a.Alert,{onClose:l,severity:n?"error":"success"},n||r))},pt=s.makeStyles((function(e){var t;return{root:(t={height:"100%",overflow:"hidden",padding:0},t[e.breakpoints.up("lg")]={minWidth:1200},t)}})),ft=function(e){var t=e.children,n=pt();return i.createElement(a.Container,{maxWidth:!1,className:n.root},t)},gt=function(e){var t=e.conferenceActive,n=e.hideRooms,r=e.contactsList,o=e.chatRoom,l=e.activeRoom,c=e.user,s=e.onExitRoom,u=e.onChangeChat,d=e.chatOld;return e.isMobile?i.createElement(i.Fragment,null,t&&i.createElement(a.Box,{sx:{position:"absolute",overflow:"hidden",zIndex:1400,top:null!=c&&c.role&&[3,4].includes(c.role)?-56:-12,left:null!=c&&c.role&&[3,4].includes(c.role)?32:218}},i.createElement(a.Box,{display:"flex",flexDirection:"row",columnGap:3,my:3,sx:{position:"relative"}},i.createElement(a.IconButton,{"aria-label":"exit room",sx:{color:"#fff",background:"#000","&:hover":{background:"#eee",color:"#000",boxShadow:"none"}},onClick:function(){l&&s?s(l):d&&u&&(console.log("onChangeChat"),u(d))}},i.createElement(l?M:D,null)))),r,o):i.createElement(i.Fragment,null,i.createElement(a.Grid2,{container:!0,spacing:1,sx:{height:"100%"}},(t||!n)&&i.createElement(a.Grid2,{size:l?{sm:t?6:4,lg:t?6:4,xl:t?6:3}:12,sx:{height:"100%"}},r),l&&i.createElement(a.Grid2,{size:{sm:t?6:n?12:8,lg:t?6:n?12:8,xl:t?6:n?12:9},sx:{height:"100%"}},o)))},Et=function(e){var t=e.audio,n=e.video,r=l.useTranslation().t,o=a.useMediaQuery((function(e){return e.breakpoints.down("md")})),c=i.useContext(Ze).dispatch,s=function(){navigator.mediaDevices.getUserMedia({audio:t,video:n}).then((function(e){console.log("permissions",e),c({type:"SET_SUCCES",payload:r("CHAT.CONFERENCE.ALLOK")})})).catch((function(e){var t=r("CHAT.CONFERENCE.ErrorAny");"NotFoundError"===e.name&&(t=r("CHAT.CONFERENCE.NotFoundError")),"NotAllowedError"===e.name&&(t=r("CHAT.CONFERENCE.NotAllowedError")),c({type:"SET_ERROR",payload:t}),console.log("err",e.name+" : "+e.message)}))},u=r(t&&n?"CHAT.CONFERENCE.CheckCamMic":t?"CHAT.CONFERENCE.CheckMic":"CHAT.CONFERENCE.CheckCam");return o?i.createElement(a.Tooltip,{title:u},i.createElement(a.IconButton,{sx:{color:"#fff",background:"#000","&:hover":{background:"#eee",color:"#000",boxShadow:"none"}},"aria-label":"check",onClick:function(){return s()},size:"large"},i.createElement(t&&n?j:t?L:M,null))):i.createElement(a.Button,{"aria-label":"cancel call",variant:"contained",sx:{color:"#fff",background:"#000","&:hover":{background:"#eee",color:"#000",boxShadow:"none"}},size:"small",startIcon:i.createElement(t&&n?j:t?L:M,null),onClick:function(){return s()}},u)},ht=function(e){var t=e.user;return o.createElement(a.Box,{sx:function(e){var n;return(n={position:"absolute",overflow:"hidden",top:null!=t&&t.role&&[3,4].includes(t.role)?50:110,left:null!=t&&t.role&&[3,4].includes(t.role)?50:30,zIndex:1e3})[e.breakpoints.down("sm")]={top:98,left:26},n}},o.createElement(a.Box,{display:"flex",flexDirection:"row",columnGap:3,my:3,sx:{position:"relative"}},o.createElement(Et,{audio:!0,video:!1}),o.createElement(Et,{audio:!1,video:!0})))},vt=function(e){var t=e.conference,n=e.onAccept,r=e.isMobile,a=e.user,i=e.activeRoom,l=e.apiUrl;return t.data?t.joined?o.createElement(o.Fragment,null,o.createElement(le,{conference:t.data,onClose:e.onClose,langCode:a.langCode}),(!i&&r||!r)&&o.createElement(ht,{user:a})):o.createElement(se,{apiUrl:l,contact:a.userId===t.data.userId?t.data.contactId:t.data.userId,conference:t.data,onAccept:n}):null},yt=o.createContext({online:!1}),Ct=function(e){var t,n,r=e.wsUrl,a=e.wsPath,l=e.baseUrl,c=e.children,s=o.useContext(Ze),u=s.state,d=s.dispatch,m=function(e,t,n){var r=o.useState(null),a=r[0],i=r[1],l=o.useCallback((function(){var r=U(e,{path:t,reconnection:!0,extraHeaders:{Authorization:"Bearer "+n}});i(r)}),[e,t,n]),c=o.useCallback((function(){null==a||a.disconnect(),i(null)}),[a]),s=o.useState(!1),u=s[0],d=s[1];return o.useEffect((function(){d(!(null==a||!a.connected))}),[a]),o.useEffect((function(){null==a||a.on("connect",(function(){d(!0),a.emit("chatData")}))}),[a]),o.useEffect((function(){null==a||a.on("disconnect",(function(){d(!1)}))}),[a]),{socket:a,online:u,disconnectSocket:c,connectSocket:l}}(r,a,u.token),p=m.socket,f=m.online,g=m.disconnectSocket,E=m.connectSocket;o.useEffect((function(){return u.token&&E(),u.token||g(),function(){g()}}),[u.token]);var h,v=function(e,t){return!!e.code&&(t({type:"SET_ERROR",payload:e.msg}),!0)};o.useEffect((function(){var e=function(e){console.log("unauthorized msg",e),nt(u.token,u.refreshToken,l)};null==p||p.on("unauthorized",e);var t=function(e){if(!v(e,d)){var t=e.data,n=t.groupData,r=t.contactData,a=t.userData;if(d({type:"CLEAR_CHAT_DATA"}),d({type:"SET_USER",payload:t.user}),n.length)for(var o,i=V(n);!(o=i()).done;){var l=o.value;null==p||p.emit("joinGroupSocket",{groupId:l.groupId}),d({type:"SET_GROUP_GATHER",payload:l})}if(r.length)for(var c,s=V(r);!(c=s()).done;){var u=c.value;null==p||p.emit("joinPrivateSocket",{contactId:u.userId}),d({type:"SET_CONTACT_GATHER",payload:u})}if(d({type:"SET_OPERATORS",payload:t.operatorData}),a.length)for(var m,f=V(a);!(m=f()).done;)d({type:"SET_USER_GATHER",payload:m.value});d({type:"UPDATE_ACTIVE_ROOM"}),d({type:"SET_CONFERENCE",payload:t.conferenceData}),d({type:"SET_VISIT_DATA",payload:t.visitData})}};null==p||p.on("chatData",t);var n=function(e){d({type:"USER_ONLINE",payload:e.data})};null==p||p.on("userOnline",n);var r=function(e){d({type:"USER_OFFLINE",payload:e.data})};null==p||p.on("userOffline",r);var a,o=function(e){v(e,d)||console.log("Ð£ÑÐ¿ÐµÑˆÐ½Ð¾ Ð²Ð¾ÑˆÐµÐ» Ð² Ð¿Ñ€Ð¸Ð²Ð°Ñ‚Ð½Ñ‹Ð¹ Ñ‡Ð°Ñ‚")};null==p||p.on("joinPrivateSocket",o);var i=function(e){v(e,d)||(a&&clearTimeout(a),d({type:"SET_TYPING",payload:e.data}),a=setTimeout((function(){d({type:"SET_TYPING",payload:null})}),1e3))};null==p||p.on("typing",i);var c=function(e){v(e,d)||(d({type:"REVOKE_MESSAGE",payload:e.data}),console.log("REVOKE_MESSAGE"))};null==p||p.on("revokeMessage",c);var s=function(e){v(e,d)||d({type:"SET_GROUP_GATHER",payload:e.data})};null==p||p.on("addGroup",s);var m=function(e){if(!v(e,d)){var t=e.data;d({type:"SET_CONTACT_GATHER",payload:t}),d({type:"SET_USER_GATHER",payload:t}),null==p||p.emit("joinPrivateSocket",{contactId:t.userId})}};null==p||p.on("addContact",m);var f=function(e){v(e,d)||d({type:"DEL_CONTACT",payload:e.data})};null==p||p.on("deleteContact",f);var g=function(e){v(e,d)||d({type:"UPDATE_GROUP_INFO",payload:e.data})};null==p||p.on("updateGroupInfo",g);var E=function(e){v(e,d)||d({type:"UPDATE_USER_INFO",payload:e.data})};null==p||p.on("updateUserInfo",E);var h=function(e){v(e,d)||d({type:"SET_CONFERENCE",payload:e.data})};null==p||p.on("startConference",h);var y=function(e){v(e,d)||d({type:"PAUSE_CONFERENCE",payload:e.data})};null==p||p.on("pauseConference",y);var C=function(e){v(e,d)||d({type:"STOP_CONFERENCE",payload:e.data})};null==p||p.on("stopConference",C);var R=function(e){v(e,d)};null==p||p.on("addOperator",R);var T=function(e){v(e,d)||d({type:"SET_ACTIVE_ROOM",payload:e.data})};null==p||p.on("setActiveRoom",T);var x=function(e){v(e,d)||d({type:"SET_VISIT_DATA",payload:e.data.visitData})};return null==p||p.on("visitData",x),function(){null==p||p.off("unauthorized",e),null==p||p.off("chatData",t),null==p||p.off("userOnline",n),null==p||p.off("userOffline",r),null==p||p.off("joinPrivateSocket",o),a&&clearTimeout(a),null==p||p.off("typing",i),null==p||p.off("revokeMessage",c),null==p||p.off("addGroup",s),null==p||p.off("addContact",m),null==p||p.off("deleteContact",f),null==p||p.off("updateGroupInfo",g),null==p||p.off("updateUserInfo",E),null==p||p.off("startConference",h),null==p||p.off("pauseConference",y),null==p||p.off("stopConference",C),null==p||p.off("addOperator",R),null==p||p.off("setActiveRoom",T),null==p||p.off("visitData",x)}}),[null==p?void 0:p.id]),o.useEffect((function(){var e=function(){var e=F(Te.mark((function e(t){var n;return Te.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!v(t,d)){e.next=2;break}return e.abrupt("return");case 2:d({type:"ADD_GROUP_MESSAGE",payload:n=t.data}),n.userId!==u.user.userId&&(null==p||p.emit("markAsRead",{groupId:n.groupId,_id:n._id}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();null==p||p.on("groupMessage",e);var t=function(){var e=F(Te.mark((function e(t){var n,r;return Te.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!v(t,d)){e.next=2;break}return e.abrupt("return");case 2:(n=t.data).contactId!==u.user.userId&&n.userId!==u.user.userId||(d({type:"ADD_PRIVATE_MESSAGE",payload:n}),u.activeRoom&&(null==(r=u.activeRoom)?void 0:r.userId)===n.userId&&(null==p||p.emit("markAsRead",{contactId:n.userId,_id:n._id})));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return null==p||p.on("privateMessage",t),function(){null==p||p.off("groupMessage",e),null==p||p.off("privateMessage",t)}}),[null==p?void 0:p.id,null==(t=u.activeRoom)?void 0:t.userId,null==(n=u.activeRoom)?void 0:n.groupId]),o.useEffect((function(){var e=function(e){if(!v(e,d)){var t=e.data;t.userId===u.user.userId?d(t.groupId?{type:"LOSE_GROUP_UNREAD_GATHER",payload:t.groupId}:{type:"LOSE_CONTACT_UNREAD_GATHER",payload:t.contactId}):t.contactId&&d({type:"MARK_PRIVATE_MESSAGES_READ",payload:t.userId})}};null==p||p.on("markAsRead",e);var t=function(e){if(!v(e,d)){var t=e.data;d(t.userId===u.user.userId?{type:"DEL_GROUP",payload:t.groupId}:{type:"DEL_GROUP_MEMBER",payload:t})}};null==p||p.on("deleteGroup",t);var n=function(e){if(!v(e,d)){var t=e.data,n=t.group,r=t.user;u.groupGather[n.groupId]?r.userId!==u.user.userId&&d({type:"ADD_GROUP_MEMBER",payload:{groupId:n.groupId,members:[r]}}):(console.log("joined to a new group"),null==p||p.emit("chatData"))}};null==p||p.on("joinGroup",n);var r=function(e){var t;if(!v(e,d)){var n=e.data,r=n.user;r.online=1;var a,o=u.groupGather[n.group.groupId];!o||null!=(t=o.members)&&t.find((function(e){return e.userId===r.userId}))||(r.isManager=0,null==(a=o.members)||a.push(r)),d({type:"SET_USER_GATHER",payload:r})}};return null==p||p.on("joinGroupSocket",r),function(){null==p||p.off("markAsRead",e),null==p||p.off("deleteGroup",t),null==p||p.off("joinGroup",n),null==p||p.off("joinGroupSocket",r)}}),[null==p?void 0:p.id,u.user.userId,(h=u.groupGather,Object.values(h).map((function(e){return null!=(null==e?void 0:e.messages)?null==e?void 0:e.messages.length:0})).reduce((function(e,t){return e+t}),0))]);var y=o.useMemo((function(){return{socket:p,online:f}}),[p,f]);return i.createElement(yt.Provider,{value:y},c)},Rt=["activeGroupId","activeChatUserId","hideRooms","fullWidth"],Tt=function(e){var t,n,r=e.activeGroupId,i=e.activeChatUserId,l=e.hideRooms,c=void 0!==l&&l,s=B(e,Rt),u=a.useMediaQuery((function(e){return e.breakpoints.down("md")})),d=o.useContext(Ze),m=d.state,p=d.dispatch,f=o.useContext(yt).socket,g=o.useContext(tt),E=g.apiUrl,h=g.pageSize,v=g.getPrivateMessages,y=g.getGroupMessages,C=g.getUserByMmk,R=o.useCallback((function(){p({type:"SET_ACTIVE_ROOM",payload:{}})}),[p]),T=o.useCallback((function(e,t){if(f)try{f.emit(e,t)}catch(t){console.error("Error emitting "+e+":",t),p({type:"SET_ERROR",payload:"Failed to send "+e})}else console.warn("Socket not connected, cannot emit "+e)}),[f,p]),x=o.useCallback(function(){var e=F(Te.mark((function e(t){return Te.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,p({type:"SET_LOADING",payload:!0}),!$(t)){e.next=7;break}return e.next=5,y(t);case 5:e.next=9;break;case 7:return e.next=9,v(t);case 9:e.next=15;break;case 11:e.prev=11,e.t0=e.catch(0),console.error("Failed to load messages:",e.t0),p({type:"SET_ERROR",payload:"Failed to load messages"});case 15:return e.prev=15,p({type:"SET_LOADING",payload:!1}),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[0,11,15,18]])})));return function(t){return e.apply(this,arguments)}}(),[v,y,p]),S=o.useCallback((function(e,t){T("revokeMessage",{groupId:$(e)?e.groupId:void 0,contactId:e.userId,_id:t._id})}),[T]),I=o.useCallback((function(e){T("typing",{groupId:$(e)?e.groupId:void 0,contactId:e.userId})}),[T]),b=o.useCallback((function(e,t){var n={content:t.message,width:t.width,height:t.height,fileName:t.fileName,messageType:t.messageType,size:t.size};$(e)?T("groupMessage",H({},n,{groupId:e.groupId})):T("privateMessage",H({},n,{contactId:e.userId}))}),[T]),A=o.useCallback((function(e){var t;if(null!=e&&null!=(t=e.messages)&&t.length&&f)try{var n=e.messages[e.messages.length-1];if(null==n||!n._id)return;$(e)?f.emit("markAsRead",{groupId:e.groupId,_id:n._id}):(p({type:"MARK_PRIVATE_MESSAGES_READ",payload:e.userId}),f.emit("markAsRead",{contactId:e.userId,_id:n._id}))}catch(e){console.error("Error marking messages as read:",e),p({type:"SET_ERROR",payload:"Failed to mark messages as read"})}}),[f,p]),k=o.useCallback((function(e){if(e)try{p({type:"SET_ACTIVE_ROOM",payload:{groupId:$(e)?e.groupId:void 0,contactId:null==e?void 0:e.userId}}),A(e)}catch(e){console.error("Error changing chat:",e),p({type:"SET_ERROR",payload:"Failed to change chat room"})}}),[p,A,f]),w=o.useCallback((function(e,t,n){T("startConference",{groupId:$(e)?e.groupId:void 0,contactId:e.userId,visitId:t,recreate:n})}),[T]),O=o.useCallback((function(e){null!=e&&e.id&&T("stopConference",{id:e.id})}),[T]),_=o.useCallback((function(e){null!=e&&e.id&&T("pauseConference",{id:e.id})}),[T]),G=o.useCallback((function(e){null!=e&&e.id&&(T("resumeConference",{id:e.id}),p({type:"JOIN_CONFERENCE",payload:e}))}),[T,p]),N=o.useCallback((function(e,t){T("addOperator",{groupId:e.groupId,operatorId:t.userId})}),[T]),D=o.useCallback((function(e){T("deleteGroup",{groupId:e.groupId})}),[T]);o.useEffect((function(){var e=!0;return function(){var t=F(Te.mark((function t(){var n,a,o,l,c,s;return Te.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null==r||q(m.groupGather)){t.next=5;break}if(q(n=Object.values(m.groupGather).find((function(e){return e.groupId===r})))||!e){t.next=5;break}return k(n),t.abrupt("return");case 5:if(null==i||q(m.contactGather)){t.next=10;break}if(!(a=Object.values(m.contactGather).find((function(e){return e.userId===i})))||!e){t.next=10;break}return k(a),t.abrupt("return");case 10:if(o=X("mmk"),l=X("guid"),null==o&&null==l||q(m.contactGather)){t.next=27;break}return t.prev=13,t.next=16,C(o,l);case 16:if(null==(c=t.sent)){t.next=22;break}if(!(s=Object.values(m.contactGather).find((function(e){return e.userId===c})))||!e){t.next=22;break}return k(s),t.abrupt("return");case 22:t.next=27;break;case 24:t.prev=24,t.t0=t.catch(13),console.error("Failed to get user by MMK:",t.t0);case 27:return t.abrupt("return",(function(){e=!1}));case 28:case"end":return t.stop()}}),t,null,[[13,24]])})));return function(){return t.apply(this,arguments)}}()(),function(){e=!1}}),[m.user.userId]);var M=null!=m.activeRoom&&o.createElement(Ve,{apiUrl:E,user:m.user,users:m.userGather,operators:m.operators,chat:m.activeRoom,typing:m.typing,conference:m.conference.data,visitData:m.visitData,conferenceJoined:m.conference.joined,loading:m.loading,pageSize:h,onExitRoom:R,onEnterRoom:A,onNeedMoreMessages:x,onMessageDelete:S,onTyping:I,onSendMessage:b,onVideoCall:w,onVideoEnd:O,onConferencePause:_,onOperatorAdd:N,onLeaveGroup:D,onContactClick:s.onContactInfoClick,isMobile:u});return o.createElement(ft,null,o.createElement(gt,{isMobile:u,conferenceActive:!(null==(t=m.conference.data)||!t.id),hideRooms:c,contactsList:null!=(null==(n=m.conference.data)?void 0:n.id)&&null==r?o.createElement(vt,{conference:m.conference,onClose:_,onAccept:G,user:m.user,activeRoom:m.activeRoom,onChangeChat:k,apiUrl:E,isMobile:u}):o.createElement(dt,{user:m.user,activeRoom:m.activeRoom,groups:Object.values(m.groupGather),contacts:Object.values(m.contactGather),typing:m.typing,onChangeChat:k}),chatRoom:M,activeRoom:m.activeRoom,user:m.user,onExitRoom:R,onChangeChat:k,chatOld:m.chatOld}),o.createElement(mt,null))},xt=["lang","chatBaseURLApi","baseUrl","chatWsUrl","chatWsPath","token","refreshToken"];exports.AddContact=oe,exports.CHAT_ACTIONS={SET_ACTIVE_ROOM:"SET_ACTIVE_ROOM",SET_LOADING:"SET_LOADING",SET_ERROR:"SET_ERROR",REVOKE_MESSAGE:"REVOKE_MESSAGE",MARK_PRIVATE_MESSAGES_READ:"MARK_PRIVATE_MESSAGES_READ"},exports.ChatContext=Ze,exports.ChatIndex=function(e){var t=e.lang,n=e.chatBaseURLApi,r=e.baseUrl,a=e.chatWsUrl,o=e.chatWsPath,l=e.token,c=e.refreshToken,s=B(e,xt);return i.createElement(et,{defLang:t,token:l,refreshToken:c},i.createElement(at,{chatBaseURLApi:n,pageSize:25,baseUrl:r},i.createElement(Ct,{wsUrl:a,wsPath:o,baseUrl:r},i.createElement(Tt,s))))},exports.ChatPage=Tt,exports.ChatProvider=et,exports.Conference=le,exports.ConferenceCall=se,exports.Emoji=de,exports.Message=Ce,exports.RestContext=tt,exports.RestProvider=at,exports.Room=Ve,exports.RoomList=dt,exports.SocketContext=yt,exports.SocketProvider=Ct,exports.Typing=ee,exports.clearLocalStorage=function(){localStorage.removeItem("authToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("user"),localStorage.removeItem("doctor"),localStorage.removeItem("chatUser")},exports.getRefreshToken=nt;
//# sourceMappingURL=chat.cjs.production.min.js.map
