"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t,n,r,a=require("react"),o=e(a),i=require("@mui/material"),l=require("@mui/styles"),c=e(require("@mui/icons-material/FileCopy")),s=e(require("@mui/icons-material/Delete")),u=e(require("@mui/icons-material/ArrowBack")),d=require("@mui/icons-material"),m=require("react-i18next"),p=e(require("@mui/icons-material/Group")),f=e(require("@mui/icons-material/CallEnd")),g=e(require("@mui/icons-material/PersonAdd")),E=e(require("@mui/icons-material/Star")),h=e(require("dayjs")),v=e(require("@mui/material/Button")),y=e(require("@mui/material/Dialog")),C=e(require("@mui/material/DialogActions")),T=e(require("@mui/material/DialogContent")),R=e(require("@mui/material/Slide")),I=require("@mui/material/styles"),S=e(require("@mui/material/Menu")),A=e(require("@mui/material/MenuItem")),x=e(require("@mui/icons-material/PlayArrow")),O=e(require("@mui/icons-material/RestartAlt")),b=e(require("@mui/icons-material/VideoCall")),N=e(require("@mui/icons-material/KeyboardArrowDown")),_=require("react-aspect-ratio"),k=e(require("react-infinite-scroll-hook")),w=e(require("@mui/material/List")),G=e(require("axios")),M=e(require("socket.io-client")),D=e(require("@mui/icons-material/SettingsSuggest")),L=e(require("@mui/icons-material/SettingsVoice")),U=e(require("@mui/icons-material/VideoSettings")),j=e(require("i18next"));(t=exports.MessageStatus||(exports.MessageStatus={}))[t.sent=0]="sent",t[t.read=1]="read",(n=exports.Role||(exports.Role={}))[n.Unknown=0]="Unknown",n[n.Client=1]="Client",n[n.Agent=2]="Agent",n[n.Specialist=3]="Specialist",n[n.Operator=4]="Operator",(r=exports.ContextMenuType||(exports.ContextMenuType={})).COPY="COPY",r.REVOKE="REVOKE",r.TOP_REVERT="TOP_REVERT",r.TOP="TOP",r.READ="READ",r.DELETE="DELETE";var P=l.makeStyles((function(){return l.createStyles({item:{cursor:"pointer"}})})),F=function(e){var t=P(),n=function(t){e.onSelect&&e.onSelect(t.target.innerText)},r=function(e){return a.createElement(i.Box,{m:.5,component:"span",onClick:n,className:t.item},e.emoji)};return a.createElement(i.Box,null,a.createElement(i.Box,{display:"flex",flexDirection:"row"},a.createElement(r,{emoji:"😃"}),a.createElement(r,{emoji:"😁"}),a.createElement(r,{emoji:"😂"}),a.createElement(r,{emoji:"😄"}),a.createElement(r,{emoji:"😅"}),a.createElement(r,{emoji:"😆"}),a.createElement(r,{emoji:"😇"}),a.createElement(r,{emoji:"😈"}),a.createElement(r,{emoji:"😉"})),a.createElement(i.Box,{display:"flex",flexDirection:"row"},a.createElement(r,{emoji:"😊"}),a.createElement(r,{emoji:"😋"}),a.createElement(r,{emoji:"😌"}),a.createElement(r,{emoji:"😍"}),a.createElement(r,{emoji:"😎"}),a.createElement(r,{emoji:"😏"}),a.createElement(r,{emoji:"😐"}),a.createElement(r,{emoji:"😒"}),a.createElement(r,{emoji:"😓"})),a.createElement(i.Box,{display:"flex",flexDirection:"row"},a.createElement(r,{emoji:"❓"}),a.createElement(r,{emoji:"😕"}),a.createElement(r,{emoji:"😖"}),a.createElement(r,{emoji:"😗"}),a.createElement(r,{emoji:"😘"}),a.createElement(r,{emoji:"😙"}),a.createElement(r,{emoji:"😚"}),a.createElement(r,{emoji:"😜"}),a.createElement(r,{emoji:"😝"})),a.createElement(i.Box,{display:"flex",flexDirection:"row"},a.createElement(r,{emoji:"😞"}),a.createElement(r,{emoji:"😟"}),a.createElement(r,{emoji:"😠"}),a.createElement(r,{emoji:"😡"}),a.createElement(r,{emoji:"😢"}),a.createElement(r,{emoji:"😣"}),a.createElement(r,{emoji:"😤"}),a.createElement(r,{emoji:"😥"}),a.createElement(r,{emoji:"😦"})),a.createElement(i.Box,{display:"flex",flexDirection:"row"},a.createElement(r,{emoji:"😨"}),a.createElement(r,{emoji:"😩"}),a.createElement(r,{emoji:"😪"}),a.createElement(r,{emoji:"😫"}),a.createElement(r,{emoji:"😬"}),a.createElement(r,{emoji:"😭"}),a.createElement(r,{emoji:"😮"}),a.createElement(r,{emoji:"😯"}),a.createElement(r,{emoji:"😰"})),a.createElement(i.Box,{display:"flex",flexDirection:"row"},a.createElement(r,{emoji:"😲"}),a.createElement(r,{emoji:"😳"}),a.createElement(r,{emoji:"😴"}),a.createElement(r,{emoji:"😵"}),a.createElement(r,{emoji:"🧐"}),a.createElement(r,{emoji:"😷"}),a.createElement(r,{emoji:"🙁"}),a.createElement(r,{emoji:"🙂"}),a.createElement(r,{emoji:"🙃"})),a.createElement(i.Box,{display:"flex",flexDirection:"row"},a.createElement(r,{emoji:"🤐"}),a.createElement(r,{emoji:"🤑"}),a.createElement(r,{emoji:"🤒"}),a.createElement(r,{emoji:"🤓"}),a.createElement(r,{emoji:"🤔"}),a.createElement(r,{emoji:"🤕"}),a.createElement(r,{emoji:"🤠"}),a.createElement(r,{emoji:"🤡"}),a.createElement(r,{emoji:"🤢"})),a.createElement(i.Box,{display:"flex",flexDirection:"row"},a.createElement(r,{emoji:"🤤"}),a.createElement(r,{emoji:"🤥"}),a.createElement(r,{emoji:"🤧"}),a.createElement(r,{emoji:"🤨"}),a.createElement(r,{emoji:"🤩"}),a.createElement(r,{emoji:"🤪"}),a.createElement(r,{emoji:"🤫"}),a.createElement(r,{emoji:"🤬"}),a.createElement(r,{emoji:"🤭"})))},H=l.makeStyles((function(e){return l.createStyles({typingText:{paddingLeft:e.spacing(.5)},typingDot:{display:"inline-block",verticalAlign:"middle",width:4,height:4,margin:"0px 2px",background:e.palette.primary.main,borderRadius:"50%",opacity:"0",animation:"$loadingFade 1s infinite","&:nth-child(1)":{animationDelay:"0s"},"&:nth-child(2)":{animationDelay:"0.2s"},"&:nth-child(3)":{animationDelay:"0.4s"}},"@keyframes loadingFade":{"0%":{opacity:0},"50%":{opacity:.8},"100%":{opacity:0}}})})),B=function(e){var t=H();return o.createElement(i.Typography,{color:"primary",variant:"body2",component:"span"},o.createElement("span",{className:t.typingDot}),o.createElement("span",{className:t.typingDot}),o.createElement("span",{className:t.typingDot}),o.createElement("span",{className:t.typingText},e.message))},z=l.makeStyles((function(){return{input:{flex:"auto"},inputUpload:{display:"none"},attachmentIcon:{fill:"none",stroke:"currentColor"}}})),V=function(e){var t=z(),n=e.chat,r=m.useTranslation().t,a=o.useState(null),l=a[0],c=a[1],s=o.useState(""),u=s[0],p=s[1],f=o.useState({chat:n,time:0}),g=f[0],E=f[1],h=function(){c(null)},v=function(t){n&&e.onSendMessage&&e.onSendMessage(n,t)},y=function(){0!==u.trim().length&&(v({message:u,messageType:"text"}),p(""))},C=Boolean(l),T=C?"simple-popover":void 0;return o.createElement(i.Box,{display:"flex",flexDirection:"row"},o.createElement(i.TextField,{className:t.input,placeholder:r("CHAT.INPUT_MESSAGE")||"",autoFocus:!0,variant:"standard",InputProps:{disableUnderline:!0,startAdornment:o.createElement(i.InputAdornment,{position:"start"},o.createElement("input",{accept:".pdf,.jpg,.jpeg,.bmp,.gif,.png,application/pdf,image/jpeg,image/bmp,image/gif,image/png",className:t.inputUpload,id:"icon-button-file",type:"file",onChange:function(e){if(e.currentTarget.files){var t,n=e.currentTarget.files[0];if("image"==(t=n.type.includes("image")?"image":n.type.includes("video")?"video":"file")){var r=new Image,a=window.URL||window.webkitURL;r.src=a.createObjectURL(n),r.onload=function(){var e,a,o,i=(o=(e={width:r.width,height:r.height}).height,((a=e.width)>335||o>335)&&(a>o?(o=o/a*335,a=335):(a=a/o*335,o=335)),{width:a,height:o});v({message:n,width:i.width,height:i.height,messageType:t})}}else v({message:n,messageType:t,fileName:n.name,size:n.size})}}}),o.createElement("label",{htmlFor:"icon-button-file"},o.createElement(i.IconButton,{color:"primary","aria-label":"upload",component:"span",size:"small"},o.createElement(i.SvgIcon,{fill:"none",className:t.attachmentIcon},o.createElement("path",{d:"M16.768 13.5767L11.6961 18.6486C9.35886 20.9859 5.56937 20.9859 3.23208 18.6486V18.6486C0.894789 16.3114 0.894789 12.5219 3.23208 10.1846L10.4479 2.96872C12.0875 1.32914 14.7458 1.32914 16.3854 2.96873V2.96873C18.025 4.60831 18.025 7.26659 16.3854 8.90617L9.16515 16.1264C8.23032 17.0612 6.71466 17.0612 5.77982 16.1264V16.1264C4.84499 15.1916 4.84499 13.6759 5.77982 12.7411L10.8896 7.63131",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"}))))," ",o.createElement(i.IconButton,{"aria-describedby":T,onClick:function(e){c(e.currentTarget)},color:"primary",size:"small"},o.createElement(d.InsertEmoticon,null))),endAdornment:o.createElement(i.IconButton,{edge:"end",color:"inherit",size:"small",onClick:function(e){e.preventDefault(),y()}},o.createElement(d.Send,null))},value:u,onChange:function(t){p(t.target.value),n&&e.onTyping&&(g.chat!==n||Date.now()-g.time>=500)&&(E({chat:n,time:Date.now()}),e.onTyping(n))},onKeyPress:function(e){"Enter"===e.key&&(e.preventDefault(),y())}}),o.createElement(i.Popover,{id:T,open:C,anchorEl:l,onClose:h,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"left"}},o.createElement(F,{onSelect:function(e){p(""+u+e),h()}})))},Y=function(e){var t=m.useTranslation().t;return e.isTyping?o.createElement(B,{message:t("CHAT.STATUS.TYPING")}):1===e.contact.online?o.createElement(i.Typography,{variant:"body2",color:"primary",component:"span"},t("CHAT.STATUS.ONLINE")):o.createElement(i.Typography,{variant:"body2",color:"textSecondary",component:"span"},t("CHAT.STATUS.OFFLINE"))};function q(e,t,n,r,a,o,i){try{var l=e[o](i),c=l.value}catch(e){return void n(e)}l.done?t(c):Promise.resolve(c).then(r,a)}function W(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){q(o,r,a,i,l,"next",e)}function l(e){q(o,r,a,i,l,"throw",e)}i(void 0)}))}}function K(){return(K=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function $(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t.indexOf(n=o[r])>=0||(a[n]=e[n]);return a}function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function X(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return J(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?J(e,void 0):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Q(e){return null==e||"object"==typeof e&&0===Object.keys(e).length||"string"==typeof e&&0===e.trim().length}function Z(e,t){return void 0===t&&(t="DD.MM.YYYY HH:mm"),void 0===e?null:("string"==typeof e&&(e=new Date(e)),h().add(-1,"days").startOf("day").isAfter(e)?h(e).format(t):h().startOf("day").isAfter(e)?"Вчера в "+h(e).format("HH:mm"):h(e).format("HH:mm"))}var ee=function(e){return e?e.groupId?"group:"+e.groupId:"user:"+e.userId:null},te=function(e){return e.groupId?e.name:e.username},ne=function(e){return Object.values(e).map((function(e){return null!=(null==e?void 0:e.messages)?null==e?void 0:e.messages.length:0})).reduce((function(e,t){return e+t}),0)},re=function(e,t){var n=Array.isArray(e.messages)&&e.messages.length>0,r=Array.isArray(t.messages)&&t.messages.length>0;return n&&r&&null!=t.messages&&null!=e.messages?(null!=t.messages[t.messages.length-1].cdate?new Date(t.messages[t.messages.length-1].cdate).getTime():(new Date).getTime())-(null!=e.messages[e.messages.length-1].cdate?new Date(e.messages[e.messages.length-1].cdate).getTime():(new Date).getTime()-1):n?-1:1},ae=function(e){var t=window.location.search;return new URLSearchParams(t).get(e)},oe=function(e,t,n){var r=t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e;return n?r+(r.includes("?")?"&":"?")+new URLSearchParams(n).toString():r},ie=["apiUrl","contacts","owner","onContactClick"],le=l.makeStyles((function(){return{star:{fontSize:"0.85rem",verticalAlign:"middle"}}})),ce=function(e){var t=le(),n=e.apiUrl,r=e.contacts,a=e.owner,l=e.onContactClick,c=$(e,ie);return o.createElement(i.List,K({},c,{"aria-label":"contacts"}),r.map((function(e){return o.createElement(i.ListItemButton,{key:e.userId,onClick:function(){return l&&l(e)}},o.createElement(i.ListItemAvatar,null,o.createElement(i.Avatar,{alt:e.username,src:e.avatar?oe(n,e.avatar):""})),o.createElement(i.ListItemText,{primary:o.createElement("span",null,e.username," ",a===e.userId&&o.createElement(E,{className:t.star,color:"primary"})),secondary:o.createElement(Y,{contact:e,isTyping:!1})}))})))},se=function(e){var t=e.onClose,n=e.open,r=e.apiUrl,a=e.contacts,l=m.useTranslation();return o.createElement(i.Dialog,{onClose:function(){t()},"aria-labelledby":"add-contact-title",open:n},o.createElement(i.DialogTitle,{id:"switch-operator-title"},(0,l.t)("CHAT.ADD_CONTACT")),o.createElement(ce,{apiUrl:r,contacts:a,onContactClick:function(e){t(e)}}))},ue=o.forwardRef((function(e,t){return o.createElement(i.Slide,K({direction:"up",ref:t},e))}));function de(e){var t=e.children,n=e.open,r=e.setOpen,a=e.severity,l=void 0===a?"warning":a,c=m.useTranslation().t,s=function(){r(!1)};return o.createElement(i.Dialog,{open:n,TransitionComponent:ue,keepMounted:!0,onClose:s,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},o.createElement(i.DialogContent,null,o.createElement(i.Alert,{severity:l},"string"==typeof t?o.createElement(i.Typography,{variant:"body2"},t):t)),o.createElement(i.DialogActions,null,o.createElement(i.Button,{onClick:s,variant:"text"},c("CHAT.BUT_CLOSE"))))}var me=function(e){var t=e.modaleInfo,n=e.setModaleInfo,r=e.strTime,l=m.useTranslation().t;return a.useMemo((function(){return o.createElement(de,{open:t,setOpen:n,severity:"info"},o.createElement(i.Typography,{variant:"body1",textAlign:"center"},l("CHAT.CONFERENCE.UntillTheEnd"),":"),o.createElement(i.Typography,{variant:"h6",textAlign:"center"},r))}),[t])},pe=function(e){var t=e.finishDate,n=m.useTranslation().t,r=a.useState(!1),l=r[0],c=r[1],s=Date.now(),u=new Date(t).getTime(),d=Math.round((u-s)/1e3),p=function(e){void 0===e&&(e=3e4);var t=a.useState(e),n=t[0],r=t[1],o=a.useRef(null);return a.useEffect((function(){return n>0&&(o.current=setInterval((function(){return r((function(e){return e-1}))}),1e3)),function(){o.current&&clearInterval(o.current)}}),[n]),{counter:n,handlerRefresh:function(){r(e)}}}(d);if(a.useEffect((function(){null!=g&&3===g&&null!=E&&0===E&&c(!0)}),[p.counter]),d<1)return null;var f=function(e){var t=Math.floor(e/3600),n=t<10?"0"+t:t;e%=3600;var r=Math.floor(e/60),a=e%60;return{hours:t,minutes:r,seconds:a,strTime:n+":"+(r<10?"0"+r:r)+":"+(a<10?"0"+a:a)}}(d),g=f.minutes,E=f.seconds,h=f.strTime;return o.createElement(i.Box,{textAlign:"center"},o.createElement(i.Typography,{variant:"body2",component:"span"},n("CHAT.CONFERENCE.LEFT_TIME"),":"," "),o.createElement(i.Typography,{variant:"button",component:"span"},h),o.createElement(me,{modaleInfo:l,setModaleInfo:c,strTime:h}))},fe=a.forwardRef((function(e,t){return a.createElement(R,K({direction:"up",ref:t},e))}));function ge(e){var t=e.open,n=e.setOpen,r=e.contentText,o=e.callback,l=m.useTranslation().t,c=function(){n(!1)};return a.createElement(a.Fragment,null,a.createElement(y,{open:t,TransitionComponent:fe,keepMounted:!0,onClose:c,"aria-describedby":"alert-dialog-slide-description"},a.createElement(T,null,a.createElement(i.Typography,{variant:"h6"},r)),a.createElement(C,null,a.createElement(v,{onClick:c,color:"primary"},l("CHAT.BUT_CLOSE")),a.createElement(v,{onClick:function(){n(!1),o()},color:"warning"},l("CHAT.BUT_CONFIRM")))))}var Ee=I.styled((function(e){return a.createElement(S,K({elevation:0,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"}},e))}))((function(e){var t=e.theme;return{"& .MuiPaper-root":{borderRadius:6,marginTop:t.spacing(1),minWidth:180,color:"light"===t.palette.mode?"rgb(55, 65, 81)":t.palette.grey[300],boxShadow:"rgb(255, 255, 255) 0px 0px 0px 0px, rgba(0, 0, 0, 0.05) 0px 0px 0px 1px, rgba(0, 0, 0, 0.1) 0px 10px 15px -3px, rgba(0, 0, 0, 0.05) 0px 4px 6px -2px","& .MuiMenu-list":{padding:"4px 0"},"& .MuiMenuItem-root":{"& .MuiSvgIcon-root":{fontSize:18,color:t.palette.text.secondary,marginRight:t.spacing(1.5)},"&:active":{backgroundColor:I.alpha(t.palette.primary.main,t.palette.action.selectedOpacity)}}}}}));function he(e){var t=m.useTranslation().t,n=a.useState(null),r=n[0],o=n[1],i=a.useState(null),l=i[0],c=i[1],s=a.useState(!1),u=s[0],d=s[1],p=Boolean(r),f=a.useMemo((function(){return e.visitData.filter((function(t){return t.contactId===e.chat.userId}))}),[e.visitData,e.chat]);return a.createElement("div",null,a.createElement(v,{id:"conference-button","aria-controls":p?"conference-menu":void 0,"aria-haspopup":"true","aria-expanded":p?"true":void 0,color:"primary",size:"small",variant:"contained",disableElevation:!0,onClick:function(e){o(e.currentTarget)},startIcon:a.createElement(b,null),endIcon:a.createElement(N,null),disabled:0===f.length},t("CHAT.CONFERENCE.START")),a.createElement(ge,{open:u,setOpen:d,contentText:t("CHAT.CONFERENCE.CONFIRM_RECREATE_CONF"),callback:function(){l&&u&&e.onVideoCall(e.chat,l,!0)}}),a.createElement(Ee,{id:"conference-menu",MenuListProps:{"aria-labelledby":"conference-button"},anchorEl:r,open:p,onClose:function(){o(null)}},f.map((function(t){return a.createElement(A,{onClick:function(){return function(t){o(null),c(t.visitId),"finished"===t.conferenceStatus?d(!0):e.onVideoCall(e.chat,t.visitId)}(t)},key:t.visitId,value:t.visitId,disableRipple:!0},a.createElement("finished"===t.conferenceStatus?O:x,null),(n=t,r=new Date(n.visitDate),n.plExamName+" ("+Z(r,"HH:mm")+" - "+Z(new Date(r.getTime()+6e4*n.duration),"HH:mm")+")"));var n,r}))))}var ve=l.makeStyles((function(e){return l.createStyles({paper:{padding:e.spacing(1)},avatarGroup:{backgroundColor:"#28B7C6",color:"#fff"}})})),ye=function(e,t){var n,r=[(null==(n=e.members)?void 0:n.length)+" "+t("CHAT.MEMBERS")],a=(e.members||[]).reduce((function(e,t){return t.online?e+1:e}),0);return a&&r.push(a+" "+t("CHAT.STATUS.ONLINE")),r.join(", ")},Ce=function(e){var t=e.apiUrl,n=e.user,r=e.chat,l=e.typing,c=e.conference,u=e.visitData,d=e.conferenceJoined,E=e.className,h=e.operators,v=e.onVideoCall,y=e.onVideoEnd,C=e.onConferencePause,T=e.onOperatorAdd,R=e.onLeaveGroup,I=e.onContactClick,S=ve(),A=m.useTranslation().t,x=a.useState(null),O=x[0],b=x[1],N=a.useState(!1),_=N[0],k=N[1],w=o.useState(!1),G=w[0],M=w[1];if(!r)return o.createElement(i.CardHeader,{avatar:o.createElement(i.Avatar,null),title:"",subheader:"",className:E});var D,L=null,U=function(e){O||b(e.currentTarget),L&&(clearTimeout(L),L=null)},j=function(){b(null),L&&(clearTimeout(L),L=null)},P=function(){L||(L=setTimeout((function(){j()}),1e3))},F=r;if(F.groupId)return o.createElement(i.CardHeader,{avatar:o.createElement(i.Avatar,{alt:F.name,className:S.avatarGroup},o.createElement(p,null)),title:F.name,subheader:o.createElement(o.Fragment,null,o.createElement("span",{id:"mouse-over-span","aria-owns":O?"mouse-over-popover":void 0,"aria-haspopup":"true",onMouseEnter:U,onMouseLeave:P},ye(F,A)),o.createElement(i.Popover,{id:"mouse-over-popover",classes:{paper:S.paper},sx:{pointerEvents:"none"},open:!!O,anchorEl:O,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},onClose:j,disableRestoreFocus:!0},o.createElement(ce,{apiUrl:t,contacts:F.members,onContactClick:I,owner:F.userId,onMouseEnter:U,onMouseLeave:P,sx:{pointerEvents:"all"}}))),className:E,action:o.createElement(o.Fragment,null,4===n.role&&o.createElement(o.Fragment,null,o.createElement(i.IconButton,{"aria-label":"add user",onClick:function(){k(!0)}},o.createElement(g,null)),o.createElement(se,{apiUrl:t,open:_,contacts:h,onClose:function(e){k(!1),T&&e&&r&&T(r,e)}})),4===n.role&&(null==(D=F.members)?void 0:D.find((function(e){return e.userId!==n.userId&&4===e.role})))&&R&&o.createElement(i.IconButton,{"aria-label":"leave group",onClick:function(){return R(F)}},o.createElement(s,null)))});var H=r,B=!(null==l||!l.contactId)&&(null==l?void 0:l.userId)===H.userId;return o.createElement(i.CardHeader,{avatar:o.createElement(i.Avatar,{alt:H.username,src:H.avatar?oe(t,H.avatar):""}),title:H.username,subheader:o.createElement(Y,{contact:H,isTyping:B}),className:E,action:o.createElement(o.Fragment,null,1!==n.role&&d&&c&&!Q(c)&&null!=C&&o.createElement(i.Button,{"aria-label":"cancel call",variant:"contained",color:"secondary",size:"small",startIcon:o.createElement(f,{color:"error"}),onClick:function(){return C(c)}},A("CHAT.CONFERENCE.PAUSE")),c&&!Q(c)&&null!=y&&null!=n.role&&[3,4].includes(n.role)&&o.createElement(o.Fragment,null,o.createElement(i.Button,{"aria-label":"cancel call",variant:"contained",color:"primary",size:"small",startIcon:o.createElement(f,{color:"error"}),onClick:function(){return M(!0)},style:{marginLeft:8}},A("CHAT.CONFERENCE.FINISH")),o.createElement(ge,{open:G,setOpen:M,contentText:A("CHAT.CONFERENCE.CONFIRM_FINISH_CONF"),callback:function(){y(c)}})),Q(c)&&null!=v&&n.role&&[3,4].includes(n.role)&&o.createElement(he,{visitData:u,chat:H,onVideoCall:v}),null!=(null==c?void 0:c.finishDate)&&o.createElement(pe,{finishDate:c.finishDate}))})},Te=l.makeStyles((function(e){return l.createStyles({fileIcon:{fontSize:"0.75rem"},fileBody:{paddingLeft:e.spacing(1.2)}})})),Re=function(e){var t=e.message,n=Te(),r=function(e){var t=e.split("$");return{date:t[0],userId:t[1],size:t[2],name:t[3]}}(t.content),a=function(e){var t=e.lastIndexOf(".");return-1===t?{name:e,ext:""}:{name:e.slice(0,t),ext:e.slice(t+1)}}(r.name),l=a.name,c=a.ext;return o.createElement(i.Box,{display:"flex",flexDirection:"row"},o.createElement(i.Avatar,{className:n.fileIcon},c.toUpperCase()),o.createElement(i.Box,{display:"flex",flexDirection:"column",className:n.fileBody},l,o.createElement("span",null,c+" "+r.size)))},Ie=l.makeStyles((function(e){var t;return{mediaContent:(t={backgroundColor:e.palette.secondary.main,borderRadius:e.spacing(1.2),maxWidth:284,height:190},t[e.breakpoints.down("sm")]={maxWidth:250,height:170},t)}})),Se=function(e){var t=e.apiUrl,n=e.message,r=e.isConference,a=Ie(),i="";if(r){var l=JSON.parse(n.content);i=oe(t,"/static/conf/"+l.visitId+"/"+l.name)}else i=oe(t,"/static/file/"+n.content);return o.createElement("video",{src:i,className:a.mediaContent,controls:!0,muted:!0,preload:"none"},"Ваш браузер не поддерживает тег video.")},Ae=l.makeStyles((function(e){var t,n;return l.createStyles({img:(t={cursor:"pointer",borderRadius:e.spacing(1.2),maxWidth:284,maxHeight:190},t[e.breakpoints.down("sm")]={maxWidth:250,maxHeight:170},t),aspect:(n={maxWidth:284,height:190},n[e.breakpoints.down("sm")]={maxWidth:250,height:170},n)})})),xe=function(e){var t=e.apiUrl,n=e.message,r=e.setViewerData,a=Ae();return o.createElement(_.AspectRatio,{ratio:"3/4",className:a.aspect},o.createElement("img",{src:oe(t,"/static/image/"+n.content),onClick:function(){r({visible:!0,src:oe(t,"/static/image/"+n.content)})},className:a.img,alt:n.cdate}))},Oe=function(e){var t=e.apiUrl,n=e.message,r=e.setViewerData;switch(n.messageType){case"text":return o.createElement(o.Fragment,null,n.content);case"video":case"video_conference":return o.createElement(Se,{message:n,apiUrl:t,isConference:"video_conference"===n.messageType});case"image":return o.createElement(xe,{message:n,apiUrl:t,setViewerData:r});case"file":return o.createElement(Re,{message:n})}return null},be=l.makeStyles((function(e){var t;return l.createStyles({rootContact:{padding:1,paddingLeft:e.spacing(2),"& span":{float:"right",color:e.palette.text.secondary,fontSize:"0.8rem"},"& $message":{backgroundColor:e.palette.grey[200],color:e.palette.text.primary,borderTopRightRadius:e.spacing(3),borderBottomRightRadius:e.spacing(3)},"& $firstMessage":{borderTopLeftRadius:e.spacing(3),marginTop:10},"& $lastMessage":{borderTopRightRadius:e.spacing(3),borderBottomLeftRadius:0,borderBottomRightRadius:e.spacing(3),marginBottom:10}},rootUser:{padding:1,paddingRight:e.spacing(2),justifyContent:"flex-end","& span":{float:"right",color:"#D9DEEC",fontSize:"0.8rem"},"& $message":{backgroundColor:e.palette.primary.main,color:e.palette.primary.contrastText,borderTopLeftRadius:e.spacing(3),borderBottomLeftRadius:e.spacing(3)},"& $firstMessage":{borderTopRightRadius:e.spacing(3),marginTop:10},"& $lastMessage":{borderTopLeftRadius:e.spacing(3),borderBottomRightRadius:0,marginBottom:10}},rootNotify:{justifyContent:"center","& span":{float:"right",color:e.palette.text.secondary,fontSize:"0.8rem"},"& > *":{borderRadius:e.spacing(3),fontWeight:500}},message:(t={maxWidth:"65%"},t[e.breakpoints.down("md")]={maxWidth:"95%"},t[e.breakpoints.down("sm")]={maxWidth:"85%"},t.borderRadius=e.spacing(.6),t.padding=e.spacing(.9),t.paddingLeft=e.spacing(1.8),t.paddingRight=e.spacing(1.8),t),firstMessage:{},lastMessage:{},file:{display:"flex",flexDirection:"row",flexWrap:"wrap",cursor:"pointer"},header:{flex:"0 0 100%",overflow:"hidden",fontWeight:"bold"},body:{flex:"1 1 auto",wordBreak:"break-word",overflow:"hidden"},status:{paddingLeft:e.spacing(1),flex:"1 1 auto",alignSelf:"flex-end"},statusImage:{fontSize:"1rem",marginRight:e.spacing(.5),verticalAlign:"middle"}})})),Ne=a.memo(a.forwardRef((function(e,t){var n=be(),r=m.useTranslation().t,a=e.apiUrl,l=e.message,c=e.owner,s=e.user,u=e.isGroupMessage,p=e.isUserFirst,f=e.isUserLast,g=e.setViewerData;if("notify"===l.messageType){var E="{"===l.content[0]?JSON.parse(l.content):l.content;return o.createElement(i.ListItem,{className:n.rootNotify,ref:t},o.createElement(i.Alert,{severity:"string"==typeof E?"info":E.severity},"string"==typeof E?E:E.message))}if(l.isRevoke)return o.createElement(i.ListItem,{className:n.rootNotify,ref:t},o.createElement(i.Typography,{variant:"body2",align:"center"},l.userId===s.userId?r("CHAT.MESSAGE.REVOKED.YOU"):l.revokeUserName+" "+r("CHAT.MESSAGE.REVOKED.CONTACT")));var h=s.userId===l.userId;return o.createElement(i.ListItem,{ref:t,className:"video_conference"===l.messageType?n.rootNotify:h?n.rootUser:n.rootContact},function(e,t,n,r,a,l,c){var s=t.messageType,u=r&&a?n.message+" "+n.firstMessage+" "+n.lastMessage:r?n.message+" "+n.firstMessage:a?n.message+" "+n.lastMessage:n.message;return"file"===s?o.createElement(i.Link,{className:u+" "+n.file,underline:"none",href:oe(e,"/static/file/"+t.content),target:"_blank",download:!0,onContextMenu:l},c):o.createElement(i.Box,{display:"flex",flexDirection:"image"===s||"video"===s||"video_conference"===s?"column":"row",flexWrap:"wrap",className:u,onContextMenu:l},c)}(a,l,n,p,f,e.onContextMenu,o.createElement(o.Fragment,null,!h&&u&&c&&p&&o.createElement("div",{className:n.header},c.username),o.createElement("div",{className:n.body},o.createElement(Oe,{message:l,apiUrl:a,setViewerData:g})),o.createElement("div",{className:n.status},o.createElement("span",null,h?o.createElement(0===l.status?d.Done:d.DoneAll,{className:n.statusImage}):null,Z(l.cdate))))))})));Ne.displayName="Message";var _e={userId:0,username:"",password:"",avatar:"",langCode:""},ke={user:_e,token:"",refreshToken:"",activeRoom:null,chatOld:null,groupGather:{},userGather:{},contactGather:{},operators:[],initialContactId:null,conference:{data:null,joined:!1,ringPlayed:!1},typing:null,loading:!1,error:void 0,success:void 0,visitData:[]},we=function(e){return e.activeRoom?e.groupGather[e.activeRoom.groupId]||e.contactGather[e.activeRoom.userId]:null},Ge=function(e){var t=e.initialContactId,n=null;if(t)n=e.contactGather[t];else if(e.activeRoom)n=we(e);else{var r=[].concat(Object.values(e.contactGather),Object.values(e.groupGather)).sort(re);r.length>0&&(n=r[0])}return n},Me=function(e,t,n){var r=K({},e);e.contactGather[t]&&(r.contactGather[t]=K({},r.contactGather[t],{online:n}));for(var a=0,o=Object.values(e.groupGather);a<o.length;a++){var i=o[a];if(i.members){var l=i.members.find((function(e){return e.userId===t}));if(l){var c=i.members.indexOf(l);i.members[c]=K({},l,{online:n})}}}var s=r.operators.findIndex((function(e){return e.userId===t}));return-1!==s&&(r.operators[s]=K({},r.operators[s],{online:n})),r.activeRoom=we(r),r},De=function(e,t,n){var r=K({},e);return r.contactGather[t]&&(r.contactGather[t]=K({},r.contactGather[t],{unreadCount:n(r.contactGather[t].unreadCount)})),r.activeRoom=we(r),r},Le=function(e,t,n){var r=K({},e);return r.groupGather[t]&&(r.groupGather[t]=K({},r.groupGather[t],{unreadCount:n(r.groupGather[t].unreadCount)})),r.activeRoom=we(r),r};function Ue(e,t){var n,r,a;switch(t.type){case"SET_GROUP_GATHER":return K({},e,{groupGather:K({},e.groupGather,(n={},n[t.payload.groupId]=t.payload,n))});case"SET_CONTACT_GATHER":return K({},e,{contactGather:K({},e.contactGather,(r={},r[t.payload.userId]=t.payload,r))});case"DEL_GROUP":return function(e,t){var n=K({},e),r=n.activeRoom===n.groupGather[t];return delete n.groupGather[t],r&&(n.activeRoom=Ge(n)),n}(e,t.payload);case"DEL_GROUP_MEMBER":return function(e,t){var n,r=K({},e),a=r.groupGather[t.groupId];return a&&(a.members=null==(n=a.members)?void 0:n.filter((function(e){return e.userId!==t.userId}))),r}(e,t.payload);case"DEL_CONTACT":return function(e,t){var n=K({},e),r=n.activeRoom===n.contactGather[t];return delete n.contactGather[t],r&&(n.activeRoom=Ge(n)),n}(e,t.payload.userId);case"SET_USER_GATHER":return K({},e,{userGather:K({},e.userGather,(a={},a[t.payload.userId]=t.payload,a))});case"UPDATE_ACTIVE_ROOM":return K({},e,{activeRoom:Ge(e)});case"SET_ACTIVE_ROOM":return function(e,t){return K({},e,{chatOld:null!=e.activeRoom?K({},e.activeRoom):null,activeRoom:t.groupId?e.groupGather[t.groupId]:t.contactId?e.contactGather[t.contactId]:null})}(e,t.payload);case"USER_ONLINE":return Me(e,t.payload,1);case"USER_OFFLINE":return Me(e,t.payload,0);case"ADD_GROUP_MESSAGE":return function(e,t){var n=K({},e),r=t.groupId;n.groupGather[r]&&(n.groupGather[r].messages?n.groupGather[r].messages=[].concat(n.groupGather[r].messages,[t]):n.groupGather[r]=K({},e.groupGather[r],{messages:[t]}));var a=n.activeRoom;return a&&a.groupId!==r&&t.userId!==e.user.userId?Le(n,r,(function(e){return(e||0)+1})):(n.activeRoom=we(n),n)}(e,t.payload);case"ADD_PRIVATE_MESSAGE":return function(e,t){var n,r=K({},e),a=t.contactId===e.user.userId?t.userId:t.contactId;return r.contactGather[a].messages?r.contactGather[a].messages=[].concat(r.contactGather[a].messages,[t]):r.contactGather[a]=K({},r.contactGather[a],{messages:[t]}),(null==(n=r.activeRoom)?void 0:n.userId)!==a&&t.userId!==e.user.userId?De(r,a,(function(e){return(e||0)+1})):(r.activeRoom=we(r),r)}(e,t.payload);case"ADD_GROUP_UNREAD_GATHER":return Le(e,t.payload,(function(e){return(e||0)+1}));case"ADD_CONTACT_UNREAD_GATHER":return De(e,t.payload,(function(e){return(e||0)+1}));case"SET_TYPING":return K({},e,{typing:t.payload});case"LOSE_GROUP_UNREAD_GATHER":return Le(e,t.payload,(function(){return 0}));case"LOSE_CONTACT_UNREAD_GATHER":return De(e,t.payload,(function(){return 0}));case"REVOKE_MESSAGE":return function(e,t){var n=e.user.userId,r=K({},e),a=t.username||r.userGather[t.userId].username;if(t.groupId){var o=r.groupGather[t.groupId].messages;if(o){var i=o.find((function(e){return e._id===t._id}));if(i){var l=o.indexOf(i);o[l]=K({},i,{isRevoke:!0,revokeUserName:a})}}}else{var c=r.contactGather[t.contactId===n?t.userId:t.contactId].messages;if(c){var s=c.find((function(e){return e._id===t._id}));if(s){var u=c.indexOf(s);c[u]=K({},s,{isRevoke:!0,revokeUserName:a})}}}return r.activeRoom=we(r),r}(e,t.payload);case"UPDATE_GROUP_INFO":return function(e,t){var n=K({},e),r=t.groupId,a=n.groupGather[r];return a&&(n.groupGather[r]=K({},a,{name:t.name,notice:t.notice})),n.activeRoom=we(n),n}(e,t.payload);case"UPDATE_USER_INFO":return function(e,t){var n=K({},e),r=t.userId,a=t.username,o=t.avatar;return n.userGather[r]&&(n.userGather[r]=K({},n.userGather[r],{username:a,avatar:o})),n.contactGather[r]&&(n.contactGather[r]=K({},n.contactGather[r],{username:a,avatar:o})),n.activeRoom=we(n),n}(e,t.payload);case"ADD_GROUP_MEMBER":return function(e,t){var n=t.members.map((function(e){return K({},e,{isManager:0})})),r=K({},e);return r.groupGather[t.groupId].members&&n?r.groupGather[t.groupId].members=[].concat(e.groupGather[t.groupId].members,n):r.groupGather[t.groupId]=K({},r.groupGather[t.groupId],{members:n}),r.activeRoom=we(r),r}(e,t.payload);case"SET_CONFERENCE":return function(e,t){return K({},e,{conference:{data:K({},t),joined:(null==t?void 0:t.userId)===e.user.userId,ringPlayed:(null==t?void 0:t.userId)!==e.user.userId}})}(e,t.payload);case"JOIN_CONFERENCE":return K({},e,{conference:{data:K({},t.payload),joined:!0,ringPlayed:!1}});case"PAUSE_CONFERENCE":return function(e,t){var n;return(null==(n=e.conference.data)?void 0:n.id)!==(null==t?void 0:t.id)?e:K({},e,{conference:{data:K({},e.conference.data),joined:!1,ringPlayed:!1}})}(e,t.payload);case"STOP_CONFERENCE":return function(e,t){var n;return(null==(n=e.conference.data)?void 0:n.id)!==(null==t?void 0:t.id)?e:K({},e,{conference:{data:null,joined:!1,ringPlayed:!1}})}(e,t.payload);case"MARK_PRIVATE_MESSAGES_READ":return function(e,t){var n=K({},e);if(n.contactGather[t]){var r=K({},n.contactGather[t]);if(r.messages)for(var a=0;a<r.messages.length;a++)r.messages[a]=K({},r.messages[a],{status:1});n.contactGather[t]=r}if(n.activeRoom=we(n),null!=n.activeRoom&&n.activeRoom.messages)for(var o=0;o<n.activeRoom.messages.length;o++)n.activeRoom.messages[o]=K({},n.activeRoom.messages[o],{status:1});return n}(e,t.payload);case"ADD_PRIVATE_MESSAGES":return function(e,t){var n=K({},e),r=t.messages,a=t.contactId;return n.contactGather[a]&&(n.contactGather[a]=K({},n.contactGather[a],{messages:[].concat(r||[],n.contactGather[a].messages||[]),noMoreData:null==r||!r.length||(null==r?void 0:r.length)<t.pageSize})),n.activeRoom=we(n),n}(e,t.payload);case"ADD_GROUP_MESSAGES":return function(e,t){var n=K({},e),r=t.groupId,a=t.messages,o=t.userArr;n.groupGather[r]&&(n.groupGather[r]=K({},n.groupGather[r],{messages:[].concat(a||[],n.groupGather[r].messages||[]),noMoreData:null==a||!a.length||(null==a?void 0:a.length)<t.pageSize})),n.userGather=K({},n.userGather);for(var i,l=X(o);!(i=l()).done;){var c=i.value;n.userGather[c.userId]||(n.userGather[c.userId]=c)}return n.activeRoom=we(n),n}(e,t.payload);case"SET_LOADING":return K({},e,{loading:t.payload,error:""});case"SET_ERROR":return K({},e,{error:t.payload,success:void 0});case"SET_SUCCES":return K({},e,{success:t.payload,error:void 0});case"SET_TOKEN":return function(e,t){return K({},e,{token:t})}(e,t.payload);case"SET_USER":return K({},e,{user:t.payload});case"CLEAR_USER":return function(e){return K({},e,{token:"",user:_e})}(e);case"CLEAR_CHAT_DATA":return K({},e,{activeRoom:null,groupGather:{},userGather:{},contactGather:{},conference:{data:null,joined:!1,ringPlayed:!1},typing:null});case"SET_OPERATORS":return K({},e,{operators:t.payload});case"SET_VISIT_DATA":return K({},e,{visitData:t.payload})}return e}var je,Pe=o.createContext({state:ke,dispatch:function(){return null}}),Fe=function(e){_e.langCode=e.defLang;var t=K({},ke,{token:e.token,refreshToken:e.token}),n=o.useReducer(Ue,t),r=n[0],i=n[1],l=a.useMemo((function(){return{state:r,dispatch:i}}),[r]);return o.createElement(Pe.Provider,{value:l},e.children)},He=l.makeStyles((function(e){var t,n;return l.createStyles({messageListOuter:{flex:1,overflowY:"auto",margin:0,padding:0,height:"100%",scrollbarWidth:"thin",scrollbarColor:e.palette.primary.light+" #fff"},messageList:{},img:(t={cursor:"pointer",borderRadius:e.spacing(1.2),maxWidth:"auto",maxHeight:"95%"},t[e.breakpoints.down("sm")]={maxWidth:"auto",maxHeight:"95%"},t),arrowDown:(n={position:"absolute",left:"94.5%",bottom:105},n[e.breakpoints.down("md")]={left:"91.5%",bottom:95},n[e.breakpoints.down("sm")]={left:"84%",bottom:95},n)})})),Be=function(e){var t,n,r,l=e.apiUrl,c=e.user,s=e.users,u=e.chat,d=e.loading,m=e.pageSize,p=e.setMenuState,f=e.initialMenuState,g=e.inModale,E=e.isConference,v=e.onEnterRoom,y=He(),C=i.useMediaQuery((function(e){return e.breakpoints.down("sm")})),T=ee(u),R=o.useState({visible:!1,src:""}),I=R[0],S=R[1],A=o.useContext(Pe).dispatch,x=o.useState(!1),O=x[0],b=x[1],_=o.useRef(null),w=o.useRef(),G=o.useRef(),M=null==u||null==(null==u?void 0:u.noMoreData)||!u.noMoreData,D=o.useMemo((function(){return null!=u&&u.messages?u.messages.map((function(e){return K({},e,{ref:o.createRef()})})):[]}),[null==u?void 0:u.messages]),L=(null==D?void 0:D.length)||0,U=L&&D[L-1],j=D.filter((function(e){return null!=(null==e?void 0:e.status)&&0===e.status})),P=o.useState(D[L-1].cdate),F=P[0],H=P[1],B=k({loading:d,hasNextPage:M,onLoadMore:function(){u&&e.onNeedMoreMessages(u)},disabled:!1}),z=B[0],V=B[1].rootRef;o.useEffect((function(){T&&_.current&&L&&(H(D[L-1].cdate),q())}),[T]),t=function(){H("")},n=F,r=a.useRef(),a.useEffect((function(){r.current=t}),[t]),a.useEffect((function(){if(n){var e=setInterval((function(){r.current()}),3700);return function(){return clearInterval(e)}}}),[n]),o.useEffect((function(){var e,t=_.current,n=null!=(e=w.current)?e:0;t&&U&&u&&(G.current===L-m?t.scrollTop=t.scrollHeight-n:(U.userId!==u.userId||n<=900)&&q()),G.current=L}),[L]);var Y=o.useCallback((function(){var e,t,n=_.current;if(n){var r=n.scrollHeight-n.scrollTop;w.current=r;var a=M&&r>900;b(a),!a&&T&&u&&v&&(v(u),A({type:"MARK_PRIVATE_MESSAGES_READ",payload:u.userId}));for(var o=0;o<L;o++){var i,l=D[o];if(null==l||null==(i=l.ref)||!i.current)break;if(e=n,(t=l.ref.current.getBoundingClientRect()).top>=50&&t.bottom<=e.clientHeight){H(l.cdate);break}}}}),[D,T]),q=function(){_.current&&(_.current.scrollTop=_.current.scrollHeight)},W=o.useCallback((function(e){V(e),_.current=e}),[V]);if(null!=T)return o.createElement(o.Fragment,null,o.createElement(i.Fade,{in:!!F,style:F?{display:"block",position:"relative",width:"auto"}:{display:"none"},timeout:2e3},o.createElement(i.Alert,{severity:"warning",icon:!1,style:{width:"auto",position:"absolute",left:C?"50%":E?"69%":"60%",top:g?105:50,zIndex:10}},o.createElement(i.Typography,{variant:"h6",textAlign:"center"},h(F).format("DD.MM.YYYY")))),o.createElement(i.CardContent,{className:y.messageListOuter,ref:W,onScroll:Y},o.createElement(i.List,{className:y.messageList},M&&o.createElement(i.ListItem,{ref:z,sx:{justifyContent:"center"}},o.createElement(i.CircularProgress,null)),D.map((function(t,n){return o.createElement(Ne,{ref:t.ref,key:n,apiUrl:l,user:c,message:t,owner:s[t.userId],isGroupMessage:!(null==u||!u.groupId),isUserFirst:0===n||"notify"===D[n-1].messageType||D[n-1].userId!==D[n].userId,isUserLast:n===D.length-1||"notify"===D[n+1].messageType||D[n+1].userId!==D[n].userId,onContextMenu:function(n){return function(t,n){var r="text"===t.messageType,a=c.userId===t.userId&&!!e.onMeesageDelete&&(new Date).getTime()-new Date(t.cdate).getTime()<=12e4;r||a?(n.preventDefault(),p({message:t,mouseX:n.clientX-2,mouseY:n.clientY-4,canCopy:r,canDelete:a})):p(f)}(t,n)},setViewerData:S})}))),O&&o.createElement(i.Box,{className:y.arrowDown,textAlign:"center"},o.createElement(i.Fab,{color:"info","aria-label":"add",size:"medium",onClick:function(){return q()}},o.createElement(N,null)),null!=j&&j.length>0&&o.createElement(i.Fab,{color:"warning","aria-label":"add",size:"small",sx:{width:24,height:24,minHeight:24,position:"relative",top:-10,pointerEvents:"none"}},o.createElement(i.Typography,{variant:"body2",sx:function(e){return{color:e.palette.background.default}}},j.length))),I.visible&&o.createElement(i.Backdrop,{sx:{color:"#fff",zIndex:function(e){return e.zIndex.drawer+1}},open:I.visible,onClick:function(){S({visible:!1,src:""})}},o.createElement("img",{src:I.src,className:y.img,alt:""}))))},ze=l.makeStyles((function(e){return l.createStyles({root:{width:"100%",minWidth:360,height:"100%",display:"flex",flexDirection:"column"},roomHeader:{flex:1},flexAll:{flex:"1 1 auto"},flexEnd:{justifyContent:"flex-end"}})})),Ve={message:null,mouseX:null,mouseY:null,canCopy:!1,canDelete:!1},Ye=function(e){var t=e.apiUrl,n=e.user,r=e.users,l=e.chat,d=e.typing,p=e.conference,f=e.visitData,g=e.conferenceJoined,E=e.loading,h=e.pageSize,v=e.inModale,y=ze(),C=m.useTranslation().t,T=i.useMediaQuery((function(e){return e.breakpoints.down("sm")})),R=o.useState(Ve),I=R[0],S=R[1],A=a.useCallback((function(){var e=I.message;S(Ve),e&&navigator.clipboard.writeText(e.content)}),[I.message]),x=a.useCallback((function(){var t=I.message;S(Ve),e.onMeesageDelete&&l&&t&&e.onMeesageDelete(l,t)}),[I.message]);return o.createElement(i.Card,{elevation:1,className:y.root},o.createElement(i.Box,{display:"flex",flexDirection:"row"},l&&T&&o.createElement(i.Tooltip,{title:"Вернуться в конференцию"},o.createElement(i.IconButton,{"aria-label":"exit room",onClick:function(){return e.onExitRoom&&e.onExitRoom(l)}},o.createElement(u,null))),o.createElement(Ce,{apiUrl:t,user:n,chat:l,typing:d,conference:p,visitData:f,conferenceJoined:g,operators:e.operators,className:y.roomHeader,onVideoCall:e.onVideoCall,onVideoEnd:e.onVideoEnd,onConferencePause:e.onConferencePause,onOperatorAdd:e.onOperatorAdd,onLeaveGroup:e.onLeaveGroup,onContactClick:e.onContactClick})),o.createElement(i.Divider,null),o.createElement(Be,{apiUrl:t,user:n,users:r,chat:l,loading:E,pageSize:h,initialMenuState:Ve,onNeedMoreMessages:e.onNeedMoreMessages,onMeesageDelete:e.onMeesageDelete,setMenuState:S,inModale:v,isConference:!(null==p||!p.id),onEnterRoom:e.onEnterRoom}),o.createElement(i.Divider,null),o.createElement(i.CardContent,null,o.createElement(V,{chat:l,onTyping:e.onTyping,onSendMessage:e.onSendMessage})),o.createElement(i.Menu,{keepMounted:!0,open:null!==I.mouseY,onClose:function(){S(Ve)},anchorReference:"anchorPosition",anchorPosition:null!==I.mouseY&&null!==I.mouseX?{top:I.mouseY,left:I.mouseX}:void 0},o.createElement(i.MenuItem,{onClick:A,disabled:!I.canCopy},o.createElement("span",{className:y.flexAll},C("CHAT.MESSAGE.MENU.COPY")),o.createElement(i.ListItemIcon,{className:y.flexEnd},o.createElement(c,{fontSize:"small"}))),o.createElement(i.MenuItem,{onClick:x,disabled:!I.canDelete},o.createElement("span",{className:y.flexAll},C("CHAT.MESSAGE.MENU.DELETE")),o.createElement(i.ListItemIcon,{className:y.flexEnd},o.createElement(s,{fontSize:"small"})))))},qe=l.makeStyles((function(e){return l.createStyles({main:{flex:"1 1 auto",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},time:{paddingLeft:e.spacing(1),justifyContent:"flex-end",whiteSpace:"nowrap"},unread:{justifyContent:"flex-end",maxHeight:20},avatarGroup:{backgroundColor:"#28B7C6",color:"#fff"}})})),We=l.withStyles((function(e){return l.createStyles({badge:{backgroundColor:"#44b700",color:"#44b700",boxShadow:"0 0 0 2px "+e.palette.background.paper,"&::after":{position:"absolute",top:0,left:0,width:"100%",height:"100%",borderRadius:"50%",animation:"$ripple 1.2s infinite ease-in-out",border:"1px solid currentColor",content:'""'}},"@keyframes ripple":{"0%":{transform:"scale(.8)",opacity:1},"100%":{transform:"scale(2.4)",opacity:0}}})}))(i.Badge),Ke=l.withStyles((function(e){return l.createStyles({badge:{backgroundColor:e.palette.primary.main,boxShadow:"0 0 0 2px "+e.palette.background.paper}})}))(i.Badge),$e=function(e){var t,n=qe(),r=m.useTranslation().t,l=e.apiUrl,c=e.chat,s=e.typing,u=te(c),d=c.groupId?o.createElement(i.Avatar,{alt:u,className:n.avatarGroup},o.createElement(p,null)," "):function(e,t,n){var r=o.createElement(i.Avatar,{alt:t.username,src:t.avatar?oe(e,t.avatar):""});return null!=n&&n.contactId&&(null==n?void 0:n.userId)===t.userId?o.createElement(We,{overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"dot"},r):null!=t&&t.online?o.createElement(Ke,{overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"dot"},r):r}(l,c,s),f=c.messages&&c.messages.length>0?c.messages[c.messages.length-1]:null,g=function(e,t){if(!e)return null;switch(e.messageType){case"text":return e.content;case"image":return"["+t("CHAT.MESSAGE.TYPE.IMAGE")+"]";case"video":return"["+t("CHAT.MESSAGE.TYPE.VIDEO")+"]";case"file":return"["+t("CHAT.MESSAGE.TYPE.FILE")+"]";case"notify":return"["+t("CHAT.MESSAGE.TYPE.NOTIFY")+"]";default:return null}}(f,r),E=null==f?void 0:f.cdate;return a.useMemo((function(){return o.createElement(i.ListItemButton,{selected:e.active,onClick:e.onClick},o.createElement(i.ListItemAvatar,null,d),o.createElement(i.ListItemText,{secondaryTypographyProps:{component:"span"},primary:o.createElement(i.Box,{display:"flex",flexDirection:"row"},o.createElement("span",{className:n.main},u),o.createElement("span",{className:n.time},Z(E))),secondary:o.createElement(i.Box,{display:"flex",flexDirection:"row"},o.createElement("span",{className:n.main},g),c.unreadCount?o.createElement(i.Chip,{className:n.unread,component:"span",size:"small",color:"primary",label:c.unreadCount}):null)}))}),[null==(t=c.messages)?void 0:t.length])},Je=l.makeStyles((function(e){return{root:{width:"100%",height:"100%"},searchField:{width:"100%"},listStyle:{height:"89.5%",overflowY:"auto",scrollbarWidth:"thin",scrollbarColor:e.palette.primary.light+" #fff"}}})),Xe=function(e,t){if(null===t)return e;var n=t.toLowerCase();return e.filter((function(e){return-1!==te(e).toLowerCase().indexOf(n.toLowerCase())}))},Qe=function(e,t,n){var r=[].concat(t,n);r=r.sort(re);var a=localStorage.getItem(e+"-topChatId");if(a){var o=r.find((function(e){return ee(e)===a}));o&&(r=r.filter((function(e){return ee(e)!==a})),o.isTop=!0,r.unshift(o))}return r},Ze=function(e){var t,n=Je(),r=m.useTranslation().t,a=o.useState(Qe(e.user.userId,Xe(e.groups,null),Xe(e.contacts,null))),l=a[0],c=a[1],s=o.useMemo((function(){return l.map((function(t){return o.createElement($e,{key:ee(t),apiUrl:e.apiUrl,chat:t,active:t===e.activeRoom,typing:e.typing,onClick:function(){return null!=e.onChangeChat&&e.onChangeChat(t)}})}))}),[null==(t=e.activeRoom)?void 0:t.userId,e.typing]);return o.createElement(i.Card,{elevation:1,className:n.root},o.createElement(i.CardHeader,{title:o.createElement(i.TextField,{className:n.searchField,label:r("CHAT.INPUT_SEARCH_CONTACT"),variant:"outlined",size:"small",fullWidth:!0,onChange:function(t){c(Qe(e.user.userId,Xe(e.groups,t.target.value),Xe(e.contacts,t.target.value)))}})}),o.createElement(i.Divider,null),o.createElement(w,{"aria-label":"rooms",className:n.listStyle},s))},et=l.makeStyles((function(){return{root:{width:"100%",height:"100%",borderRadius:4}}})),tt=function(e){var t,n,r,i,l=e.conference,c=e.onClose,s=e.langCode,u=void 0===s?"en":s,d=et(),m=o.useRef(null),p=null!=l&&l.url&&u?(t=null==l?void 0:l.url,n="ru"===(i=u)?"rus":"fr"===i?"fra":"en"===i?"eng":"",r=new RegExp("(lang=)[^&]+"),t.replace(r,"$1"+n)):"";return a.useEffect((function(){var e=function(e){var t;e.source===(null==(t=m.current)?void 0:t.contentWindow)&&["notSupported","connectionFail","callFail","hangUp","remoteHangUp"].includes(e.data.type)&&c(l)};return window.addEventListener("message",e),function(){window.removeEventListener("message",e)}}),[null==l?void 0:l.id,u]),o.createElement("iframe",{title:"conference",className:d.root,src:p,allowFullScreen:!0,allow:"microphone; camera; autoplay; display-capture",ref:m})},nt=l.makeStyles((function(){return{root:{width:"100%",height:"100%",borderRadius:8,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},pulse:{height:100,width:100,borderRadius:"50%",display:"flex",justifyContent:"center",alignItems:"center",position:"relative","&::before":{content:"''",position:"absolute",border:"1px solid green",width:"calc(100% + 40px)",height:"calc(100% + 40px)",borderRadius:"50%",animation:"$pulse 1s linear infinite"},"&::after":{content:"''",position:"absolute",border:"1px solid green",width:"calc(100% + 40px)",height:"calc(100% + 40px)",borderRadius:"50%",animation:"$pulse 1s linear infinite",animationDelay:"0.3s"}},avatar:{width:"80%",height:"80%"},footer:{width:"100%",alignSelf:"flex-end",paddingTop:64,display:"flex",justifyContent:"center"},"@keyframes pulse":{"0%":{transform:"scale(0.5)",opacity:0},"50%":{transform:"scale(1)",opacity:1},"100%":{transform:"scale(1.3)",opacity:0}}}})),rt=function(e){var t=e.conference,n=e.contact,r=e.apiUrl,a=e.onAccept,l=nt(),c=m.useTranslation().t;return o.createElement(i.Paper,{className:l.root},o.createElement("div",{className:l.pulse},o.createElement(i.Avatar,n?{className:l.avatar,alt:n.username,src:n.avatar?oe(r,n.avatar):""}:{className:l.avatar})),o.createElement("div",{className:l.footer},o.createElement(i.Button,{variant:"contained",color:"primary",onClick:function(){return a(t)}},c("CHAT.CONFERENCE.JOIN"))))},at=(function(e){var t=function(e){var t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",i=r.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var a=Object.create((t&&t.prototype instanceof d?t:d).prototype),o=new I(r||[]);return a._invoke=function(e,t,n){var r="suspendedStart";return function(a,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw o;return{value:void 0,done:!0}}for(n.method=a,n.arg=o;;){var i=n.delegate;if(i){var l=C(i,n);if(l){if(l===u)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=s(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}(e,n,o),a}function s(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var u={};function d(){}function m(){}function p(){}var f={};l(f,a,(function(){return this}));var g=Object.getPrototypeOf,E=g&&g(g(S([])));E&&E!==t&&n.call(E,a)&&(f=E);var h=p.prototype=d.prototype=Object.create(f);function v(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){var r;this._invoke=function(a,o){function i(){return new t((function(r,i){!function r(a,o,i,l){var c=s(e[a],e,o);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,i,l)}),(function(e){r("throw",e,i,l)})):t.resolve(d).then((function(e){u.value=e,i(u)}),(function(e){return r("throw",e,i,l)}))}l(c.arg)}(a,o,r,i)}))}return r=r?r.then(i,i):i()}}function C(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,C(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var r=s(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,u;var a=r.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function S(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:A}}function A(){return{value:void 0,done:!0}}return m.prototype=p,l(h,"constructor",p),l(p,"constructor",m),m.displayName=l(p,i,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,l(e,i,"GeneratorFunction")),e.prototype=Object.create(h),e},e.awrap=function(e){return{__await:e}},v(y.prototype),l(y.prototype,o,(function(){return this})),e.AsyncIterator=y,e.async=function(t,n,r,a,o){void 0===o&&(o=Promise);var i=new y(c(t,n,r,a),o);return e.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},v(h),l(h,i,"Generator"),l(h,a,(function(){return this})),l(h,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=S,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(R),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return i.type="throw",i.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],i=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var l=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(l&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),R(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;R(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:S(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}}(je={exports:{}}),je.exports),ot=a.createContext({});function it(){localStorage.removeItem("authToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("user"),localStorage.removeItem("doctor"),localStorage.removeItem("chatUser")}var lt=function(){var e=W(at.mark((function e(){return at.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,G.post("auth/logout");case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.log("ERROR Logout",e.t0);case 8:it(),window.location.href="/";case 10:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(){return e.apply(this,arguments)}}(),ct=function(){var e=W(at.mark((function e(t,n,r){var a;return at.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,G.post("auth/refreshToken",{authToken:t,refreshToken:n});case 3:a=e.sent.data,localStorage.setItem("authToken",null==a?void 0:a.authToken),localStorage.setItem("refreshToken",null==a?void 0:a.refreshToken),window.location.href="/",e.next=15;break;case 10:e.prev=10,e.t0=e.catch(0),console.log("ERROR RefreshToken",e.t0),r({type:"CLEAR_USER"}),lt();case 15:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n,r){return e.apply(this,arguments)}}(),st=function(e){var t=e.baseURLApi,n=e.pageSize,r=e.children,i=a.useContext(Pe),l=i.state,c=i.dispatch,s=G.create({timeout:6e4,baseURL:t,headers:{"Cache-Control":"no-cache",Pragma:"no-cache",Authorization:"Bearer "+l.token},withCredentials:!1});s.interceptors.response.use((function(e){return e}),(function(e){return console.log("ERROR AxiosError"),function(e){null!=e.response&&401===e.response.status&&ct(l.token,l.refreshToken,c)}(e),Promise.reject(e)}));var u=a.useCallback(function(){var e=W(at.mark((function e(t,r){var a,o,i,l;return at.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.userId,i=null==(a=t.messages)?void 0:a.length,e.prev=2,c({type:"SET_LOADING",payload:!0}),e.next=6,s.get("/contact/messages",{params:{contactId:o,current:i,pageSize:n}});case 6:(l=e.sent.data)&&(c({type:"ADD_PRIVATE_MESSAGES",payload:{pageSize:n,contactId:o,messages:l}}),r&&r()),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(2),c({type:"SET_ERROR",payload:e.t0.message});case 15:return e.prev=15,c({type:"SET_LOADING",payload:!1}),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[2,11,15,18]])})));return function(t,n){return e.apply(this,arguments)}}(),[c]),d=a.useCallback(function(){var e=W(at.mark((function e(t){var r,a,o,i;return at.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.groupId,o=null==(r=t.messages)?void 0:r.length,e.prev=2,c({type:"SET_LOADING",payload:!0}),e.next=6,s.get("/group/messages",{params:{groupId:a,current:o,pageSize:n}});case 6:(i=e.sent.data)&&c({type:"ADD_GROUP_MESSAGES",payload:K({pageSize:n,groupId:a},i)}),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(2),c({type:"SET_ERROR",payload:e.t0.message});case 15:return e.prev=15,c({type:"SET_LOADING",payload:!1}),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[2,11,15,18]])})));return function(t){return e.apply(this,arguments)}}(),[c]),m=function(){var e=W(at.mark((function e(t,n){var r;return at.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.get("/contact/find",{params:{mmkId:t,guid:n}});case 3:if(null==(r=e.sent.data)){e.next=7;break}return e.abrupt("return",r);case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.log("err getUserByMmk",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,n){return e.apply(this,arguments)}}(),p=a.useMemo((function(){return{apiUrl:t,pageSize:n,fetch:s,getPrivateMessages:u,getGroupMessages:d,getUserByMmk:m}}),[t,n]);return o.createElement(ot.Provider,{value:p},r)},ut=a.createContext({online:!1}),dt=function(e){var t,n,r=e.wsUrl,i=e.wsPath,l=e.children,c=a.useContext(Pe),s=c.state,u=c.dispatch,d=function(e,t,n){var r=a.useState(null),o=r[0],i=r[1],l=a.useCallback((function(){var r=M(e,{path:t,reconnection:!0,extraHeaders:{Authorization:"Bearer "+n}});i(r)}),[e,t,n]),c=a.useCallback((function(){null==o||o.disconnect(),i(null)}),[o]),s=a.useState(!1),u=s[0],d=s[1];return a.useEffect((function(){d(!(null==o||!o.connected))}),[o]),a.useEffect((function(){null==o||o.on("connect",(function(){d(!0),o.emit("chatData")}))}),[o]),a.useEffect((function(){null==o||o.on("disconnect",(function(){d(!1)}))}),[o]),{socket:o,online:u,disconnectSocket:c,connectSocket:l}}(r,i,s.token),m=d.socket,p=d.online,f=d.disconnectSocket,g=d.connectSocket;a.useEffect((function(){return s.token&&g(),s.token||f(),function(){f()}}),[s.token]),a.useEffect((function(){var e=function(e){console.log("unauthorized msg",e),ct(s.token,s.refreshToken,u)};null==m||m.on("unauthorized",e);var t=function(e){if(e.code)u({type:"SET_ERROR",payload:e.msg});else{var t=e.data,n=t.groupData,r=t.contactData,a=t.userData;if(u({type:"CLEAR_CHAT_DATA"}),u({type:"SET_USER",payload:t.user}),n.length)for(var o,i=X(n);!(o=i()).done;){var l=o.value;null==m||m.emit("joinGroupSocket",{groupId:l.groupId}),u({type:"SET_GROUP_GATHER",payload:l})}if(r.length)for(var c,s=X(r);!(c=s()).done;){var d=c.value;null==m||m.emit("joinPrivateSocket",{contactId:d.userId}),u({type:"SET_CONTACT_GATHER",payload:d})}if(u({type:"SET_OPERATORS",payload:t.operatorData}),a.length)for(var p,f=X(a);!(p=f()).done;)u({type:"SET_USER_GATHER",payload:p.value});u({type:"UPDATE_ACTIVE_ROOM"}),u({type:"SET_CONFERENCE",payload:t.conferenceData}),u({type:"SET_VISIT_DATA",payload:t.visitData})}};null==m||m.on("chatData",t);var n=function(e){u({type:"USER_ONLINE",payload:e.data})};null==m||m.on("userOnline",n);var r=function(e){u({type:"USER_OFFLINE",payload:e.data})};null==m||m.on("userOffline",r);var a,o=function(e){e.code?u({type:"SET_ERROR",payload:e.msg}):console.log("Успешно вошел в приватный чат")};null==m||m.on("joinPrivateSocket",o);var i=function(e){e.code?u({type:"SET_ERROR",payload:e.msg}):(a&&clearTimeout(a),u({type:"SET_TYPING",payload:e.data}),a=setTimeout((function(){u({type:"SET_TYPING",payload:null})}),1e3))};null==m||m.on("typing",i);var l=function(e){u(e.code?{type:"SET_ERROR",payload:e.msg}:{type:"REVOKE_MESSAGE",payload:e.data})};null==m||m.on("revokeMessage",l);var c=function(e){u(e.code?{type:"SET_ERROR",payload:e.msg}:{type:"SET_GROUP_GATHER",payload:e.data})};null==m||m.on("addGroup",c);var d=function(e){if(e.code)u({type:"SET_ERROR",payload:e.msg});else{var t=e.data;u({type:"SET_CONTACT_GATHER",payload:t}),u({type:"SET_USER_GATHER",payload:t}),null==m||m.emit("joinPrivateSocket",{contactId:t.userId})}};null==m||m.on("addContact",d);var p=function(e){u(e.code?{type:"SET_ERROR",payload:e.msg}:{type:"DEL_CONTACT",payload:e.data})};null==m||m.on("deleteContact",p);var f=function(e){u(e.code?{type:"SET_ERROR",payload:e.msg}:{type:"UPDATE_GROUP_INFO",payload:e.data})};null==m||m.on("updateGroupInfo",f);var g=function(e){u(e.code?{type:"SET_ERROR",payload:e.msg}:{type:"UPDATE_USER_INFO",payload:e.data})};null==m||m.on("updateUserInfo",g);var E=function(e){u(e.code?{type:"SET_ERROR",payload:e.msg}:{type:"SET_CONFERENCE",payload:e.data})};null==m||m.on("startConference",E);var h=function(e){u(e.code?{type:"SET_ERROR",payload:e.msg}:{type:"PAUSE_CONFERENCE",payload:e.data})};null==m||m.on("pauseConference",h);var v=function(e){u(e.code?{type:"SET_ERROR",payload:e.msg}:{type:"STOP_CONFERENCE",payload:e.data})};null==m||m.on("stopConference",v);var y=function(e){e.code&&u({type:"SET_ERROR",payload:e.msg})};null==m||m.on("addOperator",y);var C=function(e){u(e.code?{type:"SET_ERROR",payload:e.msg}:{type:"SET_ACTIVE_ROOM",payload:e.data})};null==m||m.on("setActiveRoom",C);var T=function(e){u(e.code?{type:"SET_ERROR",payload:e.msg}:{type:"SET_VISIT_DATA",payload:e.data.visitData})};return null==m||m.on("visitData",T),function(){null==m||m.off("unauthorized",e),null==m||m.off("chatData",t),null==m||m.off("userOnline",n),null==m||m.off("userOffline",r),null==m||m.off("joinPrivateSocket",o),a&&clearTimeout(a),null==m||m.off("typing",i),null==m||m.off("revokeMessage",l),null==m||m.off("addGroup",c),null==m||m.off("addContact",d),null==m||m.off("deleteContact",p),null==m||m.off("updateGroupInfo",f),null==m||m.off("updateUserInfo",g),null==m||m.off("startConference",E),null==m||m.off("pauseConference",h),null==m||m.off("stopConference",v),null==m||m.off("addOperator",y),null==m||m.off("setActiveRoom",C),null==m||m.off("visitData",T)}}),[null==m?void 0:m.id]),a.useEffect((function(){var e=function(){var e=W(at.mark((function e(t){var n,r;return at.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.code){e.next=3;break}return u({type:"SET_ERROR",payload:t.msg}),e.abrupt("return");case 3:u({type:"ADD_GROUP_MESSAGE",payload:n=t.data}),(r=s.activeRoom)&&r.groupId===n.groupId&&n.userId!==s.user.userId&&(null==m||m.emit("markAsRead",{groupId:n.groupId,_id:n._id}));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();null==m||m.on("groupMessage",e);var t=function(){var e=W(at.mark((function e(t){var n,r;return at.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.code){e.next=3;break}return u({type:"SET_ERROR",payload:t.msg}),e.abrupt("return");case 3:(n=t.data).contactId!==s.user.userId&&n.userId!==s.user.userId||(u({type:"ADD_PRIVATE_MESSAGE",payload:n}),s.activeRoom&&!s.activeRoom.groupId&&(null==(r=s.activeRoom)?void 0:r.userId)===n.userId&&(null==m||m.emit("markAsRead",{contactId:n.userId,_id:n._id})));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return null==m||m.on("privateMessage",t),function(){null==m||m.off("groupMessage",e),null==m||m.off("privateMessage",t)}}),[null==m?void 0:m.id,null==(t=s.activeRoom)?void 0:t.userId,null==(n=s.activeRoom)?void 0:n.groupId]),a.useEffect((function(){var e=function(e){if(e.code)u({type:"SET_ERROR",payload:e.msg});else{var t=e.data;t.userId===s.user.userId?u(t.groupId?{type:"LOSE_GROUP_UNREAD_GATHER",payload:t.groupId}:{type:"LOSE_CONTACT_UNREAD_GATHER",payload:t.contactId}):t.contactId&&u({type:"MARK_PRIVATE_MESSAGES_READ",payload:t.userId})}};null==m||m.on("markAsRead",e);var t=function(e){if(e.code)u({type:"SET_ERROR",payload:e.msg});else{var t=e.data;u(t.userId===s.user.userId?{type:"DEL_GROUP",payload:t.groupId}:{type:"DEL_GROUP_MEMBER",payload:t})}};null==m||m.on("deleteGroup",t);var n=function(e){if(e.code)u({type:"SET_ERROR",payload:e.msg});else{var t=e.data,n=t.group,r=t.user;s.groupGather[n.groupId]?r.userId!==s.user.userId&&u({type:"ADD_GROUP_MEMBER",payload:{groupId:n.groupId,members:[r]}}):(console.log("joined to a new group"),null==m||m.emit("chatData"))}};null==m||m.on("joinGroup",n);var r=function(e){var t;if(e.code)u({type:"SET_ERROR",payload:e.msg});else{var n=e.data,r=n.user;r.online=1;var a,o=s.groupGather[n.group.groupId];!o||null!=(t=o.members)&&t.find((function(e){return e.userId===r.userId}))||(r.isManager=0,null==(a=o.members)||a.push(r)),u({type:"SET_USER_GATHER",payload:r})}};return null==m||m.on("joinGroupSocket",r),function(){null==m||m.off("markAsRead",e),null==m||m.off("deleteGroup",t),null==m||m.off("joinGroup",n),null==m||m.off("joinGroupSocket",r)}}),[null==m?void 0:m.id,s.user.userId,ne(s.groupGather)]);var E=a.useMemo((function(){return{socket:m,online:p}}),[m,p]);return o.createElement(ut.Provider,{value:E},l)},mt=function(e){var t=e.audio,n=e.video,r=m.useTranslation().t,a=o.useContext(Pe).dispatch,l=r(t&&n?"CHAT.CONFERENCE.CheckCamMic":t?"CHAT.CONFERENCE.CheckMic":"CHAT.CONFERENCE.CheckCam");return o.createElement(i.Tooltip,{title:l},o.createElement(i.IconButton,{"aria-label":"check",onClick:function(){navigator.mediaDevices.getUserMedia({audio:t,video:n}).then((function(e){console.log("permissions",e),a({type:"SET_SUCCES",payload:r("CHAT.CONFERENCE.ALLOK")})})).catch((function(e){var t=r("CHAT.CONFERENCE.ErrorAny");"NotFoundError"===e.name&&(t=r("CHAT.CONFERENCE.NotFoundError")),"NotAllowedError"===e.name&&(t=r("CHAT.CONFERENCE.NotAllowedError")),a({type:"SET_ERROR",payload:t}),console.log("err",e.name+" : "+e.message)}))},size:"large"},o.createElement(t&&n?D:t?L:U,null)))},pt=function(){var e=o.useContext(Pe),t=e.state,n=t.error,r=t.success,a=e.dispatch,l=function(){a({type:"SET_ERROR",payload:void 0}),a({type:"SET_SUCCES",payload:void 0})};return o.createElement(i.Snackbar,{anchorOrigin:{vertical:"top",horizontal:"center"},open:!!n||!!r,autoHideDuration:6e3,onClose:l},o.createElement(i.Alert,{onClose:l,severity:n?"error":"success"},n||r))},ft=["activeGroupId","activeChatUserId","inModale","hideRooms","fullWidth"],gt=l.makeStyles((function(e){var t;return{root:(t={height:"100%",overflow:"hidden",padding:0},t[e.breakpoints.down("sm")]={width:"100%"},t),innerGrid:{height:"100%",width:"100%"},conAbsOnConf:{position:"absolute",top:42,left:25,zIndex:1e3,margin:e.spacing(3)}}})),Et=function(e){var t,n,r,o,l,c,s,u=e.activeGroupId,p=e.activeChatUserId,f=e.inModale,g=void 0!==f&&f,E=e.hideRooms,h=void 0!==E&&E,v=e.fullWidth,y=void 0!==v&&v,C=$(e,ft),T=gt(),R=i.useMediaQuery((function(e){return e.breakpoints.down("sm")})),I=m.useTranslation().t,S=a.useContext(Pe),A=S.state,x=S.dispatch,O=a.useContext(ut).socket,b=a.useContext(ot),N=b.apiUrl,_=b.pageSize,k=b.getPrivateMessages,w=b.getGroupMessages,G=b.getUserByMmk,M=a.useCallback((function(){x({type:"SET_ACTIVE_ROOM",payload:{}})}),[x]),D=a.useCallback(function(){var e=W(at.mark((function e(t){return at.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.groupId){e.next=5;break}return e.next=3,w(t);case 3:e.next=7;break;case 5:return e.next=7,k(t);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[k,w]),L=a.useCallback((function(e,t){null==O||O.emit("revokeMessage",{groupId:e.groupId,contactId:e.userId,_id:t._id})}),[null==O?void 0:O.id]),U=a.useCallback((function(e){null==O||O.emit("typing",{groupId:null==e?void 0:e.groupId,contactId:null==e?void 0:e.userId})}),[null==O?void 0:O.id]),j=a.useCallback((function(e,t){e.groupId?null==O||O.emit("groupMessage",{groupId:null==e?void 0:e.groupId,content:t.message,width:t.width,height:t.height,fileName:t.fileName,messageType:t.messageType,size:t.size}):null==O||O.emit("privateMessage",{contactId:null==e?void 0:e.userId,content:t.message,width:t.width,height:t.height,fileName:t.fileName,messageType:t.messageType,size:t.size})}),[null==O?void 0:O.id]),P=a.useCallback((function(e){x({type:"SET_ACTIVE_ROOM",payload:{groupId:null==e?void 0:e.groupId,contactId:null==e?void 0:e.userId}}),F(e)}),[null==O?void 0:O.id,x]),F=a.useCallback((function(e){e.messages&&0!==e.messages.length&&(e.groupId?null==O||O.emit("markAsRead",{groupId:e.groupId,_id:e.messages[e.messages.length-1]._id}):null==O||O.emit("markAsRead",{contactId:e.userId,_id:e.messages[e.messages.length-1]._id}))}),[null==O?void 0:O.id]),H=a.useCallback((function(e,t,n){null==O||O.emit("startConference",{groupId:e.groupId,contactId:e.userId,visitId:t,recreate:n})}),[null==O?void 0:O.id]),B=a.useCallback((function(e){null!=(null==e?void 0:e.id)&&(null==O||O.emit("stopConference",{id:null==e?void 0:e.id}))}),[null==O?void 0:O.id]),z=a.useCallback((function(e){null!=(null==e?void 0:e.id)&&(null==O||O.emit("pauseConference",{id:e.id}))}),[null==O?void 0:O.id]),V=a.useCallback((function(e){null!=(null==e?void 0:e.id)&&(null==O||O.emit("resumeConference",{id:e.id})),x({type:"JOIN_CONFERENCE",payload:e})}),[null==O?void 0:O.id,x]),Y=a.useCallback((function(e,t){null==O||O.emit("addOperator",{groupId:e.groupId,operatorId:t.userId})}),[null==O?void 0:O.id]),q=a.useCallback((function(e){null==O||O.emit("deleteGroup",{groupId:e.groupId})}),[null==O?void 0:O.id]);a.useEffect((function(){if(null!=p&&!Q(A.contactGather)){var e=Object.values(A.contactGather).find((function(e){return e.userId===p}));P(e)}var t=ae("mmk"),n=ae("guid");null==t&&null==n||Q(A.contactGather)||function(){var e=W(at.mark((function e(){var r,a;return at.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G(t,n);case 2:null!=(r=e.sent)&&(a=Object.values(A.contactGather).find((function(e){return e.userId===r})),P(a));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}),[A.user.userId]),a.useEffect((function(){if(null!=u&&!Q(A.groupGather)){var e=Object.values(A.groupGather).find((function(e){return e.groupId===u}));Q(e)||P(e)}}),[A.user.userId]);var K=null!=A.activeRoom&&a.createElement(Ye,{apiUrl:N,user:A.user,users:A.userGather,operators:A.operators,chat:A.activeRoom,typing:A.typing,conference:A.conference.data,visitData:A.visitData,conferenceJoined:A.conference.joined,loading:A.loading,pageSize:_,onExitRoom:M,onEnterRoom:F,onNeedMoreMessages:D,onMeesageDelete:L,onTyping:U,onSendMessage:j,onVideoCall:H,onVideoEnd:B,onConferencePause:z,onOperatorAdd:Y,onLeaveGroup:q,inModale:g,onContactClick:C.onContactInfoClick}),J=function(){return a.createElement(Ze,{apiUrl:N,user:A.user,activeRoom:A.activeRoom,groups:Object.values(A.groupGather),contacts:Object.values(A.contactGather),typing:A.typing,onChangeChat:P})},X=function(){return A.conference.data&&a.createElement(rt,{apiUrl:N,contact:A.contactGather[A.user.userId===A.conference.data.userId?A.conference.data.contactId:A.conference.data.userId],conference:A.conference.data,onAccept:V})},Z=function(){return a.createElement(tt,{conference:A.conference.data,onClose:z,langCode:A.user.langCode})},ee=function(){return A.conference.joined?a.createElement(a.Fragment,null,a.createElement(Z,null),a.createElement(i.Box,{className:T.conAbsOnConf},a.createElement(i.Paper,{style:{borderRadius:8}},a.createElement(i.Box,{display:"flex",flexDirection:"row",my:3},(Q(A.activeRoom)&&R||!Q(A.activeRoom)&&!R)&&a.createElement(a.Fragment,null,a.createElement(mt,{audio:!0,video:!1}),a.createElement(mt,{audio:!1,video:!0})),Q(A.activeRoom)&&null!=A.chatOld&&R&&a.createElement(i.Tooltip,{title:I("CHAT.CONFERENCE.BACK")},a.createElement(i.IconButton,{"aria-label":"check",onClick:function(){return null!=A.chatOld&&P(A.chatOld)},size:"large"},a.createElement(d.ArrowForward,null))))))):a.createElement(X,null)},te=a.useMemo((function(){var e;return null!=(null==(e=A.conference.data)?void 0:e.id)?a.createElement(ee,null):a.createElement(J,null)}),null!=(null==(t=A.conference.data)?void 0:t.id)?[A.conference.joined,null==(n=A.conference.data)?void 0:n.id]:[null==(r=A.activeRoom)?void 0:r.groupId,null==(o=A.activeRoom)?void 0:o.userId,ne(A.contactGather),ne(A.groupGather)]);return a.createElement(i.Container,{maxWidth:!y&&"lg",className:T.root,sx:function(e){return{width:g?"calc(100vw - "+e.spacing(8)+")":"100%"}}},R?a.createElement(a.Fragment,null,te,K):a.createElement(i.Grid,{container:!0,spacing:1,className:T.innerGrid},(null!=(null==(l=A.conference.data)?void 0:l.id)||!h)&&a.createElement(i.Grid,{item:!0,sm:null!=(null==(c=A.conference.data)?void 0:c.id)?6:4,className:T.innerGrid},te),a.createElement(i.Grid,{item:!0,sm:null!=(null==(s=A.conference.data)?void 0:s.id)?6:h?12:8,className:T.innerGrid},K)),a.createElement(pt,null))};j.addResourceBundle("ru","translations",{CHAT:{STATUS:{ONLINE:"в сети",OFFLINE:"не в сети",TYPING:"печатает"},MESSAGE:{TYPE:{IMAGE:"Изображение",VIDEO:"Видео",FILE:"Файл",NOTIFY:"Уведомление"},MENU:{COPY:"Копировать",DELETE:"Удалить"},REVOKED:{YOU:"Вы удалили сообщение",CONTACT:"удалил(а) сообщение"}},CONFERENCE:{JOIN:"Присоединиться",START:"Начать",RESTART:"Пересоздать конференцию",CONFIRM_RECREATE_CONF:"Вы уверены что хотите пересоздать конференцию?",CONFIRM_FINISH_CONF:"Вы уверены что хотите завершить конференцию?",PAUSE:"Остановить",FINISH:"Завершить",BACK:"Вернуться в чат",NotFoundError:"Запрошенное устройство не найдено",NotAllowedError:"В доступе  отказано. Чтобы разрешить доступ к устройству зайдите в настройки браузера",ErrorAny:"Устройство не настроено",ALLOK:"Все OK",CheckCamMic:"Проверить доступ к микрофону и камере",CheckMic:"Проверить доступ к микрофону",CheckCam:"Проверить доступ к камере",UntillTheEnd:"До окончания конференции осталось",LEFT_TIME:"Осталось"},ADD_CONTACT:"Добавить контакт",INPUT_MESSAGE:"Напишите сообщение...",INPUT_SEARCH_CONTACT:"Фамилия Имя Отчество",MEMBERS:"участников",BUT_CLOSE:"Закрыть",BUT_CONFIRM:"Да"}}),j.addResourceBundle("en","translations",{CHAT:{STATUS:{ONLINE:"online",OFFLINE:"offline",TYPING:"typing"},MESSAGE:{TYPE:{IMAGE:"Image",VIDEO:"Video",FILE:"File",NOTIFY:"Notification"},MENU:{COPY:"Copy",DELETE:"Delete"},REVOKED:{YOU:"You deleted the message",CONTACT:"deleted the message"}},CONFERENCE:{JOIN:"Join",START:"Start",RESTART:"Recreate the conference",CONFIRM_RECREATE_CONF:"Are you sure you want to re-create the conference?",CONFIRM_FINISH_CONF:"Are you sure you want to end the conference?",PAUSE:"Pause",FINISH:"Finish",BACK:"Back to chat",NotFoundError:"Requested device not found",NotAllowedError:"Permission denied. To allow access to the device, go to the browser settings",ErrorAny:"The device is not configured",ALLOK:"All OK",CheckCamMic:"Check access to microphone and camera",CheckMic:"Check access to microphone",CheckCam:"Check access to camera",UntillTheEnd:"There is still time until the end of the conference",LEFT_TIME:"Time left"},ADD_CONTACT:"Add contact",INPUT_MESSAGE:"Please write a message...",INPUT_SEARCH_CONTACT:"Surname Name",MEMBERS:"members",BUT_CLOSE:"Close",BUT_CONFIRM:"Yes"}}),j.addResourceBundle("fr","translations",{CHAT:{STATUS:{ONLINE:"en ligne",OFFLINE:"hors ligne",TYPING:"imprime"},MESSAGE:{TYPE:{IMAGE:"Image",VIDEO:"Vidéo",FILE:"File",NOTIFY:"Notification"},MENU:{COPY:"Copier",DELETE:"Supprimer"},REVOKED:{YOU:"Vous avez supprimé le message",CONTACT:"message supprimé"}},CONFERENCE:{JOIN:"Rejoindre",START:"Démarrer",RESTART:"Recréer la conférence",CONFIRM_RECREATE_CONF:"êtes-vous sûr de vouloir recréer la conférence?",CONFIRM_FINISH_CONF:"êtes-vous sûr de vouloir terminer la conférence?",PAUSE:"Pause",FINISH:"Terminer",BACK:"Retour au chat",NotFoundError:"Périphérique demandé introuvable",NotAllowedError:"Autorisation refusée. Pour autoriser l'accès à l'appareil, accédez aux paramètres du navigateur",ErrorAny:"L'appareil n'est pas configuré",ALLOK:"Tout va bien",CheckCamMic:"Vérifier l'accès au microphone et à la caméra",CheckMic:"Vérifier l'accès au microphone",CheckCam:"Vérifier l'accès à la caméra",UntillTheEnd:" Il est encore temps jusqu'à la fin de la conférence",LEFT_TIME:"temps restant:"},ADD_CONTACT:"Ajouter un contact",INPUT_MESSAGE:"Veuillez écrire un message...",INPUT_SEARCH_CONTACT:"Surname Name",MEMBERS:"members",BUT_CLOSE:"Fermer",BUT_CONFIRM:"Oui"}});var ht=function(e,t){switch(t.type){case"SET_ENGLISH":return j.changeLanguage("en"),{language:"en"};case"SET_FRENCH":return j.changeLanguage("fr"),{language:"fr"};case"SET_RUSSIAN":return j.changeLanguage("ru"),{language:"ru"};default:return e}},vt=a.createContext({}),yt=function(e){var t=e.children,n=a.useReducer(ht,{language:j.language.substring(0,2)}),r=n[0],i=n[1],l=a.useMemo((function(){return{languageState:r,dispatchLanguage:i}}),[r]);return o.createElement(vt.Provider,{value:l},o.createElement(m.I18nextProvider,{i18n:j},t))},Ct=["lang","chatBaseURLApi","chatWsUrl","chatWsPath","token","refreshToken"];exports.AddContact=se,exports.ChatContext=Pe,exports.ChatIndex=function(e){var t=e.lang,n=e.chatBaseURLApi,r=e.chatWsUrl,a=e.chatWsPath,i=e.token,l=e.refreshToken,c=$(e,Ct);return o.createElement(yt,null,o.createElement(Fe,{defLang:t,token:i,refreshToken:l},o.createElement(st,{baseURLApi:n,pageSize:25},o.createElement(dt,{wsUrl:r,wsPath:a},o.createElement(Et,c)))))},exports.ChatPage=Et,exports.ChatProvider=Fe,exports.Conference=tt,exports.ConferenceCall=rt,exports.Emoji=F,exports.Message=Ne,exports.RestContext=ot,exports.RestProvider=st,exports.Room=Ye,exports.RoomList=Ze,exports.SocketContext=ut,exports.SocketProvider=dt,exports.Typing=B,exports.clearLocalStorage=it,exports.getRefreshToken=ct,exports.signOut=lt;
//# sourceMappingURL=chat.cjs.production.min.js.map
