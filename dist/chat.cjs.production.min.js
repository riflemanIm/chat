"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t,r,n,a=require("react"),o=e(a),i=require("@mui/material"),c=require("@mui/styles"),l=e(require("@mui/icons-material/FileCopy")),s=e(require("@mui/icons-material/Delete")),u=e(require("@mui/icons-material/Videocam")),d=e(require("@mui/icons-material/RecentActors")),m=require("@mui/icons-material"),p=require("react-i18next"),f=e(require("@mui/icons-material/Group")),E=e(require("@mui/icons-material/CallEnd")),g=e(require("@mui/icons-material/Pause")),h=e(require("@mui/icons-material/PersonAdd")),v=e(require("@mui/icons-material/Star")),y=e(require("dayjs")),C=e(require("@mui/material/Button")),T=e(require("@mui/material/Dialog")),I=e(require("@mui/material/DialogActions")),S=e(require("@mui/material/DialogContent")),R=e(require("@mui/material/Slide")),A=require("@mui/material/styles"),x=e(require("@mui/material/Menu")),b=e(require("@mui/material/MenuItem")),O=e(require("@mui/icons-material/PlayArrow")),N=e(require("@mui/icons-material/RestartAlt")),_=e(require("@mui/icons-material/VideoCall")),k=e(require("@mui/icons-material/KeyboardArrowDown")),w=require("react-aspect-ratio"),G=e(require("react-infinite-scroll-hook")),D=e(require("@mui/material/List")),M=e(require("axios")),L=e(require("socket.io-client")),U=e(require("@mui/icons-material/Chat")),P=e(require("@mui/icons-material/SettingsSuggest")),j=e(require("@mui/icons-material/SettingsVoice")),F=e(require("i18next"));(t=exports.MessageStatus||(exports.MessageStatus={}))[t.sent=0]="sent",t[t.read=1]="read",(r=exports.Role||(exports.Role={}))[r.Unknown=0]="Unknown",r[r.Client=1]="Client",r[r.Agent=2]="Agent",r[r.Specialist=3]="Specialist",r[r.Operator=4]="Operator",(n=exports.ContextMenuType||(exports.ContextMenuType={})).COPY="COPY",n.REVOKE="REVOKE",n.TOP_REVERT="TOP_REVERT",n.TOP="TOP",n.READ="READ",n.DELETE="DELETE";var H=c.makeStyles((function(){return c.createStyles({item:{cursor:"pointer"}})})),B=function(e){var t=H(),r=function(t){e.onSelect&&e.onSelect(t.target.innerText)},n=function(e){return a.createElement(i.Box,{m:.5,component:"span",onClick:r,className:t.item},e.emoji)};return a.createElement(i.Box,null,a.createElement(i.Box,{display:"flex",flexDirection:"row"},a.createElement(n,{emoji:"ðŸ˜ƒ"}),a.createElement(n,{emoji:"ðŸ˜"}),a.createElement(n,{emoji:"ðŸ˜‚"}),a.createElement(n,{emoji:"ðŸ˜„"}),a.createElement(n,{emoji:"ðŸ˜…"}),a.createElement(n,{emoji:"ðŸ˜†"}),a.createElement(n,{emoji:"ðŸ˜‡"}),a.createElement(n,{emoji:"ðŸ˜ˆ"}),a.createElement(n,{emoji:"ðŸ˜‰"})),a.createElement(i.Box,{display:"flex",flexDirection:"row"},a.createElement(n,{emoji:"ðŸ˜Š"}),a.createElement(n,{emoji:"ðŸ˜‹"}),a.createElement(n,{emoji:"ðŸ˜Œ"}),a.createElement(n,{emoji:"ðŸ˜"}),a.createElement(n,{emoji:"ðŸ˜Ž"}),a.createElement(n,{emoji:"ðŸ˜"}),a.createElement(n,{emoji:"ðŸ˜"}),a.createElement(n,{emoji:"ðŸ˜’"}),a.createElement(n,{emoji:"ðŸ˜“"})),a.createElement(i.Box,{display:"flex",flexDirection:"row"},a.createElement(n,{emoji:"â“"}),a.createElement(n,{emoji:"ðŸ˜•"}),a.createElement(n,{emoji:"ðŸ˜–"}),a.createElement(n,{emoji:"ðŸ˜—"}),a.createElement(n,{emoji:"ðŸ˜˜"}),a.createElement(n,{emoji:"ðŸ˜™"}),a.createElement(n,{emoji:"ðŸ˜š"}),a.createElement(n,{emoji:"ðŸ˜œ"}),a.createElement(n,{emoji:"ðŸ˜"})),a.createElement(i.Box,{display:"flex",flexDirection:"row"},a.createElement(n,{emoji:"ðŸ˜ž"}),a.createElement(n,{emoji:"ðŸ˜Ÿ"}),a.createElement(n,{emoji:"ðŸ˜ "}),a.createElement(n,{emoji:"ðŸ˜¡"}),a.createElement(n,{emoji:"ðŸ˜¢"}),a.createElement(n,{emoji:"ðŸ˜£"}),a.createElement(n,{emoji:"ðŸ˜¤"}),a.createElement(n,{emoji:"ðŸ˜¥"}),a.createElement(n,{emoji:"ðŸ˜¦"})),a.createElement(i.Box,{display:"flex",flexDirection:"row"},a.createElement(n,{emoji:"ðŸ˜¨"}),a.createElement(n,{emoji:"ðŸ˜©"}),a.createElement(n,{emoji:"ðŸ˜ª"}),a.createElement(n,{emoji:"ðŸ˜«"}),a.createElement(n,{emoji:"ðŸ˜¬"}),a.createElement(n,{emoji:"ðŸ˜­"}),a.createElement(n,{emoji:"ðŸ˜®"}),a.createElement(n,{emoji:"ðŸ˜¯"}),a.createElement(n,{emoji:"ðŸ˜°"})),a.createElement(i.Box,{display:"flex",flexDirection:"row"},a.createElement(n,{emoji:"ðŸ˜²"}),a.createElement(n,{emoji:"ðŸ˜³"}),a.createElement(n,{emoji:"ðŸ˜´"}),a.createElement(n,{emoji:"ðŸ˜µ"}),a.createElement(n,{emoji:"ðŸ§"}),a.createElement(n,{emoji:"ðŸ˜·"}),a.createElement(n,{emoji:"ðŸ™"}),a.createElement(n,{emoji:"ðŸ™‚"}),a.createElement(n,{emoji:"ðŸ™ƒ"})),a.createElement(i.Box,{display:"flex",flexDirection:"row"},a.createElement(n,{emoji:"ðŸ¤"}),a.createElement(n,{emoji:"ðŸ¤‘"}),a.createElement(n,{emoji:"ðŸ¤’"}),a.createElement(n,{emoji:"ðŸ¤“"}),a.createElement(n,{emoji:"ðŸ¤”"}),a.createElement(n,{emoji:"ðŸ¤•"}),a.createElement(n,{emoji:"ðŸ¤ "}),a.createElement(n,{emoji:"ðŸ¤¡"}),a.createElement(n,{emoji:"ðŸ¤¢"})),a.createElement(i.Box,{display:"flex",flexDirection:"row"},a.createElement(n,{emoji:"ðŸ¤¤"}),a.createElement(n,{emoji:"ðŸ¤¥"}),a.createElement(n,{emoji:"ðŸ¤§"}),a.createElement(n,{emoji:"ðŸ¤¨"}),a.createElement(n,{emoji:"ðŸ¤©"}),a.createElement(n,{emoji:"ðŸ¤ª"}),a.createElement(n,{emoji:"ðŸ¤«"}),a.createElement(n,{emoji:"ðŸ¤¬"}),a.createElement(n,{emoji:"ðŸ¤­"})))},V=c.makeStyles((function(e){return c.createStyles({typingText:{paddingLeft:e.spacing(.5)},typingDot:{display:"inline-block",verticalAlign:"middle",width:4,height:4,margin:"0px 2px",background:e.palette.primary.main,borderRadius:"50%",opacity:"0",animation:"$loadingFade 1s infinite","&:nth-child(1)":{animationDelay:"0s"},"&:nth-child(2)":{animationDelay:"0.2s"},"&:nth-child(3)":{animationDelay:"0.4s"}},"@keyframes loadingFade":{"0%":{opacity:0},"50%":{opacity:.8},"100%":{opacity:0}}})})),z=function(e){var t=V();return o.createElement(i.Typography,{color:"primary",variant:"body2",component:"span"},o.createElement("span",{className:t.typingDot}),o.createElement("span",{className:t.typingDot}),o.createElement("span",{className:t.typingDot}),o.createElement("span",{className:t.typingText},e.message))},Y=c.makeStyles((function(){return{input:{flex:"auto"},inputUpload:{display:"none"},attachmentIcon:{fill:"none",stroke:"currentColor"}}})),q=function(e){var t=Y(),r=e.chat,n=p.useTranslation().t,a=o.useState(null),c=a[0],l=a[1],s=o.useState(""),u=s[0],d=s[1],f=o.useState({chat:r,time:0}),E=f[0],g=f[1],h=function(){l(null)},v=function(t){r&&e.onSendMessage&&e.onSendMessage(r,t)},y=function(){0!==u.trim().length&&(v({message:u,messageType:"text"}),d(""))},C=Boolean(c),T=C?"simple-popover":void 0;return o.createElement(i.Box,{display:"flex",flexDirection:"row"},o.createElement(i.TextField,{className:t.input,placeholder:n("CHAT.INPUT_MESSAGE")||"",autoFocus:!0,variant:"standard",slotProps:{input:{autoComplete:"off",disableUnderline:!0,startAdornment:o.createElement(i.InputAdornment,{position:"start"},o.createElement("input",{accept:".pdf,.jpg,.jpeg,.bmp,.gif,.png,application/pdf,image/jpeg,image/bmp,image/gif,image/png",className:t.inputUpload,id:"icon-button-file",type:"file",onChange:function(e){if(e.currentTarget.files){var t,r=e.currentTarget.files[0];if("image"==(t=r.type.includes("image")?"image":r.type.includes("video")?"video":"file")){var n=new Image,a=window.URL||window.webkitURL;n.src=a.createObjectURL(r),n.onload=function(){var e,a,o,i=(o=(e={width:n.width,height:n.height}).height,((a=e.width)>335||o>335)&&(a>o?(o=o/a*335,a=335):(a=a/o*335,o=335)),{width:a,height:o});v({message:r,width:i.width,height:i.height,messageType:t})}}else v({message:r,messageType:t,fileName:r.name,size:r.size})}}}),o.createElement("label",{htmlFor:"icon-button-file"},o.createElement(i.IconButton,{color:"primary","aria-label":"upload",component:"span",size:"small"},o.createElement(i.SvgIcon,{fill:"none",className:t.attachmentIcon},o.createElement("path",{d:"M16.768 13.5767L11.6961 18.6486C9.35886 20.9859 5.56937 20.9859 3.23208 18.6486V18.6486C0.894789 16.3114 0.894789 12.5219 3.23208 10.1846L10.4479 2.96872C12.0875 1.32914 14.7458 1.32914 16.3854 2.96873V2.96873C18.025 4.60831 18.025 7.26659 16.3854 8.90617L9.16515 16.1264C8.23032 17.0612 6.71466 17.0612 5.77982 16.1264V16.1264C4.84499 15.1916 4.84499 13.6759 5.77982 12.7411L10.8896 7.63131",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"}))))," ",o.createElement(i.IconButton,{"aria-describedby":T,onClick:function(e){l(e.currentTarget)},color:"primary",size:"small"},o.createElement(m.InsertEmoticon,null))),endAdornment:o.createElement(i.IconButton,{edge:"end",color:"inherit",size:"small",onClick:function(e){e.preventDefault(),y()}},o.createElement(m.Send,null))}},value:u,onChange:function(t){d(t.target.value),r&&e.onTyping&&(E.chat!==r||Date.now()-E.time>=500)&&(g({chat:r,time:Date.now()}),e.onTyping(r))},onKeyPress:function(e){"Enter"===e.key&&(e.preventDefault(),y())}}),o.createElement(i.Popover,{id:T,open:C,anchorEl:c,onClose:h,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"left"}},o.createElement(B,{onSelect:function(e){d(""+u+e),h()}})))},W=function(e){var t=p.useTranslation().t;return e.isTyping?o.createElement(z,{message:t("CHAT.STATUS.TYPING")}):1===e.contact.online?o.createElement(i.Typography,{variant:"body2",color:"primary",component:"span"},t("CHAT.STATUS.ONLINE")):o.createElement(i.Typography,{variant:"body2",color:"textSecondary",component:"span"},t("CHAT.STATUS.OFFLINE"))};function K(e,t,r,n,a,o,i){try{var c=e[o](i),l=c.value}catch(e){return void r(e)}c.done?t(l):Promise.resolve(l).then(n,a)}function $(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){K(o,n,a,i,c,"next",e)}function c(e){K(o,n,a,i,c,"throw",e)}i(void 0)}))}}function J(){return(J=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function X(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)t.indexOf(r=o[n])>=0||(a[r]=e[r]);return a}function Q(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Z(e){return null==e||"object"==typeof e&&0===Object.keys(e).length||"string"==typeof e&&0===e.trim().length}function ee(e,t){return void 0===t&&(t="DD.MM.YYYY HH:mm"),void 0===e?null:("string"==typeof e&&(e=new Date(e)),y().add(-1,"days").startOf("day").isAfter(e)?y(e).format(t):y().startOf("day").isAfter(e)?"Ð’Ñ‡ÐµÑ€Ð° Ð² "+y(e).format("HH:mm"):y(e).format("HH:mm"))}var te=function(e){return e?e.groupId?"group:"+e.groupId:"user:"+e.userId:null},re=function(e){return e.groupId?e.name:e.username},ne=function(e,t){var r=Array.isArray(e.messages)&&e.messages.length>0,n=Array.isArray(t.messages)&&t.messages.length>0;return r&&n&&null!=t.messages&&null!=e.messages?(null!=t.messages[t.messages.length-1].cdate?new Date(t.messages[t.messages.length-1].cdate).getTime():(new Date).getTime())-(null!=e.messages[e.messages.length-1].cdate?new Date(e.messages[e.messages.length-1].cdate).getTime():(new Date).getTime()-1):r?-1:1},ae=function(e){var t=window.location.search;return new URLSearchParams(t).get(e)},oe=function(e,t,r){var n=t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e;return r?n+(n.includes("?")?"&":"?")+new URLSearchParams(r).toString():n},ie=["apiUrl","contacts","owner","onContactClick"],ce=c.makeStyles((function(){return{star:{fontSize:"0.85rem",verticalAlign:"middle"}}})),le=function(e){var t=ce(),r=e.apiUrl,n=e.contacts,a=e.owner,c=e.onContactClick,l=X(e,ie);return o.createElement(i.List,J({},l,{"aria-label":"contacts"}),n.map((function(e){return o.createElement(i.ListItemButton,{key:e.userId,onClick:function(){return c&&c(e)}},o.createElement(i.ListItemAvatar,null,o.createElement(i.Avatar,{alt:e.username,src:e.avatar?oe(r,e.avatar):""})),o.createElement(i.ListItemText,{primary:o.createElement("span",null,e.username," ",a===e.userId&&o.createElement(v,{className:t.star,color:"primary"})),secondary:o.createElement(W,{contact:e,isTyping:!1})}))})))},se=function(e){var t=e.onClose,r=e.open,n=e.apiUrl,a=e.contacts,c=p.useTranslation();return o.createElement(i.Dialog,{onClose:function(){t()},"aria-labelledby":"add-contact-title",open:r},o.createElement(i.DialogTitle,{id:"switch-operator-title"},(0,c.t)("CHAT.ADD_CONTACT")),o.createElement(le,{apiUrl:n,contacts:a,onContactClick:function(e){t(e)}}))},ue=o.forwardRef((function(e,t){return o.createElement(i.Slide,J({direction:"up",ref:t},e))}));function de(e){var t=e.children,r=e.open,n=e.setOpen,a=e.severity,c=void 0===a?"warning":a,l=p.useTranslation().t,s=function(){n(!1)};return o.createElement(i.Dialog,{open:r,TransitionComponent:ue,keepMounted:!0,onClose:s,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},o.createElement(i.DialogContent,null,o.createElement(i.Alert,{severity:c},"string"==typeof t?o.createElement(i.Typography,{variant:"body2"},t):t)),o.createElement(i.DialogActions,null,o.createElement(i.Button,{onClick:s,variant:"text"},l("CHAT.BUT_CLOSE"))))}var me=function(e){var t=e.modaleInfo,r=e.setModaleInfo,n=e.strTime,c=p.useTranslation().t;return a.useMemo((function(){return o.createElement(de,{open:t,setOpen:r,severity:"info"},o.createElement(i.Typography,{variant:"body1",textAlign:"center"},c("CHAT.CONFERENCE.UntillTheEnd"),":"),o.createElement(i.Typography,{variant:"h6",textAlign:"center"},n))}),[t])},pe=function(e){var t=e.finishDate,r=p.useTranslation().t,n=a.useState(!1),c=n[0],l=n[1],s=Date.now(),u=new Date(t).getTime(),d=Math.round((u-s)/1e3),m=function(e){void 0===e&&(e=3e4);var t=a.useState(e),r=t[0],n=t[1],o=a.useRef(null);return a.useEffect((function(){return r>0&&(o.current=setInterval((function(){return n((function(e){return e-1}))}),1e3)),function(){o.current&&clearInterval(o.current)}}),[r]),{counter:r,handlerRefresh:function(){n(e)}}}(d).counter,f=function(e){var t=Math.floor(e/3600),r=t<10?"0"+t:t;e%=3600;var n=Math.floor(e/60),a=e%60;return{hours:t,minutes:n,seconds:a,strTime:r+":"+(n<10?"0"+n:n)+":"+(a<10?"0"+a:a)}}(d),E=f.minutes,g=f.seconds,h=f.strTime;return a.useEffect((function(){E&&3===E&&null!=g&&0===g&&l(!0)}),[m]),d<1?null:o.createElement(i.Box,{textAlign:"center"},o.createElement(i.Typography,{variant:"body2",component:"span"},r("CHAT.CONFERENCE.LEFT_TIME"),":"," "),o.createElement(i.Typography,{variant:"button",component:"span"},h),o.createElement(me,{modaleInfo:c,setModaleInfo:l,strTime:h}))},fe=a.forwardRef((function(e,t){return a.createElement(R,J({direction:"up",ref:t},e))}));function Ee(e){var t=e.open,r=e.setOpen,n=e.contentText,o=e.callback,c=p.useTranslation().t,l=function(){r(!1)};return a.createElement(a.Fragment,null,a.createElement(T,{open:t,TransitionComponent:fe,keepMounted:!0,onClose:l,"aria-describedby":"alert-dialog-slide-description"},a.createElement(S,null,a.createElement(i.Typography,{variant:"h6"},n)),a.createElement(I,null,a.createElement(C,{onClick:l,color:"primary"},c("CHAT.BUT_CLOSE")),a.createElement(C,{onClick:function(){r(!1),o()},color:"warning"},c("CHAT.BUT_CONFIRM")))))}var ge=A.styled((function(e){return o.createElement(x,J({elevation:0,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"}},e))}))((function(e){var t=e.theme;return{"& .MuiPaper-root":{borderRadius:6,marginTop:t.spacing(1),minWidth:180,color:"light"===t.palette.mode?"rgb(55, 65, 81)":t.palette.grey[300],boxShadow:"rgb(255, 255, 255) 0px 0px 0px 0px, rgba(0, 0, 0, 0.05) 0px 0px 0px 1px, rgba(0, 0, 0, 0.1) 0px 10px 15px -3px, rgba(0, 0, 0, 0.05) 0px 4px 6px -2px","& .MuiMenu-list":{padding:"4px 0"},"& .MuiMenuItem-root":{"& .MuiSvgIcon-root":{fontSize:18,color:t.palette.text.secondary,marginRight:t.spacing(1.5)},"&:active":{backgroundColor:A.alpha(t.palette.primary.main,t.palette.action.selectedOpacity)}}}}}));function he(e){var t=p.useTranslation().t,r=o.useState(null),n=r[0],a=r[1],i=o.useState(null),c=i[0],l=i[1],s=o.useState(!1),u=s[0],d=s[1],m=Boolean(n),f=o.useMemo((function(){return e.visitData.filter((function(t){return t.contactId===e.chat.userId}))}),[e.visitData,e.chat]);return o.createElement("div",null,o.createElement(C,{id:"conference-button","aria-controls":m?"conference-menu":void 0,"aria-haspopup":"true","aria-expanded":m?"true":void 0,color:"primary",size:"small",variant:"contained",disableElevation:!0,onClick:function(e){a(e.currentTarget)},startIcon:o.createElement(_,null),endIcon:o.createElement(k,null),disabled:0===f.length},t("CHAT.CONFERENCE.START")),o.createElement(Ee,{open:u,setOpen:d,contentText:t("CHAT.CONFERENCE.CONFIRM_RECREATE_CONF"),callback:function(){c&&u&&e.onVideoCall(e.chat,c,!0)}}),o.createElement(ge,{id:"conference-menu",MenuListProps:{"aria-labelledby":"conference-button"},anchorEl:n,open:m,onClose:function(){a(null)}},f.map((function(t){return o.createElement(b,{onClick:function(){return function(t){a(null),l(t.visitId),"finished"===t.conferenceStatus?d(!0):e.onVideoCall(e.chat,t.visitId)}(t)},key:t.visitId,value:t.visitId,disableRipple:!0},o.createElement("finished"===t.conferenceStatus?N:O,null),(r=t,n=new Date(r.visitDate),r.plExamName+" ("+ee(n,"HH:mm")+" - "+ee(new Date(n.getTime()+6e4*r.duration),"HH:mm")+")"));var r,n}))))}var ve=c.makeStyles((function(e){return c.createStyles({paper:{padding:e.spacing(1)},avatarGroup:{backgroundColor:"#28B7C6",color:"#fff"}})})),ye=function(e,t){var r,n=[(null==(r=e.members)?void 0:r.length)+" "+t("CHAT.MEMBERS")],a=(e.members||[]).reduce((function(e,t){return t.online?e+1:e}),0);return a&&n.push(a+" "+t("CHAT.STATUS.ONLINE")),n.join(", ")},Ce=function(e){var t=e.apiUrl,r=e.user,n=e.chat,c=e.typing,l=e.conference,u=e.visitData,d=e.conferenceJoined,m=e.className,v=e.operators,y=e.onVideoCall,C=e.onVideoEnd,T=e.onConferencePause,I=e.onOperatorAdd,S=e.onLeaveGroup,R=e.onContactClick,A=ve(),x=p.useTranslation().t,b=a.useState(null),O=b[0],N=b[1],_=a.useState(!1),k=_[0],w=_[1],G=o.useState(!1),D=G[0],M=G[1];if(!n)return o.createElement(i.CardHeader,{avatar:o.createElement(i.Avatar,null),title:"",subheader:"",className:m});var L,U=null,P=function(e){O||N(e.currentTarget),U&&(clearTimeout(U),U=null)},j=function(){N(null),U&&(clearTimeout(U),U=null)},F=function(){U||(U=setTimeout((function(){j()}),1e3))},H=n;if(H.groupId)return o.createElement(i.CardHeader,{avatar:o.createElement(i.Avatar,{alt:H.name,className:A.avatarGroup},o.createElement(f,null)),title:H.name,subheader:o.createElement(o.Fragment,null,o.createElement("span",{id:"mouse-over-span","aria-owns":O?"mouse-over-popover":void 0,"aria-haspopup":"true",onMouseEnter:P,onMouseLeave:F},ye(H,x)),o.createElement(i.Popover,{id:"mouse-over-popover",classes:{paper:A.paper},sx:{pointerEvents:"none"},open:!!O,anchorEl:O,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},onClose:j,disableRestoreFocus:!0},o.createElement(le,{apiUrl:t,contacts:H.members,onContactClick:R,owner:H.userId,onMouseEnter:P,onMouseLeave:F,sx:{pointerEvents:"all"}}))),className:m,action:o.createElement(o.Fragment,null,4===r.role&&o.createElement(o.Fragment,null,o.createElement(i.IconButton,{"aria-label":"add user",onClick:function(){w(!0)}},o.createElement(h,null)),o.createElement(se,{apiUrl:t,open:k,contacts:v,onClose:function(e){w(!1),I&&e&&n&&I(n,e)}})),4===r.role&&(null==(L=H.members)?void 0:L.find((function(e){return e.userId!==r.userId&&4===e.role})))&&S&&o.createElement(i.IconButton,{"aria-label":"leave group",onClick:function(){return S(H)}},o.createElement(s,null)))});var B=n,V=!(null==c||!c.contactId)&&(null==c?void 0:c.userId)===B.userId;return o.createElement(i.CardHeader,{avatar:o.createElement(i.Avatar,{alt:B.username,src:B.avatar?oe(t,B.avatar):""}),title:o.createElement(i.Typography,{variant:"h6",sx:function(e){var t;return(t={whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",fontSize:"0.9rem"})[e.breakpoints.down("md")]={fontSize:"0.8rem"},t[e.breakpoints.down("sm")]={whiteSpace:"wrap",fontSize:"0.7rem"},t}},B.username),subheader:o.createElement(W,{contact:B,isTyping:V}),className:m,action:o.createElement(o.Fragment,null,1!==r.role&&d&&l&&!Z(l)&&null!=T&&o.createElement(i.Button,{"aria-label":"cancel call",variant:"contained",color:"secondary",size:"small",startIcon:o.createElement(g,{color:"primary"}),onClick:function(){return T(l)}},x("CHAT.CONFERENCE.PAUSE")),l&&!Z(l)&&null!=C&&null!=r.role&&[3,4].includes(r.role)&&o.createElement(o.Fragment,null,o.createElement(i.Button,{"aria-label":"cancel call",variant:"contained",color:"warning",size:"small",startIcon:o.createElement(E,{color:"inherit"}),onClick:function(){return M(!0)},style:{marginLeft:8}},x("CHAT.CONFERENCE.FINISH")),o.createElement(Ee,{open:D,setOpen:M,contentText:x("CHAT.CONFERENCE.CONFIRM_FINISH_CONF"),callback:function(){C(l)}})),Z(l)&&null!=y&&r.role&&[3,4].includes(r.role)&&o.createElement(he,{visitData:u,chat:B,onVideoCall:y}),null!=(null==l?void 0:l.finishDate)&&o.createElement(pe,{finishDate:l.finishDate}))})},Te=c.makeStyles((function(e){return c.createStyles({fileIcon:{fontSize:"0.75rem"},fileBody:{paddingLeft:e.spacing(1.2)}})})),Ie=function(e){var t=e.message,r=Te(),n=function(e){var t=e.split("$");return{date:t[0],userId:t[1],size:t[2],name:t[3]}}(t.content),a=function(e){var t=e.lastIndexOf(".");return-1===t?{name:e,ext:""}:{name:e.slice(0,t),ext:e.slice(t+1)}}(n.name),c=a.name,l=a.ext;return o.createElement(i.Box,{display:"flex",flexDirection:"row"},o.createElement(i.Avatar,{className:r.fileIcon},l.toUpperCase()),o.createElement(i.Box,{display:"flex",flexDirection:"column",className:r.fileBody},c,o.createElement("span",null,l+" "+n.size)))},Se=c.makeStyles((function(e){var t;return{mediaContent:(t={backgroundColor:e.palette.secondary.main,borderRadius:e.spacing(1.2),maxWidth:284,height:190},t[e.breakpoints.down("sm")]={maxWidth:250,height:170},t)}})),Re=function(e){var t=e.apiUrl,r=e.message,n=e.isConference,a=Se(),i="";if(n){var c=JSON.parse(r.content);i=oe(t,"/static/conf/"+c.visitId+"/"+c.name)}else i=oe(t,"/static/file/"+r.content);return o.createElement("video",{src:i,className:a.mediaContent,controls:!0,muted:!0,preload:"none"},"Ð’Ð°Ñˆ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€ Ð½Ðµ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ Ñ‚ÐµÐ³ video.")},Ae=c.makeStyles((function(e){var t,r;return c.createStyles({img:(t={cursor:"pointer",borderRadius:e.spacing(1.2),maxWidth:284,maxHeight:190},t[e.breakpoints.down("sm")]={maxWidth:250,maxHeight:170},t),aspect:(r={maxWidth:284,height:190},r[e.breakpoints.down("sm")]={maxWidth:250,height:170},r)})})),xe=function(e){var t=e.apiUrl,r=e.message,n=e.setViewerData,a=Ae();return o.createElement(w.AspectRatio,{ratio:"3/4",className:a.aspect},o.createElement("img",{src:oe(t,"/static/image/"+r.content),onClick:function(){n({visible:!0,src:oe(t,"/static/image/"+r.content)})},className:a.img,alt:r.cdate}))},be=function(e){var t=e.apiUrl,r=e.message,n=e.setViewerData;switch(r.messageType){case"text":return o.createElement(o.Fragment,null,r.content);case"video":case"video_conference":return o.createElement(Re,{message:r,apiUrl:t,isConference:"video_conference"===r.messageType});case"image":return o.createElement(xe,{message:r,apiUrl:t,setViewerData:n});case"file":return o.createElement(Ie,{message:r})}return null},Oe=c.makeStyles((function(e){var t;return c.createStyles({rootContact:{padding:1,paddingLeft:e.spacing(2),"& span":{float:"right",color:e.palette.text.secondary,fontSize:"0.8rem"},"& $message":{backgroundColor:e.palette.grey[200],color:e.palette.text.primary,borderTopRightRadius:e.spacing(3),borderBottomRightRadius:e.spacing(3)},"& $firstMessage":{borderTopLeftRadius:e.spacing(3),marginTop:10},"& $lastMessage":{borderTopRightRadius:e.spacing(3),borderBottomLeftRadius:0,borderBottomRightRadius:e.spacing(3),marginBottom:10}},rootUser:{padding:1,paddingRight:e.spacing(2),justifyContent:"flex-end","& span":{float:"right",color:"#D9DEEC",fontSize:"0.8rem"},"& $message":{backgroundColor:e.palette.primary.main,color:e.palette.primary.contrastText,borderTopLeftRadius:e.spacing(3),borderBottomLeftRadius:e.spacing(3)},"& $firstMessage":{borderTopRightRadius:e.spacing(3),marginTop:10},"& $lastMessage":{borderTopLeftRadius:e.spacing(3),borderBottomRightRadius:0,marginBottom:10}},rootNotify:{justifyContent:"center","& span":{float:"right",color:e.palette.text.secondary,fontSize:"0.8rem"},"& > *":{borderRadius:e.spacing(3),fontWeight:500}},message:(t={maxWidth:"65%"},t[e.breakpoints.down("md")]={maxWidth:"95%"},t[e.breakpoints.down("sm")]={maxWidth:"85%"},t.borderRadius=e.spacing(.6),t.padding=e.spacing(.9),t.paddingLeft=e.spacing(1.8),t.paddingRight=e.spacing(1.8),t),firstMessage:{},lastMessage:{},file:{display:"flex",flexDirection:"row",flexWrap:"wrap",cursor:"pointer"},header:{flex:"0 0 100%",overflow:"hidden",fontWeight:"bold"},body:{flex:"1 1 auto",wordBreak:"break-word",overflow:"hidden"},status:{paddingLeft:e.spacing(1),flex:"1 1 auto",alignSelf:"flex-end"},statusImage:{fontSize:"1rem",marginRight:e.spacing(.5),verticalAlign:"middle"}})})),Ne=a.memo(a.forwardRef((function(e,t){var r=Oe(),n=p.useTranslation().t,a=e.apiUrl,c=e.message,l=e.owner,s=e.user,u=e.isGroupMessage,d=e.isUserFirst,f=e.isUserLast,E=e.setViewerData;if("notify"===c.messageType){var g="{"===c.content[0]?JSON.parse(c.content):c.content;return o.createElement(i.ListItem,{className:r.rootNotify,ref:t},o.createElement(i.Alert,{severity:"string"==typeof g?"info":g.severity},"string"==typeof g?g:g.message))}if(c.isRevoke)return o.createElement(i.ListItem,{className:r.rootNotify,ref:t},o.createElement(i.Typography,{variant:"body2",align:"center"},c.userId===s.userId?n("CHAT.MESSAGE.REVOKED.YOU"):c.revokeUserName+" "+n("CHAT.MESSAGE.REVOKED.CONTACT")));var h=s.userId===c.userId;return o.createElement(i.ListItem,{ref:t,className:"video_conference"===c.messageType?r.rootNotify:h?r.rootUser:r.rootContact},function(e,t,r,n,a,c,l){var s=t.messageType,u=n&&a?r.message+" "+r.firstMessage+" "+r.lastMessage:n?r.message+" "+r.firstMessage:a?r.message+" "+r.lastMessage:r.message;return"file"===s?o.createElement(i.Link,{className:u+" "+r.file,underline:"none",href:oe(e,"/static/file/"+t.content),target:"_blank",download:!0,onContextMenu:c},l):o.createElement(i.Box,{display:"flex",flexDirection:"image"===s||"video"===s||"video_conference"===s?"column":"row",flexWrap:"wrap",className:u,onContextMenu:c},l)}(a,c,r,d,f,e.onContextMenu,o.createElement(o.Fragment,null,!h&&u&&l&&d&&o.createElement("div",{className:r.header},l.username),o.createElement("div",{className:r.body},o.createElement(be,{message:c,apiUrl:a,setViewerData:E})),o.createElement("div",{className:r.status},o.createElement("span",null,h?o.createElement(0===c.status?m.Done:m.DoneAll,{className:r.statusImage}):null,ee(c.cdate))))))})));Ne.displayName="Message";var _e,ke=c.makeStyles((function(e){var t,r;return c.createStyles({messageListOuter:{flex:1,overflowY:"auto",margin:0,padding:0,height:"100%",scrollbarWidth:"thin",scrollbarColor:e.palette.primary.light+" #fff"},messageList:{},img:(t={cursor:"pointer",borderRadius:e.spacing(1.2),maxWidth:"auto",maxHeight:"95%"},t[e.breakpoints.down("sm")]={maxWidth:"auto",maxHeight:"95%"},t),arrowDown:(r={position:"absolute",left:"94.5%",bottom:105},r[e.breakpoints.down("md")]={left:"91.5%",bottom:95},r[e.breakpoints.down("sm")]={left:"84%",bottom:95},r)})})),we=function(e){var t,r,n,c,l,s=e.apiUrl,u=e.user,d=e.users,m=e.chat,p=e.loading,f=e.pageSize,E=e.setMenuState,g=e.initialMenuState,h=e.onEnterRoom,v=ke(),C=te(m),T=o.useState({visible:!1,src:""}),I=T[0],S=T[1],R=o.useState(!1),A=R[0],x=R[1],b=o.useRef(null),O=o.useRef(),N=o.useRef(),_=null==m||null==(null==m?void 0:m.noMoreData)||!m.noMoreData,w=o.useMemo((function(){return null!=m&&m.messages?m.messages.map((function(e){return J({},e,{ref:o.createRef()})})):[]}),[null==m?void 0:m.messages]),D=(null==w?void 0:w.length)||0,M=D&&w[D-1],L=w.filter((function(e){return null!=(null==e?void 0:e.status)&&0===e.status})),U=o.useState(null!=(t=null==(r=w[D-1])?void 0:r.cdate)?t:""),P=U[0],j=U[1],F=G({loading:p,hasNextPage:_,onLoadMore:function(){m&&e.onNeedMoreMessages(m)},disabled:!1}),H=F[0],B=F[1].rootRef;o.useEffect((function(){var e,t;C&&b.current&&D&&(j(null!=(e=null==(t=w[D-1])?void 0:t.cdate)?e:""),z())}),[C]),n=function(){j("")},c=P,l=a.useRef(),a.useEffect((function(){l.current=n}),[n]),a.useEffect((function(){if(c){var e=setInterval((function(){l.current()}),4700);return function(){return clearInterval(e)}}}),[c]),o.useEffect((function(){var e,t=b.current,r=null!=(e=O.current)?e:0;t&&M&&m&&(N.current===D-f?t.scrollTop=t.scrollHeight-r:(M.userId!==m.userId||r<=900)&&z()),N.current=D}),[D]);var V=o.useCallback((function(){var e,t,r=b.current;if(r){var n=r.scrollHeight-r.scrollTop;O.current=n,x(_&&n>900);for(var a=0;a<D;a++){var o,i=w[a];if(null==i||null==(o=i.ref)||!o.current)break;if(e=r,(t=i.ref.current.getBoundingClientRect()).top>=150&&t.bottom<=e.clientHeight){j(i.cdate);break}}}}),[w,C]),z=o.useCallback((function(){b.current&&(b.current.scrollTop=b.current.scrollHeight,h&&m&&h(m))}),[m,h]),Y=o.useCallback((function(e){B(e),b.current=e}),[B]);if(null!=C)return o.createElement(o.Fragment,null,o.createElement(i.Box,{sx:{position:"relative",margin:"0 auto"}},o.createElement(i.Fade,{in:!!P,style:P?{top:"50%",left:"50%",transform:"translate( calc(-50% + 75px), -50%)",width:160}:{display:"none"},timeout:2e3},o.createElement(i.Alert,{severity:"warning",icon:!1,sx:function(e){return{width:150,mx:"auto",justifyContent:"center"}}},o.createElement(i.Typography,{variant:"h6",textAlign:"center"},y(P).format("DD.MM.YYYY"))))),o.createElement(i.CardContent,{className:v.messageListOuter,ref:Y,onScroll:V},o.createElement(i.List,{className:v.messageList},_&&o.createElement(i.ListItem,{ref:H,sx:{justifyContent:"center"}},o.createElement(i.CircularProgress,null)),w.map((function(t,r){return o.createElement(Ne,{ref:t.ref,key:r,apiUrl:s,user:u,message:t,owner:d[t.userId],isGroupMessage:!(null==m||!m.groupId),isUserFirst:0===r||"notify"===w[r-1].messageType||w[r-1].userId!==w[r].userId,isUserLast:r===w.length-1||"notify"===w[r+1].messageType||w[r+1].userId!==w[r].userId,onContextMenu:function(r){return function(t,r){var n="text"===t.messageType,a=u.userId===t.userId&&!!e.onMessageDelete&&(new Date).getTime()-new Date(t.cdate).getTime()<=12e4;n||a?(r.preventDefault(),E({message:t,mouseX:r.clientX-2,mouseY:r.clientY-4,canCopy:n,canDelete:a})):E(g)}(t,r)},setViewerData:S})}))),A&&o.createElement(i.Box,{className:v.arrowDown,textAlign:"center"},o.createElement(i.Fab,{color:"info","aria-label":"add",size:"medium",onClick:function(){return z()}},o.createElement(k,null)),null!=L&&L.length>0&&o.createElement(i.Fab,{color:"warning","aria-label":"add",size:"small",sx:{width:24,height:24,minHeight:24,position:"relative",top:-10,pointerEvents:"none"}},o.createElement(i.Typography,{variant:"body2",sx:function(e){return{color:e.palette.background.default}}},L.length))),I.visible&&o.createElement(i.Backdrop,{sx:{color:"#fff",zIndex:function(e){return e.zIndex.drawer+1}},open:I.visible,onClick:function(){S({visible:!1,src:""})}},o.createElement("img",{src:I.src,className:v.img,alt:""}))))},Ge=c.makeStyles((function(e){return c.createStyles({root:{width:"100%",minWidth:360,height:"100%",display:"flex",flexDirection:"column"},roomHeader:{flex:1},flexAll:{flex:"1 1 auto"},flexEnd:{justifyContent:"flex-end"}})})),De={message:null,mouseX:null,mouseY:null,canCopy:!1,canDelete:!1},Me=function(e){var t=e.apiUrl,r=e.user,n=e.users,c=e.chat,m=e.typing,f=e.conference,E=e.visitData,g=e.conferenceJoined,h=e.loading,v=e.pageSize,y=e.isMobile,C=Ge(),T=p.useTranslation().t,I=o.useState(De),S=I[0],R=I[1],A=a.useCallback((function(){var e=S.message;R(De),e&&navigator.clipboard.writeText(e.content)}),[S.message]),x=a.useCallback((function(){var t=S.message;R(De),e.onMessageDelete&&c&&t&&e.onMessageDelete(c,t)}),[S.message]);return console.log("conference ",f),o.createElement(i.Card,{elevation:1,className:C.root},o.createElement(i.Box,{display:"flex",flexDirection:"row"},c&&y&&o.createElement(i.Box,{sx:{position:"absolute",overflow:"hidden",top:null!=r&&r.role&&[3,4].includes(r.role)?-56:-12,left:null!=r&&r.role&&[3,4].includes(r.role)?32:218}},o.createElement(i.Box,{display:"flex",flexDirection:"row",columnGap:3,my:3,sx:{position:"relative"}},o.createElement(i.IconButton,{"aria-label":"exit room",sx:{color:"#fff",background:"#000","&:hover":{background:"#eee",color:"#000",boxShadow:"none"}},onClick:function(){return e.onExitRoom&&e.onExitRoom(c)}},o.createElement(null!=f&&f.id?u:d,null)))),o.createElement(Ce,{apiUrl:t,user:r,chat:c,typing:m,conference:f,visitData:E,conferenceJoined:g,operators:e.operators,className:C.roomHeader,onVideoCall:e.onVideoCall,onVideoEnd:e.onVideoEnd,onConferencePause:e.onConferencePause,onOperatorAdd:e.onOperatorAdd,onLeaveGroup:e.onLeaveGroup,onContactClick:e.onContactClick})),o.createElement(i.Divider,null),o.createElement(we,{apiUrl:t,user:r,users:n,chat:c,loading:h,pageSize:v,initialMenuState:De,onNeedMoreMessages:e.onNeedMoreMessages,onMessageDelete:e.onMessageDelete,setMenuState:R}),o.createElement(i.Divider,null),o.createElement(i.CardContent,null,o.createElement(q,{chat:c,onTyping:e.onTyping,onSendMessage:e.onSendMessage})),o.createElement(i.Menu,{keepMounted:!0,open:null!==S.mouseY,onClose:function(){R(De)},anchorReference:"anchorPosition",anchorPosition:null!==S.mouseY&&null!==S.mouseX?{top:S.mouseY,left:S.mouseX}:void 0},o.createElement(i.MenuItem,{onClick:A,disabled:!S.canCopy},o.createElement("span",{className:C.flexAll},T("CHAT.MESSAGE.MENU.COPY")),o.createElement(i.ListItemIcon,{className:C.flexEnd},o.createElement(l,{fontSize:"small"}))),o.createElement(i.MenuItem,{onClick:x,disabled:!S.canDelete},o.createElement("span",{className:C.flexAll},T("CHAT.MESSAGE.MENU.DELETE")),o.createElement(i.ListItemIcon,{className:C.flexEnd},o.createElement(s,{fontSize:"small"})))))},Le=(function(e){var t=function(e){var t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",i=n.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var a=Object.create((t&&t.prototype instanceof d?t:d).prototype),o=new S(n||[]);return a._invoke=function(e,t,r){var n="suspendedStart";return function(a,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===a)throw o;return{value:void 0,done:!0}}for(r.method=a,r.arg=o;;){var i=r.delegate;if(i){var c=C(i,r);if(c){if(c===u)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var l=s(e,t,r);if("normal"===l.type){if(n=r.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n="completed",r.method="throw",r.arg=l.arg)}}}(e,r,o),a}function s(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function d(){}function m(){}function p(){}var f={};c(f,a,(function(){return this}));var E=Object.getPrototypeOf,g=E&&E(E(R([])));g&&g!==t&&r.call(g,a)&&(f=g);var h=p.prototype=d.prototype=Object.create(f);function v(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){var n;this._invoke=function(a,o){function i(){return new t((function(n,i){!function n(a,o,i,c){var l=s(e[a],e,o);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==typeof d&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,i,c)}),(function(e){n("throw",e,i,c)})):t.resolve(d).then((function(e){u.value=e,i(u)}),(function(e){return n("throw",e,i,c)}))}c(l.arg)}(a,o,n,i)}))}return n=n?n.then(i,i):i()}}function C(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,C(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var n=s(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,u;var a=n.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function R(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:A}}function A(){return{value:void 0,done:!0}}return m.prototype=p,c(h,"constructor",p),c(p,"constructor",m),m.displayName=c(p,i,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,c(e,i,"GeneratorFunction")),e.prototype=Object.create(h),e},e.awrap=function(e){return{__await:e}},v(y.prototype),c(y.prototype,o,(function(){return this})),e.AsyncIterator=y,e.async=function(t,r,n,a,o){void 0===o&&(o=Promise);var i=new y(l(t,r,n,a),o);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},v(h),c(h,i,"Generator"),c(h,a,(function(){return this})),c(h,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=R,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(I),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return i.type="throw",i.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],i=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var c=r.call(o,"catchLoc"),l=r.call(o,"finallyLoc");if(c&&l){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),I(r),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;I(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:R(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),u}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}}(_e={exports:{}}),_e.exports),Ue=c.makeStyles((function(e){return c.createStyles({main:{flex:"1 1 auto",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},time:{paddingLeft:e.spacing(1),justifyContent:"flex-end",whiteSpace:"nowrap"},unread:{justifyContent:"flex-end",maxHeight:20},avatarGroup:{backgroundColor:"#28B7C6",color:"#fff"}})})),Pe=c.withStyles((function(e){return c.createStyles({badge:{backgroundColor:"#44b700",color:"#44b700",boxShadow:"0 0 0 2px "+e.palette.background.paper,"&::after":{position:"absolute",top:0,left:0,width:"100%",height:"100%",borderRadius:"50%",animation:"$ripple 1.2s infinite ease-in-out",border:"1px solid currentColor",content:'""'}},"@keyframes ripple":{"0%":{transform:"scale(.8)",opacity:1},"100%":{transform:"scale(2.4)",opacity:0}}})}))(i.Badge),je=c.withStyles((function(e){return c.createStyles({badge:{backgroundColor:e.palette.primary.main,boxShadow:"0 0 0 2px "+e.palette.background.paper}})}))(i.Badge),Fe=function(e){var t=Ue(),r=p.useTranslation().t,n=e.apiUrl,a=e.chat,c=e.typing,l=re(a),s=a.groupId?o.createElement(i.Avatar,{alt:l,className:t.avatarGroup},o.createElement(f,null)," "):function(e,t,r){var n=o.createElement(i.Avatar,{alt:t.username,src:t.avatar?oe(e,t.avatar):""});return null!=r&&r.contactId&&(null==r?void 0:r.userId)===t.userId?o.createElement(Pe,{overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"dot"},n):null!=t&&t.online?o.createElement(je,{overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"dot"},n):n}(n,a,c),u=a.messages&&a.messages.length>0?a.messages[a.messages.length-1]:null,d=function(e,t){if(!e)return null;switch(e.messageType){case"text":return e.content;case"image":return"["+t("CHAT.MESSAGE.TYPE.IMAGE")+"]";case"video":return"["+t("CHAT.MESSAGE.TYPE.VIDEO")+"]";case"file":return"["+t("CHAT.MESSAGE.TYPE.FILE")+"]";case"notify":return"["+t("CHAT.MESSAGE.TYPE.NOTIFY")+"]";default:return null}}(u,r),m=null==u?void 0:u.cdate;return o.createElement(i.ListItemButton,{selected:e.active,onClick:e.onClick},o.createElement(i.ListItemAvatar,null,s),o.createElement(i.ListItemText,{secondaryTypographyProps:{component:"span"},primary:o.createElement(i.Box,{display:"flex",flexDirection:"row"},o.createElement("span",{className:t.main},l),o.createElement("span",{className:t.time},ee(m))),secondary:o.createElement(i.Box,{display:"flex",flexDirection:"row"},o.createElement("span",{className:t.main},d),a.unreadCount?o.createElement(i.Chip,{className:t.unread,component:"span",size:"small",color:"primary",label:a.unreadCount}):null)}))},He={userId:0,username:"",password:"",avatar:"",langCode:""},Be={user:He,token:"",refreshToken:"",activeRoom:null,chatOld:null,groupGather:{},userGather:{},contactGather:{},operators:[],initialContactId:null,conference:{data:null,joined:!1,ringPlayed:!1},typing:null,loading:!1,error:void 0,success:void 0,visitData:[]},Ve=function(e){return e.activeRoom?e.groupGather[e.activeRoom.groupId]||e.contactGather[e.activeRoom.userId]:null},ze=function(e){var t=e.initialContactId,r=null;if(t)r=e.contactGather[t];else if(e.activeRoom)r=Ve(e);else{var n=[].concat(Object.values(e.contactGather),Object.values(e.groupGather)).sort(ne);n.length>0&&(r=n[0])}return r},Ye=function(e,t,r){var n=J({},e);e.contactGather[t]&&(n.contactGather[t]=J({},n.contactGather[t],{online:r}));for(var a=0,o=Object.values(e.groupGather);a<o.length;a++){var i=o[a];if(i.members){var c=i.members.find((function(e){return e.userId===t}));if(c){var l=i.members.indexOf(c);i.members[l]=J({},c,{online:r})}}}var s=n.operators.findIndex((function(e){return e.userId===t}));return-1!==s&&(n.operators[s]=J({},n.operators[s],{online:r})),n.activeRoom=Ve(n),n},qe=function(e,t,r){var n=J({},e);return n.contactGather[t]&&(n.contactGather[t]=J({},n.contactGather[t],{unreadCount:r(n.contactGather[t].unreadCount)})),n.activeRoom=Ve(n),n},We=function(e,t,r){var n=J({},e);return n.groupGather[t]&&(n.groupGather[t]=J({},n.groupGather[t],{unreadCount:r(n.groupGather[t].unreadCount)})),n.activeRoom=Ve(n),n};function Ke(e,t){var r,n,a;switch(t.type){case"SET_GROUP_GATHER":return J({},e,{groupGather:J({},e.groupGather,(r={},r[t.payload.groupId]=t.payload,r))});case"SET_CONTACT_GATHER":return J({},e,{contactGather:J({},e.contactGather,(n={},n[t.payload.userId]=t.payload,n))});case"DEL_GROUP":return function(e,t){var r=J({},e),n=r.activeRoom===r.groupGather[t];return delete r.groupGather[t],n&&(r.activeRoom=ze(r)),r}(e,t.payload);case"DEL_GROUP_MEMBER":return function(e,t){var r,n=J({},e),a=n.groupGather[t.groupId];return a&&(a.members=null==(r=a.members)?void 0:r.filter((function(e){return e.userId!==t.userId}))),n}(e,t.payload);case"DEL_CONTACT":return function(e,t){var r=J({},e),n=r.activeRoom===r.contactGather[t];return delete r.contactGather[t],n&&(r.activeRoom=ze(r)),r}(e,t.payload.userId);case"SET_USER_GATHER":return J({},e,{userGather:J({},e.userGather,(a={},a[t.payload.userId]=t.payload,a))});case"UPDATE_ACTIVE_ROOM":return J({},e,{activeRoom:ze(e)});case"SET_ACTIVE_ROOM":return function(e,t){return J({},e,{chatOld:null!=e.activeRoom?J({},e.activeRoom):null,activeRoom:t.groupId?e.groupGather[t.groupId]:t.contactId?e.contactGather[t.contactId]:null})}(e,t.payload);case"USER_ONLINE":return Ye(e,t.payload,1);case"USER_OFFLINE":return Ye(e,t.payload,0);case"ADD_GROUP_MESSAGE":return function(e,t){var r=J({},e),n=t.groupId;r.groupGather[n]&&(r.groupGather[n].messages?r.groupGather[n].messages=[].concat(r.groupGather[n].messages,[t]):r.groupGather[n]=J({},e.groupGather[n],{messages:[t]}));var a=r.activeRoom;return a&&a.groupId!==n&&t.userId!==e.user.userId?We(r,n,(function(e){return(e||0)+1})):(r.activeRoom=Ve(r),r)}(e,t.payload);case"ADD_PRIVATE_MESSAGE":return function(e,t){var r,n=J({},e),a=t.contactId===e.user.userId?t.userId:t.contactId;return n.contactGather[a].messages?n.contactGather[a].messages=[].concat(n.contactGather[a].messages,[t]):n.contactGather[a]=J({},n.contactGather[a],{messages:[t]}),(null==(r=n.activeRoom)?void 0:r.userId)!==a&&t.userId!==e.user.userId?qe(n,a,(function(e){return(e||0)+1})):(n.activeRoom=Ve(n),n)}(e,t.payload);case"ADD_GROUP_UNREAD_GATHER":return We(e,t.payload,(function(e){return(e||0)+1}));case"ADD_CONTACT_UNREAD_GATHER":return qe(e,t.payload,(function(e){return(e||0)+1}));case"SET_TYPING":return J({},e,{typing:t.payload});case"LOSE_GROUP_UNREAD_GATHER":return We(e,t.payload,(function(){return 0}));case"LOSE_CONTACT_UNREAD_GATHER":return qe(e,t.payload,(function(){return 0}));case"REVOKE_MESSAGE":return function(e,t){var r=e.user.userId,n=J({},e),a=t.username||n.userGather[t.userId].username;if(t.groupId){var o=n.groupGather[t.groupId].messages;if(o){var i=o.find((function(e){return e._id===t._id}));if(i){var c=o.indexOf(i);o[c]=J({},i,{isRevoke:!0,revokeUserName:a})}}}else{var l=n.contactGather[t.contactId===r?t.userId:t.contactId].messages;if(l){var s=l.find((function(e){return e._id===t._id}));if(s){var u=l.indexOf(s);l[u]=J({},s,{isRevoke:!0,revokeUserName:a})}}}return n.activeRoom=Ve(n),n}(e,t.payload);case"UPDATE_GROUP_INFO":return function(e,t){var r=J({},e),n=t.groupId,a=r.groupGather[n];return a&&(r.groupGather[n]=J({},a,{name:t.name,notice:t.notice})),r.activeRoom=Ve(r),r}(e,t.payload);case"UPDATE_USER_INFO":return function(e,t){var r=J({},e),n=t.userId,a=t.username,o=t.avatar;return r.userGather[n]&&(r.userGather[n]=J({},r.userGather[n],{username:a,avatar:o})),r.contactGather[n]&&(r.contactGather[n]=J({},r.contactGather[n],{username:a,avatar:o})),r.activeRoom=Ve(r),r}(e,t.payload);case"ADD_GROUP_MEMBER":return function(e,t){var r=t.members.map((function(e){return J({},e,{isManager:0})})),n=J({},e);return n.groupGather[t.groupId].members&&r?n.groupGather[t.groupId].members=[].concat(e.groupGather[t.groupId].members,r):n.groupGather[t.groupId]=J({},n.groupGather[t.groupId],{members:r}),n.activeRoom=Ve(n),n}(e,t.payload);case"SET_CONFERENCE":return function(e,t){return J({},e,{conference:{data:J({},t),joined:(null==t?void 0:t.userId)===e.user.userId,ringPlayed:(null==t?void 0:t.userId)!==e.user.userId}})}(e,t.payload);case"JOIN_CONFERENCE":return J({},e,{conference:{data:J({},t.payload),joined:!0,ringPlayed:!1}});case"PAUSE_CONFERENCE":return function(e,t){var r;return(null==(r=e.conference.data)?void 0:r.id)!==(null==t?void 0:t.id)?e:J({},e,{conference:{data:J({},e.conference.data),joined:!1,ringPlayed:!1}})}(e,t.payload);case"STOP_CONFERENCE":return function(e,t){var r;return(null==(r=e.conference.data)?void 0:r.id)!==(null==t?void 0:t.id)?e:J({},e,{conference:{data:null,joined:!1,ringPlayed:!1}})}(e,t.payload);case"MARK_PRIVATE_MESSAGES_READ":return function(e,t){var r=J({},e);if(r.contactGather[t]){var n=J({},r.contactGather[t]);if(n.messages)for(var a=0;a<n.messages.length;a++)n.messages[a]=J({},n.messages[a],{status:1});r.contactGather[t]=n}if(r.activeRoom=Ve(r),null!=r.activeRoom&&r.activeRoom.messages)for(var o=0;o<r.activeRoom.messages.length;o++)r.activeRoom.messages[o]=J({},r.activeRoom.messages[o],{status:1});return r}(e,t.payload);case"ADD_PRIVATE_MESSAGES":return function(e,t){var r=J({},e),n=t.messages,a=t.contactId;return r.contactGather[a]&&(r.contactGather[a]=J({},r.contactGather[a],{messages:[].concat(n||[],r.contactGather[a].messages||[]),noMoreData:null==n||!n.length||(null==n?void 0:n.length)<t.pageSize})),r.activeRoom=Ve(r),r}(e,t.payload);case"ADD_GROUP_MESSAGES":return function(e,t){var r=J({},e),n=t.groupId,a=t.messages,o=t.userArr;r.groupGather[n]&&(r.groupGather[n]=J({},r.groupGather[n],{messages:[].concat(a||[],r.groupGather[n].messages||[]),noMoreData:null==a||!a.length||(null==a?void 0:a.length)<t.pageSize})),r.userGather=J({},r.userGather);for(var i,c=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return Q(e,void 0);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Q(e,void 0):void 0}}(e))){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(o);!(i=c()).done;){var l=i.value;r.userGather[l.userId]||(r.userGather[l.userId]=l)}return r.activeRoom=Ve(r),r}(e,t.payload);case"SET_LOADING":return J({},e,{loading:t.payload,error:""});case"SET_ERROR":return J({},e,{error:t.payload,success:void 0});case"SET_SUCCES":return J({},e,{success:t.payload,error:void 0});case"SET_TOKEN":return function(e,t){return J({},e,{token:t})}(e,t.payload);case"SET_USER":return J({},e,{user:t.payload});case"CLEAR_USER":return function(e){return J({},e,{token:"",user:He})}(e);case"CLEAR_CHAT_DATA":return J({},e,{activeRoom:null,groupGather:{},userGather:{},contactGather:{},conference:{data:null,joined:!1,ringPlayed:!1},typing:null});case"SET_OPERATORS":return J({},e,{operators:t.payload});case"SET_VISIT_DATA":return J({},e,{visitData:t.payload})}return e}var $e=o.createContext({state:Be,dispatch:function(){return null}}),Je=function(e){He.langCode=e.defLang;var t=J({},Be,{token:e.token,refreshToken:e.token}),r=o.useReducer(Ke,t),n=r[0],i=r[1],c=a.useMemo((function(){return{state:n,dispatch:i}}),[n]);return o.createElement($e.Provider,{value:c},e.children)},Xe=a.createContext({});function Qe(){localStorage.removeItem("authToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("user"),localStorage.removeItem("doctor"),localStorage.removeItem("chatUser")}var Ze=function(){var e=$(Le.mark((function e(){return Le.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,M.post("auth/logout");case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.log("ERROR Logout",e.t0);case 8:Qe(),window.location.href="/";case 10:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(){return e.apply(this,arguments)}}(),et=function(){var e=$(Le.mark((function e(t,r,n){var a;return Le.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,M.post("auth/refreshToken",{authToken:t,refreshToken:r});case 3:a=e.sent.data,localStorage.setItem("authToken",null==a?void 0:a.authToken),localStorage.setItem("refreshToken",null==a?void 0:a.refreshToken),window.location.href="/",e.next=15;break;case 10:e.prev=10,e.t0=e.catch(0),console.log("ERROR RefreshToken",e.t0),n({type:"CLEAR_USER"}),Ze();case 15:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,r,n){return e.apply(this,arguments)}}(),tt=function(e){var t=e.baseURLApi,r=e.pageSize,n=e.children,i=a.useContext($e),c=i.state,l=i.dispatch,s=M.create({timeout:6e4,baseURL:t,headers:{"Cache-Control":"no-cache",Pragma:"no-cache",Authorization:"Bearer "+c.token},withCredentials:!1});s.interceptors.response.use((function(e){return e}),(function(e){return console.log("ERROR AxiosError"),function(e){null!=e.response&&401===e.response.status&&et(c.token,c.refreshToken,l)}(e),Promise.reject(e)}));var u=a.useCallback(function(){var e=$(Le.mark((function e(t,n){var a,o,i,c;return Le.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.userId,i=null==(a=t.messages)?void 0:a.length,e.prev=2,l({type:"SET_LOADING",payload:!0}),e.next=6,s.get("/contact/messages",{params:{contactId:o,current:i,pageSize:r}});case 6:(c=e.sent.data)&&(l({type:"ADD_PRIVATE_MESSAGES",payload:{pageSize:r,contactId:o,messages:c}}),n&&n()),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(2),l({type:"SET_ERROR",payload:e.t0.message});case 15:return e.prev=15,l({type:"SET_LOADING",payload:!1}),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[2,11,15,18]])})));return function(t,r){return e.apply(this,arguments)}}(),[l]),d=a.useCallback(function(){var e=$(Le.mark((function e(t){var n,a,o,i;return Le.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.groupId,o=null==(n=t.messages)?void 0:n.length,e.prev=2,l({type:"SET_LOADING",payload:!0}),e.next=6,s.get("/group/messages",{params:{groupId:a,current:o,pageSize:r}});case 6:(i=e.sent.data)&&l({type:"ADD_GROUP_MESSAGES",payload:J({pageSize:r,groupId:a},i)}),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(2),l({type:"SET_ERROR",payload:e.t0.message});case 15:return e.prev=15,l({type:"SET_LOADING",payload:!1}),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[2,11,15,18]])})));return function(t){return e.apply(this,arguments)}}(),[l]),m=function(){var e=$(Le.mark((function e(t,r){var n;return Le.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.get("/contact/find",{params:{mmkId:t,guid:r}});case 3:if(null==(n=e.sent.data)){e.next=7;break}return e.abrupt("return",n);case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.log("err getUserByMmk",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r){return e.apply(this,arguments)}}(),p=a.useMemo((function(){return{apiUrl:t,pageSize:r,fetch:s,getPrivateMessages:u,getGroupMessages:d,getUserByMmk:m}}),[t,r]);return o.createElement(Xe.Provider,{value:p},n)},rt=c.makeStyles((function(e){return{root:{width:"100%",height:"100%"},searchField:{width:"100%"},listStyle:{height:"89.5%",overflowY:"auto",scrollbarWidth:"thin",scrollbarColor:e.palette.primary.light+" #fff"}}})),nt=function(e,t){if(!t)return e;var r=t.toLowerCase();return e.filter((function(e){return re(e).toLowerCase().includes(r)}))},at=function(e,t,r){var n=[].concat(t,r);n=n.sort(ne);var a=localStorage.getItem(e+"-topChatId");if(a){var o=n.find((function(e){return te(e)===a}));o&&(n=n.filter((function(e){return te(e)!==a})),o.isTop=!0,n.unshift(o))}return n},ot=function(e){var t=e.user,r=e.activeRoom,n=e.groups,c=e.contacts,l=e.typing,s=e.onChangeChat,u=e.activeChatUserId,d=e.activeGroupId,m=rt(),f=p.useTranslation().t,E=a.useContext(Xe),g=E.apiUrl,h=E.getUserByMmk,v=at(t.userId,nt(n,null),nt(c,null)),y=a.useState(v),C=y[0],T=y[1];return a.useEffect((function(){Z(v)||T(v)}),[v]),a.useEffect((function(){if(null!=u&&!Z(c)){var e=Object.values(c).find((function(e){return e.userId===u}));null!=e&&s(e)}var t=ae("mmk"),r=ae("guid");if(null==t&&null==r||Z(c)||function(){var e=$(Le.mark((function e(){var n,a;return Le.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h(t,r);case 2:null!=(n=e.sent)&&null!=(a=Object.values(c).find((function(e){return e.userId===n})))&&s(a);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()(),null!=d&&!Z(n)){var a=Object.values(n).find((function(e){return e.groupId===d}));null!=a&&s(a)}}),[]),o.createElement(i.Card,{elevation:1,className:m.root},o.createElement(i.CardHeader,{title:o.createElement(i.TextField,{className:m.searchField,label:f("CHAT.INPUT_SEARCH_CONTACT"),variant:"outlined",size:"small",fullWidth:!0,onChange:function(e){T(at(t.userId,nt(n,e.target.value),nt(c,e.target.value)))}})}),o.createElement(i.Divider,null),o.createElement(D,{"aria-label":"rooms",className:m.listStyle},C.map((function(e){return o.createElement(Fe,{key:te(e),apiUrl:g,chat:e,active:e===r,typing:l,onClick:function(){return null!=s&&s(e)}})}))))},it=c.makeStyles((function(){return{root:{width:"100%",height:"100%",borderRadius:4}}})),ct=function(e){var t,r,n,i,c=e.conference,l=e.onClose,s=e.langCode,u=void 0===s?"en":s,d=it(),m=o.useRef(null),p=null!=c&&c.url&&u?(t=null==c?void 0:c.url,r="ru"===(i=u)?"rus":"fr"===i?"fra":"en"===i?"eng":"",n=new RegExp("(lang=)[^&]+"),t.replace(n,"$1"+r)):"";return a.useEffect((function(){var e=function(e){var t;e.source===(null==(t=m.current)?void 0:t.contentWindow)&&["notSupported","connectionFail","callFail","hangUp","remoteHangUp"].includes(e.data.type)&&l(c)};return window.addEventListener("message",e),function(){window.removeEventListener("message",e)}}),[null==c?void 0:c.id,u]),o.createElement("iframe",{title:"conference",className:d.root,src:p,allowFullScreen:!0,allow:"microphone; camera; autoplay; display-capture",ref:m})},lt=c.makeStyles((function(){return{root:{width:"100%",height:"100%",borderRadius:8,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},pulse:{height:100,width:100,borderRadius:"50%",display:"flex",justifyContent:"center",alignItems:"center",position:"relative","&::before":{content:"''",position:"absolute",border:"1px solid green",width:"calc(100% + 40px)",height:"calc(100% + 40px)",borderRadius:"50%",animation:"$pulse 1s linear infinite"},"&::after":{content:"''",position:"absolute",border:"1px solid green",width:"calc(100% + 40px)",height:"calc(100% + 40px)",borderRadius:"50%",animation:"$pulse 1s linear infinite",animationDelay:"0.3s"}},avatar:{width:"80%",height:"80%"},footer:{width:"100%",alignSelf:"flex-end",paddingTop:64,display:"flex",justifyContent:"center"},"@keyframes pulse":{"0%":{transform:"scale(0.5)",opacity:0},"50%":{transform:"scale(1)",opacity:1},"100%":{transform:"scale(1.3)",opacity:0}}}})),st=function(e){var t=e.conference,r=e.contact,n=e.apiUrl,a=e.onAccept,c=lt(),l=p.useTranslation().t;return o.createElement(i.Paper,{className:c.root},o.createElement("div",{className:c.pulse},o.createElement(i.Avatar,r?{className:c.avatar,alt:r.username,src:r.avatar?oe(n,r.avatar):""}:{className:c.avatar})),o.createElement("div",{className:c.footer},o.createElement(i.Button,{variant:"contained",color:"primary",onClick:function(){return a(t)}},l("CHAT.CONFERENCE.JOIN"))))};function ut(e,t,r,n){void 0===n&&(n=[]),a.useEffect((function(){if(e){var n=function(e){e.code?console.error("Error in "+t+":",e.msg):r(e.data)};return e.on(t,n),function(){e.off(t,n)}}}),[null==e?void 0:e.id].concat(n))}var dt=a.createContext({online:!1}),mt=function(e){var t=e.wsUrl,r=e.wsPath,n=e.children,i=a.useContext($e),c=i.state,l=i.dispatch,s=function(e,t,r){var n=a.useState(null),o=n[0],i=n[1],c=a.useCallback((function(){var n=L(e,{path:t,reconnection:!0,extraHeaders:{Authorization:"Bearer "+r}});i(n)}),[e,t,r]),l=a.useCallback((function(){null==o||o.disconnect(),i(null)}),[o]),s=a.useState(!1),u=s[0],d=s[1];return a.useEffect((function(){d(!(null==o||!o.connected))}),[o]),a.useEffect((function(){null==o||o.on("connect",(function(){d(!0),o.emit("chatData")}))}),[o]),a.useEffect((function(){null==o||o.on("disconnect",(function(){d(!1)}))}),[o]),{socket:o,online:u,disconnectSocket:l,connectSocket:c}}(t,r,c.token),u=s.socket,d=s.online,m=s.disconnectSocket,p=s.connectSocket;a.useMemo((function(){return function(e,t,r){return{handleChatData:function(r){e({type:"CLEAR_CHAT_DATA"}),e({type:"SET_USER",payload:r.user}),r.groupData.forEach((function(r){null==t||t.emit("joinGroupSocket",{groupId:r.groupId}),e({type:"SET_GROUP_GATHER",payload:r})})),r.contactData.forEach((function(r){null==t||t.emit("joinPrivateSocket",{contactId:r.userId}),e({type:"SET_CONTACT_GATHER",payload:r})})),e({type:"SET_OPERATORS",payload:r.operatorData}),r.userData.forEach((function(t){return e({type:"SET_USER_GATHER",payload:t})})),e({type:"UPDATE_ACTIVE_ROOM"}),e({type:"SET_CONFERENCE",payload:r.conferenceData}),e({type:"SET_VISIT_DATA",payload:r.visitData})},handleGroupMessage:function(n){e({type:"ADD_GROUP_MESSAGE",payload:n});var a=r.activeRoom;a&&a.groupId===n.groupId&&n.userId!==r.user.userId&&(null==t||t.emit("markAsRead",{groupId:n.groupId,_id:n._id}))},handlePrivateMessage:function(n){var a;n.contactId!==r.user.userId&&n.userId!==r.user.userId||(e({type:"ADD_PRIVATE_MESSAGE",payload:n}),r.activeRoom&&!r.activeRoom.groupId&&(null==(a=r.activeRoom)?void 0:a.userId)===n.userId&&(null==t||t.emit("markAsRead",{contactId:n.userId,_id:n._id})))}}}(l,u,c)}),[l,u,c]),a.useEffect((function(){return c.token?p():m(),function(){return m()}}),[c.token]),ut(u,"unauthorized",(function(e){console.log("unauthorized msg",e),et(c.token,c.refreshToken,l)})),ut(u,"chatData",(function(e){l({type:"CLEAR_CHAT_DATA"}),l({type:"SET_USER",payload:e.user}),e.groupData.forEach((function(e){null==u||u.emit("joinGroupSocket",{groupId:e.groupId}),l({type:"SET_GROUP_GATHER",payload:e})})),e.contactData.forEach((function(e){null==u||u.emit("joinPrivateSocket",{contactId:e.userId}),l({type:"SET_CONTACT_GATHER",payload:e})})),l({type:"SET_OPERATORS",payload:e.operatorData}),e.userData.forEach((function(e){return l({type:"SET_USER_GATHER",payload:e})})),l({type:"UPDATE_ACTIVE_ROOM"}),l({type:"SET_CONFERENCE",payload:e.conferenceData}),l({type:"SET_VISIT_DATA",payload:e.visitData})})),ut(u,"userOnline",(function(e){l({type:"USER_ONLINE",payload:e})})),ut(u,"userOffline",(function(e){l({type:"USER_OFFLINE",payload:e})})),ut(u,"joinPrivateSocket",(function(){console.log("Ð£ÑÐ¿ÐµÑˆÐ½Ð¾ Ð²Ð¾ÑˆÐµÐ» Ð² Ð¿Ñ€Ð¸Ð²Ð°Ñ‚Ð½Ñ‹Ð¹ Ñ‡Ð°Ñ‚")})),ut(u,"typing",(function(e){l({type:"SET_TYPING",payload:e}),setTimeout((function(){l({type:"SET_TYPING",payload:null})}),1e3)})),ut(u,"revokeMessage",(function(e){l({type:"REVOKE_MESSAGE",payload:e})})),ut(u,"groupMessage",(function(e){l({type:"ADD_GROUP_MESSAGE",payload:e});var t=c.activeRoom;t&&t.groupId===e.groupId&&e.userId!==c.user.userId&&(null==u||u.emit("markAsRead",{groupId:e.groupId,_id:e._id}))}),[c.activeRoom,c.user.userId]),ut(u,"privateMessage",(function(e){var t;e.contactId!==c.user.userId&&e.userId!==c.user.userId||(l({type:"ADD_PRIVATE_MESSAGE",payload:e}),c.activeRoom&&!c.activeRoom.groupId&&(null==(t=c.activeRoom)?void 0:t.userId)===e.userId&&(null==u||u.emit("markAsRead",{contactId:e.userId,_id:e._id})))}),[c.activeRoom,c.user.userId]),ut(u,"addGroup",(function(e){l({type:"SET_GROUP_GATHER",payload:e})})),ut(u,"deleteGroup",(function(e){l(e.userId===c.user.userId?{type:"DEL_GROUP",payload:e.groupId}:{type:"DEL_GROUP_MEMBER",payload:e})}),[c.user.userId]),ut(u,"joinGroup",(function(e){var t=e.group,r=e.user;c.groupGather[t.groupId]?r.userId!==c.user.userId&&l({type:"ADD_GROUP_MEMBER",payload:{groupId:t.groupId,members:[r]}}):null==u||u.emit("chatData")}),[c.groupGather,c.user.userId]),ut(u,"joinGroupSocket",(function(e){var t,r,n=J({},e.user,{online:1,isManager:0}),a=c.groupGather[e.group.groupId];!a||null!=(t=a.members)&&t.find((function(e){return e.userId===n.userId}))||null==(r=a.members)||r.push(n),l({type:"SET_USER_GATHER",payload:n})}),[c.groupGather]),ut(u,"addContact",(function(e){l({type:"SET_CONTACT_GATHER",payload:e}),l({type:"SET_USER_GATHER",payload:e}),null==u||u.emit("joinPrivateSocket",{contactId:e.userId})})),ut(u,"deleteContact",(function(e){l({type:"DEL_CONTACT",payload:e})})),ut(u,"updateGroupInfo",(function(e){l({type:"UPDATE_GROUP_INFO",payload:e})})),ut(u,"updateUserInfo",(function(e){try{l({type:"UPDATE_USER_INFO",payload:e})}catch(e){console.error("Error updating user info:",e)}})),ut(u,"startConference",(function(e){l({type:"SET_CONFERENCE",payload:e})})),ut(u,"pauseConference",(function(e){l({type:"PAUSE_CONFERENCE",payload:e})})),ut(u,"stopConference",(function(e){l({type:"STOP_CONFERENCE",payload:e})})),ut(u,"addOperator",(function(){})),ut(u,"setActiveRoom",(function(e){l({type:"SET_ACTIVE_ROOM",payload:e})})),ut(u,"visitData",(function(e){l({type:"SET_VISIT_DATA",payload:e.visitData})}));var f=a.useMemo((function(){return{socket:u,online:d}}),[u,d]);return o.createElement(dt.Provider,{value:f},n)},pt=function(){var e=o.useContext($e),t=e.state,r=t.error,n=t.success,a=e.dispatch,c=function(){a({type:"SET_ERROR",payload:void 0}),a({type:"SET_SUCCES",payload:void 0})};return o.createElement(i.Snackbar,{anchorOrigin:{vertical:"top",horizontal:"center"},open:!!r||!!n,autoHideDuration:6e3,onClose:c},o.createElement(i.Alert,{onClose:c,severity:r?"error":"success"},r||n))},ft=c.makeStyles((function(e){var t;return{root:(t={height:"100%",overflow:"hidden",padding:0},t[e.breakpoints.up("lg")]={minWidth:1200},t)}})),Et=function(e){var t=e.children,r=ft();return o.createElement(i.Container,{maxWidth:!1,className:r.root},t)},gt=function(e){var t=e.conferenceActive,r=e.hideRooms,n=e.contactsList,a=e.chatRoom;return e.isMobile?o.createElement(o.Fragment,null,n,a):o.createElement(i.Grid,{container:!0,spacing:1,sx:{height:"100%"}},(t||!r)&&o.createElement(i.Grid,{item:!0,sm:t?6:4,lg:t?6:4,xl:t?6:3,sx:{height:"100%"}},n),o.createElement(i.Grid,{item:!0,sm:t?6:r?12:8,lg:t?6:r?12:8,xl:t?6:r?12:9,sx:{height:"100%"}},a))},ht=function(e){var t=e.audio,r=e.video,n=p.useTranslation().t,a=i.useMediaQuery((function(e){return e.breakpoints.down("md")})),c=o.useContext($e).dispatch,l=function(){navigator.mediaDevices.getUserMedia({audio:t,video:r}).then((function(e){console.log("permissions",e),c({type:"SET_SUCCES",payload:n("CHAT.CONFERENCE.ALLOK")})})).catch((function(e){var t=n("CHAT.CONFERENCE.ErrorAny");"NotFoundError"===e.name&&(t=n("CHAT.CONFERENCE.NotFoundError")),"NotAllowedError"===e.name&&(t=n("CHAT.CONFERENCE.NotAllowedError")),c({type:"SET_ERROR",payload:t}),console.log("err",e.name+" : "+e.message)}))},s=n(t&&r?"CHAT.CONFERENCE.CheckCamMic":t?"CHAT.CONFERENCE.CheckMic":"CHAT.CONFERENCE.CheckCam");return a?o.createElement(i.Tooltip,{title:s},o.createElement(i.IconButton,{sx:{color:"#fff",background:"#000","&:hover":{background:"#eee",color:"#000",boxShadow:"none"}},"aria-label":"check",onClick:function(){return l()},size:"large"},o.createElement(t&&r?P:t?j:u,null))):o.createElement(i.Button,{"aria-label":"cancel call",variant:"contained",sx:{color:"#fff",background:"#000","&:hover":{background:"#eee",color:"#000",boxShadow:"none"}},size:"small",startIcon:o.createElement(t&&r?P:t?j:u,null),onClick:function(){return l()}},s)},vt=function(e){var t=e.isMobile,r=e.user,n=e.onBackToChat,o=p.useTranslation().t;return a.createElement(i.Box,{sx:function(e){var t;return(t={position:"absolute",overflow:"hidden",top:null!=r&&r.role&&[3,4].includes(r.role)?50:110,left:null!=r&&r.role&&[3,4].includes(r.role)?50:30,zIndex:1e3})[e.breakpoints.down("sm")]={top:98,left:26},t}},a.createElement(i.Box,{display:"flex",flexDirection:"row",columnGap:3,my:3,sx:{position:"relative"}},a.createElement(ht,{audio:!0,video:!1}),a.createElement(ht,{audio:!1,video:!0}),t&&a.createElement(i.Tooltip,{title:o("CHAT.CONFERENCE.BACK")},a.createElement(i.IconButton,{sx:{color:"#fff",background:"#000","&:hover":{background:"#eee",color:"#000",boxShadow:"none"}},onClick:n,size:"large"},a.createElement(U,null)))))},yt=function(e){var t=e.conference,r=e.onAccept,n=e.isMobile,o=e.user,i=e.chatOld,c=e.onChangeChat,l=e.apiUrl;return t.data?t.joined?a.createElement(a.Fragment,null,a.createElement(ct,{conference:t.data,onClose:e.onClose,langCode:o.langCode}),(!i||!n)&&a.createElement(vt,{isMobile:n,user:o,onBackToChat:function(){return i&&c(i)}})):a.createElement(st,{apiUrl:l,contact:o.userId===t.data.userId?t.data.contactId:t.data.userId,conference:t.data,onAccept:r}):null},Ct=["activeGroupId","activeChatUserId","hideRooms","fullWidth"],Tt=function(e){return"groupId"in e},It=function(e){var t,r,n=e.activeGroupId,o=e.activeChatUserId,c=e.hideRooms,l=void 0!==c&&c,s=X(e,Ct),u=i.useMediaQuery((function(e){return e.breakpoints.down("sm")})),d=a.useContext($e),m=d.state,p=d.dispatch,f=a.useContext(dt).socket,E=a.useContext(Xe),g=E.apiUrl,h=E.pageSize,v=E.getPrivateMessages,y=E.getGroupMessages,C=a.useCallback((function(){p({type:"SET_ACTIVE_ROOM",payload:{}})}),[p]),T=a.useCallback((function(e,t){if(f)try{f.emit(e,t)}catch(t){console.error("Error emitting "+e+":",t),p({type:"SET_ERROR",payload:"Failed to send "+e})}else console.warn("Socket not connected, cannot emit "+e)}),[f,p]),I=a.useCallback(function(){var e=$(Le.mark((function e(t){return Le.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,p({type:"SET_LOADING",payload:!0}),!Tt(t)){e.next=7;break}return e.next=5,y(t);case 5:e.next=9;break;case 7:return e.next=9,v(t);case 9:e.next=15;break;case 11:e.prev=11,e.t0=e.catch(0),console.error("Failed to load messages:",e.t0),p({type:"SET_ERROR",payload:"Failed to load messages"});case 15:return e.prev=15,p({type:"SET_LOADING",payload:!1}),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[0,11,15,18]])})));return function(t){return e.apply(this,arguments)}}(),[v,y,p]),S=a.useCallback((function(e,t){T("revokeMessage",{groupId:Tt(e)?e.groupId:void 0,contactId:e.userId,_id:t._id})}),[T]),R=a.useCallback((function(e){T("typing",{groupId:Tt(e)?e.groupId:void 0,contactId:e.userId})}),[T]),A=a.useCallback((function(e,t){var r={content:t.message,width:t.width,height:t.height,fileName:t.fileName,messageType:t.messageType,size:t.size};Tt(e)?T("groupMessage",J({},r,{groupId:e.groupId})):T("privateMessage",J({},r,{contactId:e.userId}))}),[T]),x=a.useCallback((function(e){var t;if(null!=e&&null!=(t=e.messages)&&t.length&&f)try{var r=e.messages[e.messages.length-1];if(null==r||!r._id)return;Tt(e)?f.emit("markAsRead",{groupId:e.groupId,_id:r._id}):(p({type:"MARK_PRIVATE_MESSAGES_READ",payload:e.userId}),f.emit("markAsRead",{contactId:e.userId,_id:r._id}))}catch(e){console.error("Error marking messages as read:",e),p({type:"SET_ERROR",payload:"Failed to mark messages as read"})}}),[f,p]),b=a.useCallback((function(e){if(e)try{p({type:"SET_ACTIVE_ROOM",payload:{groupId:Tt(e)?e.groupId:void 0,contactId:null==e?void 0:e.userId}}),x(e)}catch(e){console.error("Error changing chat:",e),p({type:"SET_ERROR",payload:"Failed to change chat room"})}}),[p,x,f]),O=a.useCallback((function(e,t,r){T("startConference",{groupId:Tt(e)?e.groupId:void 0,contactId:e.userId,visitId:t,recreate:r})}),[T]),N=a.useCallback((function(e){null!=e&&e.id&&T("stopConference",{id:e.id})}),[T]),_=a.useCallback((function(e){null!=e&&e.id&&T("pauseConference",{id:e.id})}),[T]),k=a.useCallback((function(e){null!=e&&e.id&&(T("resumeConference",{id:e.id}),p({type:"JOIN_CONFERENCE",payload:e}))}),[T,p]),w=a.useCallback((function(e,t){T("addOperator",{groupId:e.groupId,operatorId:t.userId})}),[T]),G=a.useCallback((function(e){T("deleteGroup",{groupId:e.groupId})}),[T]),D=null!=m.activeRoom&&a.createElement(Me,{apiUrl:g,user:m.user,users:m.userGather,operators:m.operators,chat:m.activeRoom,typing:m.typing,conference:m.conference.data,visitData:m.visitData,conferenceJoined:m.conference.joined,loading:m.loading,pageSize:h,onExitRoom:C,onEnterRoom:x,onNeedMoreMessages:I,onMessageDelete:S,onTyping:R,onSendMessage:A,onVideoCall:O,onVideoEnd:N,onConferencePause:_,onOperatorAdd:w,onLeaveGroup:G,onContactClick:s.onContactInfoClick,isMobile:u});return a.createElement(Et,null,a.createElement(gt,{isMobile:u,conferenceActive:!(null==(t=m.conference.data)||!t.id),hideRooms:l,contactsList:null!=(null==(r=m.conference.data)?void 0:r.id)?a.createElement(yt,{conference:m.conference,onClose:_,onAccept:k,isMobile:u,user:m.user,chatOld:m.chatOld,onChangeChat:b,apiUrl:g}):a.createElement(ot,{user:m.user,activeRoom:m.activeRoom,groups:Object.values(m.groupGather),contacts:Object.values(m.contactGather),typing:m.typing,onChangeChat:b,activeChatUserId:o,activeGroupId:n}),chatRoom:D}),a.createElement(pt,null))};F.addResourceBundle("ru","translations",{CHAT:{STATUS:{ONLINE:"Ð² ÑÐµÑ‚Ð¸",OFFLINE:"Ð½Ðµ Ð² ÑÐµÑ‚Ð¸",TYPING:"Ð¿ÐµÑ‡Ð°Ñ‚Ð°ÐµÑ‚"},MESSAGE:{TYPE:{IMAGE:"Ð˜Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ",VIDEO:"Ð’Ð¸Ð´ÐµÐ¾",FILE:"Ð¤Ð°Ð¹Ð»",NOTIFY:"Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ðµ"},MENU:{COPY:"ÐšÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ",DELETE:"Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ"},REVOKED:{YOU:"Ð’Ñ‹ ÑƒÐ´Ð°Ð»Ð¸Ð»Ð¸ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ",CONTACT:"ÑƒÐ´Ð°Ð»Ð¸Ð»(Ð°) ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ"}},CONFERENCE:{JOIN:"ÐŸÑ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½Ð¸Ñ‚ÑŒÑÑ",START:"ÐÐ°Ñ‡Ð°Ñ‚ÑŒ",RESTART:"ÐŸÐµÑ€ÐµÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ ÐºÐ¾Ð½Ñ„ÐµÑ€ÐµÐ½Ñ†Ð¸ÑŽ",CONFIRM_RECREATE_CONF:"Ð’Ñ‹ ÑƒÐ²ÐµÑ€ÐµÐ½Ñ‹ Ñ‡Ñ‚Ð¾ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ Ð¿ÐµÑ€ÐµÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ ÐºÐ¾Ð½Ñ„ÐµÑ€ÐµÐ½Ñ†Ð¸ÑŽ?",CONFIRM_FINISH_CONF:"Ð’Ñ‹ ÑƒÐ²ÐµÑ€ÐµÐ½Ñ‹ Ñ‡Ñ‚Ð¾ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ Ð·Ð°Ð²ÐµÑ€ÑˆÐ¸Ñ‚ÑŒ ÐºÐ¾Ð½Ñ„ÐµÑ€ÐµÐ½Ñ†Ð¸ÑŽ?",PAUSE:"ÐžÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ",FINISH:"Ð—Ð°Ð²ÐµÑ€ÑˆÐ¸Ñ‚ÑŒ",BACK:"Ð’ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ Ð² Ñ‡Ð°Ñ‚",NotFoundError:"Ð—Ð°Ð¿Ñ€Ð¾ÑˆÐµÐ½Ð½Ð¾Ðµ ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð¾ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾",NotAllowedError:"Ð’ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ðµ  Ð¾Ñ‚ÐºÐ°Ð·Ð°Ð½Ð¾. Ð§Ñ‚Ð¾Ð±Ñ‹ Ñ€Ð°Ð·Ñ€ÐµÑˆÐ¸Ñ‚ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ðº ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ñƒ Ð·Ð°Ð¹Ð´Ð¸Ñ‚Ðµ Ð² Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ð°",ErrorAny:"Ð£ÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð¾ Ð½Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¾",ALLOK:"Ð’ÑÐµ OK",CheckCamMic:"ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ðº Ð¼Ð¸ÐºÑ€Ð¾Ñ„Ð¾Ð½Ñƒ Ð¸ ÐºÐ°Ð¼ÐµÑ€Ðµ",CheckMic:"ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð¼Ð¸ÐºÑ€Ð¾Ñ„Ð¾Ð½",CheckCam:"ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ ÐºÐ°Ð¼ÐµÑ€Ñƒ",UntillTheEnd:"Ð”Ð¾ Ð¾ÐºÐ¾Ð½Ñ‡Ð°Ð½Ð¸Ñ ÐºÐ¾Ð½Ñ„ÐµÑ€ÐµÐ½Ñ†Ð¸Ð¸ Ð¾ÑÑ‚Ð°Ð»Ð¾ÑÑŒ",LEFT_TIME:"ÐžÑÑ‚Ð°Ð»Ð¾ÑÑŒ"},ADD_CONTACT:"Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚",INPUT_MESSAGE:"ÐÐ°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ...",INPUT_SEARCH_CONTACT:"Ð¤Ð°Ð¼Ð¸Ð»Ð¸Ñ Ð˜Ð¼Ñ ÐžÑ‚Ñ‡ÐµÑÑ‚Ð²Ð¾",MEMBERS:"ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð²",BUT_CLOSE:"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ",BUT_CONFIRM:"Ð”Ð°"}}),F.addResourceBundle("en","translations",{CHAT:{STATUS:{ONLINE:"online",OFFLINE:"offline",TYPING:"typing"},MESSAGE:{TYPE:{IMAGE:"Image",VIDEO:"Video",FILE:"File",NOTIFY:"Notification"},MENU:{COPY:"Copy",DELETE:"Delete"},REVOKED:{YOU:"You deleted the message",CONTACT:"deleted the message"}},CONFERENCE:{JOIN:"Join",START:"Start",RESTART:"Recreate the conference",CONFIRM_RECREATE_CONF:"Are you sure you want to re-create the conference?",CONFIRM_FINISH_CONF:"Are you sure you want to end the conference?",PAUSE:"Pause",FINISH:"Finish",BACK:"Back to chat",NotFoundError:"Requested device not found",NotAllowedError:"Permission denied. To allow access to the device, go to the browser settings",ErrorAny:"The device is not configured",ALLOK:"All OK",CheckCamMic:"Check access to microphone and camera",CheckMic:"Check access to microphone",CheckCam:"Check access to camera",UntillTheEnd:"There is still time until the end of the conference",LEFT_TIME:"Time left"},ADD_CONTACT:"Add contact",INPUT_MESSAGE:"Please write a message...",INPUT_SEARCH_CONTACT:"Surname Name",MEMBERS:"members",BUT_CLOSE:"Close",BUT_CONFIRM:"Yes"}}),F.addResourceBundle("fr","translations",{CHAT:{STATUS:{ONLINE:"en ligne",OFFLINE:"hors ligne",TYPING:"imprime"},MESSAGE:{TYPE:{IMAGE:"Image",VIDEO:"VidÃ©o",FILE:"File",NOTIFY:"Notification"},MENU:{COPY:"Copier",DELETE:"Supprimer"},REVOKED:{YOU:"Vous avez supprimÃ© le message",CONTACT:"message supprimÃ©"}},CONFERENCE:{JOIN:"Rejoindre",START:"DÃ©marrer",RESTART:"RecrÃ©er la confÃ©rence",CONFIRM_RECREATE_CONF:"Ãªtes-vous sÃ»r de vouloir recrÃ©er la confÃ©rence?",CONFIRM_FINISH_CONF:"Ãªtes-vous sÃ»r de vouloir terminer la confÃ©rence?",PAUSE:"Pause",FINISH:"Terminer",BACK:"Retour au chat",NotFoundError:"PÃ©riphÃ©rique demandÃ© introuvable",NotAllowedError:"Autorisation refusÃ©e. Pour autoriser l'accÃ¨s Ã  l'appareil, accÃ©dez aux paramÃ¨tres du navigateur",ErrorAny:"L'appareil n'est pas configurÃ©",ALLOK:"Tout va bien",CheckCamMic:"VÃ©rifier l'accÃ¨s au microphone et Ã  la camÃ©ra",CheckMic:"VÃ©rifier l'accÃ¨s au microphone",CheckCam:"VÃ©rifier l'accÃ¨s Ã  la camÃ©ra",UntillTheEnd:" Il est encore temps jusqu'Ã  la fin de la confÃ©rence",LEFT_TIME:"temps restant:"},ADD_CONTACT:"Ajouter un contact",INPUT_MESSAGE:"Veuillez Ã©crire un message...",INPUT_SEARCH_CONTACT:"Surname Name",MEMBERS:"members",BUT_CLOSE:"Fermer",BUT_CONFIRM:"Oui"}});var St=function(e,t){switch(t.type){case"SET_ENGLISH":return F.changeLanguage("en"),{language:"en"};case"SET_FRENCH":return F.changeLanguage("fr"),{language:"fr"};case"SET_RUSSIAN":return F.changeLanguage("ru"),{language:"ru"};default:return e}},Rt=a.createContext({}),At=function(e){var t=e.children,r=a.useReducer(St,{language:F.language.substring(0,2)}),n=r[0],i=r[1],c=a.useMemo((function(){return{languageState:n,dispatchLanguage:i}}),[n]);return o.createElement(Rt.Provider,{value:c},o.createElement(p.I18nextProvider,{i18n:F},t))},xt=["lang","chatBaseURLApi","chatWsUrl","chatWsPath","token","refreshToken"];exports.AddContact=se,exports.CHAT_ACTIONS={SET_ACTIVE_ROOM:"SET_ACTIVE_ROOM",SET_LOADING:"SET_LOADING",SET_ERROR:"SET_ERROR",REVOKE_MESSAGE:"REVOKE_MESSAGE",MARK_PRIVATE_MESSAGES_READ:"MARK_PRIVATE_MESSAGES_READ"},exports.ChatContext=$e,exports.ChatIndex=function(e){var t=e.lang,r=e.chatBaseURLApi,n=e.chatWsUrl,a=e.chatWsPath,i=e.token,c=e.refreshToken,l=X(e,xt);return o.createElement(At,null,o.createElement(Je,{defLang:t,token:i,refreshToken:c},o.createElement(tt,{baseURLApi:r,pageSize:25},o.createElement(mt,{wsUrl:n,wsPath:a},o.createElement(It,l)))))},exports.ChatPage=It,exports.ChatProvider=Je,exports.Conference=ct,exports.ConferenceCall=st,exports.Emoji=B,exports.Message=Ne,exports.RestContext=Xe,exports.RestProvider=tt,exports.Room=Me,exports.RoomList=ot,exports.SocketContext=dt,exports.SocketProvider=mt,exports.Typing=z,exports.clearLocalStorage=Qe,exports.getRefreshToken=et,exports.signOut=Ze;
//# sourceMappingURL=chat.cjs.production.min.js.map
