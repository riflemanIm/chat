"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t,a,n,r=require("react"),o=e(r),l=require("@mui/material"),s=require("@mui/styles"),i=e(require("@mui/icons-material/FileCopy")),c=e(require("@mui/icons-material/Delete")),u=e(require("@mui/icons-material/ArrowBack")),d=require("@mui/icons-material"),m=require("react-i18next"),p=e(require("@mui/material/Select")),E=e(require("@mui/icons-material/Group")),g=e(require("@mui/icons-material/VideoCall")),f=e(require("@mui/icons-material/CallEnd")),h=e(require("@mui/icons-material/PersonAdd")),y=e(require("@mui/icons-material/Star")),C=e(require("dayjs")),T=e(require("@mui/material/Button")),v=e(require("@mui/material/Dialog")),R=e(require("@mui/material/DialogActions")),I=e(require("@mui/material/DialogContent")),S=e(require("@mui/material/Slide")),A=e(require("@mui/icons-material/KeyboardArrowDown")),O=require("react-aspect-ratio"),N=e(require("react-infinite-scroller")),x=e(require("@mui/material/List")),_=e(require("axios")),b=e(require("socket.io-client")),G=e(require("@mui/icons-material/SettingsSuggest")),k=e(require("@mui/icons-material/SettingsVoice")),D=e(require("@mui/icons-material/VideoSettings")),M=e(require("i18next")),w=e(require("i18next-browser-languagedetector"));(t=exports.MessageStatus||(exports.MessageStatus={}))[t.sent=0]="sent",t[t.read=1]="read",(a=exports.Role||(exports.Role={}))[a.Unknown=0]="Unknown",a[a.Client=1]="Client",a[a.Agent=2]="Agent",a[a.Specialist=3]="Specialist",a[a.Operator=4]="Operator",(n=exports.ContextMenuType||(exports.ContextMenuType={})).COPY="COPY",n.REVOKE="REVOKE",n.TOP_REVERT="TOP_REVERT",n.TOP="TOP",n.READ="READ",n.DELETE="DELETE";const U=s.makeStyles(()=>s.createStyles({item:{cursor:"pointer"}})),L=e=>{const t=U(),a=t=>{e.onSelect&&e.onSelect(t.target.innerText)},n=e=>r.createElement(l.Box,{m:.5,component:"span",onClick:a,className:t.item},e.emoji);return r.createElement(l.Box,null,r.createElement(l.Box,{display:"flex",flexDirection:"row"},r.createElement(n,{emoji:"ðŸ˜ƒ"}),r.createElement(n,{emoji:"ðŸ˜"}),r.createElement(n,{emoji:"ðŸ˜‚"}),r.createElement(n,{emoji:"ðŸ˜„"}),r.createElement(n,{emoji:"ðŸ˜…"}),r.createElement(n,{emoji:"ðŸ˜†"}),r.createElement(n,{emoji:"ðŸ˜‡"}),r.createElement(n,{emoji:"ðŸ˜ˆ"}),r.createElement(n,{emoji:"ðŸ˜‰"})),r.createElement(l.Box,{display:"flex",flexDirection:"row"},r.createElement(n,{emoji:"ðŸ˜Š"}),r.createElement(n,{emoji:"ðŸ˜‹"}),r.createElement(n,{emoji:"ðŸ˜Œ"}),r.createElement(n,{emoji:"ðŸ˜"}),r.createElement(n,{emoji:"ðŸ˜Ž"}),r.createElement(n,{emoji:"ðŸ˜"}),r.createElement(n,{emoji:"ðŸ˜"}),r.createElement(n,{emoji:"ðŸ˜’"}),r.createElement(n,{emoji:"ðŸ˜“"})),r.createElement(l.Box,{display:"flex",flexDirection:"row"},r.createElement(n,{emoji:"â“"}),r.createElement(n,{emoji:"ðŸ˜•"}),r.createElement(n,{emoji:"ðŸ˜–"}),r.createElement(n,{emoji:"ðŸ˜—"}),r.createElement(n,{emoji:"ðŸ˜˜"}),r.createElement(n,{emoji:"ðŸ˜™"}),r.createElement(n,{emoji:"ðŸ˜š"}),r.createElement(n,{emoji:"ðŸ˜œ"}),r.createElement(n,{emoji:"ðŸ˜"})),r.createElement(l.Box,{display:"flex",flexDirection:"row"},r.createElement(n,{emoji:"ðŸ˜ž"}),r.createElement(n,{emoji:"ðŸ˜Ÿ"}),r.createElement(n,{emoji:"ðŸ˜ "}),r.createElement(n,{emoji:"ðŸ˜¡"}),r.createElement(n,{emoji:"ðŸ˜¢"}),r.createElement(n,{emoji:"ðŸ˜£"}),r.createElement(n,{emoji:"ðŸ˜¤"}),r.createElement(n,{emoji:"ðŸ˜¥"}),r.createElement(n,{emoji:"ðŸ˜¦"})),r.createElement(l.Box,{display:"flex",flexDirection:"row"},r.createElement(n,{emoji:"ðŸ˜¨"}),r.createElement(n,{emoji:"ðŸ˜©"}),r.createElement(n,{emoji:"ðŸ˜ª"}),r.createElement(n,{emoji:"ðŸ˜«"}),r.createElement(n,{emoji:"ðŸ˜¬"}),r.createElement(n,{emoji:"ðŸ˜­"}),r.createElement(n,{emoji:"ðŸ˜®"}),r.createElement(n,{emoji:"ðŸ˜¯"}),r.createElement(n,{emoji:"ðŸ˜°"})),r.createElement(l.Box,{display:"flex",flexDirection:"row"},r.createElement(n,{emoji:"ðŸ˜²"}),r.createElement(n,{emoji:"ðŸ˜³"}),r.createElement(n,{emoji:"ðŸ˜´"}),r.createElement(n,{emoji:"ðŸ˜µ"}),r.createElement(n,{emoji:"ðŸ§"}),r.createElement(n,{emoji:"ðŸ˜·"}),r.createElement(n,{emoji:"ðŸ™"}),r.createElement(n,{emoji:"ðŸ™‚"}),r.createElement(n,{emoji:"ðŸ™ƒ"})),r.createElement(l.Box,{display:"flex",flexDirection:"row"},r.createElement(n,{emoji:"ðŸ¤"}),r.createElement(n,{emoji:"ðŸ¤‘"}),r.createElement(n,{emoji:"ðŸ¤’"}),r.createElement(n,{emoji:"ðŸ¤“"}),r.createElement(n,{emoji:"ðŸ¤”"}),r.createElement(n,{emoji:"ðŸ¤•"}),r.createElement(n,{emoji:"ðŸ¤ "}),r.createElement(n,{emoji:"ðŸ¤¡"}),r.createElement(n,{emoji:"ðŸ¤¢"})),r.createElement(l.Box,{display:"flex",flexDirection:"row"},r.createElement(n,{emoji:"ðŸ¤¤"}),r.createElement(n,{emoji:"ðŸ¤¥"}),r.createElement(n,{emoji:"ðŸ¤§"}),r.createElement(n,{emoji:"ðŸ¤¨"}),r.createElement(n,{emoji:"ðŸ¤©"}),r.createElement(n,{emoji:"ðŸ¤ª"}),r.createElement(n,{emoji:"ðŸ¤«"}),r.createElement(n,{emoji:"ðŸ¤¬"}),r.createElement(n,{emoji:"ðŸ¤­"})))},j=s.makeStyles(e=>s.createStyles({typingText:{paddingLeft:e.spacing(.5)},typingDot:{display:"inline-block",verticalAlign:"middle",width:4,height:4,margin:"0px 2px",background:e.palette.primary.main,borderRadius:"50%",opacity:"0",animation:"$loadingFade 1s infinite","&:nth-child(1)":{animationDelay:"0s"},"&:nth-child(2)":{animationDelay:"0.2s"},"&:nth-child(3)":{animationDelay:"0.4s"}},"@keyframes loadingFade":{"0%":{opacity:0},"50%":{opacity:.8},"100%":{opacity:0}}})),P=e=>{const t=j();return o.createElement(l.Typography,{color:"primary",variant:"body2",component:"span"},o.createElement("span",{className:t.typingDot}),o.createElement("span",{className:t.typingDot}),o.createElement("span",{className:t.typingDot}),o.createElement("span",{className:t.typingText},e.message))},F=s.makeStyles(()=>({input:{flex:"auto"},inputUpload:{display:"none"},attachmentIcon:{fill:"none",stroke:"currentColor"}})),H=e=>{const t=F(),{chat:a}=e,{t:n}=m.useTranslation(),[r,s]=o.useState(null),[i,c]=o.useState(""),[u,p]=o.useState({chat:a,time:0}),E=()=>{s(null)},g=t=>{a&&e.onSendMessage&&e.onSendMessage(a,t)},f=()=>{0!==i.trim().length&&(g({message:i,messageType:"text"}),c(""))},h=Boolean(r),y=h?"simple-popover":void 0;return o.createElement(l.Box,{display:"flex",flexDirection:"row"},o.createElement(l.TextField,{className:t.input,placeholder:n("CHAT.INPUT_MESSAGE")||"",autoFocus:!0,variant:"standard",InputProps:{disableUnderline:!0,startAdornment:o.createElement(l.InputAdornment,{position:"start"},o.createElement("input",{accept:".pdf,.jpg,.jpeg,.bmp,.gif,.png,application/pdf,image/jpeg,image/bmp,image/gif,image/png",className:t.inputUpload,id:"icon-button-file",type:"file",onChange:e=>{if(!e.currentTarget.files)return;const t=e.currentTarget.files[0];let a;if(a=t.type.includes("image")?"image":t.type.includes("video")?"video":"file","image"===a){const e=new Image,n=window.URL||window.webkitURL;e.src=n.createObjectURL(t),e.onload=()=>{const n=(e=>{let{width:t,height:a}=e;return(t>335||a>335)&&(t>a?(a=a/t*335,t=335):(t=t/a*335,a=335)),{width:t,height:a}})({width:e.width,height:e.height});g({message:t,width:n.width,height:n.height,messageType:a})}}else g({message:t,messageType:a,fileName:t.name,size:t.size})}}),o.createElement("label",{htmlFor:"icon-button-file"},o.createElement(l.IconButton,{color:"primary","aria-label":"upload",component:"span",size:"small"},o.createElement(l.SvgIcon,{fill:"none",className:t.attachmentIcon},o.createElement("path",{d:"M16.768 13.5767L11.6961 18.6486C9.35886 20.9859 5.56937 20.9859 3.23208 18.6486V18.6486C0.894789 16.3114 0.894789 12.5219 3.23208 10.1846L10.4479 2.96872C12.0875 1.32914 14.7458 1.32914 16.3854 2.96873V2.96873C18.025 4.60831 18.025 7.26659 16.3854 8.90617L9.16515 16.1264C8.23032 17.0612 6.71466 17.0612 5.77982 16.1264V16.1264C4.84499 15.1916 4.84499 13.6759 5.77982 12.7411L10.8896 7.63131",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"}))))," ",o.createElement(l.IconButton,{"aria-describedby":y,onClick:e=>{s(e.currentTarget)},color:"primary",size:"small"},o.createElement(d.InsertEmoticon,null))),endAdornment:o.createElement(l.IconButton,{edge:"end",color:"inherit",size:"small",onClick:e=>{e.preventDefault(),f()}},o.createElement(d.Send,null))},value:i,onChange:t=>{let{target:n}=t;c(n.value),a&&e.onTyping&&(u.chat!==a||Date.now()-u.time>=500)&&(p({chat:a,time:Date.now()}),e.onTyping(a))},onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),f())}}),o.createElement(l.Popover,{id:y,open:h,anchorEl:r,onClose:E,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"left"}},o.createElement(L,{onSelect:e=>{c(""+i+e),E()}})))},B=e=>{const{t:t}=m.useTranslation();return e.isTyping?o.createElement(P,{message:t("CHAT.STATUS.TYPING")}):1===e.contact.online?o.createElement(l.Typography,{variant:"body2",color:"primary",component:"span"},t("CHAT.STATUS.ONLINE")):o.createElement(l.Typography,{variant:"body2",color:"textSecondary",component:"span"},t("CHAT.STATUS.OFFLINE"))};function z(e){return null==e||"object"==typeof e&&0===Object.keys(e).length||"string"==typeof e&&0===e.trim().length}function V(e,t){return void 0===t&&(t="DD.MM.YYYY HH:mm"),void 0===e?null:("string"==typeof e&&(e=new Date(e)),C().add(-1,"days").startOf("day").isAfter(e)?C(e).format(t):C().startOf("day").isAfter(e)?"Ð’Ñ‡ÐµÑ€Ð° Ð² "+C(e).format("HH:mm"):C(e).format("HH:mm"))}const Y=e=>e?e.groupId?"group:"+e.groupId:"user:"+e.userId:null,q=e=>e.groupId?e.name:e.username,W=e=>Object.values(e).map(e=>null!=(null==e?void 0:e.messages)?null==e?void 0:e.messages.length:0).reduce((e,t)=>e+t,0),K=(e,t)=>{const a=Array.isArray(e.messages)&&e.messages.length>0,n=Array.isArray(t.messages)&&t.messages.length>0;return a&&n&&null!=t.messages&&null!=e.messages?(null!=t.messages[t.messages.length-1].cdate?new Date(t.messages[t.messages.length-1].cdate).getTime():(new Date).getTime())-(null!=e.messages[e.messages.length-1].cdate?new Date(e.messages[e.messages.length-1].cdate).getTime():(new Date).getTime()-1):a?-1:1},J=e=>{const t=window.location.search;return new URLSearchParams(t).get(e)},$=(e,t,a)=>{const n=t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e;return a?n+(n.includes("?")?"&":"?")+new URLSearchParams(a).toString():n},X=s.makeStyles(()=>({star:{fontSize:"0.85rem",verticalAlign:"middle"}})),Q=e=>{const t=X(),{apiUrl:a,contacts:n,owner:r}=e;return o.createElement(l.List,{"aria-label":"contacts"},n.map(n=>o.createElement(l.ListItem,{button:!0,key:n.userId,onClick:()=>e.onClick&&e.onClick(n)},o.createElement(l.ListItemAvatar,null,o.createElement(l.Avatar,{alt:n.username,src:n.avatar?$(a,n.avatar):""})),o.createElement(l.ListItemText,{primary:o.createElement("span",null,n.username," ",r===n.userId&&o.createElement(y,{className:t.star,color:"primary"})),secondary:o.createElement(B,{contact:n,isTyping:!1})}))))},Z=e=>{const{onClose:t,open:a,apiUrl:n,contacts:r}=e,{t:s}=m.useTranslation();return o.createElement(l.Dialog,{onClose:()=>{t()},"aria-labelledby":"add-contact-title",open:a},o.createElement(l.DialogTitle,{id:"switch-operator-title"},s("CHAT.ADD_CONTACT")),o.createElement(Q,{apiUrl:n,contacts:r,onClick:e=>{t(e)}}))};function ee(){return(ee=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}const te=o.forwardRef((function(e,t){return o.createElement(l.Slide,ee({direction:"up",ref:t},e))}));function ae(e){let{children:t,open:a,setOpen:n,severity:r="warning"}=e;const{t:s}=m.useTranslation(),i=()=>{n(!1)};return o.createElement(l.Dialog,{open:a,TransitionComponent:te,keepMounted:!0,onClose:i,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},o.createElement(l.DialogContent,null,o.createElement(l.Alert,{severity:r},"string"==typeof t?o.createElement(l.Typography,{variant:"body2"},t):t)),o.createElement(l.DialogActions,null,o.createElement(l.Button,{onClick:i,variant:"text"},s("CHAT.BUT_CLOSE"))))}const ne=e=>{let{modaleInfo:t,setModaleInfo:a,strTime:n}=e;const{t:s}=m.useTranslation();return r.useMemo(()=>o.createElement(ae,{open:t,setOpen:a,severity:"info"},o.createElement(l.Typography,{variant:"body1",textAlign:"center"},s("CHAT.CONFERENCE.UntillTheEnd"),":"),o.createElement(l.Typography,{variant:"h6",textAlign:"center"},n)),[t])},re=e=>{let{finishDate:t}=e;const{t:a}=m.useTranslation(),[n,s]=r.useState(!1),i=Date.now(),c=new Date(t).getTime(),u=Math.round((c-i)/1e3),{counter:d}=function(e){void 0===e&&(e=3e4);const[t,a]=r.useState(e),n=r.useRef(null);return r.useEffect(()=>(t>0&&(n.current=setInterval(()=>a(e=>e-1),1e3)),()=>{n.current&&clearInterval(n.current)}),[t]),{counter:t,handlerRefresh:()=>{a(e)}}}(u);if(r.useEffect(()=>{null!=p&&3===p&&null!=E&&0===E&&s(!0)},[d]),u<1)return null;const{minutes:p,seconds:E,strTime:g}=(e=>{const t=Math.floor(e/3600),a=t<10?"0"+t:t;e%=3600;const n=Math.floor(e/60),r=e%60;return{hours:t,minutes:n,seconds:r,strTime:a+":"+(n<10?"0"+n:n)+":"+(r<10?"0"+r:r)}})(u);return o.createElement(l.Box,{textAlign:"center"},o.createElement(l.Typography,{variant:"body2",component:"span"},a("CHAT.CONFERENCE.LEFT_TIME"),":"," "),o.createElement(l.Typography,{variant:"button",component:"span"},g),o.createElement(ne,{modaleInfo:n,setModaleInfo:s,strTime:g}))},oe=r.forwardRef((function(e,t){return r.createElement(S,ee({direction:"up",ref:t},e))}));function le(e){let{open:t,setOpen:a,contentText:n,callback:o}=e;const{t:s}=m.useTranslation(),i=()=>{a(!1)};return r.createElement(r.Fragment,null,r.createElement(v,{open:t,TransitionComponent:oe,keepMounted:!0,onClose:i,"aria-describedby":"alert-dialog-slide-description"},r.createElement(I,null,r.createElement(l.Typography,{variant:"h6"},n)),r.createElement(R,null,r.createElement(T,{onClick:i,color:"primary"},s("CHAT.BUT_CLOSE")),r.createElement(T,{onClick:()=>{a(!1),o()},color:"warning"},s("CHAT.BUT_CONFIRM")))))}const se=s.makeStyles(e=>s.createStyles({popover:{pointerEvents:"none"},paper:{padding:e.spacing(1)},avatarGroup:{backgroundColor:"#28B7C6",color:"#fff"}})),ie=(e,t)=>{var a;const n=[(null==(a=e.members)?void 0:a.length)+" "+t("CHAT.MEMBERS")],r=(e.members||[]).reduce((e,t)=>t.online?e+1:e,0);return r&&n.push(r+" "+t("CHAT.STATUS.ONLINE")),n.join(", ")},ce=e=>{var t,a;let{apiUrl:n,user:s,chat:i,typing:u,conference:d,visitData:y,conferenceJoined:C,className:T,operators:v,onVideoCall:R,onVideoEnd:I,onConferencePause:S,onOperatorAdd:A,onLeaveGroup:O}=e;const N=se(),{t:x}=m.useTranslation(),[_,b]=r.useState(null),[G,k]=r.useState(!1),[D,M]=r.useState(""+(z(y)?null:z(y.find(e=>"none"===e.conferenceStatus))?y[0].visitId:null==(w=y.find(e=>"finished"===e.conferenceStatus))?void 0:w.visitId));var w;console.log("conferenceStatus",null==(t=y.find(e=>""+e.visitId===D))?void 0:t.conferenceStatus);const[U,L]=r.useState(!1);if(!i)return o.createElement(l.CardHeader,{avatar:o.createElement(l.Avatar,null),title:"",subheader:"",className:T});const j=()=>{b(null)},P=i;var F;if(P.groupId)return o.createElement(l.CardHeader,{avatar:o.createElement(l.Avatar,{alt:P.name,className:N.avatarGroup},o.createElement(E,null)),title:P.name,subheader:o.createElement(o.Fragment,null,o.createElement("span",{"aria-owns":_?"mouse-over-popover":void 0,"aria-haspopup":"true",onMouseEnter:e=>{b(e.currentTarget)},onMouseLeave:j},ie(P,x)),o.createElement(l.Popover,{id:"mouse-over-popover",className:N.popover,classes:{paper:N.paper},open:!!_,anchorEl:_,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},onClose:j,disableRestoreFocus:!0},o.createElement(Q,{apiUrl:n,contacts:P.members,owner:P.userId}))),className:T,action:o.createElement(o.Fragment,null,4===s.role&&o.createElement(o.Fragment,null,o.createElement(l.IconButton,{"aria-label":"add user",onClick:()=>{k(!0)}},o.createElement(h,null)),o.createElement(Z,{apiUrl:n,open:G,contacts:v,onClose:e=>{k(!1),A&&e&&i&&A(i,e)}})),4===s.role&&(null==(F=P.members)?void 0:F.find(e=>e.userId!==s.userId&&4===e.role))&&O&&o.createElement(l.IconButton,{"aria-label":"leave group",onClick:()=>O(P)},o.createElement(c,null)))});const H=i,Y=!(null==u||!u.contactId)&&(null==u?void 0:u.userId)===H.userId;return o.createElement(l.CardHeader,{avatar:o.createElement(l.Avatar,{alt:H.username,src:H.avatar?$(n,H.avatar):""}),title:H.username,subheader:o.createElement(B,{contact:H,isTyping:Y}),className:T,action:o.createElement(o.Fragment,null,1!==s.role&&C&&d&&!z(d)&&null!=S&&o.createElement(l.Button,{"aria-label":"cancel call",variant:"contained",color:"secondary",size:"small",startIcon:o.createElement(f,{color:"error"}),onClick:()=>S(d)},x("CHAT.CONFERENCE.PAUSE")),d&&!z(d)&&null!=I&&null!=s.role&&[3,4].includes(s.role)&&o.createElement(l.Button,{"aria-label":"cancel call",variant:"contained",color:"primary",size:"small",startIcon:o.createElement(f,{color:"error"}),onClick:()=>I(d),style:{marginLeft:8}},x("CHAT.CONFERENCE.FINISH")),z(d)&&null!=R&&s.role&&[3,4].includes(s.role)&&o.createElement(o.Fragment,null,!z(y)&&o.createElement(o.Fragment,null,o.createElement(l.FormControl,{fullWidth:!0,variant:"standard",margin:"dense"},o.createElement(l.InputLabel,{id:"demo-simple-select-label"},"Ð’Ð¸Ð·Ð¸Ñ‚Ñ‹"),o.createElement(p,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:""+D,label:"Ð’Ð¸Ð·Ð¸Ñ‚Ñ‹",onChange:e=>{M(""+e.target.value)},fullWidth:!0,size:"small"},y.map(e=>o.createElement(l.MenuItem,{key:e.visitId,value:e.visitId},o.createElement(l.Typography,{variant:"body1",sx:{fontSize:14}},e.plExamName),o.createElement(l.Typography,{variant:"body2",sx:{fontSize:13}},V(e.chatFrom,"HH:mm")," -"," ",V(e.visitDate,"HH:mm")," ",e.conferenceStatus))))),o.createElement(le,{open:U,setOpen:L,contentText:x("CHAT.CONFERENCE.CONFIRM_RECREATE_CONF"),callback:()=>R(H,parseInt(D,10))})),o.createElement(l.Button,{"aria-label":"video call",variant:"contained",color:"primary",size:"small",startIcon:o.createElement(g,null),onClick:()=>D?L(!0):R(H,null),fullWidth:!0},x(z(y)||"finished"!==(null==(a=y.find(e=>""+e.visitId===D))?void 0:a.conferenceStatus)?"CHAT.CONFERENCE.START":"CHAT.CONFERENCE.RESTART"))),null!=(null==d?void 0:d.finishDate)&&o.createElement(re,{finishDate:d.finishDate}))})},ue=s.makeStyles(e=>s.createStyles({fileIcon:{fontSize:"0.75rem"},fileBody:{paddingLeft:e.spacing(1.2)}})),de=e=>{let{message:t}=e;const a=ue(),n=function(e){const t=e.split("$"),[a,n,r,o]=t;return{date:a,userId:n,size:r,name:o}}(t.content),{name:r,ext:s}=function(e){const t=e.lastIndexOf(".");return-1===t?{name:e,ext:""}:{name:e.slice(0,t),ext:e.slice(t+1)}}(n.name);return o.createElement(l.Box,{display:"flex",flexDirection:"row"},o.createElement(l.Avatar,{className:a.fileIcon},s.toUpperCase()),o.createElement(l.Box,{display:"flex",flexDirection:"column",className:a.fileBody},r,o.createElement("span",null,s+" "+n.size)))},me=s.makeStyles(e=>({mediaContent:{maxWidth:284,maxHeight:190,backgroundColor:e.palette.secondary.main,borderRadius:e.spacing(1.2),[e.breakpoints.down("sm")]:{maxWidth:250,maxHeight:210}}})),pe=e=>{let{apiUrl:t,message:a,isConference:n}=e;const r=me();let l="";if(n){const e=JSON.parse(a.content);l=$(t,"/static/conf/"+e.visitId+"/"+e.name)}else l=$(t,"/static/file/"+a.content);return o.createElement("video",{src:l,className:r.mediaContent,controls:!0,muted:!0,preload:"none"},"Ð’Ð°Ñˆ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€ Ð½Ðµ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ Ñ‚ÐµÐ³ video.")},Ee=s.makeStyles(e=>s.createStyles({img:{cursor:"pointer",borderRadius:e.spacing(1.2),maxWidth:284,maxHeight:190,[e.breakpoints.down("sm")]:{maxWidth:250,maxHeight:170}},aspect:{maxWidth:284,maxHeight:190,[e.breakpoints.down("sm")]:{maxWidth:250,maxHeight:170}}})),ge=e=>{let{apiUrl:t,message:a,setViewerData:n}=e;const r=Ee();return o.createElement(O.AspectRatio,{ratio:"3/4",className:r.aspect},o.createElement("img",{src:$(t,"/static/image/"+a.content),onClick:()=>{n({visible:!0,src:$(t,"/static/image/"+a.content)})},className:r.img,alt:a.cdate}))},fe=e=>{let{apiUrl:t,message:a,setViewerData:n}=e;switch(a.messageType){case"text":return o.createElement(o.Fragment,null,a.content);case"video":case"video_conference":return o.createElement(pe,{message:a,apiUrl:t,isConference:"video_conference"===a.messageType});case"image":return o.createElement(ge,{message:a,apiUrl:t,setViewerData:n});case"file":return o.createElement(de,{message:a})}return null};var he=s.makeStyles(e=>s.createStyles({rootContact:{padding:1,paddingLeft:e.spacing(2),"& span":{float:"right",color:e.palette.text.secondary,fontSize:"0.8rem"},"& $message":{backgroundColor:e.palette.grey[200],color:e.palette.text.primary,borderTopRightRadius:e.spacing(3),borderBottomRightRadius:e.spacing(3)},"& $firstMessage":{borderTopLeftRadius:e.spacing(3),marginTop:10},"& $lastMessage":{borderTopRightRadius:e.spacing(3),borderBottomLeftRadius:0,borderBottomRightRadius:e.spacing(3),marginBottom:10}},rootUser:{padding:1,paddingRight:e.spacing(2),justifyContent:"flex-end","& span":{float:"right",color:"#D9DEEC",fontSize:"0.8rem"},"& $message":{backgroundColor:e.palette.primary.main,color:e.palette.primary.contrastText,borderTopLeftRadius:e.spacing(3),borderBottomLeftRadius:e.spacing(3)},"& $firstMessage":{borderTopRightRadius:e.spacing(3),marginTop:10},"& $lastMessage":{borderTopLeftRadius:e.spacing(3),borderBottomRightRadius:0,marginBottom:10}},rootNotify:{justifyContent:"center","& span":{float:"right",color:e.palette.text.secondary,fontSize:"0.8rem"},"& > *":{borderRadius:e.spacing(3),fontWeight:500}},message:{maxWidth:"65%",[e.breakpoints.down("md")]:{maxWidth:"95%"},[e.breakpoints.down("sm")]:{maxWidth:"85%"},borderRadius:e.spacing(.6),padding:e.spacing(.9),paddingLeft:e.spacing(1.8),paddingRight:e.spacing(1.8)},firstMessage:{},lastMessage:{},file:{display:"flex",flexDirection:"row",flexWrap:"wrap",cursor:"pointer"},header:{flex:"0 0 100%",overflow:"hidden",fontWeight:"bold"},body:{flex:"1 1 auto",wordBreak:"break-word",overflow:"hidden"},status:{paddingLeft:e.spacing(1),flex:"1 1 auto",alignSelf:"flex-end"},statusImage:{fontSize:"1rem",marginRight:e.spacing(.5),verticalAlign:"middle"}}));const ye=e=>{const t=he(),{t:a}=m.useTranslation(),{apiUrl:n,message:o,owner:s,user:i,isGroupMessage:c,isUserFirst:u,isUserLast:p,setViewerData:E}=e;if("notify"===o.messageType){const e="{"===o.content[0]?JSON.parse(o.content):o.content;return r.createElement(l.ListItem,{className:t.rootNotify},r.createElement(l.Alert,{severity:"string"==typeof e?"info":e.severity},"string"==typeof e?e:e.message))}if(o.isRevoke)return r.createElement(l.ListItem,{className:t.rootNotify},r.createElement(l.Typography,{variant:"body2",align:"center"},o.userId===i.userId?a("CHAT.MESSAGE.REVOKED.YOU"):o.revokeUserName+" "+a("CHAT.MESSAGE.REVOKED.CONTACT")));const g=i.userId===o.userId;return r.createElement(l.ListItem,{className:"video_conference"===o.messageType?t.rootNotify:g?t.rootUser:t.rootContact},((e,t,a,n,o,s,i)=>{const{messageType:c}=t,u=n&&o?a.message+" "+a.firstMessage+" "+a.lastMessage:n?a.message+" "+a.firstMessage:o?a.message+" "+a.lastMessage:a.message;return"file"===c?r.createElement(l.Link,{className:u+" "+a.file,underline:"none",href:$(e,"/static/file/"+t.content),target:"_blank",download:!0,onContextMenu:s},i):r.createElement(l.Box,{display:"flex",flexDirection:"image"===c||"video"===c||"video_conference"===c?"column":"row",flexWrap:"wrap",className:u,onContextMenu:s},i)})(n,o,t,u,p,e.onContextMenu,r.createElement(r.Fragment,null,!g&&c&&s&&u&&r.createElement("div",{className:t.header},s.username),r.createElement("div",{className:t.body},r.createElement(fe,{message:o,apiUrl:n,setViewerData:E})),r.createElement("div",{className:t.status},r.createElement("span",null,g?r.createElement(0===o.status?d.Done:d.DoneAll,{className:t.statusImage}):null,V(o.cdate))))))},Ce=s.makeStyles(e=>s.createStyles({messageListOuter:{flex:1,overflowY:"auto",margin:0,padding:0},messageList:{height:"100%",overflowY:"auto",scrollbarWidth:"thin",scrollbarColor:e.palette.primary.light+" #fff"},img:{cursor:"pointer",borderRadius:e.spacing(1.2),maxWidth:"auto",maxHeight:"95%",[e.breakpoints.down("sm")]:{maxWidth:"auto",maxHeight:"95%"}},arrowDown:{position:"absolute",left:"94.5%",bottom:105,[e.breakpoints.down("md")]:{left:"91.5%",bottom:95},[e.breakpoints.down("sm")]:{left:"84%",bottom:95}}})),Te=e=>{let{loading:t}=e;return t&&o.createElement(l.Box,{sx:{width:"100%",mx:"auto",textAlign:"center"}},o.createElement(l.CircularProgress,null))},ve=e=>{const{apiUrl:t,user:a,users:n,chat:r,loading:s,pageSize:i,setMenuState:c,initialMenuState:u}=e,d=Ce(),[m,p]=o.useState(!1),[E,g]=o.useState(!0),f=null==r?void 0:r.messages,h=(null==f?void 0:f.length)||0,y=(null==r?void 0:r.messages)&&r.messages[h-1],C=o.useRef(null),[T,v]=o.useState({visible:!1,src:""});o.useEffect(()=>{setTimeout(()=>{g(!0),R()},500)},[]),o.useEffect(()=>{g(!0),R()},[Y(r)]),o.useEffect(()=>{y&&a.userId===y.userId&&(R(),g(!0))},[h]);const R=()=>{C.current&&E&&(C.current.scrollTop=C.current.scrollHeight)};return o.createElement(l.CardContent,{className:d.messageListOuter},o.createElement(l.List,{className:d.messageList,ref:C},o.createElement(N,{pageStart:0,loadMore:()=>{h>=i&&!s&&e.onNeedMoreMessages&&r&&(g(!1),e.onNeedMoreMessages(r))},hasMore:!(!r||r.noMoreData),loader:o.createElement(Te,{loading:s,key:0}),isReverse:!0,useCapture:!0,useWindow:!1,getScrollParent:()=>(C.current&&p(C.current.scrollTop<C.current.scrollHeight-1540),C.current)},f&&f.map((l,s)=>o.createElement(ye,{key:s,apiUrl:t,user:a,message:l,owner:n[l.userId],isGroupMessage:!(null==r||!r.groupId),isUserFirst:0===s||"notify"===f[s-1].messageType||f[s-1].userId!==f[s].userId,isUserLast:s===f.length-1||"notify"===f[s+1].messageType||f[s+1].userId!==f[s].userId,onContextMenu:t=>((t,n)=>{const r="text"===t.messageType,o=a.userId===t.userId&&!!e.onMeesageDelete&&(new Date).getTime()-new Date(t.cdate).getTime()<=12e4;r||o?(n.preventDefault(),c({message:t,mouseX:n.clientX-2,mouseY:n.clientY-4,canCopy:r,canDelete:o})):c(u)})(l,t),setViewerData:v})))),m&&o.createElement(l.Box,{className:d.arrowDown},o.createElement(l.Fab,{color:"info","aria-label":"add",size:"medium",onClick:()=>{R()}},o.createElement(A,null))),T.visible&&o.createElement(l.Backdrop,{sx:{color:"#fff",zIndex:e=>e.zIndex.drawer+1},open:T.visible,onClick:()=>{v({visible:!1,src:""})}},o.createElement("img",{src:T.src,className:d.img,alt:""})))},Re=s.makeStyles(e=>s.createStyles({root:{width:"100%",minWidth:360,height:"100%",display:"flex",flexDirection:"column"},roomHeader:{flex:1},flexAll:{flex:"1 1 auto"},flexEnd:{justifyContent:"flex-end"}})),Ie={message:null,mouseX:null,mouseY:null,canCopy:!1,canDelete:!1},Se=e=>{const{apiUrl:t,user:a,users:n,chat:s,typing:d,conference:p,visitData:E,conferenceJoined:g,loading:f,pageSize:h}=e,y=Re(),{t:C}=m.useTranslation(),T=l.useMediaQuery(e=>e.breakpoints.down("sm")),[v,R]=o.useState(Ie),I=r.useCallback(()=>{const{message:e}=v;R(Ie),e&&navigator.clipboard.writeText(e.content)},[v.message]),S=r.useCallback(()=>{const{message:t}=v;R(Ie),e.onMeesageDelete&&s&&t&&e.onMeesageDelete(s,t)},[v.message]);return o.createElement(l.Card,{elevation:1,className:y.root},o.createElement(l.Box,{display:"flex",flexDirection:"row"},s&&T&&o.createElement(l.Tooltip,{title:"Ð’ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ Ð² ÐºÐ¾Ð½Ñ„ÐµÑ€ÐµÐ½Ñ†Ð¸ÑŽ"},o.createElement(l.IconButton,{"aria-label":"exit room",onClick:()=>e.onExitRoom&&e.onExitRoom(s)},o.createElement(u,null))),o.createElement(ce,{apiUrl:t,user:a,chat:s,typing:d,conference:p,visitData:E,conferenceJoined:g,operators:e.operators,className:y.roomHeader,onVideoCall:e.onVideoCall,onVideoEnd:e.onVideoEnd,onConferencePause:e.onConferencePause,onOperatorAdd:e.onOperatorAdd,onLeaveGroup:e.onLeaveGroup})),o.createElement(l.Divider,null),o.createElement(ve,{apiUrl:t,user:a,users:n,chat:s,loading:f,pageSize:h,initialMenuState:Ie,onNeedMoreMessages:e.onNeedMoreMessages,onMeesageDelete:e.onMeesageDelete,setMenuState:R}),o.createElement(l.Divider,null),o.createElement(l.CardContent,null,o.createElement(H,{chat:s,onTyping:e.onTyping,onSendMessage:e.onSendMessage})),o.createElement(l.Menu,{keepMounted:!0,open:null!==v.mouseY,onClose:()=>{R(Ie)},anchorReference:"anchorPosition",anchorPosition:null!==v.mouseY&&null!==v.mouseX?{top:v.mouseY,left:v.mouseX}:void 0},o.createElement(l.MenuItem,{onClick:I,disabled:!v.canCopy},o.createElement("span",{className:y.flexAll},C("CHAT.MESSAGE.MENU.COPY")),o.createElement(l.ListItemIcon,{className:y.flexEnd},o.createElement(i,{fontSize:"small"}))),o.createElement(l.MenuItem,{onClick:S,disabled:!v.canDelete},o.createElement("span",{className:y.flexAll},C("CHAT.MESSAGE.MENU.DELETE")),o.createElement(l.ListItemIcon,{className:y.flexEnd},o.createElement(c,{fontSize:"small"})))))},Ae=s.makeStyles(e=>s.createStyles({main:{flex:"1 1 auto",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},time:{paddingLeft:e.spacing(1),justifyContent:"flex-end",whiteSpace:"nowrap"},unread:{justifyContent:"flex-end",maxHeight:20},avatarGroup:{backgroundColor:"#28B7C6",color:"#fff"}})),Oe=s.withStyles(e=>s.createStyles({badge:{backgroundColor:"#44b700",color:"#44b700",boxShadow:"0 0 0 2px "+e.palette.background.paper,"&::after":{position:"absolute",top:0,left:0,width:"100%",height:"100%",borderRadius:"50%",animation:"$ripple 1.2s infinite ease-in-out",border:"1px solid currentColor",content:'""'}},"@keyframes ripple":{"0%":{transform:"scale(.8)",opacity:1},"100%":{transform:"scale(2.4)",opacity:0}}}))(l.Badge),Ne=s.withStyles(e=>s.createStyles({badge:{backgroundColor:e.palette.primary.main,boxShadow:"0 0 0 2px "+e.palette.background.paper}}))(l.Badge),xe=e=>{const t=Ae(),{t:a}=m.useTranslation(),{apiUrl:n,chat:r,typing:s}=e,i=q(r),c=r.groupId?o.createElement(l.Avatar,{alt:i,className:t.avatarGroup},o.createElement(E,null)," "):((e,t,a)=>{const n=o.createElement(l.Avatar,{alt:t.username,src:t.avatar?$(e,t.avatar):""});return null!=a&&a.contactId&&(null==a?void 0:a.userId)===t.userId?o.createElement(Oe,{overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"dot"},n):null!=t&&t.online?o.createElement(Ne,{overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"dot"},n):n})(n,r,s),u=r.messages&&r.messages.length>0?r.messages[r.messages.length-1]:null,d=((e,t)=>{if(!e)return null;switch(e.messageType){case"text":return e.content;case"image":return"["+t("CHAT.MESSAGE.TYPE.IMAGE")+"]";case"video":return"["+t("CHAT.MESSAGE.TYPE.VIDEO")+"]";case"file":return"["+t("CHAT.MESSAGE.TYPE.FILE")+"]";case"notify":return"["+t("CHAT.MESSAGE.TYPE.NOTIFY")+"]";default:return null}})(u,a),p=null==u?void 0:u.cdate;return o.createElement(l.ListItem,{button:!0,selected:e.active,onClick:e.onClick},o.createElement(l.ListItemAvatar,null,c),o.createElement(l.ListItemText,{secondaryTypographyProps:{component:"span"},primary:o.createElement(l.Box,{display:"flex",flexDirection:"row"},o.createElement("span",{className:t.main},i),o.createElement("span",{className:t.time},V(p))),secondary:o.createElement(l.Box,{display:"flex",flexDirection:"row"},o.createElement("span",{className:t.main},d),r.unreadCount?o.createElement(l.Chip,{className:t.unread,component:"span",size:"small",color:"primary",label:r.unreadCount}):null)}))},_e=s.makeStyles(e=>({root:{width:"100%",height:"100%"},searchField:{width:"100%"},listStyle:{height:"89.5%",overflowY:"auto",scrollbarWidth:"thin",scrollbarColor:e.palette.primary.light+" #fff"}})),be=(e,t)=>{if(null===t)return e;const a=t.toLowerCase();return e.filter(e=>-1!==q(e).toLowerCase().indexOf(a.toLowerCase()))},Ge=(e,t,a)=>{let n=[...t,...a];n=n.sort(K);const r=localStorage.getItem(e+"-topChatId");if(r){const e=n.find(e=>Y(e)===r);e&&(n=n.filter(e=>Y(e)!==r),e.isTop=!0,n.unshift(e))}return n},ke=e=>{const t=_e(),{t:a}=m.useTranslation(),[n,r]=o.useState(Ge(e.user.userId,be(e.groups,null),be(e.contacts,null)));return o.createElement(l.Card,{elevation:1,className:t.root},o.createElement(l.CardHeader,{title:o.createElement(l.TextField,{className:t.searchField,label:a("CHAT.INPUT_SEARCH_CONTACT"),variant:"outlined",size:"small",fullWidth:!0,onChange:t=>{r(Ge(e.user.userId,be(e.groups,t.target.value),be(e.contacts,t.target.value)))}})}),o.createElement(l.Divider,null),o.createElement(x,{"aria-label":"rooms",className:t.listStyle},!z(n)&&n.map(t=>!z(t)&&o.createElement(xe,{key:Y(t),apiUrl:e.apiUrl,chat:t,active:t===e.activeRoom,typing:e.typing,onClick:()=>null!=e.onChangeChat&&e.onChangeChat(t)}))))},De=s.makeStyles(()=>({root:{width:"100%",height:"100%",borderRadius:4}})),Me=e=>{let{conference:t,onClose:a,langCode:n="en"}=e;const l=De(),s=o.useRef(null),i=null!=t&&t.url&&n?function(e,t,a){const n=new RegExp("(lang=)[^&]+");return e.replace(n,"$1"+a)}(null==t?void 0:t.url,0,(e=>"ru"===e?"rus":"fr"===e?"fra":"en"===e?"eng":"")(n)):"";return r.useEffect(()=>{const e=e=>{var n;let{source:r,data:o}=e;if(r===(null==(n=s.current)?void 0:n.contentWindow)){const{type:e}=o;["notSupported","connectionFail","callFail","hangUp","remoteHangUp"].includes(e)&&a(t)}};return window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}},[null==t?void 0:t.id,n]),o.createElement("iframe",{title:"conference",className:l.root,src:i,allowFullScreen:!0,allow:"microphone; camera; autoplay; display-capture",ref:s})},we=s.makeStyles(()=>({root:{width:"100%",height:"100%",borderRadius:8,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},pulse:{height:100,width:100,borderRadius:"50%",display:"flex",justifyContent:"center",alignItems:"center",position:"relative","&::before":{content:"''",position:"absolute",border:"1px solid green",width:"calc(100% + 40px)",height:"calc(100% + 40px)",borderRadius:"50%",animation:"$pulse 1s linear infinite"},"&::after":{content:"''",position:"absolute",border:"1px solid green",width:"calc(100% + 40px)",height:"calc(100% + 40px)",borderRadius:"50%",animation:"$pulse 1s linear infinite",animationDelay:"0.3s"}},avatar:{width:"80%",height:"80%"},footer:{width:"100%",alignSelf:"flex-end",paddingTop:64,display:"flex",justifyContent:"center"},"@keyframes pulse":{"0%":{transform:"scale(0.5)",opacity:0},"50%":{transform:"scale(1)",opacity:1},"100%":{transform:"scale(1.3)",opacity:0}}})),Ue=e=>{let{conference:t,contact:a,apiUrl:n,onAccept:r}=e;const s=we(),{t:i}=m.useTranslation();return o.createElement(l.Paper,{className:s.root},o.createElement("div",{className:s.pulse},o.createElement(l.Avatar,a?{className:s.avatar,alt:a.username,src:a.avatar?$(n,a.avatar):""}:{className:s.avatar})),o.createElement("div",{className:s.footer},o.createElement(l.Button,{variant:"contained",color:"primary",onClick:()=>r(t)},i("CHAT.CONFERENCE.JOIN"))))},Le={userId:0,username:"",password:"",avatar:"",langCode:""},je={user:Le,token:"",refreshToken:"",activeRoom:null,chatOld:null,groupGather:{},userGather:{},contactGather:{},operators:[],initialContactId:null,conference:{data:null,joined:!1,ringPlayed:!1},typing:null,loading:!1,error:void 0,success:void 0,visitData:[]},Pe=e=>e.activeRoom?e.groupGather[e.activeRoom.groupId]||e.contactGather[e.activeRoom.userId]:null,Fe=e=>{const{activeRoom:t,initialContactId:a,contactGather:n}=e;let r=null;if(a)r=n[a];else if(t)r=Pe(e);else{const t=[...Object.values(e.contactGather),...Object.values(e.groupGather)].sort(K);t.length>0&&(r=t[0])}return r},He=(e,t,a)=>{const n={...e};e.contactGather[t]&&(n.contactGather[t]={...n.contactGather[t],online:a});for(const n of Object.values(e.groupGather)){if(!n.members)continue;const e=n.members.find(e=>e.userId===t);if(e){const t=n.members.indexOf(e);n.members[t]={...e,online:a}}}const r=n.operators.findIndex(e=>e.userId===t);return-1!==r&&(n.operators[r]={...n.operators[r],online:a}),n.activeRoom=Pe(n),n},Be=(e,t,a)=>{const n={...e};return n.contactGather[t]&&(n.contactGather[t]={...n.contactGather[t],unreadCount:a(n.contactGather[t].unreadCount)}),n.activeRoom=Pe(n),n},ze=(e,t,a)=>{const n={...e};return n.groupGather[t]&&(n.groupGather[t]={...n.groupGather[t],unreadCount:a(n.groupGather[t].unreadCount)}),n.activeRoom=Pe(n),n};function Ve(e,t){switch(t.type){case"SET_GROUP_GATHER":return{...e,groupGather:{...e.groupGather,[t.payload.groupId]:t.payload}};case"SET_CONTACT_GATHER":return{...e,contactGather:{...e.contactGather,[t.payload.userId]:t.payload}};case"DEL_GROUP":return((e,t)=>{const a={...e},n=a.activeRoom===a.groupGather[t];return delete a.groupGather[t],n&&(a.activeRoom=Fe(a)),a})(e,t.payload);case"DEL_GROUP_MEMBER":return((e,t)=>{const a={...e},n=a.groupGather[t.groupId];var r;return n&&(n.members=null==(r=n.members)?void 0:r.filter(e=>e.userId!==t.userId)),a})(e,t.payload);case"DEL_CONTACT":return((e,t)=>{const a={...e},n=a.activeRoom===a.contactGather[t];return delete a.contactGather[t],n&&(a.activeRoom=Fe(a)),a})(e,t.payload.userId);case"SET_USER_GATHER":return{...e,userGather:{...e.userGather,[t.payload.userId]:t.payload}};case"UPDATE_ACTIVE_ROOM":return{...e,activeRoom:Fe(e)};case"SET_ACTIVE_ROOM":return((e,t)=>({...e,chatOld:null!=e.activeRoom?{...e.activeRoom}:null,activeRoom:t.groupId?e.groupGather[t.groupId]:t.contactId?e.contactGather[t.contactId]:null}))(e,t.payload);case"USER_ONLINE":return He(e,t.payload,1);case"USER_OFFLINE":return He(e,t.payload,0);case"ADD_GROUP_MESSAGE":return((e,t)=>{const a={...e},{groupId:n}=t;a.groupGather[n]&&(a.groupGather[n].messages?a.groupGather[n].messages=[...a.groupGather[n].messages,t]:a.groupGather[n]={...e.groupGather[n],messages:[t]});const{activeRoom:r}=a;return r&&r.groupId!==n&&t.userId!==e.user.userId?ze(a,n,e=>(e||0)+1):(a.activeRoom=Pe(a),a)})(e,t.payload);case"ADD_PRIVATE_MESSAGE":return((e,t)=>{var a;const n={...e},r=t.contactId===e.user.userId?t.userId:t.contactId;return n.contactGather[r].messages?n.contactGather[r].messages=[...n.contactGather[r].messages,t]:n.contactGather[r]={...n.contactGather[r],messages:[t]},(null==(a=n.activeRoom)?void 0:a.userId)!==r&&t.userId!==e.user.userId?Be(n,r,e=>(e||0)+1):(n.activeRoom=Pe(n),n)})(e,t.payload);case"ADD_GROUP_UNREAD_GATHER":return ze(e,t.payload,e=>(e||0)+1);case"ADD_CONTACT_UNREAD_GATHER":return Be(e,t.payload,e=>(e||0)+1);case"SET_TYPING":return{...e,typing:t.payload};case"LOSE_GROUP_UNREAD_GATHER":return ze(e,t.payload,()=>0);case"LOSE_CONTACT_UNREAD_GATHER":return Be(e,t.payload,()=>0);case"REVOKE_MESSAGE":return((e,t)=>{const{userId:a}=e.user,n={...e},r=t.username||n.userGather[t.userId].username;if(t.groupId){const{messages:e}=n.groupGather[t.groupId];if(e){const a=e.find(e=>e._id===t._id);if(a){const t=e.indexOf(a);e[t]={...a,isRevoke:!0,revokeUserName:r}}}}else{const{messages:e}=n.contactGather[t.contactId===a?t.userId:t.contactId];if(e){const a=e.find(e=>e._id===t._id);if(a){const t=e.indexOf(a);e[t]={...a,isRevoke:!0,revokeUserName:r}}}}return n.activeRoom=Pe(n),n})(e,t.payload);case"UPDATE_GROUP_INFO":return((e,t)=>{const a={...e},{groupId:n,name:r,notice:o}=t,l=a.groupGather[n];return l&&(a.groupGather[n]={...l,name:r,notice:o}),a.activeRoom=Pe(a),a})(e,t.payload);case"UPDATE_USER_INFO":return((e,t)=>{const a={...e},{userId:n,username:r,avatar:o}=t;return a.userGather[n]&&(a.userGather[n]={...a.userGather[n],username:r,avatar:o}),a.contactGather[n]&&(a.contactGather[n]={...a.contactGather[n],username:r,avatar:o}),a.activeRoom=Pe(a),a})(e,t.payload);case"ADD_GROUP_MEMBER":return((e,t)=>{const a=t.members.map(e=>({...e,isManager:0})),n={...e};return n.groupGather[t.groupId].members&&a?n.groupGather[t.groupId].members=[...e.groupGather[t.groupId].members,...a]:n.groupGather[t.groupId]={...n.groupGather[t.groupId],members:a},n.activeRoom=Pe(n),n})(e,t.payload);case"SET_CONFERENCE":return((e,t)=>({...e,conference:{data:{...t},joined:(null==t?void 0:t.userId)===e.user.userId,ringPlayed:(null==t?void 0:t.userId)!==e.user.userId}}))(e,t.payload);case"JOIN_CONFERENCE":return{...e,conference:{data:{...t.payload},joined:!0,ringPlayed:!1}};case"PAUSE_CONFERENCE":return((e,t)=>{var a;return(null==(a=e.conference.data)?void 0:a.id)!==(null==t?void 0:t.id)?e:{...e,conference:{data:{...e.conference.data},joined:!1,ringPlayed:!1}}})(e,t.payload);case"STOP_CONFERENCE":return((e,t)=>{var a;return(null==(a=e.conference.data)?void 0:a.id)!==(null==t?void 0:t.id)?e:{...e,conference:{data:null,joined:!1,ringPlayed:!1}}})(e,t.payload);case"MARK_PRIVATE_MESSAGES_READ":return((e,t)=>{const a={...e};if(a.contactGather[t]){const e={...a.contactGather[t]};if(e.messages)for(let t=0;t<e.messages.length;t++)e.messages[t]={...e.messages[t],status:1};a.contactGather[t]=e}return a.activeRoom=Pe(a),a})(e,t.payload);case"ADD_PRIVATE_MESSAGES":return((e,t)=>{const a={...e},{messages:n,contactId:r}=t;return a.contactGather[r]&&(a.contactGather[r]={...a.contactGather[r],messages:[...n||[],...a.contactGather[r].messages||[]],noMoreData:!(null==n||!n.length)&&(null==n?void 0:n.length)<t.pageSize}),a.activeRoom=Pe(a),a})(e,t.payload);case"ADD_GROUP_MESSAGES":return((e,t)=>{const a={...e},{groupId:n,messages:r,userArr:o}=t;a.groupGather[n]&&(a.groupGather[n]={...a.groupGather[n],messages:[...r||[],...a.groupGather[n].messages||[]],noMoreData:!(null==r||!r.length)&&(null==r?void 0:r.length)<t.pageSize}),a.userGather={...a.userGather};for(const e of o)a.userGather[e.userId]||(a.userGather[e.userId]=e);return a.activeRoom=Pe(a),a})(e,t.payload);case"SET_LOADING":return{...e,loading:t.payload,error:""};case"SET_ERROR":return{...e,error:t.payload,success:void 0};case"SET_SUCCES":return{...e,success:t.payload,error:void 0};case"SET_TOKEN":return((e,t)=>({...e,token:t}))(e,t.payload);case"SET_USER":return{...e,user:t.payload};case"CLEAR_USER":return(e=>({...e,token:"",user:Le}))(e);case"CLEAR_CHAT_DATA":return{...e,activeRoom:null,groupGather:{},userGather:{},contactGather:{},conference:{data:null,joined:!1,ringPlayed:!1},typing:null};case"SET_OPERATORS":return{...e,operators:t.payload};case"SET_VISIT_DATA":return{...e,visitData:t.payload}}return e}const Ye=o.createContext({state:je,dispatch:()=>null}),qe=e=>{Le.langCode=e.defLang;const t=e.token,a=e.token,n={...je,token:t,refreshToken:a},[r,l]=o.useReducer(Ve,n);return o.createElement(Ye.Provider,{value:{state:r,dispatch:l}},e.children)},We=r.createContext({});function Ke(){localStorage.removeItem("authToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("user"),localStorage.removeItem("doctor"),localStorage.removeItem("chatUser")}const Je=async()=>{try{await _.post("auth/logout")}catch(e){console.log("ERROR Logout",e)}Ke(),window.location.href="/"},$e=async(e,t,a)=>{try{const{data:a}=await _.post("auth/refreshToken",{authToken:e,refreshToken:t});localStorage.setItem("authToken",null==a?void 0:a.authToken),localStorage.setItem("refreshToken",null==a?void 0:a.refreshToken),window.location.href="/"}catch(e){console.log("ERROR RefreshToken",e),a({type:"CLEAR_USER"}),Je()}},Xe=e=>{let{baseURLApi:t,pageSize:a,children:n}=e;const{state:l,dispatch:s}=r.useContext(Ye),i=_.create({timeout:6e4,baseURL:t,headers:{"Cache-Control":"no-cache",Pragma:"no-cache",Authorization:"Bearer "+l.token},withCredentials:!1});i.interceptors.response.use(e=>e,e=>(console.log("ERROR AxiosError"),(e=>{null!=e.response&&401===e.response.status&&$e(l.token,l.refreshToken,s)})(e),Promise.reject(e)));const c=r.useCallback(async(e,t)=>{var n;const r=e.userId,o=null==(n=e.messages)?void 0:n.length;try{s({type:"SET_LOADING",payload:!0});const{data:e}=await i.get("/contact/messages",{params:{contactId:r,current:o,pageSize:a}});e&&(s({type:"ADD_PRIVATE_MESSAGES",payload:{pageSize:a,contactId:r,messages:e}}),t&&t())}catch(e){s({type:"SET_ERROR",payload:e.message})}finally{s({type:"SET_LOADING",payload:!1})}},[s]),u=r.useCallback(async e=>{var t;const{groupId:n}=e,r=null==(t=e.messages)?void 0:t.length;try{s({type:"SET_LOADING",payload:!0});const{data:e}=await i.get("/group/messages",{params:{groupId:n,current:r,pageSize:a}});e&&s({type:"ADD_GROUP_MESSAGES",payload:{pageSize:a,groupId:n,...e}})}catch(e){s({type:"SET_ERROR",payload:e.message})}finally{s({type:"SET_LOADING",payload:!1})}},[s]);return o.createElement(We.Provider,{value:{apiUrl:t,pageSize:a,fetch:i,getPrivateMessages:c,getGroupMessages:u,getUserByMmk:async(e,t)=>{try{const{data:a}=await i.get("/contact/find",{params:{mmkId:e,guid:t}});if(null!=a)return a}catch(e){console.log("err getUserByMmk",e)}}}},n)},Qe=r.createContext({online:!1}),Ze=e=>{let{wsUrl:t,wsPath:a,children:n}=e;const{state:l,dispatch:s}=r.useContext(Ye),{socket:i,online:c,disconnectSocket:u,connectSocket:d}=((e,t,a)=>{const[n,o]=r.useState(null),l=r.useCallback(()=>{const n=b(e,{path:t,reconnection:!0,extraHeaders:{Authorization:"Bearer "+a}});o(n)},[e,t,a]),s=r.useCallback(()=>{null==n||n.disconnect(),o(null)},[n]),[i,c]=r.useState(!1);return r.useEffect(()=>{c(!(null==n||!n.connected))},[n]),r.useEffect(()=>{null==n||n.on("connect",()=>{c(!0),n.emit("chatData")})},[n]),r.useEffect(()=>{null==n||n.on("disconnect",()=>{c(!1)})},[n]),{socket:n,online:i,disconnectSocket:s,connectSocket:l}})(t,a,l.token);return r.useEffect(()=>(l.token&&d(),()=>{u()}),[l.token,d]),r.useEffect(()=>{l.token||u()},[l.token,u]),r.useEffect(()=>{const e=e=>{console.log("unauthorized msg",e),$e(l.token,l.refreshToken,s)};return null==i||i.on("unauthorized",e),()=>{null==i||i.off("unauthorized",e)}},[null==i?void 0:i.id]),r.useEffect(()=>{const e=e=>{if(e.code)return void s({type:"SET_ERROR",payload:e.msg});console.log("res.data",e.data);const t=e.data,a=t.groupData,n=t.contactData,r=t.userData;if(s({type:"CLEAR_CHAT_DATA"}),s({type:"SET_USER",payload:t.user}),a.length)for(const e of a)null==i||i.emit("joinGroupSocket",{groupId:e.groupId}),s({type:"SET_GROUP_GATHER",payload:e});if(n.length)for(const e of n)null==i||i.emit("joinPrivateSocket",{contactId:e.userId}),s({type:"SET_CONTACT_GATHER",payload:e});if(s({type:"SET_OPERATORS",payload:t.operatorData}),r.length)for(const e of r)s({type:"SET_USER_GATHER",payload:e});s({type:"UPDATE_ACTIVE_ROOM"}),s({type:"SET_CONFERENCE",payload:t.conferenceData}),s({type:"SET_VISIT_DATA",payload:t.visitData})};return null==i||i.on("chatData",e),()=>{null==i||i.off("chatData",e)}},[null==i?void 0:i.id]),r.useEffect(()=>{const e=e=>{s({type:"USER_ONLINE",payload:e.data})};return null==i||i.on("userOnline",e),()=>{null==i||i.off("userOnline",e)}},[null==i?void 0:i.id]),r.useEffect(()=>{const e=e=>{s({type:"USER_OFFLINE",payload:e.data})};return null==i||i.on("userOffline",e),()=>{null==i||i.off("userOffline",e)}},[null==i?void 0:i.id]),r.useEffect(()=>{const e=e=>{e.code?s({type:"SET_ERROR",payload:e.msg}):console.log("Ð£ÑÐ¿ÐµÑˆÐ½Ð¾ Ð²Ð¾ÑˆÐµÐ» Ð² Ð¿Ñ€Ð¸Ð²Ð°Ñ‚Ð½Ñ‹Ð¹ Ñ‡Ð°Ñ‚")};return null==i||i.on("joinPrivateSocket",e),()=>{null==i||i.off("joinPrivateSocket",e)}},[null==i?void 0:i.id]),r.useEffect(()=>{const e=e=>{var t;if(e.code)return void s({type:"SET_ERROR",payload:e.msg});const a=e.data,n=a.user;n.online=1;const{group:r}=a,o=l.groupGather[r.groupId];var i;!o||null!=(t=o.members)&&t.find(e=>e.userId===n.userId)||(n.isManager=0,null==(i=o.members)||i.push(n)),s({type:"SET_USER_GATHER",payload:n})};return null==i||i.on("joinGroupSocket",e),()=>{null==i||i.off("joinGroupSocket",e)}},[null==i?void 0:i.id,l.groupGather]),r.useEffect(()=>{const e=async e=>{if(e.code)return void s({type:"SET_ERROR",payload:e.msg});const t=e.data;s({type:"ADD_GROUP_MESSAGE",payload:t});const{activeRoom:a}=l;a&&a.groupId===t.groupId&&t.userId!==l.user.userId&&(null==i||i.emit("markAsRead",{groupId:t.groupId,_id:t._id}))};return null==i||i.on("groupMessage",e),()=>{null==i||i.off("groupMessage",e)}},[null==i?void 0:i.id,l.activeRoom]),r.useEffect(()=>{const e=async e=>{if(e.code)return void s({type:"SET_ERROR",payload:e.msg});const t=e.data;var a;t.contactId!==l.user.userId&&t.userId!==l.user.userId||(s({type:"ADD_PRIVATE_MESSAGE",payload:t}),l.activeRoom&&!l.activeRoom.groupId&&(null==(a=l.activeRoom)?void 0:a.userId)===t.userId&&(null==i||i.emit("markAsRead",{contactId:t.userId,_id:t._id})))};return null==i||i.on("privateMessage",e),()=>{null==i||i.off("privateMessage",e)}},[null==i?void 0:i.id,l.activeRoom]),r.useEffect(()=>{let e;const t=t=>{t.code?s({type:"SET_ERROR",payload:t.msg}):(e&&clearTimeout(e),s({type:"SET_TYPING",payload:t.data}),e=setTimeout(()=>{s({type:"SET_TYPING",payload:null})},1e3))};return null==i||i.on("typing",t),()=>{e&&clearTimeout(e),null==i||i.off("typing",t)}},[null==i?void 0:i.id]),r.useEffect(()=>{const e=e=>{if(e.code)return void s({type:"SET_ERROR",payload:e.msg});const t=e.data;t.userId===l.user.userId?s(t.groupId?{type:"LOSE_GROUP_UNREAD_GATHER",payload:t.groupId}:{type:"LOSE_CONTACT_UNREAD_GATHER",payload:t.contactId}):t.contactId&&s({type:"MARK_PRIVATE_MESSAGES_READ",payload:t.userId})};return null==i||i.on("markAsRead",e),()=>{null==i||i.off("markAsRead",e)}},[null==i?void 0:i.id,l.user.userId]),r.useEffect(()=>{const e=e=>{s(e.code?{type:"SET_ERROR",payload:e.msg}:{type:"REVOKE_MESSAGE",payload:e.data})};return null==i||i.on("revokeMessage",e),()=>{null==i||i.off("revokeMessage",e)}},[null==i?void 0:i.id]),r.useEffect(()=>{const e=e=>{s(e.code?{type:"SET_ERROR",payload:e.msg}:{type:"SET_GROUP_GATHER",payload:e.data})};return null==i||i.on("addGroup",e),()=>{null==i||i.off("addGroup",e)}},[null==i?void 0:i.id]),r.useEffect(()=>{const e=e=>{if(e.code)return void s({type:"SET_ERROR",payload:e.msg});const t=e.data;s({type:"SET_CONTACT_GATHER",payload:t}),s({type:"SET_USER_GATHER",payload:t}),null==i||i.emit("joinPrivateSocket",{contactId:t.userId})};return null==i||i.on("addContact",e),()=>{null==i||i.off("addContact",e)}},[null==i?void 0:i.id]),r.useEffect(()=>{const e=e=>{if(e.code)return void s({type:"SET_ERROR",payload:e.msg});const t=e.data;s(t.userId===l.user.userId?{type:"DEL_GROUP",payload:t.groupId}:{type:"DEL_GROUP_MEMBER",payload:t})};return null==i||i.on("deleteGroup",e),()=>{null==i||i.off("deleteGroup",e)}},[null==i?void 0:i.id,l.user]),r.useEffect(()=>{const e=e=>{s(e.code?{type:"SET_ERROR",payload:e.msg}:{type:"DEL_CONTACT",payload:e.data})};return null==i||i.on("deleteContact",e),()=>{null==i||i.off("deleteContact",e)}},[null==i?void 0:i.id]),r.useEffect(()=>{const e=e=>{s(e.code?{type:"SET_ERROR",payload:e.msg}:{type:"UPDATE_GROUP_INFO",payload:e.data})};return null==i||i.on("updateGroupInfo",e),()=>{null==i||i.off("updateGroupInfo",e)}},[null==i?void 0:i.id]),r.useEffect(()=>{const e=e=>{s(e.code?{type:"SET_ERROR",payload:e.msg}:{type:"UPDATE_USER_INFO",payload:e.data})};return null==i||i.on("updateUserInfo",e),()=>{null==i||i.off("updateUserInfo",e)}},[null==i?void 0:i.id]),r.useEffect(()=>{const e=e=>{if(e.code)return void s({type:"SET_ERROR",payload:e.msg});const{group:t,user:a}=e.data;l.groupGather[t.groupId]?a.userId!==l.user.userId&&s({type:"ADD_GROUP_MEMBER",payload:{groupId:t.groupId,members:[a]}}):(console.log("joined to a new group"),null==i||i.emit("chatData"))};return null==i||i.on("joinGroup",e),()=>{null==i||i.off("joinGroup",e)}},[null==i?void 0:i.id,l.user,l.groupGather]),r.useEffect(()=>{const e=e=>{s(e.code?{type:"SET_ERROR",payload:e.msg}:{type:"SET_CONFERENCE",payload:e.data})};return null==i||i.on("startConference",e),()=>{null==i||i.off("startConference",e)}},[null==i?void 0:i.id]),r.useEffect(()=>{const e=e=>{s(e.code?{type:"SET_ERROR",payload:e.msg}:{type:"PAUSE_CONFERENCE",payload:e.data})};return null==i||i.on("pauseConference",e),()=>{null==i||i.off("pauseConference",e)}},[null==i?void 0:i.id]),r.useEffect(()=>{const e=e=>{s(e.code?{type:"SET_ERROR",payload:e.msg}:{type:"STOP_CONFERENCE",payload:e.data})};return null==i||i.on("stopConference",e),()=>{null==i||i.off("stopConference",e)}},[null==i?void 0:i.id]),r.useEffect(()=>{const e=e=>{e.code&&s({type:"SET_ERROR",payload:e.msg})};return null==i||i.on("addOperator",e),()=>{null==i||i.off("addOperator",e)}},[null==i?void 0:i.id]),r.useEffect(()=>{const e=e=>{s(e.code?{type:"SET_ERROR",payload:e.msg}:{type:"SET_ACTIVE_ROOM",payload:e.data})};return null==i||i.on("setActiveRoom",e),()=>{null==i||i.off("setActiveRoom",e)}},[null==i?void 0:i.id]),o.createElement(Qe.Provider,{value:{socket:i,online:c}},n)},et=e=>{let{audio:t,video:a}=e;const{t:n}=m.useTranslation(),{dispatch:r}=o.useContext(Ye),s=n(t&&a?"CHAT.CONFERENCE.CheckCamMic":t?"CHAT.CONFERENCE.CheckMic":"CHAT.CONFERENCE.CheckCam");return o.createElement(l.Tooltip,{title:s},o.createElement(l.IconButton,{"aria-label":"check",onClick:()=>{navigator.mediaDevices.getUserMedia({audio:t,video:a}).then(e=>{console.log("permissions",e),r({type:"SET_SUCCES",payload:n("CHAT.CONFERENCE.ALLOK")})}).catch(e=>{let t=n("CHAT.CONFERENCE.ErrorAny");"NotFoundError"===e.name&&(t=n("CHAT.CONFERENCE.NotFoundError")),"NotAllowedError"===e.name&&(t=n("CHAT.CONFERENCE.NotAllowedError")),r({type:"SET_ERROR",payload:t}),console.log("err",e.name+" : "+e.message)})},size:"large"},o.createElement(t&&a?G:t?k:D,null)))},tt=()=>{const{state:{error:e,success:t},dispatch:a}=o.useContext(Ye),n=()=>{a({type:"SET_ERROR",payload:void 0}),a({type:"SET_SUCCES",payload:void 0})};return o.createElement(l.Snackbar,{anchorOrigin:{vertical:"top",horizontal:"center"},open:!!e||!!t,autoHideDuration:6e3,onClose:n},o.createElement(l.Alert,{onClose:n,severity:e?"error":"success"},e||t))},at=s.makeStyles(e=>({root:{height:"100%",overflow:"hidden",padding:0},innerGrid:{height:"100%",width:"100%"},conAbsOnConf:{position:"absolute",top:42,left:25,zIndex:1e3,margin:e.spacing(3)}})),nt=e=>{var t,a,n,o,s,i,c;let{activeGroupId:u,activeChatUserId:p,inModale:E=!0}=e;const g=at(),f=l.useMediaQuery(e=>e.breakpoints.down("sm")),{t:h}=m.useTranslation(),{state:y,dispatch:C}=r.useContext(Ye),{socket:T}=r.useContext(Qe),{apiUrl:v,pageSize:R,getPrivateMessages:I,getGroupMessages:S,getUserByMmk:A}=r.useContext(We),O=r.useCallback(()=>{C({type:"SET_ACTIVE_ROOM",payload:{}})},[C]),N=r.useCallback(async e=>{e.groupId?await S(e):await I(e)},[I,S]),x=r.useCallback((e,t)=>{null==T||T.emit("revokeMessage",{groupId:e.groupId,contactId:e.userId,_id:t._id})},[null==T?void 0:T.id]),_=r.useCallback(e=>{null==T||T.emit("typing",{groupId:null==e?void 0:e.groupId,contactId:null==e?void 0:e.userId})},[null==T?void 0:T.id]),b=r.useCallback((e,t)=>{e.groupId?null==T||T.emit("groupMessage",{groupId:null==e?void 0:e.groupId,content:t.message,width:t.width,height:t.height,fileName:t.fileName,messageType:t.messageType,size:t.size}):null==T||T.emit("privateMessage",{contactId:null==e?void 0:e.userId,content:t.message,width:t.width,height:t.height,fileName:t.fileName,messageType:t.messageType,size:t.size})},[null==T?void 0:T.id]),G=r.useCallback(e=>{C({type:"SET_ACTIVE_ROOM",payload:{groupId:null==e?void 0:e.groupId,contactId:null==e?void 0:e.userId}}),k(e)},[null==T?void 0:T.id,C]),k=r.useCallback(e=>{e.messages&&0!==e.messages.length&&(e.groupId?null==T||T.emit("markAsRead",{groupId:e.groupId,_id:e.messages[e.messages.length-1]._id}):null==T||T.emit("markAsRead",{contactId:e.userId,_id:e.messages[e.messages.length-1]._id}))},[null==T?void 0:T.id]),D=r.useCallback((function(e,t){void 0===t&&(t=null),null==T||T.emit("startConference",{groupId:e.groupId,contactId:e.userId,visitId:t})}),[null==T?void 0:T.id]),M=r.useCallback(e=>{null!=(null==e?void 0:e.id)&&(null==T||T.emit("stopConference",{id:null==e?void 0:e.id}))},[null==T?void 0:T.id]),w=r.useCallback(e=>{null!=(null==e?void 0:e.id)&&(null==T||T.emit("pauseConference",{id:e.id}))},[null==T?void 0:T.id]),U=r.useCallback(e=>{null!=(null==e?void 0:e.id)&&(null==T||T.emit("resumeConference",{id:e.id})),C({type:"JOIN_CONFERENCE",payload:e})},[null==T?void 0:T.id,C]),L=r.useCallback((e,t)=>{null==T||T.emit("addOperator",{groupId:e.groupId,operatorId:t.userId})},[null==T?void 0:T.id]),j=r.useCallback(e=>{null==T||T.emit("deleteGroup",{groupId:e.groupId})},[null==T?void 0:T.id]);r.useEffect(()=>{if(null!=p&&!z(y.contactGather)){const e=Object.values(y.contactGather).find(e=>e.userId===p);G(e)}const e=J("mmk"),t=J("guid");null==e&&null==t||z(y.contactGather)||(async()=>{const a=await A(e,t);if(null!=a){const e=Object.values(y.contactGather).find(e=>e.userId===a);G(e)}})()},[y.contactGather]),r.useEffect(()=>{if(null!=u&&!z(y.groupGather)){const e=Object.values(y.groupGather).find(e=>e.groupId===u);z(e)||G(e)}},[y.groupGather]);const P=null!=y.activeRoom&&r.createElement(Se,{apiUrl:v,user:y.user,users:y.userGather,operators:y.operators,chat:y.activeRoom,typing:y.typing,conference:y.conference.data,visitData:y.visitData,conferenceJoined:y.conference.joined,loading:y.loading,pageSize:R,onExitRoom:O,onEnterRoom:k,onNeedMoreMessages:N,onMeesageDelete:x,onTyping:_,onSendMessage:b,onVideoCall:D,onVideoEnd:M,onConferencePause:w,onOperatorAdd:L,onLeaveGroup:j}),F=()=>r.createElement(ke,{apiUrl:v,user:y.user,activeRoom:y.activeRoom,groups:Object.values(y.groupGather),contacts:Object.values(y.contactGather),typing:y.typing,onChangeChat:G}),H=()=>y.conference.data&&r.createElement(Ue,{apiUrl:v,contact:y.contactGather[y.user.userId===y.conference.data.userId?y.conference.data.contactId:y.conference.data.userId],conference:y.conference.data,onAccept:U}),B=()=>r.createElement(Me,{conference:y.conference.data,onClose:w,langCode:y.user.langCode}),V=null!=(t=y.conference.data)&&t.id?[y.conference.joined,null==(a=y.conference.data)?void 0:a.id,null==(n=y.conference.data)?void 0:n.contactId,null==(o=y.activeRoom)?void 0:o.groupId,null==(s=y.activeRoom)?void 0:s.userId]:[y.activeRoom,W(y.groupGather),W(y.contactGather)],Y=r.useMemo(()=>{var e;return null!=(null==(e=y.conference.data)?void 0:e.id)?r.createElement(r.Fragment,null,r.createElement(y.conference.joined?B:H,null),r.createElement(l.Box,{className:g.conAbsOnConf},r.createElement(l.Paper,{style:{borderRadius:8}},r.createElement(l.Box,{display:"flex",flexDirection:"row",my:3},(z(y.activeRoom)&&f||!z(y.activeRoom)&&!f)&&r.createElement(r.Fragment,null,r.createElement(et,{audio:!0,video:!1}),r.createElement(et,{audio:!1,video:!0})),z(y.activeRoom)&&null!=y.chatOld&&f&&r.createElement(l.Tooltip,{title:h("CHAT.CONFERENCE.BACK")},r.createElement(l.IconButton,{"aria-label":"check",onClick:()=>null!=y.chatOld&&G(y.chatOld),size:"large"},r.createElement(d.ArrowForward,null))))))):r.createElement(F,null)},V);return console.log("chat state",y),r.createElement(l.Container,{maxWidth:"lg",className:g.root,sx:e=>({width:E?"calc(100vw - "+e.spacing(8)+")":"100%"})},f?r.createElement(r.Fragment,null,Y,P):r.createElement(l.Grid,{container:!0,spacing:1,className:g.innerGrid},r.createElement(l.Grid,{item:!0,sm:null!=(null==(i=y.conference.data)?void 0:i.id)?6:4,className:g.innerGrid},Y),r.createElement(l.Grid,{item:!0,sm:null!=(null==(c=y.conference.data)?void 0:c.id)?6:8,className:g.innerGrid},P)),r.createElement(tt,null))},rt=(()=>{const e=localStorage.getItem("user");if(e){const t=JSON.parse(e);return null==t?void 0:t.lang}return"ru"})();M.use(w).use(m.initReactI18next).init({resources:{ru:{translations:{CHAT:{STATUS:{ONLINE:"Ð² ÑÐµÑ‚Ð¸",OFFLINE:"Ð½Ðµ Ð² ÑÐµÑ‚Ð¸",TYPING:"Ð¿ÐµÑ‡Ð°Ñ‚Ð°ÐµÑ‚"},MESSAGE:{TYPE:{IMAGE:"Ð˜Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ",VIDEO:"Ð’Ð¸Ð´ÐµÐ¾",FILE:"Ð¤Ð°Ð¹Ð»",NOTIFY:"Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ðµ"},MENU:{COPY:"ÐšÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ",DELETE:"Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ"},REVOKED:{YOU:"Ð’Ñ‹ ÑƒÐ´Ð°Ð»Ð¸Ð»Ð¸ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ",CONTACT:"ÑƒÐ´Ð°Ð»Ð¸Ð»(Ð°) ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ"}},CONFERENCE:{JOIN:"ÐŸÑ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½Ð¸Ñ‚ÑŒÑÑ",START:"ÐÐ°Ñ‡Ð°Ñ‚ÑŒ",RESTART:"ÐŸÐµÑ€ÐµÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ ÐºÐ¾Ð½Ñ„ÐµÑ€ÐµÐ½Ñ†Ð¸ÑŽ",CONFIRM_RECREATE_CONF:"Ð’Ñ‹ ÑƒÐ²ÐµÑ€ÐµÐ½Ð° Ñ‡Ñ‚Ð¾ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ Ð¿ÐµÑ€ÐµÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ ÐºÐ¾Ð½Ñ„ÐµÑ€ÐµÐ½Ñ†Ð¸ÑŽ?",PAUSE:"ÐžÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ",FINISH:"Ð—Ð°Ð²ÐµÑ€ÑˆÐ¸Ñ‚ÑŒ",BACK:"Ð’ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ Ð² Ñ‡Ð°Ñ‚",NotFoundError:"Ð—Ð°Ð¿Ñ€Ð¾ÑˆÐµÐ½Ð½Ð¾Ðµ ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð¾ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾",NotAllowedError:"Ð’ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ðµ  Ð¾Ñ‚ÐºÐ°Ð·Ð°Ð½Ð¾. Ð§Ñ‚Ð¾Ð±Ñ‹ Ñ€Ð°Ð·Ñ€ÐµÑˆÐ¸Ñ‚ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ðº ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ñƒ Ð·Ð°Ð¹Ð´Ð¸Ñ‚Ðµ Ð² Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ð°",ErrorAny:"Ð£ÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð¾ Ð½Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¾",ALLOK:"Ð’ÑÐµ OK",CheckCamMic:"ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ðº Ð¼Ð¸ÐºÑ€Ð¾Ñ„Ð¾Ð½Ñƒ Ð¸ ÐºÐ°Ð¼ÐµÑ€Ðµ",CheckMic:"ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ðº Ð¼Ð¸ÐºÑ€Ð¾Ñ„Ð¾Ð½Ñƒ",CheckCam:"ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ðº ÐºÐ°Ð¼ÐµÑ€Ðµ",UntillTheEnd:"Ð”Ð¾ Ð¾ÐºÐ¾Ð½Ñ‡Ð°Ð½Ð¸Ñ ÐºÐ¾Ð½Ñ„ÐµÑ€ÐµÐ½Ñ†Ð¸Ð¸ Ð¾ÑÑ‚Ð°Ð»Ð¾ÑÑŒ",LEFT_TIME:"ÐžÑÑ‚Ð°Ð»Ð¾ÑÑŒ"},ADD_CONTACT:"Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚",INPUT_MESSAGE:"ÐÐ°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ...",INPUT_SEARCH_CONTACT:"Ð¤Ð°Ð¼Ð¸Ð»Ð¸Ñ Ð˜Ð¼Ñ ÐžÑ‚Ñ‡ÐµÑÑ‚Ð²Ð¾",MEMBERS:"ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð²",BUT_CLOSE:"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ",BUT_CONFIRM:"Ð”Ð°"}}},en:{translations:{CHAT:{STATUS:{ONLINE:"online",OFFLINE:"offline",TYPING:"typing"},MESSAGE:{TYPE:{IMAGE:"Image",VIDEO:"Video",FILE:"File",NOTIFY:"Notification"},MENU:{COPY:"Copy",DELETE:"Delete"},REVOKED:{YOU:"You deleted the message",CONTACT:"deleted the message"}},CONFERENCE:{JOIN:"Join",START:"Start",RESTART:"Recreate the conference",CONFIRM_RECREATE_CONF:"Are you sure you want to re-create the conference?",PAUSE:"Pause",FINISH:"Finish",BACK:"Back to chat",NotFoundError:"Requested device not found",NotAllowedError:"Permission denied. To allow access to the device, go to the browser settings",ErrorAny:"The device is not configured",ALLOK:"All OK",CheckCamMic:"Check access to microphone and camera",CheckMic:"Check access to microphone",CheckCam:"Check access to camera",UntillTheEnd:"There is still time until the end of the conference",LEFT_TIME:"Time left"},ADD_CONTACT:"Add contact",INPUT_MESSAGE:"Please write a message...",INPUT_SEARCH_CONTACT:"Surname Name",MEMBERS:"members",BUT_CLOSE:"Close",BUT_CONFIRM:"Yes"}}},fr:{translations:{CHAT:{STATUS:{ONLINE:"en ligne",OFFLINE:"hors ligne",TYPING:"imprime"},MESSAGE:{TYPE:{IMAGE:"Image",VIDEO:"VidÃ©o",FILE:"File",NOTIFY:"Notification"},MENU:{COPY:"Copier",DELETE:"Supprimer"},REVOKED:{YOU:"Vous avez supprimÃ© le message",CONTACT:"message supprimÃ©"}},CONFERENCE:{JOIN:"Rejoindre",START:"DÃ©marrer",RESTART:"RecrÃ©er la confÃ©rence",CONFIRM_RECREATE_CONF:"Ãªtes-vous sÃ»r de vouloir recrÃ©er la confÃ©rence?",PAUSE:"Pause",FINISH:"Terminer",BACK:"Retour au chat",NotFoundError:"PÃ©riphÃ©rique demandÃ© introuvable",NotAllowedError:"Autorisation refusÃ©e. Pour autoriser l'accÃ¨s Ã  l'appareil, accÃ©dez aux paramÃ¨tres du navigateur",ErrorAny:"L'appareil n'est pas configurÃ©",ALLOK:"Tout va bien",CheckCamMic:"VÃ©rifier l'accÃ¨s au microphone et Ã  la camÃ©ra",CheckMic:"VÃ©rifier l'accÃ¨s au microphone",CheckCam:"VÃ©rifier l'accÃ¨s Ã  la camÃ©ra",UntillTheEnd:" Il est encore temps jusqu'Ã  la fin de la confÃ©rence",LEFT_TIME:"temps restant:"},ADD_CONTACT:"Ajouter un contact",INPUT_MESSAGE:"Veuillez Ã©crire un message...",INPUT_SEARCH_CONTACT:"Surname Name",MEMBERS:"members",BUT_CLOSE:"Fermer",BUT_CONFIRM:"Oui"}}}},lng:rt,load:"languageOnly",fallbackLng:rt,debug:!0,ns:["translations"],defaultNS:"translations",lowerCaseLng:!0});const ot=(e,t)=>{switch(t.type){case"SET_ENGLISH":return M.changeLanguage("en"),{language:"en"};case"SET_FRENCH":return M.changeLanguage("fr"),{language:"fr"};case"SET_RUSSIAN":return M.changeLanguage("ru"),{language:"ru"};default:return e}},lt=r.createContext({}),st=e=>{const[t,a]=r.useReducer(ot,{language:M.language.substring(0,2)});return o.createElement(lt.Provider,{value:{languageState:t,dispatchLanguage:a}},o.createElement(m.I18nextProvider,{i18n:M},e.children))};exports.AddContact=Z,exports.ChatContext=Ye,exports.ChatIndex=e=>{let{activeGroupId:t,activeChatUserId:a,lang:n,chatBaseURLApi:r,chatWsUrl:l,chatWsPath:s,token:i,inModale:c=!1,refreshToken:u}=e;return o.createElement(st,null,o.createElement(qe,{defLang:n,token:i,refreshToken:u},o.createElement(Xe,{baseURLApi:r,pageSize:25},o.createElement(Ze,{wsUrl:l,wsPath:s},o.createElement(nt,{activeGroupId:t,activeChatUserId:a,inModale:c})))))},exports.ChatPage=nt,exports.ChatProvider=qe,exports.Conference=Me,exports.ConferenceCall=Ue,exports.Emoji=L,exports.Message=ye,exports.RestContext=We,exports.RestProvider=Xe,exports.Room=Se,exports.RoomList=ke,exports.SocketContext=Qe,exports.SocketProvider=Ze,exports.Typing=P,exports.clearLocalStorage=Ke,exports.getRefreshToken=$e,exports.signOut=Je;
//# sourceMappingURL=chat.cjs.production.min.js.map
