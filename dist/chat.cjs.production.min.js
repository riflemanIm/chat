"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t,n,r,a=require("react"),o=e(a),i=require("@material-ui/core"),l=e(require("@material-ui/icons/FileCopy")),c=e(require("@material-ui/icons/Delete")),u=e(require("@material-ui/icons/ArrowBack")),s=require("@material-ui/icons"),d=require("react-i18next"),m=e(require("moment")),p=e(require("react-viewer")),f=require("@material-ui/lab"),E=e(require("@material-ui/icons/Group")),g=e(require("@material-ui/icons/VideoCall")),v=e(require("@material-ui/icons/CallEnd")),h=e(require("@material-ui/icons/PersonAdd")),y=require("@material-ui/styles"),I=e(require("@material-ui/icons/Star")),C=require("@material-ui/core/styles"),T=e(require("@material-ui/core/List")),R=e(require("axios")),S=e(require("socket.io-client"));(t=exports.MessageStatus||(exports.MessageStatus={}))[t.sent=0]="sent",t[t.read=1]="read",(n=exports.Role||(exports.Role={}))[n.Unknown=0]="Unknown",n[n.Client=1]="Client",n[n.Agent=2]="Agent",n[n.Specialist=3]="Specialist",n[n.Operator=4]="Operator",(r=exports.ContextMenuType||(exports.ContextMenuType={})).COPY="COPY",r.REVOKE="REVOKE",r.TOP_REVERT="TOP_REVERT",r.TOP="TOP",r.READ="READ",r.DELETE="DELETE";var x=i.makeStyles((function(){return i.createStyles({item:{cursor:"pointer"}})})),b=function(e){var t=x(),n=function(t){e.onSelect&&e.onSelect(t.target.innerText)},r=function(e){return a.createElement(i.Box,{m:.5,component:"span",onClick:n,className:t.item},e.emoji)};return a.createElement(i.Box,null,a.createElement(i.Box,{display:"flex",flexDirection:"row"},a.createElement(r,{emoji:"ğŸ˜ƒ"}),a.createElement(r,{emoji:"ğŸ˜"}),a.createElement(r,{emoji:"ğŸ˜‚"}),a.createElement(r,{emoji:"ğŸ˜„"}),a.createElement(r,{emoji:"ğŸ˜…"}),a.createElement(r,{emoji:"ğŸ˜†"}),a.createElement(r,{emoji:"ğŸ˜‡"}),a.createElement(r,{emoji:"ğŸ˜ˆ"}),a.createElement(r,{emoji:"ğŸ˜‰"})),a.createElement(i.Box,{display:"flex",flexDirection:"row"},a.createElement(r,{emoji:"ğŸ˜Š"}),a.createElement(r,{emoji:"ğŸ˜‹"}),a.createElement(r,{emoji:"ğŸ˜Œ"}),a.createElement(r,{emoji:"ğŸ˜"}),a.createElement(r,{emoji:"ğŸ˜"}),a.createElement(r,{emoji:"ğŸ˜"}),a.createElement(r,{emoji:"ğŸ˜"}),a.createElement(r,{emoji:"ğŸ˜’"}),a.createElement(r,{emoji:"ğŸ˜“"})),a.createElement(i.Box,{display:"flex",flexDirection:"row"},a.createElement(r,{emoji:"â“"}),a.createElement(r,{emoji:"ğŸ˜•"}),a.createElement(r,{emoji:"ğŸ˜–"}),a.createElement(r,{emoji:"ğŸ˜—"}),a.createElement(r,{emoji:"ğŸ˜˜"}),a.createElement(r,{emoji:"ğŸ˜™"}),a.createElement(r,{emoji:"ğŸ˜š"}),a.createElement(r,{emoji:"ğŸ˜œ"}),a.createElement(r,{emoji:"ğŸ˜"})),a.createElement(i.Box,{display:"flex",flexDirection:"row"},a.createElement(r,{emoji:"ğŸ˜"}),a.createElement(r,{emoji:"ğŸ˜Ÿ"}),a.createElement(r,{emoji:"ğŸ˜ "}),a.createElement(r,{emoji:"ğŸ˜¡"}),a.createElement(r,{emoji:"ğŸ˜¢"}),a.createElement(r,{emoji:"ğŸ˜£"}),a.createElement(r,{emoji:"ğŸ˜¤"}),a.createElement(r,{emoji:"ğŸ˜¥"}),a.createElement(r,{emoji:"ğŸ˜¦"})),a.createElement(i.Box,{display:"flex",flexDirection:"row"},a.createElement(r,{emoji:"ğŸ˜¨"}),a.createElement(r,{emoji:"ğŸ˜©"}),a.createElement(r,{emoji:"ğŸ˜ª"}),a.createElement(r,{emoji:"ğŸ˜«"}),a.createElement(r,{emoji:"ğŸ˜¬"}),a.createElement(r,{emoji:"ğŸ˜­"}),a.createElement(r,{emoji:"ğŸ˜®"}),a.createElement(r,{emoji:"ğŸ˜¯"}),a.createElement(r,{emoji:"ğŸ˜°"})),a.createElement(i.Box,{display:"flex",flexDirection:"row"},a.createElement(r,{emoji:"ğŸ˜²"}),a.createElement(r,{emoji:"ğŸ˜³"}),a.createElement(r,{emoji:"ğŸ˜´"}),a.createElement(r,{emoji:"ğŸ˜µ"}),a.createElement(r,{emoji:"ğŸ§"}),a.createElement(r,{emoji:"ğŸ˜·"}),a.createElement(r,{emoji:"ğŸ™"}),a.createElement(r,{emoji:"ğŸ™‚"}),a.createElement(r,{emoji:"ğŸ™ƒ"})),a.createElement(i.Box,{display:"flex",flexDirection:"row"},a.createElement(r,{emoji:"ğŸ¤"}),a.createElement(r,{emoji:"ğŸ¤‘"}),a.createElement(r,{emoji:"ğŸ¤’"}),a.createElement(r,{emoji:"ğŸ¤“"}),a.createElement(r,{emoji:"ğŸ¤”"}),a.createElement(r,{emoji:"ğŸ¤•"}),a.createElement(r,{emoji:"ğŸ¤ "}),a.createElement(r,{emoji:"ğŸ¤¡"}),a.createElement(r,{emoji:"ğŸ¤¢"})),a.createElement(i.Box,{display:"flex",flexDirection:"row"},a.createElement(r,{emoji:"ğŸ¤¤"}),a.createElement(r,{emoji:"ğŸ¤¥"}),a.createElement(r,{emoji:"ğŸ¤§"}),a.createElement(r,{emoji:"ğŸ¤¨"}),a.createElement(r,{emoji:"ğŸ¤©"}),a.createElement(r,{emoji:"ğŸ¤ª"}),a.createElement(r,{emoji:"ğŸ¤«"}),a.createElement(r,{emoji:"ğŸ¤¬"}),a.createElement(r,{emoji:"ğŸ¤­"})))},A=i.makeStyles((function(e){return i.createStyles({typingText:{paddingLeft:e.spacing(.5)},typingDot:{display:"inline-block",verticalAlign:"middle",width:"4px",height:"4px",margin:"0px 2px",background:e.palette.primary.main,borderRadius:"50%",opacity:"0",animation:"$loadingFade 1s infinite","&:nth-child(1)":{animationDelay:"0s"},"&:nth-child(2)":{animationDelay:"0.2s"},"&:nth-child(3)":{animationDelay:"0.4s"}},"@keyframes loadingFade":{"0%":{opacity:0},"50%":{opacity:.8},"100%":{opacity:0}}})})),O=function(e){var t=A();return o.createElement(i.Typography,{color:"primary",variant:"body2",component:"span"},o.createElement("span",{className:t.typingDot}),o.createElement("span",{className:t.typingDot}),o.createElement("span",{className:t.typingDot}),o.createElement("span",{className:t.typingText},e.message))};function G(){G=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",i=r.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var a=Object.create((t&&t.prototype instanceof d?t:d).prototype),o=new R(r||[]);return a._invoke=function(e,t,n){var r="suspendedStart";return function(a,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw o;return{value:void 0,done:!0}}for(n.method=a,n.arg=o;;){var i=n.delegate;if(i){var l=I(i,n);if(l){if(l===s)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=u(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===s)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}(e,n,o),a}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var s={};function d(){}function m(){}function p(){}var f={};l(f,a,(function(){return this}));var E=Object.getPrototypeOf,g=E&&E(E(S([])));g&&g!==t&&n.call(g,a)&&(f=g);var v=p.prototype=d.prototype=Object.create(f);function h(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){var r;this._invoke=function(a,o){function i(){return new t((function(r,i){!function r(a,o,i,l){var c=u(e[a],e,o);if("throw"!==c.type){var s=c.arg,d=s.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,i,l)}),(function(e){r("throw",e,i,l)})):t.resolve(d).then((function(e){s.value=e,i(s)}),(function(e){return r("throw",e,i,l)}))}l(c.arg)}(a,o,r,i)}))}return r=r?r.then(i,i):i()}}function I(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,I(e,t),"throw"===t.method))return s;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return s}var r=u(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,s;var a=r.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,s):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,s)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function R(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function S(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:x}}function x(){return{value:void 0,done:!0}}return m.prototype=p,l(v,"constructor",p),l(p,"constructor",m),m.displayName=l(p,i,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,l(e,i,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},h(y.prototype),l(y.prototype,o,(function(){return this})),e.AsyncIterator=y,e.async=function(t,n,r,a,o){void 0===o&&(o=Promise);var i=new y(c(t,n,r,a),o);return e.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},h(v),l(v,i,"Generator"),l(v,a,(function(){return this})),l(v,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=S,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return i.type="throw",i.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],i=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var l=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(l&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,s):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),s},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),s}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;T(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:S(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),s}},e}function N(e,t,n,r,a,o,i){try{var l=e[o](i),c=l.value}catch(e){return void n(e)}l.done?t(c):Promise.resolve(c).then(r,a)}function _(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){N(o,r,a,i,l,"next",e)}function l(e){N(o,r,a,i,l,"throw",e)}i(void 0)}))}}function w(){return(w=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function D(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return k(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?k(e,void 0):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var j=i.makeStyles((function(){return{input:{flex:"auto"},inputUpload:{display:"none"},attachmentIcon:{fill:"none",stroke:"currentColor"}}})),L=function(e){var t=j(),n=e.chat,r=d.useTranslation().t,a=o.useState(null),l=a[0],c=a[1],u=o.useState(""),m=u[0],p=u[1],f=o.useState({chat:n,time:0}),E=f[0],g=f[1],v=function(){c(null)},h=function(t){n&&e.onSendMessage&&e.onSendMessage(n,t)},y=function(){0!==m.trim().length&&(h({message:m,messageType:"text"}),p(""))},I=Boolean(l),C=I?"simple-popover":void 0;return o.createElement(i.Box,{display:"flex",flexDirection:"row"},o.createElement(i.TextField,{className:t.input,placeholder:r("CHAT.INPUT_MESSAGE"),autoFocus:!0,variant:"standard",InputProps:{disableUnderline:!0,startAdornment:o.createElement(i.InputAdornment,{position:"start"},o.createElement("input",{accept:"*",className:t.inputUpload,id:"icon-button-file",type:"file",onChange:function(e){if(e.currentTarget.files){var t,n=e.currentTarget.files[0];if("image"==(t=n.type.includes("image")?"image":n.type.includes("video")?"video":"file")){var r=new Image,a=window.URL||window.webkitURL;r.src=a.createObjectURL(n),r.onload=function(){var e,a,o,i=(o=(e={width:r.width,height:r.height}).height,((a=e.width)>335||o>335)&&(a>o?(o=o/a*335,a=335):(a=a/o*335,o=335)),{width:a,height:o});h({message:n,width:i.width,height:i.height,messageType:t})}}else h({message:n,messageType:t,fileName:n.name,size:n.size})}}}),o.createElement("label",{htmlFor:"icon-button-file"},o.createElement(i.IconButton,{color:"primary","aria-label":"upload",component:"span",size:"small"},o.createElement(i.SvgIcon,{fill:"none",className:t.attachmentIcon},o.createElement("path",{d:"M16.768 13.5767L11.6961 18.6486C9.35886 20.9859 5.56937 20.9859 3.23208 18.6486V18.6486C0.894789 16.3114 0.894789 12.5219 3.23208 10.1846L10.4479 2.96872C12.0875 1.32914 14.7458 1.32914 16.3854 2.96873V2.96873C18.025 4.60831 18.025 7.26659 16.3854 8.90617L9.16515 16.1264C8.23032 17.0612 6.71466 17.0612 5.77982 16.1264V16.1264C4.84499 15.1916 4.84499 13.6759 5.77982 12.7411L10.8896 7.63131",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"}))))," ",o.createElement(i.IconButton,{"aria-describedby":C,onClick:function(e){c(e.currentTarget)},color:"primary",size:"small"},o.createElement(s.InsertEmoticon,null))),endAdornment:o.createElement(i.IconButton,{edge:"end",color:"inherit",size:"small",onClick:function(e){e.preventDefault(),y()}},o.createElement(s.Send,null))},value:m,onChange:function(t){p(t.target.value),n&&e.onTyping&&(E.chat!==n||Date.now()-E.time>=500)&&(g({chat:n,time:Date.now()}),e.onTyping(n))},onKeyPress:function(e){"Enter"===e.key&&(e.preventDefault(),y())}}),o.createElement(i.Popover,{id:C,open:I,anchorEl:l,onClose:v,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"left"}},o.createElement(b,{onSelect:function(e){p(""+m+e),v()}})))};function M(e){return null==e||"object"==typeof e&&0===Object.keys(e).length||"string"==typeof e&&0===e.trim().length}function U(e){return void 0===e?null:("string"==typeof e&&(e=new Date(e)),m().add(-1,"days").startOf("day").isAfter(e)?m(e).format("DD.MM.YYYY HH:mm"):m().startOf("day").isAfter(e)?"Ğ’Ñ‡ĞµÑ€Ğ° Ğ² "+m(e).format("HH:mm"):m(e).format("HH:mm"))}var P=function(e){return e?e.groupId?"group:"+e.groupId:"user:"+e.userId:null},F=function(e){return e.groupId?e.name:e.username},H=function(e,t){var n=Array.isArray(e.messages)&&e.messages.length>0,r=Array.isArray(t.messages)&&t.messages.length>0;return n&&r&&null!=t.messages&&null!=e.messages?new Date(t.messages[t.messages.length-1].cdate).getTime()-new Date(e.messages[e.messages.length-1].cdate).getTime():n?-1:1},B=i.makeStyles((function(e){return i.createStyles({fileIcon:{fontSize:"0.75rem"},fileBody:{paddingLeft:e.spacing(1)}})})),z=function(e){var t=e.message,n=B(),r=function(e){var t=e.split("$");return{date:t[0],userId:t[1],size:t[2],name:t[3]}}(t.content),a=function(e){var t=e.lastIndexOf(".");return-1===t?{name:e,ext:""}:{name:e.slice(0,t),ext:e.slice(t+1)}}(r.name),l=a.name,c=a.ext;return o.createElement(i.Box,{display:"flex",flexDirection:"row"},o.createElement(i.Avatar,{className:n.fileIcon},c.toUpperCase()),o.createElement(i.Box,{display:"flex",flexDirection:"column",className:n.fileBody},l,o.createElement("span",null,c+" "+r.size)))},Y=i.makeStyles((function(){return{mediaContent:{maxWidth:"350px",maxHeight:"350px"}}})),V=function(e){var t=e.apiUrl,n=e.message,r=e.isConference,a=Y(),i="";if(r){var l=JSON.parse(n.content);i=t+"/static/conf/"+l.visitId+"/"+l.name}else i=t+"/static/file/"+n.content;return o.createElement("video",{src:i,className:a.mediaContent,controls:!0,muted:!0},"Ğ’Ğ°Ñˆ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€ Ğ½Ğµ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ Ñ‚ĞµĞ³ video.")},q=i.makeStyles((function(e){var t;return i.createStyles({mediaContent:(t={maxWidth:"350px",maxHeight:"350px",cursor:"pointer"},t[e.breakpoints.down("xs")]={maxWidth:"250px",maxHeight:"250px"},t)})})),K=function(e){var t=e.apiUrl,n=e.message,r=q(),a=o.useState(!1),i=a[0],l=a[1],c=function(e){var t=e.split("$");return{date:t[0],userId:t[1],width:t[2],height:t[3]}}(n.content);return o.createElement(o.Fragment,null,o.createElement(p,{zIndex:2e3,visible:i,changeable:!1,onClose:function(){l(!1)},images:[{src:t+"/static/image/"+n.content}]}),o.createElement("img",{src:t+"/static/image/"+n.content,width:c.width,height:c.height,className:r.mediaContent,onClick:function(){l(!0)}}))},W=function(e){var t=e.apiUrl,n=e.message;switch(n.messageType){case"text":return o.createElement(o.Fragment,null,n.content);case"video":case"video_conference":return o.createElement(V,{message:n,apiUrl:t,isConference:"video_conference"===n.messageType});case"image":return o.createElement(K,{message:n,apiUrl:t});case"file":return o.createElement(z,{message:n})}return null},$=i.makeStyles((function(e){return i.createStyles({rootContact:{"& span":{float:"right",color:"#B2B6C2"},"& $message":{backgroundColor:"#F1F4FC",color:"black"},"& $lastMessage":{borderBottomLeftRadius:0}},rootUser:{justifyContent:"flex-end","& span":{float:"right",color:"#D9DEEC"},"& $message":{backgroundColor:e.palette.primary.main,color:e.palette.primary.contrastText},"& $lastMessage":{borderBottomRightRadius:0}},rootNotify:{justifyContent:"center","& > *":{padding:"0px "+e.spacing(1)+"px",borderRadius:"16px",fontWeight:500}},message:{maxWidth:"85%",borderRadius:"16px",padding:e.spacing(1)},lastMessage:{},file:{display:"flex",flexDirection:"row",flexWrap:"wrap",cursor:"pointer"},header:{flex:"0 0 100%",overflow:"hidden",fontWeight:"bold"},body:{flex:"1 1 auto",wordBreak:"break-word",overflow:"hidden"},status:{paddingLeft:e.spacing(1),flex:"1 1 auto",alignSelf:"flex-end"},statusImage:{fontSize:"1rem",marginRight:e.spacing(.5),verticalAlign:"middle"}})})),J=function(e){var t=$(),n=d.useTranslation().t,r=e.apiUrl,o=e.message,l=e.owner,c=e.refOnLastMess,u=e.user,m=e.isGroupMessage,p=e.isUserFirst,E=e.isUserLast;if("notify"===o.messageType){var g="{"===o.content[0]?JSON.parse(o.content):o.content;return a.createElement(i.ListItem,{className:t.rootNotify},a.createElement(f.Alert,{severity:"string"==typeof g?"info":g.severity,ref:c},"string"==typeof g?g:g.message))}if(o.isRevoke)return a.createElement(i.ListItem,{className:t.rootNotify},a.createElement(i.Typography,{variant:"body2",ref:c,align:"center"},o.userId===u.userId?n("CHAT.MESSAGE.REVOKED.YOU"):o.revokeUserName+" "+n("CHAT.MESSAGE.REVOKED.CONTACT")));var v=u.userId===o.userId;return a.createElement(i.ListItem,{className:v?t.rootUser:t.rootContact},function(e,t,n,r,o,l){var c=t.messageType,u=r?n.message+" "+n.lastMessage:n.message;return"file"===c?a.createElement(i.Link,{className:u+" "+n.file,underline:"none",href:e+"/static/file/"+t.content,target:"_blank",download:!0,onContextMenu:o},l):a.createElement(i.Box,{display:"flex",flexDirection:"image"===c||"video"===c||"video_conference"===c?"column":"row",flexWrap:"wrap",className:u,onContextMenu:o},l)}(r,o,t,E,e.onContextMenu,a.createElement(a.Fragment,null,!v&&m&&l&&p&&a.createElement("div",{className:t.header},l.username),a.createElement("div",{className:t.body},a.createElement(W,{message:o,apiUrl:r})),a.createElement("div",{className:t.status,ref:c},a.createElement("span",null,v?a.createElement(0===o.status?s.Done:s.DoneAll,{className:t.statusImage}):null,U(o.cdate))))))},X=function(e){var t=d.useTranslation().t;return e.isTyping?o.createElement(O,{message:t("CHAT.STATUS.TYPING")}):1===e.contact.online?o.createElement(i.Typography,{variant:"body2",color:"primary",component:"span"},t("CHAT.STATUS.ONLINE")):o.createElement(i.Typography,{variant:"body2",color:"textSecondary",component:"span"},t("CHAT.STATUS.OFFLINE"))},Q=y.makeStyles((function(){return{star:{fontSize:"0.85rem",verticalAlign:"middle"}}})),Z=function(e){var t=Q(),n=e.apiUrl,r=e.owner;return o.createElement(i.List,{"aria-label":"contacts"},e.contacts.map((function(a){return o.createElement(i.ListItem,{button:!0,key:a.userId,onClick:function(){return e.onClick&&e.onClick(a)}},o.createElement(i.ListItemAvatar,null,o.createElement(i.Avatar,{alt:a.username,src:""+n+a.avatar})),o.createElement(i.ListItemText,{primary:o.createElement("span",null,a.username," ",r===a.userId&&o.createElement(I,{className:t.star,color:"primary"})),secondary:o.createElement(X,{contact:a,isTyping:!1})}))})))},ee=function(e){var t=e.onClose,n=e.open,r=e.apiUrl,a=e.contacts,l=d.useTranslation();return o.createElement(i.Dialog,{onClose:function(){t()},"aria-labelledby":"add-contact-title",open:n},o.createElement(i.DialogTitle,{id:"switch-operator-title"},(0,l.t)("CHAT.ADD_CONTACT")),o.createElement(Z,{apiUrl:r,contacts:a,onClick:function(e){t(e)}}))},te=y.makeStyles((function(e){return y.createStyles({popover:{pointerEvents:"none"},paper:{padding:e.spacing(1)},avatarGroup:{backgroundColor:"#28B7C6",color:"#fff"}})})),ne=function(e,t){var n,r=[(null==(n=e.members)?void 0:n.length)+" "+t("CHAT.MEMBERS")],a=(e.members||[]).reduce((function(e,t){return t.online?e+1:e}),0);return a&&r.push(a+" "+t("CHAT.STATUS.ONLINE")),r.join(", ")},re=function(e){var t=e.apiUrl,n=e.user,r=e.chat,a=e.typing,l=e.conference,u=e.className,s=e.operators,m=e.onVideoCall,p=e.onVideoEnd,f=e.onOperatorAdd,y=e.onLeaveGroup,I=te(),C=d.useTranslation().t,T=o.useState(null),R=T[0],S=T[1],x=o.useState(!1),b=x[0],A=x[1];if(!r)return o.createElement(i.CardHeader,{avatar:o.createElement(i.Avatar,null),title:"",subheader:"",className:u});var O,G=function(){S(null)},N=r;if(N.groupId)return o.createElement(i.CardHeader,{avatar:o.createElement(i.Avatar,{alt:N.name,className:I.avatarGroup},o.createElement(E,null)," "),title:N.name,subheader:o.createElement(o.Fragment,null,o.createElement("span",{"aria-owns":R?"mouse-over-popover":void 0,"aria-haspopup":"true",onMouseEnter:function(e){S(e.currentTarget)},onMouseLeave:G},ne(N,C)),o.createElement(i.Popover,{id:"mouse-over-popover",className:I.popover,classes:{paper:I.paper},open:!!R,anchorEl:R,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},onClose:G,disableRestoreFocus:!0},o.createElement(Z,{apiUrl:t,contacts:N.members,owner:N.userId}))),className:u,action:o.createElement(o.Fragment,null,4===n.role&&o.createElement(o.Fragment,null,o.createElement(i.IconButton,{"aria-label":"add user",onClick:function(){A(!0)}},o.createElement(h,null)),o.createElement(ee,{apiUrl:t,open:b,contacts:s,onClose:function(e){A(!1),f&&e&&r&&f(r,e)}})),4===n.role&&(null==(O=N.members)?void 0:O.find((function(e){return e.userId!==n.userId&&4===e.role})))&&y&&o.createElement(i.IconButton,{"aria-label":"leave group",onClick:function(){return y(N)}},o.createElement(c,null)))});var _=r,w=!(null==a||!a.contactId)&&(null==a?void 0:a.userId)===_.userId;return o.createElement(i.CardHeader,{avatar:o.createElement(i.Avatar,{alt:_.username,src:""+t+_.avatar}),title:_.username,subheader:o.createElement(X,{contact:_,isTyping:w}),className:u,action:o.createElement(o.Fragment,null,null!=l&&null!=p&&o.createElement(i.Button,{"aria-label":"cancel call",variant:"contained",color:"primary",size:"small",disabled:!_.online,startIcon:o.createElement(v,{color:"error"}),onClick:function(){return p(l)}},C("CHAT.CONFERENCE.FINISH")),null==l&&null!=m&&3===n.role&&o.createElement(i.Button,{"aria-label":"video call",variant:"contained",color:"primary",size:"small",disabled:!_.online,startIcon:o.createElement(g,null),onClick:function(){return m(_)}},C("CHAT.CONFERENCE.START")))})},ae=i.makeStyles((function(e){return i.createStyles({root:{width:"100%",minWidth:360,height:"100%",display:"flex",flexDirection:"column"},inline:{display:"inline"},messageListOuter:{flex:1,overflowY:"auto",margin:0,padding:0,scrollbarWidth:"thin",scrollbarColor:"#6b6b6b #fff","&::-webkit-scrollbar, & *::-webkit-scrollbar":{backgroundColor:"#fff"},"&::-webkit-scrollbar-thumb, & *::-webkit-scrollbar-thumb":{borderRadius:8,backgroundColor:"#d5d9ef",border:"5px solid #fff"},"&::-webkit-scrollbar-thumb:focus, & *::-webkit-scrollbar-thumb:focus":{backgroundColor:"#fff"},"&::-webkit-scrollbar-thumb:active, & *::-webkit-scrollbar-thumb:active":{backgroundColor:"#73d7f5",border:"3px solid #fff"},"&::-webkit-scrollbar-thumb:hover, & *::-webkit-scrollbar-thumb:hover":{backgroundColor:"#73d7f5",border:"3px solid #fff"},"&::-webkit-scrollbar-corner, & *::-webkit-scrollbar-corner":{backgroundColor:"#fff"}},messageList:{height:"100%",overflow:"auto"},roomHeader:{flex:1},roomProgress:{padding:e.spacing(2)},flexAll:{flex:"1 1 auto"},flexEnd:{justifyContent:"flex-end"}})})),oe={message:null,mouseX:null,mouseY:null,canCopy:!1,canDelete:!1},ie={autoScroll:!0,height:0},le=function(e){var t=e.apiUrl,n=e.user,r=e.users,s=e.chat,m=e.typing,p=e.conference,f=e.loading,E=e.pageSize,g=ae(),v=d.useTranslation().t,h=o.useState(ie),y=h[0],I=h[1],C=null==s?void 0:s.messages,T=(null==C?void 0:C.length)||0,R=o.useRef(null),S=o.useRef(null),x=o.useState(oe),b=x[0],A=x[1];o.useEffect((function(){e.onEnterRoom&&s&&e.onEnterRoom(s)}),[P(s)]),o.useLayoutEffect((function(){y.autoScroll&&R.current&&R.current.scrollIntoView()}),[P(s),T]),o.useLayoutEffect((function(){!f&&S.current&&y.height>0&&(S.current.scrollTop=S.current.scrollHeight-y.height,I(ie))}),[P(s),f,y.height]);var O=o.useCallback(function(){var t=_(G().mark((function t(n){var r;return G().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((r=n.currentTarget)&&s&&!s.noMoreData){t.next=3;break}return t.abrupt("return");case 3:0===r.scrollTop&&T>=E&&!f&&e.onNeedMoreMessages&&(I({autoScroll:!1,height:r.scrollHeight}),e.onNeedMoreMessages(s));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[s,f]),N=a.useCallback((function(){var e=b.message;A(oe),e&&navigator.clipboard.writeText(e.content)}),[b.message]),w=a.useCallback((function(){var t=b.message;A(oe),e.onMeesageDelete&&s&&t&&e.onMeesageDelete(s,t)}),[b.message]);return o.createElement(i.Card,{elevation:1,className:g.root},o.createElement(i.Box,{display:"flex",flexDirection:"row"},e.onExitRoom&&s&&o.createElement(i.IconButton,{"aria-label":"exit room",onClick:function(){return e.onExitRoom&&e.onExitRoom(s)}},o.createElement(u,null)),o.createElement(re,{apiUrl:t,user:n,chat:s,typing:m,conference:p,operators:e.operators,className:g.roomHeader,onVideoCall:e.onVideoCall,onVideoEnd:e.onVideoEnd,onOperatorAdd:e.onOperatorAdd,onLeaveGroup:e.onLeaveGroup}),f&&o.createElement("div",{className:g.roomProgress},o.createElement(i.CircularProgress,{size:20}))),o.createElement(i.Divider,null),o.createElement(i.CardContent,{className:g.messageListOuter},M(C)?null:o.createElement(i.List,{className:g.messageList,onScroll:O},null!=C&&C.map((function(a,i){return o.createElement(J,{key:a._id,apiUrl:t,user:n,message:a,owner:r[a.userId],isGroupMessage:!(null==s||!s.groupId),isUserFirst:0===i||"notify"===C[i-1].messageType||C[i-1].userId!==C[i].userId,isUserLast:i===C.length-1||"notify"===C[i+1].messageType||C[i+1].userId!==C[i].userId,onContextMenu:function(t){return function(t,r){var a="text"===t.messageType,o=n.userId===t.userId&&!!e.onMeesageDelete&&(new Date).getTime()-new Date(t.cdate).getTime()<=12e4;a||o?(r.preventDefault(),A({message:t,mouseX:r.clientX-2,mouseY:r.clientY-4,canCopy:a,canDelete:o})):A(oe)}(a,t)},refOnLastMess:i===C.length-1?R:null})})))),o.createElement(i.Divider,null),o.createElement(i.CardContent,null,o.createElement(L,{chat:s,onTyping:e.onTyping,onSendMessage:e.onSendMessage})),o.createElement(i.Menu,{keepMounted:!0,open:null!==b.mouseY,onClose:function(){A(oe)},anchorReference:"anchorPosition",anchorPosition:null!==b.mouseY&&null!==b.mouseX?{top:b.mouseY,left:b.mouseX}:void 0},o.createElement(i.MenuItem,{onClick:N,disabled:!b.canCopy},o.createElement("span",{className:g.flexAll},v("CHAT.MESSAGE.MENU.COPY")),o.createElement(i.ListItemIcon,{className:g.flexEnd},o.createElement(l,{fontSize:"small"}))),o.createElement(i.MenuItem,{onClick:w,disabled:!b.canDelete},o.createElement("span",{className:g.flexAll},v("CHAT.MESSAGE.MENU.DELETE")),o.createElement(i.ListItemIcon,{className:g.flexEnd},o.createElement(c,{fontSize:"small"})))))},ce=i.makeStyles((function(e){return i.createStyles({main:{flex:"1 1 auto",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},time:{paddingLeft:e.spacing(1),justifyContent:"flex-end",whiteSpace:"nowrap"},unread:{justifyContent:"flex-end",maxHeight:"20px"},avatarGroup:{backgroundColor:"#28B7C6",color:"#fff"}})})),ue=i.withStyles((function(e){return i.createStyles({badge:{backgroundColor:"#44b700",color:"#44b700",boxShadow:"0 0 0 2px "+e.palette.background.paper,"&::after":{position:"absolute",top:0,left:0,width:"100%",height:"100%",borderRadius:"50%",animation:"$ripple 1.2s infinite ease-in-out",border:"1px solid currentColor",content:'""'}},"@keyframes ripple":{"0%":{transform:"scale(.8)",opacity:1},"100%":{transform:"scale(2.4)",opacity:0}}})}))(i.Badge),se=i.withStyles((function(e){return i.createStyles({badge:{backgroundColor:e.palette.primary.main,boxShadow:"0 0 0 2px "+e.palette.background.paper}})}))(i.Badge),de=function(e){var t=ce(),n=d.useTranslation().t,r=e.apiUrl,a=e.chat,l=e.typing,c=F(a),u=a.groupId?o.createElement(i.Avatar,{alt:c,className:t.avatarGroup},o.createElement(E,null)," "):function(e,t,n){var r=o.createElement(i.Avatar,{alt:t.username,src:""+e+t.avatar});return null!=n&&n.contactId&&(null==n?void 0:n.userId)===t.userId?o.createElement(ue,{overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"dot"},r):null!=t&&t.online?o.createElement(se,{overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"dot"},r):r}(r,a,l),s=a.messages&&a.messages.length>0?a.messages[a.messages.length-1]:null,m=function(e,t){if(!e)return null;switch(e.messageType){case"text":return e.content;case"image":return"["+t("CHAT.MESSAGE.TYPE.IMAGE")+"]";case"video":return"["+t("CHAT.MESSAGE.TYPE.VIDEO")+"]";case"file":return"["+t("CHAT.MESSAGE.TYPE.FILE")+"]";case"notify":return"["+t("CHAT.MESSAGE.TYPE.NOTIFY")+"]";default:return null}}(s,n),p=null==s?void 0:s.cdate;return o.createElement(i.ListItem,{button:!0,selected:e.active,onClick:e.onClick},o.createElement(i.ListItemAvatar,null,u),o.createElement(i.ListItemText,{secondaryTypographyProps:{component:"span"},primary:o.createElement(i.Box,{display:"flex",flexDirection:"row"},o.createElement("span",{className:t.main},c),o.createElement("span",{className:t.time},U(p))),secondary:o.createElement(i.Box,{display:"flex",flexDirection:"row"},o.createElement("span",{className:t.main},m),a.unreadCount?o.createElement(i.Chip,{className:t.unread,component:"span",size:"small",color:"primary",label:a.unreadCount}):null)}))},me=C.makeStyles((function(){return{root:{width:"100%",height:"100%"},searchField:{width:"100%"}}})),pe=function(e,t){if(null===t)return e;var n=t.toLowerCase();return e.filter((function(e){return-1!==F(e).toLowerCase().indexOf(n.toLowerCase())}))},fe=function(e,t,n){var r=[].concat(t,n);r=r.sort(H);var a=localStorage.getItem(e+"-topChatId");if(a){var o=r.find((function(e){return P(e)===a}));o&&(r=r.filter((function(e){return P(e)!==a})),o.isTop=!0,r.unshift(o))}return r},Ee=function(e){var t=me(),n=d.useTranslation().t,r=o.useState([]),l=r[0],c=r[1];return a.useEffect((function(){c(fe(e.user.userId,pe(e.groups,null),pe(e.contacts,null)))}),[]),o.createElement(i.Card,{elevation:1,className:t.root},o.createElement(i.CardHeader,{title:o.createElement(i.TextField,{className:t.searchField,label:n("CHAT.INPUT_SEARCH_CONTACT"),variant:"outlined",size:"small",fullWidth:!0,onChange:function(t){c(fe(e.user.userId,pe(e.groups,t.target.value),pe(e.contacts,t.target.value)))}})}),o.createElement(i.Divider,null),o.createElement(T,{component:"nav","aria-label":"rooms"},!M(l)&&l.map((function(t){return o.createElement(de,{key:P(t),apiUrl:e.apiUrl,chat:t,active:t===e.activeRoom,typing:e.typing,onClick:function(){return null!=e.onChangeChat&&e.onChangeChat(t)}})}))))},ge=i.makeStyles((function(){return{root:{width:"100%",height:"100%",borderRadius:"8px"}}})),ve=function(e){var t=e.conference,n=e.onClose,r=ge(),i=o.useRef(null);return a.useEffect((function(){var e=function(e){var r;e.source===(null==(r=i.current)?void 0:r.contentWindow)&&["notSupported","connectionFail","callFail","hangUp","remoteHangUp"].includes(e.data.type)&&n(t)};return window.addEventListener("message",e),function(){window.removeEventListener("message",e)}}),[t,n]),o.createElement("iframe",{title:"conference",className:r.root,src:null==t?void 0:t.url,allowFullScreen:!0,allow:"microphone; camera; autoplay; display-capture",ref:i})},he=i.makeStyles((function(){return{root:{width:"100%",height:"100%",borderRadius:"8px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},pulse:{height:"100px",width:"100px",borderRadius:"50%",display:"flex",justifyContent:"center",alignItems:"center",position:"relative","&::before":{content:"''",position:"absolute",border:"1px solid green",width:"calc(100% + 40px)",height:"calc(100% + 40px)",borderRadius:"50%",animation:"$pulse 1s linear infinite"},"&::after":{content:"''",position:"absolute",border:"1px solid green",width:"calc(100% + 40px)",height:"calc(100% + 40px)",borderRadius:"50%",animation:"$pulse 1s linear infinite",animationDelay:"0.3s"}},avatar:{width:"80%",height:"80%"},footer:{width:"100%",alignSelf:"flex-end",paddingTop:"64px",display:"flex",justifyContent:"center"},"@keyframes pulse":{"0%":{transform:"scale(0.5)",opacity:0},"50%":{transform:"scale(1)",opacity:1},"100%":{transform:"scale(1.3)",opacity:0}}}})),ye=function(e){var t=e.conference,n=e.contact,r=e.apiUrl,a=e.onAccept,l=he(),c=d.useTranslation().t;return o.createElement(i.Paper,{className:l.root},o.createElement("div",{className:l.pulse},o.createElement(i.Avatar,n?{className:l.avatar,alt:n.username,src:""+r+n.avatar}:{className:l.avatar})),o.createElement("div",{className:l.footer},o.createElement(i.Button,{variant:"contained",color:"primary",onClick:function(){return a(t)}},c("CHAT.CONFERENCE.JOIN"))))},Ie={userId:0,username:"",password:"",avatar:"",langCode:""},Ce={tokenKey:"",user:Ie,token:"",activeRoom:null,groupGather:{},userGather:{},contactGather:{},operators:[],initialContactId:null,conference:{data:null,joined:!1,ringPlayed:!1},typing:null,loading:!1,error:void 0},Te=function(e){return e.activeRoom?e.groupGather[e.activeRoom.groupId]||e.contactGather[e.activeRoom.userId]:null},Re=function(e){var t=e.initialContactId,n=null;if(t)n=e.contactGather[t];else if(e.activeRoom)n=Te(e);else{var r=[].concat(Object.values(e.contactGather),Object.values(e.groupGather)).sort(H);r.length>0&&(n=r[0])}return n},Se=function(e,t,n){var r=w({},e);e.contactGather[t]&&(r.contactGather[t]=w({},r.contactGather[t],{online:n}));for(var a=0,o=Object.values(e.groupGather);a<o.length;a++){var i=o[a];if(i.members){var l=i.members.find((function(e){return e.userId===t}));if(l){var c=i.members.indexOf(l);i.members[c]=w({},l,{online:n})}}}var u=r.operators.findIndex((function(e){return e.userId===t}));return-1!==u&&(r.operators[u]=w({},r.operators[u],{online:n})),r.activeRoom=Te(r),r},xe=function(e,t,n){var r=w({},e);return r.contactGather[t]&&(r.contactGather[t]=w({},r.contactGather[t],{unreadCount:n(r.contactGather[t].unreadCount)})),r.activeRoom=Te(r),r},be=function(e,t,n){var r=w({},e);return r.groupGather[t]&&(r.groupGather[t]=w({},r.groupGather[t],{unreadCount:n(r.groupGather[t].unreadCount)})),r.activeRoom=Te(r),r};function Ae(e,t){var n,r,a;switch(t.type){case"SET_GROUP_GATHER":return w({},e,{groupGather:w({},e.groupGather,(n={},n[t.payload.groupId]=t.payload,n))});case"SET_CONTACT_GATHER":return w({},e,{contactGather:w({},e.contactGather,(r={},r[t.payload.userId]=t.payload,r))});case"DEL_GROUP":return function(e,t){var n=w({},e),r=n.activeRoom===n.groupGather[t];return delete n.groupGather[t],r&&(n.activeRoom=Re(n)),n}(e,t.payload);case"DEL_GROUP_MEMBER":return function(e,t){var n,r=w({},e),a=r.groupGather[t.groupId];return a&&(a.members=null==(n=a.members)?void 0:n.filter((function(e){return e.userId!==t.userId}))),r}(e,t.payload);case"DEL_CONTACT":return function(e,t){var n=w({},e),r=n.activeRoom===n.contactGather[t];return delete n.contactGather[t],r&&(n.activeRoom=Re(n)),n}(e,t.payload.userId);case"SET_USER_GATHER":return w({},e,{userGather:w({},e.userGather,(a={},a[t.payload.userId]=t.payload,a))});case"UPDATE_ACTIVE_ROOM":return w({},e,{activeRoom:Re(e)});case"SET_ACTIVE_ROOM":return function(e,t){return e.activeRoom&&t.ifNotExists?e:w({},e,{activeRoom:t.groupId?e.groupGather[t.groupId]:t.contactId?e.contactGather[t.contactId]:null})}(e,t.payload);case"USER_ONLINE":return Se(e,t.payload,1);case"USER_OFFLINE":return Se(e,t.payload,0);case"ADD_GROUP_MESSAGE":return function(e,t){var n=w({},e),r=t.groupId;n.groupGather[r]&&(n.groupGather[r].messages?n.groupGather[r].messages=[].concat(n.groupGather[r].messages,[t]):n.groupGather[r]=w({},e.groupGather[r],{messages:[t]}));var a=n.activeRoom;return a&&a.groupId!==r&&t.userId!==e.user.userId?be(n,r,(function(e){return(e||0)+1})):(n.activeRoom=Te(n),n)}(e,t.payload);case"ADD_PRIVATE_MESSAGE":return function(e,t){var n,r=w({},e),a=t.contactId===e.user.userId?t.userId:t.contactId;return r.contactGather[a].messages?r.contactGather[a].messages=[].concat(r.contactGather[a].messages,[t]):r.contactGather[a]=w({},r.contactGather[a],{messages:[t]}),(null==(n=r.activeRoom)?void 0:n.userId)!==a&&t.userId!==e.user.userId?xe(r,a,(function(e){return(e||0)+1})):(r.activeRoom=Te(r),r)}(e,t.payload);case"ADD_GROUP_UNREAD_GATHER":return be(e,t.payload,(function(e){return(e||0)+1}));case"ADD_CONTACT_UNREAD_GATHER":return xe(e,t.payload,(function(e){return(e||0)+1}));case"SET_TYPING":return w({},e,{typing:t.payload});case"LOSE_GROUP_UNREAD_GATHER":return be(e,t.payload,(function(){return 0}));case"LOSE_CONTACT_UNREAD_GATHER":return xe(e,t.payload,(function(){return 0}));case"REVOKE_MESSAGE":return function(e,t){var n=e.user.userId,r=w({},e),a=t.username||r.userGather[t.userId].username;if(t.groupId){var o=r.groupGather[t.groupId].messages;if(o){var i=o.find((function(e){return e._id===t._id}));if(i){var l=o.indexOf(i);o[l]=w({},i,{isRevoke:!0,revokeUserName:a})}}}else{var c=r.contactGather[t.contactId===n?t.userId:t.contactId].messages;if(c){var u=c.find((function(e){return e._id===t._id}));if(u){var s=c.indexOf(u);c[s]=w({},u,{isRevoke:!0,revokeUserName:a})}}}return r.activeRoom=Te(r),r}(e,t.payload);case"UPDATE_GROUP_INFO":return function(e,t){var n=w({},e),r=t.groupId,a=n.groupGather[r];return a&&(n.groupGather[r]=w({},a,{name:t.name,notice:t.notice})),n.activeRoom=Te(n),n}(e,t.payload);case"UPDATE_USER_INFO":return function(e,t){var n=w({},e),r=t.userId,a=t.username,o=t.avatar;return n.userGather[r]&&(n.userGather[r]=w({},n.userGather[r],{username:a,avatar:o})),n.contactGather[r]&&(n.contactGather[r]=w({},n.contactGather[r],{username:a,avatar:o})),n.activeRoom=Te(n),n}(e,t.payload);case"ADD_GROUP_MEMBER":return function(e,t){var n=t.members.map((function(e){return w({},e,{isManager:0})})),r=w({},e);return r.groupGather[t.groupId].members&&n?r.groupGather[t.groupId].members=[].concat(e.groupGather[t.groupId].members,n):r.groupGather[t.groupId]=w({},r.groupGather[t.groupId],{members:n}),r.activeRoom=Te(r),r}(e,t.payload);case"SET_CONFERENCE":return function(e,t){return w({},e,{conference:{data:t,joined:(null==t?void 0:t.userId)===e.user.userId,ringPlayed:(null==t?void 0:t.userId)===e.user.userId}})}(e,t.payload);case"JOIN_CONFERENCE":return w({},e,{conference:{data:t.payload,joined:!0,ringPlayed:!0}});case"PAUSE_CONFERENCE":return function(e,t){var n;return(null==(n=e.conference.data)?void 0:n.id)!==(null==t?void 0:t.id)?e:w({},e,{conference:{data:e.conference.data,joined:!1,ringPlayed:!0}})}(e,t.payload);case"STOP_CONFERENCE":return function(e,t){var n;return(null==(n=e.conference.data)?void 0:n.id)!==(null==t?void 0:t.id)?e:w({},e,{conference:{data:null,joined:!1,ringPlayed:!1}})}(e,t.payload);case"MARK_PRIVATE_MESSAGES_READ":return function(e,t){var n=w({},e);if(n.contactGather[t]){var r=w({},n.contactGather[t]);if(r.messages)for(var a=0;a<r.messages.length;a++)r.messages[a]=w({},r.messages[a],{status:1});n.contactGather[t]=r}return n.activeRoom=Te(n),n}(e,t.payload);case"ADD_PRIVATE_MESSAGES":return function(e,t){var n=w({},e),r=t.messages,a=t.contactId;return n.contactGather[a]&&(n.contactGather[a]=w({},n.contactGather[a],{messages:[].concat(r,n.contactGather[a].messages||[]),noMoreData:r.length<t.pageSize})),n.activeRoom=Te(n),n}(e,t.payload);case"ADD_GROUP_MESSAGES":return function(e,t){var n=w({},e),r=t.groupId,a=t.messageArr,o=t.userArr;n.groupGather[r]&&(n.groupGather[r]=w({},n.groupGather[r],{messages:[].concat(a,n.groupGather[r].messages||[]),noMoreData:a.length<t.pageSize})),n.userGather=w({},n.userGather);for(var i,l=D(o);!(i=l()).done;){var c=i.value;n.userGather[c.userId]||(n.userGather[c.userId]=c)}return n.activeRoom=Te(n),n}(e,t.payload);case"SET_LOADING":return w({},e,{loading:t.payload,error:""});case"SET_ERROR":return w({},e,{error:t.payload});case"SET_TOKEN":return function(e,t){return localStorage.setItem(e.tokenKey,t),w({},e,{token:t})}(e,t.payload);case"SET_USER":return w({},e,{user:t.payload});case"CLEAR_USER":return function(e){return localStorage.removeItem(e.tokenKey),w({},e,{token:"",user:Ie})}(e);case"CLEAR_CHAT_DATA":return w({},e,{activeRoom:null,groupGather:{},userGather:{},contactGather:{},conference:{data:null,joined:!1,ringPlayed:!1},typing:null});case"SET_OPERATORS":return w({},e,{operators:t.payload})}return e}var Oe=o.createContext({state:Ce,dispatch:function(){return null}}),Ge=a.createContext({}),Ne=a.createContext({online:!1});exports.AddContact=ee,exports.ChatContext=Oe,exports.ChatPage=function(e){var t,n,r,o,l,c,u,s,d=e.inModale,m=e.onlyChatGroupId,p=i.makeStyles((function(e){var t,n;return{root:(t={minWidth:300,minHeight:470,height:d?"100%":"calc(100vh - "+e.spacing(8)+"px)",padding:0},t[e.breakpoints.down("xs")]={height:"100vh",minHeight:200},t),innerBox:(n={height:"100%",width:"100%",margin:d?0:e.spacing(4)+"px 0"},n[e.breakpoints.down("xs")]={margin:0},n),innerGrid:{height:"100%",width:"100%"}}}))(),E=i.useMediaQuery((function(e){return e.breakpoints.down("sm")})),g=a.useContext(Oe),v=g.state,h=g.dispatch,y=a.useContext(Ne).socket,I=a.useContext(Ge),C=I.apiUrl,T=I.pageSize,R=I.getPrivateMessages,S=I.getGroupMessages,x=a.useState(((s=new Audio(process.env.PUBLIC_URL+"/audio/ring-in.ogg")).loop=!0,s))[0],b=a.useCallback((function(){h({type:"SET_ACTIVE_ROOM",payload:{ifNotExists:!1}})}),[h]),A=a.useCallback(function(){var e=_(G().mark((function e(t){return G().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.groupId){e.next=5;break}return e.next=3,S(t);case 3:e.next=7;break;case 5:return e.next=7,R(t);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[R,S]),O=a.useCallback((function(e,t){null==y||y.emit("revokeMessage",{groupId:e.groupId,contactId:e.userId,_id:t._id})}),[null==y?void 0:y.id]),N=a.useCallback((function(e){null==y||y.emit("typing",{groupId:null==e?void 0:e.groupId,contactId:null==e?void 0:e.userId})}),[null==y?void 0:y.id]),w=a.useCallback((function(e,t){e.groupId?null==y||y.emit("groupMessage",{groupId:null==e?void 0:e.groupId,content:t.message,width:t.width,height:t.height,fileName:t.fileName,messageType:t.messageType,size:t.size}):null==y||y.emit("privateMessage",{contactId:null==e?void 0:e.userId,content:t.message,width:t.width,height:t.height,fileName:t.fileName,messageType:t.messageType,size:t.size})}),[null==y?void 0:y.id]),k=a.useCallback((function(e){h({type:"SET_ACTIVE_ROOM",payload:{groupId:null==e?void 0:e.groupId,contactId:null==e?void 0:e.userId,ifNotExists:!1}})}),[null==y?void 0:y.id,h]),D=a.useCallback((function(e){e.messages&&0!==e.messages.length&&(e.groupId?null==y||y.emit("markAsRead",{groupId:e.groupId,_id:e.messages[e.messages.length-1]._id}):null==y||y.emit("markAsRead",{contactId:e.userId,_id:e.messages[e.messages.length-1]._id}))}),[null==y?void 0:y.id]),j=a.useCallback((function(e){null==y||y.emit("startConference",{groupId:e.groupId,contactId:e.userId})}),[null==y?void 0:y.id]),L=a.useCallback((function(e){null!=(null==e?void 0:e.id)&&(null==y||y.emit("stopConference",{id:null==e?void 0:e.id}))}),[null==y?void 0:y.id]),U=a.useCallback((function(e){null!=(null==e?void 0:e.id)&&(null==y||y.emit("pauseConference",{id:e.id}))}),[null==y?void 0:y.id]),P=a.useCallback((function(e){h({type:"JOIN_CONFERENCE",payload:e})}),[h]),F=a.useCallback((function(e,t){null==y||y.emit("addOperator",{groupId:e.groupId,operatorId:t.userId})}),[null==y?void 0:y.id]),H=a.useCallback((function(e){null==y||y.emit("deleteGroup",{groupId:e.groupId})}),[null==y?void 0:y.id]),B=a.useCallback((function(){h({type:"SET_ERROR"})}),[h]);a.useEffect((function(){if(null!=m){var e=Object.values(v.contactGather).find((function(e){return e.groupId===m}));M(e)||k(e)}}),[v.contactGather]),a.useEffect((function(){var e;null==(null==(e=v.conference)?void 0:e.data)||v.conference.ringPlayed?x.pause():x.play()}),[null==(t=v.conference)||null==(n=t.data)?void 0:n.id]);var z=null!=v.activeRoom&&a.createElement(le,{apiUrl:C,user:v.user,users:v.userGather,operators:v.operators,chat:v.activeRoom,typing:v.typing,conference:v.conference.data,loading:v.loading,pageSize:T,onExitRoom:E&&null==m?b:void 0,onEnterRoom:D,onNeedMoreMessages:A,onMeesageDelete:O,onTyping:N,onSendMessage:w,onVideoCall:j,onVideoEnd:L,onOperatorAdd:F,onLeaveGroup:H}),Y=function(){return a.createElement(Ee,{apiUrl:C,user:v.user,activeRoom:v.activeRoom,groups:Object.values(v.groupGather),contacts:Object.values(v.contactGather),typing:v.typing,onChangeChat:k})},V=function(){return v.conference.data&&a.createElement(ye,{apiUrl:C,contact:v.contactGather[v.user.userId===v.conference.data.userId?v.conference.data.contactId:v.conference.data.userId],conference:v.conference.data,onAccept:P})},q=function(){return a.createElement(ve,{conference:v.conference.data,onClose:U})},K=a.useMemo((function(){return M(v.conference.data)?a.createElement(Y,null):a.createElement(v.conference.joined?q:V,null)}),[v.conference,null==(r=v.activeRoom)?void 0:r.groupId,null==(o=v.activeRoom)?void 0:o.userId,null==(l=v.activeRoom)||null==(c=l.messages)?void 0:c.length,null==(u=v.activeRoom)?void 0:u.unreadCount]),W=null==m||!M(v.conference.data);return a.createElement(i.Container,{maxWidth:"lg",className:p.root},a.createElement(i.Box,{className:p.innerBox},E?a.createElement(a.Fragment,null,W&&K,z):a.createElement(i.Grid,{container:!0,spacing:1,className:p.innerGrid},W&&a.createElement(i.Grid,{item:!0,sm:4,className:p.innerGrid},K),a.createElement(i.Grid,{item:!0,sm:W?8:12,className:p.innerGrid},z))),a.createElement(i.Snackbar,{anchorOrigin:{vertical:"top",horizontal:"center"},open:!!v.error,autoHideDuration:6e3,onClose:B},a.createElement(f.Alert,{onClose:B,severity:"error"},v.error)))},exports.ChatProvider=function(e){Ie.langCode=e.defLang;var t=localStorage.getItem(e.tokenKey),n=w({},Ce,{tokenKey:e.tokenKey,token:t}),r=o.useReducer(Ae,n);return o.createElement(Oe.Provider,{value:{state:r[0],dispatch:r[1]}},e.children)},exports.Conference=ve,exports.ConferenceCall=ye,exports.Emoji=b,exports.Message=J,exports.RestContext=Ge,exports.RestProvider=function(e){var t=e.baseURLApi,n=e.pageSize,r=e.children,i=a.useContext(Oe),l=i.dispatch,c=R.create({timeout:6e4,baseURL:t,headers:{"Cache-Control":"no-cache",Pragma:"no-cache",Authorization:"Bearer "+i.state.token},withCredentials:!1}),u=a.useCallback(function(){var e=_(G().mark((function e(t){var r,a,o,i;return G().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.userId,o=null==(r=t.messages)?void 0:r.length,e.prev=2,l({type:"SET_LOADING",payload:!0}),e.next=6,c.get("/contact/messages",{params:{contactId:a,current:o,pageSize:n}});case 6:(i=e.sent.data)&&l({type:"ADD_PRIVATE_MESSAGES",payload:{pageSize:n,contactId:a,messages:i}}),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(2),l({type:"SET_ERROR",payload:e.t0.message});case 15:return e.prev=15,l({type:"SET_LOADING",payload:!1}),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[2,11,15,18]])})));return function(t){return e.apply(this,arguments)}}(),[l]),s=a.useCallback(function(){var e=_(G().mark((function e(t){var r,a,o,i;return G().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.groupId,o=null==(r=t.messages)?void 0:r.length,e.prev=2,l({type:"SET_LOADING",payload:!0}),e.next=6,c.get("/group/messages",{params:{groupId:a,current:o,pageSize:n}});case 6:(i=e.sent.data)&&l({type:"ADD_GROUP_MESSAGES",payload:w({pageSize:n,groupId:a},i)}),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(2),l({type:"SET_ERROR",payload:e.t0.message});case 15:return e.prev=15,l({type:"SET_LOADING",payload:!1}),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[2,11,15,18]])})));return function(t){return e.apply(this,arguments)}}(),[l]);return o.createElement(Ge.Provider,{value:{apiUrl:t,pageSize:n,fetch:c,getPrivateMessages:u,getGroupMessages:s}},r)},exports.Room=le,exports.RoomList=Ee,exports.SocketContext=Ne,exports.SocketProvider=function(e){var t=e.wsUrl,n=e.children,r=a.useContext(Oe),i=r.state,l=r.dispatch,c=function(e,t){var n=a.useState(null),r=n[0],o=n[1],i=a.useCallback((function(){var n=S(e,{reconnection:!0,extraHeaders:{Authorization:"Bearer "+t}});o(n)}),[e,t]),l=a.useCallback((function(){null==r||r.disconnect(),o(null)}),[r]),c=a.useState(!1),u=c[0],s=c[1];return a.useEffect((function(){s(!(null==r||!r.connected))}),[r]),a.useEffect((function(){null==r||r.on("connect",(function(){s(!0),r.emit("chatData")}))}),[r]),a.useEffect((function(){null==r||r.on("disconnect",(function(){s(!1)}))}),[r]),{socket:r,online:u,disconnectSocket:l,connectSocket:i}}(t,i.token),u=c.socket,s=c.online,d=c.disconnectSocket,m=c.connectSocket;return a.useEffect((function(){return i.token&&m(),function(){d()}}),[i.token,m]),a.useEffect((function(){i.token||d()}),[i.token,d]),a.useEffect((function(){var e=function(e){console.log("unauthorized msg",e),l({type:"CLEAR_USER"})};return null==u||u.on("unauthorized",e),function(){null==u||u.off("unauthorized",e)}}),[null==u?void 0:u.id]),a.useEffect((function(){var e=function(e){if(e.code)l({type:"SET_ERROR",payload:e.msg});else{var t=e.data,n=t.groupData,r=t.contactData,a=t.userData;if(l({type:"CLEAR_CHAT_DATA"}),l({type:"SET_USER",payload:t.user}),n.length)for(var o,i=D(n);!(o=i()).done;){var c=o.value;null==u||u.emit("joinGroupSocket",{groupId:c.groupId}),l({type:"SET_GROUP_GATHER",payload:c})}if(r.length)for(var s,d=D(r);!(s=d()).done;){var m=s.value;null==u||u.emit("joinPrivateSocket",{contactId:m.userId}),l({type:"SET_CONTACT_GATHER",payload:m})}if(l({type:"SET_OPERATORS",payload:t.operatorData}),a.length)for(var p,f=D(a);!(p=f()).done;)l({type:"SET_USER_GATHER",payload:p.value});l({type:"UPDATE_ACTIVE_ROOM"}),l({type:"SET_CONFERENCE",payload:t.conferenceData})}};return null==u||u.on("chatData",e),function(){null==u||u.off("chatData",e)}}),[null==u?void 0:u.id]),a.useEffect((function(){var e=function(e){l({type:"USER_ONLINE",payload:e.data})};return null==u||u.on("userOnline",e),function(){null==u||u.off("userOnline",e)}}),[null==u?void 0:u.id]),a.useEffect((function(){var e=function(e){l({type:"USER_OFFLINE",payload:e.data})};return null==u||u.on("userOffline",e),function(){null==u||u.off("userOffline",e)}}),[null==u?void 0:u.id]),a.useEffect((function(){var e=function(e){e.code?l({type:"SET_ERROR",payload:e.msg}):console.log("Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ²Ğ¾ÑˆĞµĞ» Ğ² Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ‹Ğ¹ Ñ‡Ğ°Ñ‚")};return null==u||u.on("joinPrivateSocket",e),function(){null==u||u.off("joinPrivateSocket",e)}}),[null==u?void 0:u.id]),a.useEffect((function(){var e=function(e){var t;if(e.code)l({type:"SET_ERROR",payload:e.msg});else{var n=e.data,r=n.user;r.online=1;var a,o=i.groupGather[n.group.groupId];!o||null!=(t=o.members)&&t.find((function(e){return e.userId===r.userId}))||(r.isManager=0,null==(a=o.members)||a.push(r)),l({type:"SET_USER_GATHER",payload:r})}};return null==u||u.on("joinGroupSocket",e),function(){null==u||u.off("joinGroupSocket",e)}}),[null==u?void 0:u.id,i.groupGather]),a.useEffect((function(){var e=function(){var e=_(G().mark((function e(t){var n,r;return G().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.code){e.next=3;break}return l({type:"SET_ERROR",payload:t.msg}),e.abrupt("return");case 3:l({type:"ADD_GROUP_MESSAGE",payload:n=t.data}),(r=i.activeRoom)&&r.groupId===n.groupId&&n.userId!==i.user.userId&&(null==u||u.emit("markAsRead",{groupId:n.groupId,_id:n._id}));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return null==u||u.on("groupMessage",e),function(){null==u||u.off("groupMessage",e)}}),[null==u?void 0:u.id,i.activeRoom]),a.useEffect((function(){var e=function(){var e=_(G().mark((function e(t){var n,r;return G().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.code){e.next=3;break}return l({type:"SET_ERROR",payload:t.msg}),e.abrupt("return");case 3:(n=t.data).contactId!==i.user.userId&&n.userId!==i.user.userId||(l({type:"ADD_PRIVATE_MESSAGE",payload:n}),i.activeRoom&&!i.activeRoom.groupId&&(null==(r=i.activeRoom)?void 0:r.userId)===n.userId&&(null==u||u.emit("markAsRead",{contactId:n.userId,_id:n._id})));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return null==u||u.on("privateMessage",e),function(){null==u||u.off("privateMessage",e)}}),[null==u?void 0:u.id,i.activeRoom]),a.useEffect((function(){var e,t=function(t){t.code?l({type:"SET_ERROR",payload:t.msg}):(e&&clearTimeout(e),l({type:"SET_TYPING",payload:t.data}),e=setTimeout((function(){l({type:"SET_TYPING",payload:null})}),1e3))};return null==u||u.on("typing",t),function(){e&&clearTimeout(e),null==u||u.off("typing",t)}}),[null==u?void 0:u.id]),a.useEffect((function(){var e=function(e){if(e.code)l({type:"SET_ERROR",payload:e.msg});else{var t=e.data;t.userId===i.user.userId?l(t.groupId?{type:"LOSE_GROUP_UNREAD_GATHER",payload:t.groupId}:{type:"LOSE_CONTACT_UNREAD_GATHER",payload:t.contactId}):t.contactId&&l({type:"MARK_PRIVATE_MESSAGES_READ",payload:t.userId})}};return null==u||u.on("markAsRead",e),function(){null==u||u.off("markAsRead",e)}}),[null==u?void 0:u.id,i.user.userId]),a.useEffect((function(){var e=function(e){l(e.code?{type:"SET_ERROR",payload:e.msg}:{type:"REVOKE_MESSAGE",payload:e.data})};return null==u||u.on("revokeMessage",e),function(){null==u||u.off("revokeMessage",e)}}),[null==u?void 0:u.id]),a.useEffect((function(){var e=function(e){l(e.code?{type:"SET_ERROR",payload:e.msg}:{type:"SET_GROUP_GATHER",payload:e.data})};return null==u||u.on("addGroup",e),function(){null==u||u.off("addGroup",e)}}),[null==u?void 0:u.id]),a.useEffect((function(){var e=function(e){if(e.code)l({type:"SET_ERROR",payload:e.msg});else{var t=e.data;l({type:"SET_CONTACT_GATHER",payload:t}),l({type:"SET_USER_GATHER",payload:t}),null==u||u.emit("joinPrivateSocket",{contactId:t.userId})}};return null==u||u.on("addContact",e),function(){null==u||u.off("addContact",e)}}),[null==u?void 0:u.id]),a.useEffect((function(){var e=function(e){if(e.code)l({type:"SET_ERROR",payload:e.msg});else{var t=e.data;l(t.userId===i.user.userId?{type:"DEL_GROUP",payload:t.groupId}:{type:"DEL_GROUP_MEMBER",payload:t})}};return null==u||u.on("deleteGroup",e),function(){null==u||u.off("deleteGroup",e)}}),[null==u?void 0:u.id,i.user]),a.useEffect((function(){var e=function(e){l(e.code?{type:"SET_ERROR",payload:e.msg}:{type:"DEL_CONTACT",payload:e.data})};return null==u||u.on("deleteContact",e),function(){null==u||u.off("deleteContact",e)}}),[null==u?void 0:u.id]),a.useEffect((function(){var e=function(e){l(e.code?{type:"SET_ERROR",payload:e.msg}:{type:"UPDATE_GROUP_INFO",payload:e.data})};return null==u||u.on("updateGroupInfo",e),function(){null==u||u.off("updateGroupInfo",e)}}),[null==u?void 0:u.id]),a.useEffect((function(){var e=function(e){l(e.code?{type:"SET_ERROR",payload:e.msg}:{type:"UPDATE_USER_INFO",payload:e.data})};return null==u||u.on("updateUserInfo",e),function(){null==u||u.off("updateUserInfo",e)}}),[null==u?void 0:u.id]),a.useEffect((function(){var e=function(e){if(e.code)l({type:"SET_ERROR",payload:e.msg});else{var t=e.data,n=t.group,r=t.user;i.groupGather[n.groupId]?r.userId!==i.user.userId&&l({type:"ADD_GROUP_MEMBER",payload:{groupId:n.groupId,members:[r]}}):(console.log("joined to a new group"),null==u||u.emit("chatData"))}};return null==u||u.on("joinGroup",e),function(){null==u||u.off("joinGroup",e)}}),[null==u?void 0:u.id,i.user,i.groupGather]),a.useEffect((function(){var e=function(e){l(e.code?{type:"SET_ERROR",payload:e.msg}:{type:"SET_CONFERENCE",payload:e.data})};return null==u||u.on("startConference",e),function(){null==u||u.off("startConference",e)}}),[null==u?void 0:u.id]),a.useEffect((function(){var e=function(e){l(e.code?{type:"SET_ERROR",payload:e.msg}:{type:"PAUSE_CONFERENCE",payload:e.data})};return null==u||u.on("pauseConference",e),function(){null==u||u.off("pauseConference",e)}}),[null==u?void 0:u.id]),a.useEffect((function(){var e=function(e){l(e.code?{type:"SET_ERROR",payload:e.msg}:{type:"STOP_CONFERENCE",payload:e.data})};return null==u||u.on("stopConference",e),function(){null==u||u.off("stopConference",e)}}),[null==u?void 0:u.id]),a.useEffect((function(){var e=function(e){e.code&&l({type:"SET_ERROR",payload:e.msg})};return null==u||u.on("addOperator",e),function(){null==u||u.off("addOperator",e)}}),[null==u?void 0:u.id]),a.useEffect((function(){var e=function(e){l(e.code?{type:"SET_ERROR",payload:e.msg}:{type:"SET_ACTIVE_ROOM",payload:e.data})};return null==u||u.on("setActiveRoom",e),function(){null==u||u.off("setActiveRoom",e)}}),[null==u?void 0:u.id]),o.createElement(Ne.Provider,{value:{socket:u,online:s}},n)},exports.Typing=O,exports.chatResources={ru:{CHAT:{STATUS:{ONLINE:"Ğ² ÑĞµÑ‚Ğ¸",OFFLINE:"Ğ½Ğµ Ğ² ÑĞµÑ‚Ğ¸",TYPING:"Ğ¿ĞµÑ‡Ğ°Ñ‚Ğ°ĞµÑ‚"},MESSAGE:{TYPE:{IMAGE:"Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ",VIDEO:"Ğ’Ğ¸Ğ´ĞµĞ¾",FILE:"Ğ¤Ğ°Ğ¹Ğ»",NOTIFY:"Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ"},MENU:{COPY:"ĞšĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ",DELETE:"Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ"},REVOKED:{YOU:"Ğ’Ñ‹ ÑƒĞ´Ğ°Ğ»Ğ¸Ğ»Ğ¸ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ",CONTACT:"ÑƒĞ´Ğ°Ğ»Ğ¸Ğ»(Ğ°) ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ"}},CONFERENCE:{JOIN:"ĞŸÑ€Ğ¸ÑĞ¾ĞµĞ´Ğ¸Ğ½Ğ¸Ñ‚ÑŒÑÑ",START:"ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ",FINISH:"Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ñ‚ÑŒ"},ADD_CONTACT:"Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚",INPUT_MESSAGE:"ĞĞ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ...",INPUT_SEARCH_CONTACT:"Ğ¤Ğ°Ğ¼Ğ¸Ğ»Ğ¸Ñ Ğ˜Ğ¼Ñ ĞÑ‚Ñ‡ĞµÑÑ‚Ğ²Ğ¾",MEMBERS:"ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ¾Ğ²"}},en:{CHAT:{STATUS:{ONLINE:"online",OFFLINE:"offline",TYPING:"typing"},MESSAGE:{TYPE:{IMAGE:"Image",VIDEO:"Video",FILE:"File",NOTIFY:"Notification"},MENU:{COPY:"Copy",DELETE:"Delete"},REVOKED:{YOU:"You deleted the message",CONTACT:"deleted the message"}},CONFERENCE:{JOIN:"Join",START:"Start",FINISH:"Finish"},ADD_CONTACT:"Add contact",INPUT_MESSAGE:"Please write a message...",INPUT_SEARCH_CONTACT:"Surname Name",MEMBERS:"members"}},fr:{CHAT:{STATUS:{ONLINE:"online",OFFLINE:"offline",TYPING:"typing"},MESSAGE:{TYPE:{IMAGE:"Image",VIDEO:"Video",FILE:"File",NOTIFY:"Notification"},MENU:{COPY:"Copy",DELETE:"Delete"},REVOKED:{YOU:"You deleted the message",CONTACT:"deleted the message"}},CONFERENCE:{JOIN:"Join",START:"Start",FINISH:"Finish"},ADD_CONTACT:"Add contact",INPUT_MESSAGE:"Please write a message...",INPUT_SEARCH_CONTACT:"Surname Name",MEMBERS:"members"}}};
//# sourceMappingURL=chat.cjs.production.min.js.map
