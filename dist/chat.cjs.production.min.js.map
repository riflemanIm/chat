{"version":3,"file":"chat.cjs.production.min.js","sources":["../src/types/index.ts","../src/components/Emoji.tsx","../src/components/Typing.tsx","../src/components/Entry.tsx","../src/components/ContactStatus.tsx","../src/utils/common.ts","../src/components/ContactList.tsx","../src/components/AddContact.tsx","../src/components/AlertDialog.tsx","../src/components/ConferenceTime.tsx","../src/hooks/useCounter.ts","../src/components/ConfirmDialogSlide.tsx","../src/components/ConferenceButton.tsx","../src/components/RoomHeader.tsx","../src/components/MessageContent/File.tsx","../src/components/MessageContent/Video.tsx","../src/components/MessageContent/Image.tsx","../src/components/MessageContent/index.tsx","../src/components/styles.ts","../src/components/Message.tsx","../src/context/ChatContext.tsx","../src/components/RoomMessageList.tsx","../src/hooks/useInterval.js","../src/components/Room.tsx","../src/components/RoomListItem.tsx","../src/components/RoomList.tsx","../src/components/Conference.tsx","../src/components/ConferenceCall.tsx","../node_modules/regenerator-runtime/runtime.js","../src/context/RestContext.tsx","../src/context/SocketContext.tsx","../src/hooks/useSocket.ts","../src/components/CheckAudiVideoPerm.tsx","../src/components/Alert.tsx","../src/pages/chat.tsx","../src/translations/index.ts","../src/context/LanguageContext.tsx","../src/components/ChatIndex/index.tsx"],"sourcesContent":["export interface ChatPageProps {\r\n  activeGroupId?: number;\r\n  activeChatUserId?: number;\r\n  inModale?: boolean;\r\n  hideRooms?: boolean;\r\n  fullWidth?: boolean;\r\n  onContactInfoClick?: (contact: Contact) => void;\r\n}\r\n\r\nexport interface ChatProps extends ChatPageProps {\r\n  lang: 'ru' | 'en' | 'fr';\r\n  chatBaseURLApi: string;\r\n  chatWsUrl: string;\r\n  chatWsPath: string;\r\n  token: string;\r\n  refreshToken: string;\r\n}\r\n\r\n// –¢–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è\r\nexport type MessageType =\r\n  | 'text'\r\n  | 'image'\r\n  | 'file'\r\n  | 'video'\r\n  | 'notify'\r\n  | 'video_conference';\r\n\r\nexport enum MessageStatus {\r\n  sent = 0,\r\n  read = 1,\r\n}\r\n\r\nexport enum Role {\r\n  Unknown = 0,\r\n  Client = 1,\r\n  Agent = 2,\r\n  Specialist = 3,\r\n  Operator = 4,\r\n}\r\n\r\nexport interface User {\r\n  userId: number;\r\n  username: string;\r\n  password: string;\r\n  avatar: string;\r\n  role?: Role;\r\n  online?: 1 | 0; // –í —Å–µ—Ç–∏\r\n  langCode?: string;\r\n}\r\n\r\n// –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è\r\nexport interface PrivateMessage {\r\n  _id?: number;\r\n  userId: number;\r\n  contactId: number;\r\n  content: string;\r\n  messageType: MessageType;\r\n  status: MessageStatus;\r\n  cdate: string;\r\n  type?: string;\r\n  isRevoke?: boolean;\r\n  revokeUserName?: string;\r\n  ref?: React.RefObject<HTMLLIElement>;\r\n}\r\n\r\n// –ö–æ–Ω—Ç–∞–∫—Ç\r\nexport interface Contact {\r\n  userId: number;\r\n  groupId?: number;\r\n  username: string;\r\n  avatar?: string;\r\n  role?: Role;\r\n  messages?: PrivateMessage[];\r\n  unreadCount?: number;\r\n  isTop?: boolean;\r\n  online?: 1 | 0;\r\n  isManager?: 1 | 0;\r\n  noMoreData?: boolean;\r\n}\r\nexport interface VisitData {\r\n  chatFrom: Date;\r\n  conferenceStatus: 'started' | 'finished' | 'none';\r\n  contactId: number;\r\n  duration: number;\r\n  plExamName: string;\r\n  planningId: number;\r\n  visitDate: Date;\r\n  visitId: number;\r\n}\r\n\r\n// –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥—Ä—É–∑—å—è—Ö\r\nexport interface ContactGather {\r\n  [userId: number]: Contact;\r\n}\r\n\r\n// –ì—Ä—É–ø–ø–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\r\nexport interface GroupMessage {\r\n  _id?: number;\r\n  userId: number;\r\n  groupId: number;\r\n  content: string;\r\n  messageType: MessageType;\r\n  cdate: string;\r\n  isRevoke?: boolean;\r\n  revokeUserName?: string;\r\n  status?: MessageStatus;\r\n  ref?: React.RefObject<HTMLLIElement>;\r\n}\r\n\r\n// –ì—Ä—É–ø–ø–∞\r\nexport interface Group {\r\n  groupId: number;\r\n  userId: number; // –≤–ª–∞–¥–µ–ª–µ—Ü\r\n  name: string;\r\n  notice: string;\r\n  messages?: GroupMessage[];\r\n  unreadCount?: number;\r\n  cdate: string;\r\n  isTop?: boolean;\r\n  members?: Contact[];\r\n  noMoreData?: boolean;\r\n}\r\n\r\n// –ì—Ä—É–ø–ø—ã\r\nexport interface GroupGather {\r\n  [groupId: number]: Group;\r\n}\r\n\r\n// –ê—Å—Å–æ—Ü–∏–∞—Ü–∏–∏ –≥—Ä—É–ø–ø –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\r\nexport interface GroupMap {\r\n  groupId: number;\r\n  userId: number;\r\n}\r\n\r\n// –ê—Å—Å–æ—Ü–∏–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –¥—Ä—É–∑–µ–π\r\nexport interface ContactMap {\r\n  contactId: number;\r\n  userId: number;\r\n}\r\n\r\nexport interface SendMessage {\r\n  message: string | File;\r\n  width?: number;\r\n  height?: number;\r\n  fileName?: string;\r\n  messageType: MessageType[0] | MessageType[1];\r\n  size?: number;\r\n}\r\n\r\n// –†–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è\r\nexport interface ImageSize {\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\n// –ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è\r\nexport interface UnReadGather {\r\n  [key: string]: number;\r\n}\r\n\r\n// –ü–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–æ\r\nexport interface PagingParams {\r\n  groupId?: number;\r\n  userId?: number;\r\n  contactId?: number;\r\n  current: number;\r\n  pageSize: number;\r\n}\r\n\r\n// –ü–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω—ã–π –æ—Ç–≤–µ—Ç –¥–ª—è –≥—Ä—É–ø–ø–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π\r\nexport interface PagingResponse {\r\n  // messageArr: GroupMessage[]; - fix on messages\r\n  messages: GroupMessage[];\r\n  userArr: User[];\r\n}\r\n\r\nexport interface ContactUserMap {\r\n  contactId: number;\r\n  contactUserName: string;\r\n}\r\n\r\n// –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–º, —á—Ç–æ –∫–æ–Ω—Ç–∞–∫—Ç –ø–µ—á–∞—Ç–∞–µ—Ç —Ç–µ–∫—Å—Ç\r\nexport interface SetTyping {\r\n  userId?: number;\r\n  groupId?: number;\r\n  contactId?: number;\r\n}\r\n\r\n// –û–ø–µ—Ä–∞—Ü–∏—è —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º\r\nexport interface MessageOperation {\r\n  userId?: number;\r\n  username: string;\r\n  groupId?: number;\r\n  contactId?: number;\r\n  _id: number;\r\n}\r\n\r\n// –î–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏\r\nexport interface ConferenceData {\r\n  userId: number;\r\n  contactId: number;\r\n  id: string;\r\n  url?: string;\r\n  serverAddress?: string;\r\n  user?: string;\r\n  password?: string;\r\n  currentDate?: Date;\r\n  finishDate?: Date;\r\n}\r\n\r\n// –î–∞–Ω–Ω—ã–µ —á–∞—Ç–∞\r\nexport interface ChatData {\r\n  user: User;\r\n  groupData: Group[];\r\n  contactData: Contact[];\r\n  userData: User[];\r\n  operatorData: Contact[];\r\n  conferenceData: ConferenceData;\r\n  visitData: VisitData[];\r\n}\r\n\r\nexport interface GroupMember {\r\n  groupId: number;\r\n  members: Contact[];\r\n}\r\n\r\nexport interface AddPrivateMessages {\r\n  pageSize: number;\r\n  contactId: number;\r\n  messages: PrivateMessage[];\r\n}\r\n\r\nexport interface AddGroupMessages extends PagingResponse {\r\n  pageSize: number;\r\n  groupId: number;\r\n}\r\n\r\nexport interface SetActiveRoom {\r\n  groupId?: number;\r\n  contactId?: number;\r\n}\r\n\r\nexport interface JoinGroup {\r\n  group: Group;\r\n  user: Contact;\r\n}\r\n\r\nexport interface SetUser {\r\n  user: User;\r\n  token: string;\r\n}\r\n\r\nexport type ChatRoom = Group | Contact;\r\nexport type ChatMessage = GroupMessage | PrivateMessage;\r\n\r\n// –û–ø–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é\r\nexport enum ContextMenuType {\r\n  COPY = 'COPY', // –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å\r\n  REVOKE = 'REVOKE', // –£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ\r\n  TOP_REVERT = 'TOP_REVERT', // –û—Ç–∫—Ä–µ–ø–∏—Ç—å\r\n  TOP = 'TOP', // –ó–∞–∫—Ä–µ–ø–∏—Ç—å\r\n  READ = 'READ', // –ü—Ä–æ—á–µ—Å—Ç—å –≤—Å—ë\r\n  DELETE = 'DELETE', // –£–¥–∞–ª–∏—Ç—å\r\n}\r\n","import * as React from \"react\";\r\nimport { Box,  } from \"@mui/material\";\r\nimport { makeStyles,createStyles } from '@mui/styles';\r\n\r\nconst useStyles = makeStyles(() =>\r\n  createStyles({\r\n    item: {\r\n      cursor: \"pointer\",\r\n    },\r\n  })\r\n);\r\n\r\ntype EmojiProps = {\r\n  onSelect?: (emoji: string) => void;\r\n};\r\n\r\ntype EmojiItemProps = {\r\n  emoji: string;\r\n};\r\n\r\nconst Emoji: React.FC<EmojiProps> = (props: EmojiProps) => {\r\n  const classes = useStyles();\r\n  const emojiClick = (e: React.MouseEvent<HTMLDivElement>) => {\r\n    if (props.onSelect) {\r\n      props.onSelect((e.target as HTMLDivElement).innerText);\r\n    }\r\n  };\r\n\r\n  const Item = (itemProps: EmojiItemProps) => {\r\n    return (\r\n      <Box\r\n        m={0.5}\r\n        component=\"span\"\r\n        onClick={emojiClick}\r\n        className={classes.item}\r\n      >\r\n        {itemProps.emoji}\r\n      </Box>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <Box>\r\n      <Box display=\"flex\" flexDirection=\"row\">\r\n        <Item emoji=\"üòÉ\" />\r\n        <Item emoji=\"üòÅ\" />\r\n        <Item emoji=\"üòÇ\" />\r\n        <Item emoji=\"üòÑ\" />\r\n        <Item emoji=\"üòÖ\" />\r\n        <Item emoji=\"üòÜ\" />\r\n        <Item emoji=\"üòá\" />\r\n        <Item emoji=\"üòà\" />\r\n        <Item emoji=\"üòâ\" />\r\n      </Box>\r\n      <Box display=\"flex\" flexDirection=\"row\">\r\n        <Item emoji=\"üòä\" />\r\n        <Item emoji=\"üòã\" />\r\n        <Item emoji=\"üòå\" />\r\n        <Item emoji=\"üòç\" />\r\n        <Item emoji=\"üòé\" />\r\n        <Item emoji=\"üòè\" />\r\n        <Item emoji=\"üòê\" />\r\n        <Item emoji=\"üòí\" />\r\n        <Item emoji=\"üòì\" />\r\n      </Box>\r\n      <Box display=\"flex\" flexDirection=\"row\">\r\n        <Item emoji=\"‚ùì\" />\r\n        <Item emoji=\"üòï\" />\r\n        <Item emoji=\"üòñ\" />\r\n        <Item emoji=\"üòó\" />\r\n        <Item emoji=\"üòò\" />\r\n        <Item emoji=\"üòô\" />\r\n        <Item emoji=\"üòö\" />\r\n        <Item emoji=\"üòú\" />\r\n        <Item emoji=\"üòù\" />\r\n      </Box>\r\n      <Box display=\"flex\" flexDirection=\"row\">\r\n        <Item emoji=\"üòû\" />\r\n        <Item emoji=\"üòü\" />\r\n        <Item emoji=\"üò†\" />\r\n        <Item emoji=\"üò°\" />\r\n        <Item emoji=\"üò¢\" />\r\n        <Item emoji=\"üò£\" />\r\n        <Item emoji=\"üò§\" />\r\n        <Item emoji=\"üò•\" />\r\n        <Item emoji=\"üò¶\" />\r\n      </Box>\r\n      <Box display=\"flex\" flexDirection=\"row\">\r\n        <Item emoji=\"üò®\" />\r\n        <Item emoji=\"üò©\" />\r\n        <Item emoji=\"üò™\" />\r\n        <Item emoji=\"üò´\" />\r\n        <Item emoji=\"üò¨\" />\r\n        <Item emoji=\"üò≠\" />\r\n        <Item emoji=\"üòÆ\" />\r\n        <Item emoji=\"üòØ\" />\r\n        <Item emoji=\"üò∞\" />\r\n      </Box>\r\n      <Box display=\"flex\" flexDirection=\"row\">\r\n        <Item emoji=\"üò≤\" />\r\n        <Item emoji=\"üò≥\" />\r\n        <Item emoji=\"üò¥\" />\r\n        <Item emoji=\"üòµ\" />\r\n        <Item emoji=\"üßê\" />\r\n        <Item emoji=\"üò∑\" />\r\n        <Item emoji=\"üôÅ\" />\r\n        <Item emoji=\"üôÇ\" />\r\n        <Item emoji=\"üôÉ\" />\r\n      </Box>\r\n      <Box display=\"flex\" flexDirection=\"row\">\r\n        <Item emoji=\"ü§ê\" />\r\n        <Item emoji=\"ü§ë\" />\r\n        <Item emoji=\"ü§í\" />\r\n        <Item emoji=\"ü§ì\" />\r\n        <Item emoji=\"ü§î\" />\r\n        <Item emoji=\"ü§ï\" />\r\n        <Item emoji=\"ü§†\" />\r\n        <Item emoji=\"ü§°\" />\r\n        <Item emoji=\"ü§¢\" />\r\n      </Box>\r\n      <Box display=\"flex\" flexDirection=\"row\">\r\n        <Item emoji=\"ü§§\" />\r\n        <Item emoji=\"ü§•\" />\r\n        <Item emoji=\"ü§ß\" />\r\n        <Item emoji=\"ü§®\" />\r\n        <Item emoji=\"ü§©\" />\r\n        <Item emoji=\"ü§™\" />\r\n        <Item emoji=\"ü§´\" />\r\n        <Item emoji=\"ü§¨\" />\r\n        <Item emoji=\"ü§≠\" />\r\n      </Box>\r\n    </Box>\r\n  );\r\n};\r\nexport default Emoji;\r\n","import React from \"react\";\r\nimport { Typography } from \"@mui/material\";\r\nimport { Theme } from '@mui/material/styles';\r\nimport { makeStyles, createStyles } from '@mui/styles';\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    typingText: {\r\n      paddingLeft: theme.spacing(0.5),\r\n    },\r\n    typingDot: {\r\n      display: \"inline-block\",\r\n      verticalAlign: \"middle\",\r\n      width: 4,\r\n      height: 4,\r\n      margin: \"0px 2px\",\r\n      background: theme.palette.primary.main,\r\n      borderRadius: \"50%\",\r\n      opacity: \"0\",\r\n      animation: \"$loadingFade 1s infinite\",\r\n      \"&:nth-child(1)\": {\r\n        animationDelay: \"0s\",\r\n      },\r\n      \"&:nth-child(2)\": {\r\n        animationDelay: \"0.2s\",\r\n      },\r\n      \"&:nth-child(3)\": {\r\n        animationDelay: \"0.4s\",\r\n      },\r\n    },\r\n    \"@keyframes loadingFade\": {\r\n      \"0%\": {\r\n        opacity: 0,\r\n      },\r\n      \"50%\": {\r\n        opacity: 0.8,\r\n      },\r\n      \"100%\": {\r\n        opacity: 0,\r\n      },\r\n    },\r\n  })\r\n);\r\n\r\ntype TypingProps = {\r\n  message: string;\r\n};\r\n\r\nconst Typing: React.FC<TypingProps> = (props: TypingProps) => {\r\n  const classes = useStyles();\r\n  return (\r\n    <Typography color=\"primary\" variant=\"body2\" component=\"span\">\r\n      <span className={classes.typingDot} />\r\n      <span className={classes.typingDot} />\r\n      <span className={classes.typingDot} />\r\n      <span className={classes.typingText}>{props.message}</span>\r\n    </Typography>\r\n  );\r\n};\r\nexport default Typing;\r\n","import React, { ChangeEvent, KeyboardEvent } from \"react\";\r\nimport {\r\n  Box,\r\n  IconButton,\r\n  InputAdornment,\r\n  TextField,\r\n  Popover,\r\n  SvgIcon\r\n} from \"@mui/material\";\r\n\r\nimport { makeStyles } from \"@mui/styles\";\r\nimport { Send, InsertEmoticon } from \"@mui/icons-material\";\r\nimport Emoji from \"./Emoji\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { ChatRoom, ImageSize, SendMessage } from \"../types\";\r\n\r\nconst useStyles = makeStyles(() => ({\r\n  input: {\r\n    flex: \"auto\"\r\n  },\r\n  inputUpload: {\r\n    display: \"none\"\r\n  },\r\n  attachmentIcon: {\r\n    fill: \"none\",\r\n    stroke: \"currentColor\"\r\n  }\r\n}));\r\n\r\ntype EntryProps = {\r\n  chat: ChatRoom | null;\r\n  onTyping?: (chat: ChatRoom) => void;\r\n  onSendMessage?: (chat: ChatRoom, data: SendMessage) => void;\r\n};\r\n\r\n/**\r\n * –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è\r\n */\r\nconst getImageSize = (data: ImageSize) => {\r\n  let { width, height } = data;\r\n  if (width > 335 || height > 335) {\r\n    if (width > height) {\r\n      height = 335 * (height / width);\r\n      width = 335;\r\n    } else {\r\n      width = 335 * (width / height);\r\n      height = 335;\r\n    }\r\n  }\r\n  return {\r\n    width,\r\n    height\r\n  };\r\n};\r\n\r\nconst Entry: React.FC<EntryProps> = (props: EntryProps) => {\r\n  const classes = useStyles();\r\n  const { chat } = props;\r\n\r\n  const { t } = useTranslation();\r\n\r\n  const [empjiEl, setEmojiEl] = React.useState<HTMLButtonElement | null>(null);\r\n  const [text, setText] = React.useState(\"\");\r\n  const [lastTyping, setLastTyping] = React.useState({\r\n    chat,\r\n    time: 0\r\n  });\r\n\r\n  const handleEmojiClick = (event: React.MouseEvent<HTMLButtonElement>) => {\r\n    setEmojiEl(event.currentTarget);\r\n  };\r\n\r\n  const handleEmojiClose = () => {\r\n    setEmojiEl(null);\r\n  };\r\n\r\n  const emojiSelect = (emoji: string) => {\r\n    setText(`${text}${emoji}`);\r\n    handleEmojiClose();\r\n  };\r\n\r\n  const onChange = ({ target }: ChangeEvent<HTMLInputElement>) => {\r\n    setText(target.value);\r\n    if (\r\n      chat &&\r\n      props.onTyping &&\r\n      (lastTyping.chat !== chat || Date.now() - lastTyping.time >= 500)\r\n    ) {\r\n      setLastTyping({\r\n        chat,\r\n        time: Date.now()\r\n      });\r\n      props.onTyping(chat);\r\n    }\r\n  };\r\n\r\n  const sendMessage = (data: SendMessage) => {\r\n    if (chat && props.onSendMessage) props.onSendMessage(chat, data);\r\n  };\r\n\r\n  const submit = () => {\r\n    if (text.trim().length === 0) {\r\n      return;\r\n    }\r\n\r\n    sendMessage({ message: text, messageType: \"text\" });\r\n    setText(\"\");\r\n  };\r\n\r\n  const onSubmitClick = (event: React.MouseEvent<HTMLButtonElement>) => {\r\n    event.preventDefault();\r\n    submit();\r\n  };\r\n\r\n  const onKeyPress = (event: KeyboardEvent<HTMLInputElement>) => {\r\n    if (event.key === \"Enter\") {\r\n      event.preventDefault();\r\n      submit();\r\n    }\r\n  };\r\n\r\n  const onSubmitFile = (event: React.FormEvent<HTMLInputElement>) => {\r\n    if (!event.currentTarget.files) return;\r\n    const file = event.currentTarget.files[0];\r\n    let messageType: string;\r\n    if (file.type.includes(\"image\")) {\r\n      messageType = \"image\";\r\n    } else if (file.type.includes(\"video\")) {\r\n      messageType = \"video\";\r\n    } else {\r\n      messageType = \"file\";\r\n    }\r\n    if (messageType === \"image\") {\r\n      const image = new Image();\r\n      const url = window.URL || window.webkitURL;\r\n      image.src = url.createObjectURL(file);\r\n      image.onload = () => {\r\n        const imageSize: ImageSize = getImageSize({\r\n          width: image.width,\r\n          height: image.height\r\n        });\r\n        sendMessage({\r\n          message: file,\r\n          width: imageSize.width,\r\n          height: imageSize.height,\r\n          messageType\r\n        });\r\n      };\r\n    } else {\r\n      sendMessage({\r\n        message: file,\r\n        messageType,\r\n        fileName: file.name,\r\n        size: file.size\r\n      });\r\n    }\r\n  };\r\n\r\n  const emojiOpen = Boolean(empjiEl);\r\n  const enojiId = emojiOpen ? \"simple-popover\" : undefined;\r\n  return (\r\n    <Box display=\"flex\" flexDirection=\"row\">\r\n      <TextField\r\n        className={classes.input}\r\n        placeholder={t(\"CHAT.INPUT_MESSAGE\") || \"\"}\r\n        autoFocus={true}\r\n        variant=\"standard\"\r\n        InputProps={{\r\n          disableUnderline: true,\r\n          startAdornment: (\r\n            <InputAdornment position={\"start\"}>\r\n              <input\r\n                accept=\".pdf,.jpg,.jpeg,.bmp,.gif,.png,application/pdf,image/jpeg,image/bmp,image/gif,image/png\"\r\n                className={classes.inputUpload}\r\n                id=\"icon-button-file\"\r\n                type=\"file\"\r\n                onChange={onSubmitFile}\r\n              />\r\n              <label htmlFor=\"icon-button-file\">\r\n                <IconButton\r\n                  color=\"primary\"\r\n                  aria-label=\"upload\"\r\n                  component=\"span\"\r\n                  size=\"small\"\r\n                >\r\n                  <SvgIcon fill=\"none\" className={classes.attachmentIcon}>\r\n                    <path\r\n                      d=\"M16.768 13.5767L11.6961 18.6486C9.35886 20.9859 5.56937 20.9859 3.23208 18.6486V18.6486C0.894789 16.3114 0.894789 12.5219 3.23208 10.1846L10.4479 2.96872C12.0875 1.32914 14.7458 1.32914 16.3854 2.96873V2.96873C18.025 4.60831 18.025 7.26659 16.3854 8.90617L9.16515 16.1264C8.23032 17.0612 6.71466 17.0612 5.77982 16.1264V16.1264C4.84499 15.1916 4.84499 13.6759 5.77982 12.7411L10.8896 7.63131\"\r\n                      strokeWidth=\"1.6\"\r\n                      strokeLinecap=\"round\"\r\n                      strokeLinejoin=\"round\"\r\n                    />\r\n                  </SvgIcon>\r\n                </IconButton>\r\n              </label>{\" \"}\r\n              <IconButton\r\n                aria-describedby={enojiId}\r\n                onClick={handleEmojiClick}\r\n                color=\"primary\"\r\n                size=\"small\"\r\n              >\r\n                <InsertEmoticon />\r\n              </IconButton>\r\n            </InputAdornment>\r\n          ),\r\n          endAdornment: (\r\n            <IconButton\r\n              edge=\"end\"\r\n              color=\"inherit\"\r\n              size=\"small\"\r\n              onClick={onSubmitClick}\r\n            >\r\n              <Send />\r\n            </IconButton>\r\n          )\r\n        }}\r\n        value={text}\r\n        onChange={onChange}\r\n        onKeyPress={onKeyPress}\r\n      />\r\n      <Popover\r\n        id={enojiId}\r\n        open={emojiOpen}\r\n        anchorEl={empjiEl}\r\n        onClose={handleEmojiClose}\r\n        anchorOrigin={{\r\n          vertical: \"top\",\r\n          horizontal: \"center\"\r\n        }}\r\n        transformOrigin={{\r\n          vertical: \"bottom\",\r\n          horizontal: \"left\"\r\n        }}\r\n      >\r\n        <Emoji onSelect={emojiSelect} />\r\n      </Popover>\r\n    </Box>\r\n  );\r\n};\r\nexport default Entry;\r\n","import React from 'react';\r\nimport { Typography } from '@mui/material';\r\nimport Typing from './Typing';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { Contact } from '../types';\r\n\r\ntype ContactStatusProps = {\r\n  contact: Contact;\r\n  isTyping: boolean;\r\n};\r\n\r\nconst ContactStatus: React.FC<ContactStatusProps> = (\r\n  props: ContactStatusProps,\r\n) => {\r\n  const { t } = useTranslation();\r\n\r\n  if (props.isTyping)\r\n    return <Typing message={t('CHAT.STATUS.TYPING')} />;\r\n  if (props.contact.online === 1)\r\n    return (\r\n      <Typography variant=\"body2\" color=\"primary\" component=\"span\">\r\n        {t('CHAT.STATUS.ONLINE')}\r\n      </Typography>\r\n    );\r\n  return (\r\n    <Typography\r\n      variant=\"body2\"\r\n      color=\"textSecondary\"\r\n      component=\"span\"\r\n    >\r\n      {t('CHAT.STATUS.OFFLINE')}\r\n    </Typography>\r\n  );\r\n};\r\n\r\nexport default ContactStatus;\r\n","import dayjs from 'dayjs';\r\nimport {\r\n  ChatRoom,\r\n  Contact,\r\n  ContactGather,\r\n  Group,\r\n  GroupGather,\r\n} from '../types';\r\n\r\nexport function isEmpty(value: unknown): boolean {\r\n  return (\r\n    value == null ||\r\n    (typeof value === 'object' && Object.keys(value).length === 0) ||\r\n    (typeof value === 'string' && value.trim().length === 0)\r\n  );\r\n}\r\n\r\n// string contains string\r\nexport function isContainStr(str1: string, str2: string): boolean {\r\n  return str2.indexOf(str1) >= 0;\r\n}\r\n\r\n/**\r\n * check URL\r\n * @param text\r\n */\r\nexport function isUrl(text: string): boolean {\r\n  // parse url\r\n  const UrlReg = new RegExp(\r\n    /http(s)?:\\/\\/([\\w-]+\\.)+[\\w-]+(\\/[\\w- ./?%&=]*)?/,\r\n  );\r\n  return UrlReg.test(text);\r\n}\r\n\r\nexport const compareDates = (\r\n  d1: Date | string | undefined,\r\n  d2: Date | string | undefined,\r\n  period:\r\n    | 'day'\r\n    | 'millisecond'\r\n    | 'second'\r\n    | 'minute'\r\n    | 'hour'\r\n    | 'month'\r\n    | 'year'\r\n    | 'date'\r\n    | 'milliseconds'\r\n    | 'seconds'\r\n    | 'minutes'\r\n    | 'hours'\r\n    | 'days' = 'day',\r\n  count = 0,\r\n) => {\r\n  const date1 = dayjs(d1).startOf('date');\r\n  const date2 = dayjs(d2).startOf('date');\r\n\r\n  // console.log(\r\n  //   'diff',\r\n  //   dayjs(date1).format('DD.MM.YYYY'),\r\n  //   dayjs(date2).format('DD.MM.YYYY'),\r\n  //   date1.diff(date2, period) === count,\r\n  // );\r\n  return date1.diff(date2, period) === count;\r\n};\r\n\r\n/**\r\n * –§–æ—Ä–º–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ —Å–æ–æ–±—â–µ–Ω–∏—è\r\n * @param time\r\n */\r\nexport function formatTime(\r\n  time: Date | string | undefined,\r\n  format = 'DD.MM.YYYY HH:mm',\r\n) {\r\n  if (typeof time === 'undefined') return null;\r\n  if (typeof time === 'string') time = new Date(time);\r\n  // –±–æ–ª—å—à–µ —á–µ–º –≤—á–µ—Ä–∞\r\n  if (\r\n    dayjs()\r\n      .add(-1, 'days')\r\n      .startOf('day')\r\n      .isAfter(time)\r\n  ) {\r\n    return dayjs(time).format(format);\r\n  }\r\n  // –≤—á–µ—Ä–∞\r\n  if (\r\n    dayjs()\r\n      .startOf('day')\r\n      .isAfter(time)\r\n  ) {\r\n    return `–í—á–µ—Ä–∞ –≤ ${dayjs(time).format('HH:mm')}`;\r\n  }\r\n\r\n  return dayjs(time).format('HH:mm');\r\n}\r\n\r\n/**\r\n * –†–∞—Å–∫—Ä—ã—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ\r\n * @param content - –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç—Ä–æ–∫–µ\r\n */\r\nexport function getFileMeta(\r\n  content: string,\r\n): {\r\n  date: string;\r\n  userId: string;\r\n  size: string;\r\n  name: string;\r\n} {\r\n  // –§–æ—Ä–º–∞—Ç  [date]$[userId]$[size]$[fileName]\r\n  // –ù–∞–ø—Ä–∏–º–µ—Ä fileName = 1606980397047$1a01e20f-3780-4227-84b5-5c69ca766ee5$15.41KB$123.docx\r\n  const meta = content.split('$');\r\n  const [date, userId, size, name] = meta;\r\n  return {\r\n    date,\r\n    userId,\r\n    size,\r\n    name,\r\n  };\r\n}\r\n\r\nexport function getImageMeta(\r\n  content: string,\r\n): {\r\n  date: string;\r\n  userId: string;\r\n  width: string;\r\n  height: string;\r\n} {\r\n  // –§–æ—Ä–º–∞—Ç [date]$[userId]$[width]$[height]$...\r\n  const meta = content.split('$');\r\n  const [date, userId, width, height] = meta;\r\n  return {\r\n    date,\r\n    userId,\r\n    width,\r\n    height,\r\n  };\r\n}\r\n\r\nexport function splitFileName(\r\n  name: string,\r\n): { name: string; ext: string } {\r\n  const idx = name.lastIndexOf('.');\r\n  if (idx === -1)\r\n    return {\r\n      name,\r\n      ext: '',\r\n    };\r\n  return {\r\n    name: name.slice(0, idx),\r\n    ext: name.slice(idx + 1),\r\n  };\r\n}\r\n\r\nexport const getChatId = (chat: ChatRoom | null): string | null => {\r\n  if (!chat) return null;\r\n  return (chat as Group).groupId\r\n    ? `group:${(chat as Group).groupId}`\r\n    : `user:${chat.userId}`;\r\n};\r\n\r\nexport const getChatName = (chat: ChatRoom): string => {\r\n  return (chat as Group).groupId\r\n    ? (chat as Group).name\r\n    : (chat as Contact).username;\r\n};\r\n\r\nexport const allMessCount = (chats: GroupGather | ContactGather) => {\r\n  return Object.values(chats)\r\n    .map(it => (it?.messages != null ? it?.messages.length : 0))\r\n    .reduce((a: number, b: number) => a + b, 0);\r\n};\r\n\r\nexport const chatRoomComparer = (\r\n  a: ChatRoom,\r\n  b: ChatRoom,\r\n): number => {\r\n  const hasMessagesA =\r\n    Array.isArray(a.messages) && a.messages.length > 0;\r\n  const hasMessagesB =\r\n    Array.isArray(b.messages) && b.messages.length > 0;\r\n  if (\r\n    hasMessagesA &&\r\n    hasMessagesB &&\r\n    b.messages != null &&\r\n    a.messages != null\r\n  ) {\r\n    // !!! if cdate === undefined !!!\r\n    const bb =\r\n      b.messages[b.messages.length - 1].cdate != null\r\n        ? new Date(b.messages[b.messages.length - 1].cdate).getTime()\r\n        : new Date().getTime();\r\n\r\n    const aa =\r\n      a.messages[a.messages.length - 1].cdate != null\r\n        ? new Date(a.messages[a.messages.length - 1].cdate).getTime()\r\n        : new Date().getTime() - 1;\r\n    const res = bb - aa;\r\n\r\n    //console.log('res', res);\r\n    return res;\r\n  }\r\n  if (hasMessagesA) {\r\n    return -1;\r\n  }\r\n  return 1;\r\n};\r\n\r\nexport const getParam = (param: string) => {\r\n  const QueryString = window.location.search;\r\n  const urlParams = new URLSearchParams(QueryString);\r\n  return urlParams.get(param);\r\n};\r\n\r\nexport const combineURLs = (\r\n  baseURL: string,\r\n  relativeURL: string,\r\n  queryParams?: Record<string, string>,\r\n): string => {\r\n  const url = relativeURL\r\n    ? baseURL.replace(/\\/?\\/$/, '') +\r\n      '/' +\r\n      relativeURL.replace(/^\\/+/, '')\r\n    : baseURL;\r\n  if (!queryParams) return url;\r\n\r\n  return (\r\n    url +\r\n    (url.includes('?') ? '&' : '?') +\r\n    new URLSearchParams(queryParams).toString()\r\n  );\r\n};\r\n","import React from 'react';\r\nimport {\r\n  Avatar,\r\n  List,\r\n  ListItemAvatar,\r\n  ListItemButton,\r\n  ListItemText,\r\n  ListProps,\r\n} from '@mui/material';\r\nimport StarIcon from '@mui/icons-material/Star';\r\nimport ContactStatus from './ContactStatus';\r\nimport { makeStyles } from '@mui/styles';\r\nimport { Contact } from '../types';\r\nimport { combineURLs } from '../utils/common';\r\n\r\nconst useStyles = makeStyles(() => ({\r\n  star: {\r\n    fontSize: '0.85rem',\r\n    verticalAlign: 'middle',\r\n  },\r\n}));\r\n\r\ntype ContactListProps = {\r\n  apiUrl: string;\r\n  contacts: Contact[];\r\n  owner?: number;\r\n  onContactClick?: (contact: Contact) => void;\r\n};\r\n\r\nconst ContactList: React.FC<ListProps & ContactListProps> = (\r\n  props: ListProps & ContactListProps\r\n) => {\r\n  const classes = useStyles();\r\n  const { apiUrl, contacts, owner } = props;\r\n\r\n  return (\r\n    <List {...props} aria-label=\"contacts\">\r\n      {contacts.map(contact => (\r\n        <ListItemButton\r\n          key={contact.userId}\r\n          onClick={() => props.onContactClick && props.onContactClick(contact)}\r\n        >\r\n          <ListItemAvatar>\r\n            <Avatar\r\n              alt={contact.username}\r\n              src={\r\n                contact.avatar\r\n                  ? combineURLs(apiUrl, contact.avatar)\r\n                  : ''\r\n              }\r\n            />\r\n          </ListItemAvatar>\r\n          <ListItemText\r\n            primary={\r\n              <span>\r\n                {contact.username}{' '}\r\n                {owner === contact.userId && (\r\n                  <StarIcon\r\n                    className={classes.star}\r\n                    color=\"primary\"\r\n                  />\r\n                )}\r\n              </span>\r\n            }\r\n            secondary={\r\n              <ContactStatus contact={contact} isTyping={false} />\r\n            }\r\n          />\r\n        </ListItemButton>\r\n      ))}\r\n    </List>\r\n  );\r\n};\r\nexport default ContactList;\r\n","import { Dialog, DialogTitle } from \"@mui/material\";\r\nimport React from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Contact } from \"../types\";\r\nimport ContactList from \"./ContactList\";\r\n\r\ninterface AddContactProps {\r\n  open: boolean;\r\n  apiUrl: string;\r\n  contacts: Contact[];\r\n  onClose: (value?: Contact) => void;\r\n}\r\n\r\nconst AddContact: React.FC<AddContactProps> = (\r\n  props: AddContactProps\r\n) => {\r\n  const { onClose, open, apiUrl, contacts } = props;\r\n  const { t } = useTranslation();\r\n\r\n  const handleClose = () => {\r\n    onClose();\r\n  };\r\n\r\n  const handleListItemClick = (contact: Contact) => {\r\n    onClose(contact);\r\n  };\r\n\r\n  return (\r\n    <Dialog\r\n      onClose={handleClose}\r\n      aria-labelledby=\"add-contact-title\"\r\n      open={open}\r\n    >\r\n      <DialogTitle id=\"switch-operator-title\">\r\n        {t(\"CHAT.ADD_CONTACT\")}\r\n      </DialogTitle>\r\n      <ContactList\r\n        apiUrl={apiUrl}\r\n        contacts={contacts}\r\n        onClick={handleListItemClick}\r\n      />\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default AddContact;","/* eslint-disable @typescript-eslint/no-explicit-any */\r\nimport React from 'react';\r\nimport {\r\n  Alert,\r\n  Dialog,\r\n  DialogContent,\r\n  Slide,\r\n  Button,\r\n  DialogActions,\r\n  Typography,\r\n  AlertColor,\r\n} from '@mui/material';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nimport { TransitionProps } from '@mui/material/transitions';\r\n\r\nconst Transition = React.forwardRef(function Transition(\r\n  props: TransitionProps & {\r\n    children: React.ReactElement<any, any>;\r\n  },\r\n  ref: React.Ref<unknown>,\r\n) {\r\n  return <Slide direction=\"up\" ref={ref} {...props} />;\r\n});\r\n\r\ntype AlertDialogProps = {\r\n  children: React.JSX.Element | React.JSX.Element[] | string;\r\n  open: boolean;\r\n  setOpen: (value: boolean) => void;\r\n  severity: AlertColor;\r\n};\r\n\r\nexport default function AlertDialog({\r\n  children,\r\n  open,\r\n  setOpen,\r\n  severity = 'warning',\r\n}: AlertDialogProps) {\r\n  const { t } = useTranslation();\r\n\r\n  const handleClose = () => {\r\n    setOpen(false);\r\n  };\r\n  return (\r\n    <Dialog\r\n      open={open}\r\n      TransitionComponent={Transition}\r\n      keepMounted\r\n      onClose={handleClose}\r\n      aria-labelledby=\"alert-dialog-title\"\r\n      aria-describedby=\"alert-dialog-description\"\r\n    >\r\n      <DialogContent>\r\n        <Alert severity={severity}>\r\n          {typeof children === 'string' ? (\r\n            <Typography variant=\"body2\">{children}</Typography>\r\n          ) : (\r\n            children\r\n          )}\r\n        </Alert>\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button onClick={handleClose} variant=\"text\">\r\n          {t('CHAT.BUT_CLOSE')}\r\n        </Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n  );\r\n}\r\n","import React, { useEffect, useMemo, useState } from \"react\";\r\nimport { Box, Typography } from \"@mui/material\";\r\nimport useCounter from \"../hooks/useCounter\";\r\nimport AlertDialog from \"./AlertDialog\";\r\nimport { useTranslation } from \"react-i18next\";\r\n//import { useTranslation } from \"react-i18next\";\r\n\r\nconst hhMmSs = (totalSeconds: number) => {\r\n  const hours = Math.floor(totalSeconds / 3600);\r\n  const strHours = hours < 10 ? `0${hours}` : hours;\r\n  totalSeconds %= 3600;\r\n  const minutes = Math.floor(totalSeconds / 60);\r\n  const strMinutes = minutes < 10 ? `0${minutes}` : minutes;\r\n  const seconds = totalSeconds % 60;\r\n  const strSeconds = seconds < 10 ? `0${seconds}` : seconds;\r\n\r\n  const strTime = `${strHours}:${strMinutes}:${strSeconds}`;\r\n  return { hours, minutes, seconds, strTime };\r\n};\r\ntype AlertModaleProps = {\r\n  modaleInfo: boolean;\r\n  setModaleInfo: (vars: boolean) => void;\r\n  strTime: string;\r\n};\r\nconst AlertModale: React.FC<AlertModaleProps> = ({\r\n  modaleInfo,\r\n  setModaleInfo,\r\n  strTime\r\n}) => {\r\n  const { t } = useTranslation();\r\n  return useMemo(\r\n    () => (\r\n      <AlertDialog open={modaleInfo} setOpen={setModaleInfo} severity=\"info\">\r\n        <Typography variant=\"body1\" textAlign=\"center\">\r\n          {t(\"CHAT.CONFERENCE.UntillTheEnd\")}:\r\n        </Typography>\r\n        <Typography variant=\"h6\" textAlign=\"center\">\r\n          {strTime}\r\n        </Typography>\r\n      </AlertDialog>\r\n    ),\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    [modaleInfo]\r\n  );\r\n};\r\n\r\ntype ConferenceTimeProps = {\r\n  finishDate: Date;\r\n};\r\nconst ConferenceTime: React.FC<ConferenceTimeProps> = ({\r\n  finishDate\r\n}: ConferenceTimeProps) => {\r\n  const { t } = useTranslation();\r\n  const [modaleInfo, setModaleInfo] = useState(false);\r\n  const currTime = Date.now();\r\n  // console.log(\"currentDate server\", currentDate);\r\n  // console.log(\"currTime client\", currTime);\r\n  const finTime = new Date(finishDate).getTime();\r\n\r\n  //const diffTimeMin = Math.round((finTime - currTime) / (1000 * 60));\r\n  const diffTimeSec = Math.round((finTime - currTime) / 1000);\r\n\r\n  const { counter } = useCounter(diffTimeSec);\r\n  useEffect(() => {\r\n    if (minutes != null && minutes === 3 && seconds != null && seconds === 0) {\r\n      setModaleInfo(true);\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [counter]);\r\n\r\n  if (diffTimeSec < 1) return null;\r\n\r\n  const { minutes, seconds, strTime } = hhMmSs(diffTimeSec);\r\n\r\n  return (\r\n    <Box textAlign=\"center\">\r\n      <Typography variant=\"body2\" component=\"span\">\r\n        {t(\"CHAT.CONFERENCE.LEFT_TIME\")}:{\" \"}\r\n      </Typography>\r\n      <Typography variant=\"button\" component=\"span\">\r\n        {strTime}\r\n      </Typography>\r\n      <AlertModale\r\n        modaleInfo={modaleInfo}\r\n        setModaleInfo={setModaleInfo}\r\n        strTime={strTime}\r\n      />\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default ConferenceTime;\r\n","import { useEffect, useRef, useState } from \"react\";\r\n\r\nexport default function useCounter(max = 30000) {\r\n  const [counter, setCounter] = useState(max);\r\n  const counterRef = useRef<ReturnType<typeof setInterval> | null>(null);\r\n\r\n  const handlerRefresh = () => {\r\n    setCounter(max);\r\n  };\r\n\r\n  // Counter\r\n  useEffect(() => {\r\n    if (counter > 0)\r\n      counterRef.current = setInterval(\r\n        () => setCounter(prev => prev - 1),\r\n        1000\r\n      );\r\n\r\n    return () => {\r\n      if (counterRef.current) clearInterval(counterRef.current);\r\n    };\r\n  }, [counter]);\r\n\r\n  return { counter, handlerRefresh };\r\n}\r\n","import * as React from 'react';\r\nimport Button from '@mui/material/Button';\r\nimport Dialog from '@mui/material/Dialog';\r\nimport DialogActions from '@mui/material/DialogActions';\r\nimport DialogContent from '@mui/material/DialogContent';\r\nimport Slide from '@mui/material/Slide';\r\nimport { TransitionProps } from '@mui/material/transitions';\r\nimport { Typography } from '@mui/material';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nconst Transition = React.forwardRef(function Transition(\r\n  props: TransitionProps & {\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    children: React.ReactElement<any, any>;\r\n  },\r\n  ref: React.Ref<unknown>,\r\n) {\r\n  return <Slide direction=\"up\" ref={ref} {...props} />;\r\n});\r\n\r\ntype ConfirmDialogSlideProps = {\r\n  open: boolean;\r\n  contentText: string;\r\n  setOpen: (open: boolean) => void;\r\n  callback: () => void;\r\n};\r\nexport default function ConfirmDialogSlide({\r\n  open,\r\n  setOpen,\r\n  contentText,\r\n  callback,\r\n}: ConfirmDialogSlideProps) {\r\n  const { t } = useTranslation();\r\n\r\n  const handleClose = () => {\r\n    setOpen(false);\r\n  };\r\n  const handleCloseOk = () => {\r\n    setOpen(false);\r\n    callback();\r\n  };\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <Dialog\r\n        open={open}\r\n        TransitionComponent={Transition}\r\n        keepMounted\r\n        onClose={handleClose}\r\n        aria-describedby=\"alert-dialog-slide-description\"\r\n      >\r\n        <DialogContent>\r\n          <Typography variant=\"h6\">{contentText}</Typography>\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button onClick={handleClose} color=\"primary\">\r\n            {t('CHAT.BUT_CLOSE')}\r\n          </Button>\r\n          <Button onClick={handleCloseOk} color=\"warning\">\r\n            {t('CHAT.BUT_CONFIRM')}\r\n          </Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n    </React.Fragment>\r\n  );\r\n}\r\n","import * as React from 'react';\r\nimport { styled, alpha } from '@mui/material/styles';\r\nimport Button from '@mui/material/Button';\r\nimport Menu, { MenuProps } from '@mui/material/Menu';\r\nimport MenuItem from '@mui/material/MenuItem';\r\nimport PlayArrowIcon from '@mui/icons-material/PlayArrow';\r\nimport RestartAltIcon from '@mui/icons-material/RestartAlt';\r\nimport VideoCallIcon from '@mui/icons-material/VideoCall';\r\nimport KeyboardArrowDownIcon from '@mui/icons-material/KeyboardArrowDown';\r\nimport { ChatRoom, VisitData } from '../types';\r\nimport { formatTime } from '../utils/common';\r\nimport { useTranslation } from 'react-i18next';\r\nimport ConfirmDialogSlide from './ConfirmDialogSlide';\r\n\r\nconst StyledMenu = styled((props: MenuProps) => (\r\n  <Menu\r\n    elevation={0}\r\n    anchorOrigin={{\r\n      vertical: 'bottom',\r\n      horizontal: 'right',\r\n    }}\r\n    transformOrigin={{\r\n      vertical: 'top',\r\n      horizontal: 'right',\r\n    }}\r\n    {...props}\r\n  />\r\n))(({ theme }) => ({\r\n  '& .MuiPaper-root': {\r\n    borderRadius: 6,\r\n    marginTop: theme.spacing(1),\r\n    minWidth: 180,\r\n    color:\r\n      theme.palette.mode === 'light'\r\n        ? 'rgb(55, 65, 81)'\r\n        : theme.palette.grey[300],\r\n    boxShadow:\r\n      'rgb(255, 255, 255) 0px 0px 0px 0px, rgba(0, 0, 0, 0.05) 0px 0px 0px 1px, rgba(0, 0, 0, 0.1) 0px 10px 15px -3px, rgba(0, 0, 0, 0.05) 0px 4px 6px -2px',\r\n    '& .MuiMenu-list': {\r\n      padding: '4px 0',\r\n    },\r\n    '& .MuiMenuItem-root': {\r\n      '& .MuiSvgIcon-root': {\r\n        fontSize: 18,\r\n        color: theme.palette.text.secondary,\r\n        marginRight: theme.spacing(1.5),\r\n      },\r\n      '&:active': {\r\n        backgroundColor: alpha(\r\n          theme.palette.primary.main,\r\n          theme.palette.action.selectedOpacity,\r\n        ),\r\n      },\r\n    },\r\n  },\r\n}));\r\n\r\ntype ConferenceButtonProps = {\r\n  visitData: VisitData[];\r\n  chat: ChatRoom;\r\n  onVideoCall: (\r\n    chat: ChatRoom,\r\n    visitId?: number,\r\n    recreate?: boolean,\r\n  ) => void;\r\n};\r\n\r\nconst getVisitMessage = (visit: VisitData) => {\r\n  const visitDate = new Date(visit.visitDate);\r\n\r\n  return `${visit.plExamName} (${formatTime(\r\n    visitDate,\r\n    'HH:mm',\r\n  )} - ${formatTime(\r\n    new Date(visitDate.getTime() + visit.duration * 60_000),\r\n    'HH:mm',\r\n  )})`;\r\n};\r\n\r\nexport default function ConferenceButton(\r\n  props: ConferenceButtonProps,\r\n) {\r\n  const { t } = useTranslation();\r\n  const [anchorEl, setAnchorEl] = React.useState<null | HTMLElement>(\r\n    null,\r\n  );\r\n\r\n  const [visitId, setVisitId] = React.useState<number | null>(null);\r\n  const [confirmReCreateVisit, setConfirmReCreateVisit] =\r\n    React.useState(false);\r\n  const open = Boolean(anchorEl);\r\n  const handleClick = (event: React.MouseEvent<HTMLElement>) => {\r\n    setAnchorEl(event.currentTarget);\r\n  };\r\n  const handleClose = () => {\r\n    setAnchorEl(null);\r\n  };\r\n\r\n  const handleStart = (item: VisitData) => {\r\n    setAnchorEl(null);\r\n    setVisitId(item.visitId);\r\n    if (item.conferenceStatus === 'finished') {\r\n      setConfirmReCreateVisit(true);\r\n    } else {\r\n      props.onVideoCall(props.chat, item.visitId);\r\n    }\r\n  };\r\n\r\n  const visitData = React.useMemo(() => {\r\n    return props.visitData.filter(\r\n      (it) => it.contactId === props.chat.userId,\r\n    );\r\n  }, [props.visitData, props.chat]);\r\n\r\n  /**\r\n   * <Button\r\n                  aria-label=\"video call\"\r\n                  variant=\"contained\"\r\n                  color=\"primary\"\r\n                  size=\"small\"\r\n                  startIcon={<VideoCallIcon />}\r\n                  onClick={() =>\r\n                    visitId &&\r\n                    !isEmpty(\r\n                      visitData.find(\r\n                        (it) =>\r\n                          it.conferenceStatus === 'finished' &&\r\n                          it.visitId === Number(visitId),\r\n                      ),\r\n                    )\r\n                      ? setConfirmReCreateVisit(true)\r\n                      : onVideoCall(contact, null)\r\n                  }\r\n                  fullWidth\r\n                >\r\n                  {t(\r\n                    visitId\r\n                      ? 'CHAT.CONFERENCE.RESTART'\r\n                      : 'CHAT.CONFERENCE.START',\r\n                  )}\r\n                </Button>              \r\n   */\r\n\r\n  return (\r\n    <div>\r\n      <Button\r\n        id=\"conference-button\"\r\n        aria-controls={open ? 'conference-menu' : undefined}\r\n        aria-haspopup=\"true\"\r\n        aria-expanded={open ? 'true' : undefined}\r\n        color=\"primary\"\r\n        size=\"small\"\r\n        variant=\"contained\"\r\n        disableElevation\r\n        onClick={handleClick}\r\n        startIcon={<VideoCallIcon />}\r\n        endIcon={<KeyboardArrowDownIcon />}\r\n        disabled={visitData.length === 0}\r\n      >\r\n        {t('CHAT.CONFERENCE.START')}\r\n      </Button>\r\n      <ConfirmDialogSlide\r\n        open={confirmReCreateVisit}\r\n        setOpen={setConfirmReCreateVisit}\r\n        contentText={t('CHAT.CONFERENCE.CONFIRM_RECREATE_CONF')}\r\n        callback={() => {\r\n          if (visitId && confirmReCreateVisit) {\r\n            props.onVideoCall(props.chat, visitId, true);\r\n          }\r\n        }}\r\n      />\r\n      <StyledMenu\r\n        id=\"conference-menu\"\r\n        MenuListProps={{\r\n          'aria-labelledby': 'conference-button',\r\n        }}\r\n        anchorEl={anchorEl}\r\n        open={open}\r\n        onClose={handleClose}\r\n      >\r\n        {visitData.map((item) => {\r\n          return (\r\n            <MenuItem\r\n              onClick={() => handleStart(item)}\r\n              key={item.visitId}\r\n              value={item.visitId}\r\n              disableRipple\r\n            >\r\n              {item.conferenceStatus === 'finished' ? (\r\n                <RestartAltIcon />\r\n              ) : (\r\n                <PlayArrowIcon />\r\n              )}\r\n              {getVisitMessage(item)}\r\n            </MenuItem>\r\n          );\r\n        })}\r\n      </StyledMenu>\r\n    </div>\r\n  );\r\n}\r\n","import React, { useState } from 'react';\r\nimport {\r\n  Avatar,\r\n  CardHeader,\r\n  Button,\r\n  Popover,\r\n  IconButton,\r\n} from '@mui/material';\r\nimport { Theme } from '@mui/material/styles';\r\nimport GroupIcon from '@mui/icons-material/Group';\r\nimport { useTranslation } from 'react-i18next';\r\nimport CallEndIcon from '@mui/icons-material/CallEnd';\r\nimport PersonAddIcon from '@mui/icons-material/PersonAdd';\r\nimport DeleteIcon from '@mui/icons-material/Delete';\r\nimport ContactStatus from './ContactStatus';\r\nimport ContactList from './ContactList';\r\nimport AddContact from './AddContact';\r\nimport {\r\n  ChatRoom,\r\n  Contact,\r\n  Group,\r\n  SetTyping,\r\n  User,\r\n  ConferenceData,\r\n  VisitData,\r\n} from '../types';\r\nimport { makeStyles, createStyles } from '@mui/styles';\r\nimport { combineURLs, formatTime, isEmpty } from '../utils/common';\r\nimport ConferenceTime from './ConferenceTime';\r\nimport ConfirmDialogSlide from './ConfirmDialogSlide';\r\nimport ConferenceButton from './ConferenceButton';\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    paper: {\r\n      padding: theme.spacing(1),\r\n    },\r\n    avatarGroup: {\r\n      backgroundColor: '#28B7C6',\r\n      color: '#fff',\r\n    },\r\n  }),\r\n);\r\n\r\ntype RoomHeaderProps = {\r\n  apiUrl: string;\r\n  user: User;\r\n  chat: ChatRoom | null;\r\n  typing: SetTyping | null;\r\n  conference: ConferenceData | null;\r\n  conferenceJoined: boolean;\r\n  className: string;\r\n  operators: Contact[];\r\n  visitData: VisitData[];\r\n  onVideoCall?: (\r\n    chat: ChatRoom,\r\n    visitId?: number,\r\n    recreate?: boolean,\r\n  ) => void;\r\n  onVideoEnd?: (conference: ConferenceData) => void;\r\n  onConferencePause?: (conference: ConferenceData) => void;\r\n  onOperatorAdd?: (chat: Group, operator: Contact) => void;\r\n  onLeaveGroup?: (chat: Group) => void;\r\n  onContactClick?: (contact: Contact) => void;\r\n};\r\n\r\nconst getGroupStatus = (group: Group, t: (key: string) => string) => {\r\n  const status = [`${group.members?.length} ${t('CHAT.MEMBERS')}`];\r\n  const onlineCount = (group.members || []).reduce(\r\n    (sum: number, contact) => (contact.online ? sum + 1 : sum),\r\n    0,\r\n  );\r\n  if (onlineCount)\r\n    status.push(`${onlineCount} ${t('CHAT.STATUS.ONLINE')}`);\r\n  return status.join(', ');\r\n};\r\n\r\nconst RoomHeader: React.FC<RoomHeaderProps> = ({\r\n  apiUrl,\r\n  user,\r\n  chat,\r\n  typing,\r\n  conference,\r\n  visitData,\r\n  conferenceJoined,\r\n  className,\r\n  operators,\r\n  onVideoCall,\r\n  onVideoEnd,\r\n  onConferencePause,\r\n  onOperatorAdd,\r\n  onLeaveGroup,\r\n  onContactClick,\r\n}: RoomHeaderProps) => {\r\n  const classes = useStyles();\r\n  const { t } = useTranslation();\r\n  const [anchorEl, setAnchorEl] = useState<HTMLElement | null>(null);\r\n  const [addOperatorOpen, setAddOperatorOpen] = useState(false);\r\n  const [confirmFinishConf, setConfirmFinishConf] = React.useState(\r\n    false,\r\n  );\r\n  if (!chat)\r\n    return (\r\n      <CardHeader\r\n        avatar={<Avatar />}\r\n        title=\"\"\r\n        subheader=\"\"\r\n        className={className}\r\n      />\r\n    );\r\n\r\n  let closeTimer: NodeJS.Timeout | null = null;\r\n  const handlePopoverIn = (\r\n    event: React.MouseEvent<HTMLElement, MouseEvent>\r\n  ) => {\r\n    if (!anchorEl) {\r\n      setAnchorEl(event.currentTarget);\r\n    }\r\n    if (closeTimer) {\r\n      clearTimeout(closeTimer);\r\n      closeTimer = null;\r\n    }\r\n  };\r\n\r\n  const handlePopoverClose = () => {\r\n    setAnchorEl(null);\r\n    if (closeTimer) {\r\n      clearTimeout(closeTimer);\r\n      closeTimer = null;\r\n    }\r\n  };\r\n\r\n  const handlePopoverOut = () => {\r\n    if (!closeTimer) {\r\n      closeTimer = setTimeout(() => {\r\n        handlePopoverClose();\r\n      }, 1000);\r\n    }\r\n  };\r\n\r\n  const handleAddOperatorOpen = () => {\r\n    setAddOperatorOpen(true);\r\n  };\r\n\r\n  const handleAddOperatorClose = (operator?: Contact) => {\r\n    setAddOperatorOpen(false);\r\n    if (onOperatorAdd && operator && chat)\r\n      onOperatorAdd(chat as Group, operator);\r\n  };\r\n\r\n  const group = chat as Group;\r\n  if (group.groupId) {\r\n    // –≥—Ä—É–ø–ø–∞\r\n    return (\r\n      <CardHeader\r\n        avatar={\r\n          <Avatar alt={group.name} className={classes.avatarGroup}>\r\n            <GroupIcon />\r\n          </Avatar>\r\n        }\r\n        title={group.name}\r\n        subheader={\r\n          <React.Fragment>\r\n            <span\r\n              id=\"mouse-over-span\"\r\n              aria-owns={anchorEl ? \"mouse-over-popover\" : undefined}\r\n              aria-haspopup=\"true\"\r\n              onMouseEnter={handlePopoverIn}\r\n              onMouseLeave={handlePopoverOut}\r\n            >\r\n              {getGroupStatus(group, t)}\r\n            </span>\r\n            <Popover\r\n              id=\"mouse-over-popover\"\r\n              classes={{\r\n                paper: classes.paper,\r\n              }}\r\n              sx={{ pointerEvents: \"none\" }}\r\n              open={!!anchorEl}\r\n              anchorEl={anchorEl}\r\n              anchorOrigin={{\r\n                vertical: 'bottom',\r\n                horizontal: 'left',\r\n              }}\r\n              transformOrigin={{\r\n                vertical: 'top',\r\n                horizontal: 'left',\r\n              }}\r\n              onClose={handlePopoverClose}\r\n              disableRestoreFocus\r\n            >\r\n              <ContactList\r\n                apiUrl={apiUrl}\r\n                contacts={group.members as Contact[]}\r\n                onContactClick={onContactClick}\r\n                owner={group.userId}\r\n                onMouseEnter={handlePopoverIn}\r\n                onMouseLeave={handlePopoverOut}\r\n                sx={{ pointerEvents: \"all\" }}\r\n              />\r\n            </Popover>\r\n          </React.Fragment>\r\n        }\r\n        className={className}\r\n        action={\r\n          <React.Fragment>\r\n            {user.role === 4 && (\r\n              <React.Fragment>\r\n                <IconButton\r\n                  aria-label=\"add user\"\r\n                  onClick={handleAddOperatorOpen}\r\n                >\r\n                  <PersonAddIcon />\r\n                </IconButton>\r\n                <AddContact\r\n                  apiUrl={apiUrl}\r\n                  open={addOperatorOpen}\r\n                  contacts={operators}\r\n                  onClose={handleAddOperatorClose}\r\n                />\r\n              </React.Fragment>\r\n            )}\r\n            {user.role === 4 &&\r\n              group.members?.find(\r\n                it => it.userId !== user.userId && it.role === 4,\r\n              ) &&\r\n              onLeaveGroup && (\r\n                <IconButton\r\n                  aria-label=\"leave group\"\r\n                  onClick={() => onLeaveGroup(group)}\r\n                >\r\n                  <DeleteIcon />\r\n                </IconButton>\r\n              )}\r\n          </React.Fragment>\r\n        }\r\n      />\r\n    );\r\n  }\r\n  const contact = chat as Contact;\r\n  const isTyping =\r\n    !!typing?.contactId && typing?.userId === contact.userId;\r\n\r\n  return (\r\n    <CardHeader\r\n      avatar={\r\n        <Avatar\r\n          alt={contact.username}\r\n          src={\r\n            contact.avatar ? combineURLs(apiUrl, contact.avatar) : ''\r\n          }\r\n        />\r\n      }\r\n      title={contact.username}\r\n      subheader={\r\n        <ContactStatus contact={contact} isTyping={isTyping} />\r\n      }\r\n      className={className}\r\n      action={\r\n        <React.Fragment>\r\n          {user.role !== 1 &&\r\n            conferenceJoined &&\r\n            conference &&\r\n            !isEmpty(conference) &&\r\n            onConferencePause != null && (\r\n              <Button\r\n                aria-label=\"cancel call\"\r\n                variant=\"contained\"\r\n                color=\"secondary\"\r\n                size=\"small\"\r\n                startIcon={<CallEndIcon color=\"error\" />}\r\n                onClick={() => onConferencePause(conference)}\r\n              >\r\n                {t('CHAT.CONFERENCE.PAUSE')}\r\n              </Button>\r\n            )}\r\n\r\n          {conference &&\r\n            !isEmpty(conference) &&\r\n            onVideoEnd != null &&\r\n            user.role != null &&\r\n            [3, 4].includes(user.role) && (\r\n              <>\r\n                <Button\r\n                  aria-label=\"cancel call\"\r\n                  variant=\"contained\"\r\n                  color=\"primary\"\r\n                  size=\"small\"\r\n                  startIcon={<CallEndIcon color=\"error\" />}\r\n                  onClick={() => setConfirmFinishConf(true)}\r\n                  style={{ marginLeft: 8 }}\r\n                >\r\n                  {t('CHAT.CONFERENCE.FINISH')}\r\n                </Button>\r\n                <ConfirmDialogSlide\r\n                  open={confirmFinishConf}\r\n                  setOpen={setConfirmFinishConf}\r\n                  contentText={t(\r\n                    'CHAT.CONFERENCE.CONFIRM_FINISH_CONF',\r\n                  )}\r\n                  callback={() => {\r\n                    onVideoEnd(conference);\r\n                  }}\r\n                />\r\n              </>\r\n            )}\r\n\r\n          {isEmpty(conference) &&\r\n            onVideoCall != null &&\r\n            user.role &&\r\n            [3, 4].includes(user.role) && (\r\n              <ConferenceButton\r\n                visitData={visitData}\r\n                chat={contact}\r\n                onVideoCall={onVideoCall}\r\n              />\r\n            )}\r\n\r\n          {conference?.finishDate != null && (\r\n            <ConferenceTime finishDate={conference.finishDate} />\r\n          )}\r\n        </React.Fragment>\r\n      }\r\n    />\r\n  );\r\n};\r\n\r\nexport default RoomHeader;\r\n","import React from \"react\";\r\nimport { Avatar, Box } from \"@mui/material\";\r\nimport { Theme } from \"@mui/material/styles\";\r\nimport { makeStyles, createStyles } from \"@mui/styles\";\r\nimport { getFileMeta, splitFileName } from \"../../utils/common\";\r\nimport { ChatMessage } from \"../../types\";\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    fileIcon: {\r\n      fontSize: \"0.75rem\"\r\n    },\r\n    fileBody: {\r\n      paddingLeft: theme.spacing(1.2)\r\n    }\r\n  })\r\n);\r\ntype FileProps = {\r\n  message: ChatMessage;\r\n};\r\n\r\nconst File: React.FC<FileProps> = ({ message }: FileProps) => {\r\n  const classes = useStyles();\r\n  const meta = getFileMeta(message.content);\r\n  const { name, ext } = splitFileName(meta.name);\r\n  return (\r\n    <Box display=\"flex\" flexDirection=\"row\">\r\n      <Avatar className={classes.fileIcon}>{ext.toUpperCase()}</Avatar>\r\n      <Box display=\"flex\" flexDirection=\"column\" className={classes.fileBody}>\r\n        {name}\r\n        <span>{`${ext} ${meta.size}`}</span>\r\n      </Box>\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default File;\r\n","import React from 'react';\r\nimport { makeStyles } from '@mui/styles';\r\nimport { Theme } from '@mui/material/styles';\r\nimport { ChatMessage } from '../../types';\r\nimport { combineURLs } from '../../utils/common';\r\n\r\nconst useStyles = makeStyles((theme: Theme) => ({\r\n  mediaContent: {\r\n    backgroundColor: theme.palette.secondary.main,\r\n    borderRadius: theme.spacing(1.2),\r\n    maxWidth: 284,\r\n    height: 190,\r\n    [theme.breakpoints.down('sm')]: {\r\n      maxWidth: 250,\r\n      height: 170,\r\n    },\r\n  },\r\n}));\r\n\r\ntype VideoProps = {\r\n  apiUrl: string;\r\n  message: ChatMessage;\r\n  isConference: boolean;\r\n};\r\n\r\nconst Video: React.FC<VideoProps> = ({\r\n  apiUrl,\r\n  message,\r\n  isConference,\r\n}: VideoProps) => {\r\n  const classes = useStyles();\r\n  let src = '';\r\n  if (isConference) {\r\n    const meta = JSON.parse(message.content);\r\n    src = combineURLs(\r\n      apiUrl,\r\n      `/static/conf/${meta.visitId}/${meta.name}`,\r\n    );\r\n  } else src = combineURLs(apiUrl, `/static/file/${message.content}`);\r\n  return (\r\n    <video\r\n      src={src}\r\n      className={classes.mediaContent}\r\n      controls\r\n      muted\r\n      preload=\"none\"\r\n    >\r\n      –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–µ–≥ video.\r\n    </video>\r\n  );\r\n};\r\n\r\nexport default Video;\r\n","import React from 'react';\r\n\r\nimport { Theme } from '@mui/material/styles';\r\n//import { getImageMeta } from \"../../utils/common\";\r\nimport { ChatMessage } from '../../types';\r\nimport { makeStyles, createStyles } from '@mui/styles';\r\nimport { AspectRatio } from 'react-aspect-ratio';\r\nimport { combineURLs } from '../../utils/common';\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    img: {\r\n      cursor: 'pointer',\r\n      borderRadius: theme.spacing(1.2),\r\n      maxWidth: 284,\r\n      maxHeight: 190,\r\n      [theme.breakpoints.down('sm')]: {\r\n        maxWidth: 250,\r\n        maxHeight: 170,\r\n      },\r\n    },\r\n    aspect: {\r\n      maxWidth: 284,\r\n      height: 190,\r\n      [theme.breakpoints.down('sm')]: {\r\n        maxWidth: 250,\r\n        height: 170,\r\n      },\r\n    },\r\n  }),\r\n);\r\ntype ImageProrps = {\r\n  apiUrl: string;\r\n  message: ChatMessage;\r\n  setViewerData: (value: { visible: boolean; src: string }) => void;\r\n};\r\n\r\nconst Image: React.FC<ImageProrps> = ({\r\n  apiUrl,\r\n  message,\r\n  setViewerData,\r\n}: ImageProrps) => {\r\n  const classes = useStyles();\r\n  //const meta = getImageMeta(message.content);\r\n\r\n  return (\r\n    <AspectRatio ratio=\"3/4\" className={classes.aspect}>\r\n      <img\r\n        src={combineURLs(apiUrl, `/static/image/${message.content}`)}\r\n        onClick={() => {\r\n          setViewerData({\r\n            visible: true,\r\n\r\n            src: combineURLs(\r\n              apiUrl,\r\n              `/static/image/${message.content}`,\r\n            ),\r\n          });\r\n        }}\r\n        className={classes.img}\r\n        alt={message.cdate}\r\n      />\r\n    </AspectRatio>\r\n  );\r\n};\r\n\r\nexport default Image;\r\n","import React from 'react';\r\nimport File from './File';\r\nimport Video from './Video';\r\nimport Image from './Image';\r\nimport { ChatMessage } from '../../types';\r\n\r\ntype MessageProps = {\r\n  apiUrl: string;\r\n  message: ChatMessage;\r\n  setViewerData: (value: { visible: boolean; src: string }) => void;\r\n};\r\nconst MessageContent: React.FC<MessageProps> = ({\r\n  apiUrl,\r\n  message,\r\n  setViewerData,\r\n}: MessageProps) => {\r\n  switch (message.messageType) {\r\n    case 'text':\r\n      return <React.Fragment>{message.content}</React.Fragment>;\r\n    case 'video':\r\n    case 'video_conference':\r\n      return (\r\n        <Video\r\n          message={message}\r\n          apiUrl={apiUrl}\r\n          isConference={message.messageType === 'video_conference'}\r\n        />\r\n      );\r\n    case 'image':\r\n      return (\r\n        <Image\r\n          message={message}\r\n          apiUrl={apiUrl}\r\n          setViewerData={setViewerData}\r\n        />\r\n      );\r\n    case 'file':\r\n      return <File message={message} />;\r\n  }\r\n  return null;\r\n};\r\n\r\nexport default MessageContent;\r\n","import { Theme } from \"@mui/material/styles\";\r\nimport { makeStyles, createStyles } from \"@mui/styles\";\r\n\r\nexport default makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    rootContact: {\r\n      padding: 1,\r\n      paddingLeft: theme.spacing(2),\r\n      \"& span\": {\r\n        float: \"right\",\r\n        color: theme.palette.text.secondary,\r\n        fontSize: \"0.8rem\"\r\n      },\r\n      \"& $message\": {\r\n        backgroundColor: theme.palette.grey[200],\r\n        color: theme.palette.text.primary,\r\n        borderTopRightRadius: theme.spacing(3),\r\n        borderBottomRightRadius: theme.spacing(3)\r\n      },\r\n      \"& $firstMessage\": {\r\n        borderTopLeftRadius: theme.spacing(3),\r\n        marginTop: 10\r\n      },\r\n      \"& $lastMessage\": {\r\n        borderTopRightRadius: theme.spacing(3),\r\n        borderBottomLeftRadius: 0,\r\n        borderBottomRightRadius: theme.spacing(3),\r\n        marginBottom: 10\r\n      }\r\n    },\r\n    rootUser: {\r\n      padding: 1,\r\n      paddingRight: theme.spacing(2),\r\n      justifyContent: \"flex-end\",\r\n      \"& span\": {\r\n        float: \"right\",\r\n        color: \"#D9DEEC\",\r\n        fontSize: \"0.8rem\"\r\n      },\r\n      \"& $message\": {\r\n        backgroundColor: theme.palette.primary.main,\r\n        color: theme.palette.primary.contrastText,\r\n        borderTopLeftRadius: theme.spacing(3),\r\n        borderBottomLeftRadius: theme.spacing(3)\r\n      },\r\n      \"& $firstMessage\": {\r\n        borderTopRightRadius: theme.spacing(3),\r\n        marginTop: 10\r\n      },\r\n      \"& $lastMessage\": {\r\n        borderTopLeftRadius: theme.spacing(3),\r\n        borderBottomRightRadius: 0,\r\n        marginBottom: 10\r\n      }\r\n    },\r\n    rootNotify: {\r\n      justifyContent: \"center\",\r\n      \"& span\": {\r\n        float: \"right\",\r\n        color: theme.palette.text.secondary,\r\n        fontSize: \"0.8rem\"\r\n      },\r\n      \"& > *\": {\r\n        //padding: `0px ${theme.spacing(1)}`,\r\n        borderRadius: theme.spacing(3),\r\n        fontWeight: 500\r\n      }\r\n    },\r\n    message: {\r\n      //maxWidth: \"55%\",\r\n      //minWidth: \"50%\",\r\n      maxWidth: \"65%\",\r\n\r\n      [theme.breakpoints.down(\"md\")]: {\r\n        maxWidth: \"95%\"\r\n      },\r\n      [theme.breakpoints.down(\"sm\")]: {\r\n        maxWidth: \"85%\"\r\n      },\r\n      borderRadius: theme.spacing(0.6),\r\n      padding: theme.spacing(0.9),\r\n      paddingLeft: theme.spacing(1.8),\r\n      paddingRight: theme.spacing(1.8)\r\n    },\r\n    firstMessage: {},\r\n    lastMessage: {},\r\n\r\n    file: {\r\n      display: \"flex\",\r\n      flexDirection: \"row\",\r\n      flexWrap: \"wrap\",\r\n      cursor: \"pointer\"\r\n    },\r\n    header: {\r\n      flex: \"0 0 100%\",\r\n      overflow: \"hidden\",\r\n      fontWeight: \"bold\"\r\n    },\r\n    body: {\r\n      flex: \"1 1 auto\",\r\n      wordBreak: \"break-word\",\r\n      overflow: \"hidden\"\r\n    },\r\n    status: {\r\n      paddingLeft: theme.spacing(1),\r\n      flex: \"1 1 auto\",\r\n      alignSelf: \"flex-end\"\r\n    },\r\n    statusImage: {\r\n      fontSize: \"1rem\",\r\n      marginRight: theme.spacing(0.5),\r\n      verticalAlign: \"middle\"\r\n    }\r\n  })\r\n);\r\n","import React, { forwardRef, memo, useMemo } from 'react';\r\nimport { Box, Link, ListItem, Typography } from '@mui/material';\r\n\r\nimport { DoneAll, Done } from '@mui/icons-material';\r\nimport { combineURLs, formatTime } from '../utils/common';\r\nimport MessageContent from './MessageContent';\r\nimport { Alert } from '@mui/material';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { ChatMessage, Contact, PrivateMessage, User } from '../types';\r\n\r\n/* styles */\r\nimport useStyles from './styles';\r\n\r\ntype MessageProps = {\r\n  apiUrl: string;\r\n  user: User;\r\n  message: ChatMessage;\r\n  owner: Contact;\r\n  isGroupMessage: boolean; // —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø—É\r\n  isUserFirst: boolean; // –Ω–∞—á–∏–Ω–∞–µ—Ç –≥—Ä—É–ø–ø—É —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\r\n  isUserLast: boolean; // –∑–∞–≤–µ—Ä—à–∞–µ—Ç –≥—Ä—É–ø–ø—É —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\r\n  onContextMenu: (event: React.MouseEvent<HTMLElement>) => void;\r\n  setViewerData: (value: { visible: boolean; src: string }) => void;\r\n  //refOnMess: React.RefObject<HTMLDivElement> | null;\r\n};\r\n\r\nconst wrapMessage = (\r\n  apiUrl: string,\r\n  message: ChatMessage,\r\n  classes: ReturnType<typeof useStyles>,\r\n  isUserFirst: boolean,\r\n  isUserLast: boolean,\r\n  onContextMenu:\r\n    | ((event: React.MouseEvent<HTMLElement>) => void)\r\n    | undefined,\r\n  child: React.JSX.Element,\r\n) => {\r\n  const { messageType } = message;\r\n\r\n  const className =\r\n    isUserFirst && isUserLast\r\n      ? `${classes.message} ${classes.firstMessage} ${classes.lastMessage}`\r\n      : isUserFirst\r\n      ? `${classes.message} ${classes.firstMessage}`\r\n      : isUserLast\r\n      ? `${classes.message} ${classes.lastMessage}`\r\n      : classes.message;\r\n\r\n  if (messageType === 'file') {\r\n    return (\r\n      <Link\r\n        className={`${className} ${classes.file}`}\r\n        underline=\"none\"\r\n        href={combineURLs(apiUrl, `/static/file/${message.content}`)}\r\n        target=\"_blank\"\r\n        download\r\n        onContextMenu={onContextMenu}\r\n      >\r\n        {child}\r\n      </Link>\r\n    );\r\n  }\r\n  const isMedia =\r\n    messageType === 'image' ||\r\n    messageType === 'video' ||\r\n    messageType === 'video_conference';\r\n  return (\r\n    <Box\r\n      display=\"flex\"\r\n      flexDirection={isMedia ? 'column' : 'row'}\r\n      flexWrap=\"wrap\"\r\n      className={className}\r\n      onContextMenu={onContextMenu}\r\n    >\r\n      {child}\r\n    </Box>\r\n  );\r\n};\r\n\r\nconst Message = memo(\r\n  forwardRef<HTMLLIElement, MessageProps>((props, ref) => {\r\n    const classes = useStyles();\r\n    const { t } = useTranslation();\r\n\r\n    const {\r\n      apiUrl,\r\n      message,\r\n      owner,\r\n\r\n      user,\r\n      isGroupMessage,\r\n      isUserFirst,\r\n      isUserLast,\r\n      setViewerData,\r\n      //refOnMess,\r\n    } = props;\r\n    //console.log('message', message);\r\n\r\n    if (message.messageType === 'notify') {\r\n      // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ - –æ—Å–æ–±—ã–π —Å–ª—É—á–∞–π\r\n      const content =\r\n        message.content[0] === '{'\r\n          ? JSON.parse(message.content)\r\n          : message.content;\r\n      return (\r\n        <ListItem className={classes.rootNotify} ref={ref}>\r\n          <Alert\r\n            //ref={refOnMess}\r\n            severity={\r\n              typeof content === 'string' ? 'info' : content.severity\r\n            }\r\n          >\r\n            {typeof content === 'string' ? content : content.message}\r\n          </Alert>\r\n        </ListItem>\r\n      );\r\n    }\r\n\r\n    if (message.isRevoke) {\r\n      // –£–¥–∞–ª–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\r\n      return (\r\n        <ListItem className={classes.rootNotify} ref={ref}>\r\n          <Typography\r\n            variant=\"body2\"\r\n            align=\"center\"\r\n            //ref={refOnMess}\r\n          >\r\n            {message.userId === user.userId\r\n              ? t('CHAT.MESSAGE.REVOKED.YOU')\r\n              : `${message.revokeUserName} ${t(\r\n                  'CHAT.MESSAGE.REVOKED.CONTACT',\r\n                )}`}\r\n          </Typography>\r\n        </ListItem>\r\n      );\r\n    }\r\n\r\n    const isMine = user.userId === message.userId;\r\n\r\n    return (\r\n      <ListItem\r\n        ref={ref}\r\n        className={\r\n          message.messageType === 'video_conference'\r\n            ? classes.rootNotify\r\n            : isMine\r\n            ? classes.rootUser\r\n            : classes.rootContact\r\n        }\r\n      >\r\n        {wrapMessage(\r\n          apiUrl,\r\n          message,\r\n          classes,\r\n          isUserFirst,\r\n          isUserLast,\r\n          props.onContextMenu,\r\n          <React.Fragment>\r\n            {!isMine && isGroupMessage && owner && isUserFirst && (\r\n              <div className={classes.header}>{owner.username}</div>\r\n            )}\r\n            <div\r\n              className={classes.body}\r\n              //ref={refOnMess}\r\n            >\r\n              <MessageContent\r\n                message={message}\r\n                apiUrl={apiUrl}\r\n                setViewerData={setViewerData}\r\n              />\r\n            </div>\r\n            <div className={classes.status}>\r\n              <span>\r\n                {isMine ? (\r\n                  (message as PrivateMessage).status === 0 ? (\r\n                    <Done className={classes.statusImage} />\r\n                  ) : (\r\n                    <DoneAll className={classes.statusImage} />\r\n                  )\r\n                ) : null}\r\n                {formatTime(message.cdate)}\r\n              </span>\r\n            </div>\r\n          </React.Fragment>,\r\n        )}\r\n      </ListItem>\r\n    );\r\n  }),\r\n);\r\nMessage.displayName = 'Message';\r\nexport default Message;\r\n","import React, { useMemo } from 'react';\r\nimport {\r\n  AddGroupMessages,\r\n  AddPrivateMessages,\r\n  ChatRoom,\r\n  Contact,\r\n  ContactGather,\r\n  Group,\r\n  GroupGather,\r\n  GroupMember,\r\n  GroupMessage,\r\n  MessageOperation,\r\n  PrivateMessage,\r\n  SetActiveRoom,\r\n  //SetUser,\r\n  SetTyping,\r\n  User,\r\n  ConferenceData,\r\n  GroupMap,\r\n  VisitData,\r\n} from '../types';\r\nimport { chatRoomComparer } from '../utils/common';\r\n\r\nexport interface ChatState {\r\n  user: User;\r\n  token: string;\r\n  refreshToken: string;\r\n  activeRoom: ChatRoom | null;\r\n  chatOld: ChatRoom | null;\r\n\r\n  groupGather: GroupGather;\r\n  userGather: ContactGather;\r\n  contactGather: ContactGather;\r\n  operators: Contact[];\r\n  initialContactId: number | null;\r\n  conference: {\r\n    data: ConferenceData | null;\r\n    joined: boolean;\r\n    ringPlayed: boolean;\r\n  };\r\n  typing: SetTyping | null;\r\n  loading: boolean;\r\n  error?: string;\r\n  success?: string;\r\n  visitData: VisitData[];\r\n}\r\n\r\nconst emptyUser: User = {\r\n  userId: 0,\r\n  username: '',\r\n  password: '',\r\n  avatar: '',\r\n  langCode: '',\r\n};\r\n\r\nconst emptyChatState: ChatState = {\r\n  user: emptyUser, // –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å\r\n  token: '', // —Ç–æ–∫–µ–Ω\r\n  refreshToken: '',\r\n  activeRoom: null, // –∞–∫—Ç–∏–≤–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞\r\n  chatOld: null, // –∞–∫—Ç–∏–≤–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞\r\n\r\n  groupGather: {}, // —Å–ø–∏—Å–æ–∫ –≥—Ä—É–ø–ø\r\n  userGather: {}, // —Å–ø–∏—Å–æ–∫ –æ–Ω–ª–∞–π–Ω\r\n  contactGather: {}, // –∫–æ–Ω—Ç–∞–∫—Ç—ã\r\n  operators: [], // –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã\r\n  initialContactId: null, // –Ω–∞—á–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–∞–∫—Ç\r\n  conference: {\r\n    data: null, // –¥–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏\r\n    joined: false,\r\n    ringPlayed: false,\r\n  },\r\n  typing: null, // –∫—Ç–æ –ø–µ—á–∞—Ç–∞–µ—Ç —Ç–µ–∫—Å—Ç\r\n  loading: false, // –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö\r\n  error: undefined, // –æ—à–∏–±–∫–∞\r\n  success: undefined, // –ù–ï –æ—à–∏–±–∫–∞\r\n  visitData: [],\r\n};\r\n\r\ntype ChatActionType =\r\n  | 'ADD_GROUP_MEMBER'\r\n  | 'ADD_GROUP_MESSAGE'\r\n  | 'ADD_GROUP_MESSAGES'\r\n  | 'SET_GROUP_MESSAGES'\r\n  | 'ADD_PRIVATE_MESSAGE'\r\n  | 'ADD_PRIVATE_MESSAGES'\r\n  | 'SET_PRIVATE_MESSAGES'\r\n  | 'SET_ACTIVE_ROOM'\r\n  | 'UPDATE_ACTIVE_ROOM'\r\n  | 'SET_GROUP_GATHER'\r\n  | 'SET_CONTACT_GATHER'\r\n  | 'SET_USER_GATHER'\r\n  | 'DEL_GROUP'\r\n  | 'DEL_GROUP_MEMBER'\r\n  | 'DEL_CONTACT'\r\n  | 'ADD_CONTACT_UNREAD_GATHER'\r\n  | 'LOSE_CONTACT_UNREAD_GATHER'\r\n  | 'ADD_GROUP_UNREAD_GATHER'\r\n  | 'LOSE_GROUP_UNREAD_GATHER'\r\n  | 'REVOKE_MESSAGE'\r\n  | 'USER_ONLINE'\r\n  | 'USER_OFFLINE'\r\n  | 'UPDATE_USER_INFO'\r\n  | 'SET_INITIAL_CONTACT_ID'\r\n  | 'SET_CONFERENCE'\r\n  | 'JOIN_CONFERENCE'\r\n  | 'PAUSE_CONFERENCE'\r\n  | 'STOP_CONFERENCE'\r\n  | 'SET_TYPING'\r\n  | 'MARK_AS_READ'\r\n  | 'UPDATE_GROUP_INFO'\r\n  | 'MARK_PRIVATE_MESSAGES_READ'\r\n  | 'SET_LOADING'\r\n  | 'SET_ERROR'\r\n  | 'SET_SUCCES'\r\n  | 'SET_USER'\r\n  | 'SET_TOKEN'\r\n  | 'CLEAR_USER'\r\n  | 'CLEAR_CHAT_DATA'\r\n  | 'SET_OPERATORS'\r\n  | 'SET_VISIT_DATA';\r\n\r\ntype Action = {\r\n  type: ChatActionType;\r\n  payload?:\r\n    | null\r\n    | boolean\r\n    | number\r\n    | string\r\n    | Group\r\n    | Contact\r\n    | User\r\n    | PrivateMessage\r\n    | GroupMessage\r\n    | SetTyping\r\n    | MessageOperation\r\n    | GroupMember\r\n    | AddPrivateMessages\r\n    | AddGroupMessages\r\n    | SetActiveRoom\r\n    | ConferenceData\r\n    | Contact[]\r\n    | GroupMap\r\n    | VisitData[];\r\n};\r\n\r\nconst getFreshActiveRoom = (state: ChatState) => {\r\n  if (state.activeRoom)\r\n    return (\r\n      state.groupGather[(state.activeRoom as Group).groupId] ||\r\n      state.contactGather[state.activeRoom.userId]\r\n    );\r\n  return null;\r\n};\r\n\r\nconst getActiveRoom = (state: ChatState) => {\r\n  const { activeRoom, initialContactId, contactGather } = state;\r\n  let newActiveRoom: ChatRoom | null = null;\r\n  if (initialContactId) {\r\n    newActiveRoom = contactGather[initialContactId];\r\n  } else if (activeRoom) {\r\n    newActiveRoom = getFreshActiveRoom(state);\r\n  } else {\r\n    // –∏—â–µ–º –∫–æ–º–Ω–∞—Ç—É —Å —Å–∞–º—ã–º —Å–≤–µ–∂–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º\r\n    const rooms = [\r\n      ...Object.values(state.contactGather),\r\n      ...Object.values(state.groupGather),\r\n    ].sort(chatRoomComparer);\r\n    if (rooms.length > 0) newActiveRoom = rooms[0];\r\n  }\r\n  return newActiveRoom;\r\n};\r\n\r\nconst setUserOnline = (\r\n  state: ChatState,\r\n  userId: number,\r\n  online: 0 | 1,\r\n): ChatState => {\r\n  const newState = { ...state };\r\n  // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å—ã –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —á–∞—Ç–æ–≤\r\n  if (state.contactGather[userId])\r\n    newState.contactGather[userId] = {\r\n      ...newState.contactGather[userId],\r\n      online,\r\n    };\r\n\r\n  // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å —É—á–∞—Å—Ç–Ω–∏–∫–∞ –≤ –≥—Ä—É–ø–ø–∞—Ö\r\n  for (const group of Object.values(state.groupGather) as Group[]) {\r\n    if (!group.members) continue;\r\n    const member = group.members.find(m => m.userId === userId);\r\n    if (member) {\r\n      const index = group.members.indexOf(member);\r\n      group.members[index] = { ...member, online };\r\n    }\r\n  }\r\n  // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤\r\n  const idx = newState.operators.findIndex(\r\n    it => it.userId === userId,\r\n  );\r\n  if (idx !== -1)\r\n    newState.operators[idx] = { ...newState.operators[idx], online };\r\n  // –æ–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç\r\n  newState.activeRoom = getFreshActiveRoom(newState);\r\n  return newState;\r\n};\r\n\r\nconst addGroupMessage = (state: ChatState, payload: GroupMessage) => {\r\n  const newState = { ...state };\r\n  const { groupId } = payload;\r\n  if (newState.groupGather[groupId]) {\r\n    if (newState.groupGather[groupId].messages) {\r\n      newState.groupGather[groupId].messages = [\r\n        ...(newState.groupGather[groupId].messages as GroupMessage[]),\r\n        payload,\r\n      ];\r\n    } else {\r\n      newState.groupGather[groupId] = {\r\n        ...state.groupGather[groupId],\r\n        messages: [payload],\r\n      };\r\n    }\r\n  }\r\n\r\n  // —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π, –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞ –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –æ—Ç –Ω–∞—Å\r\n  const { activeRoom } = newState;\r\n  if (\r\n    activeRoom &&\r\n    (activeRoom as Group).groupId !== groupId &&\r\n    payload.userId !== state.user.userId\r\n  ) {\r\n    return groupUnreadGather(\r\n      newState,\r\n      groupId,\r\n      (x?: number) => (x || 0) + 1,\r\n    );\r\n  }\r\n\r\n  // –æ–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç\r\n  newState.activeRoom = getFreshActiveRoom(newState);\r\n  return newState;\r\n};\r\n\r\nconst addPrivateMessage = (\r\n  state: ChatState,\r\n  payload: PrivateMessage,\r\n) => {\r\n  const newState = { ...state };\r\n  const contactId =\r\n    payload.contactId === state.user.userId\r\n      ? payload.userId\r\n      : payload.contactId;\r\n\r\n  // 1 –¥–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ\r\n  if (newState.contactGather[contactId].messages) {\r\n    newState.contactGather[contactId].messages = [\r\n      ...(newState.contactGather[contactId]\r\n        .messages as PrivateMessage[]),\r\n      payload,\r\n    ];\r\n  } else {\r\n    newState.contactGather[contactId] = {\r\n      ...newState.contactGather[contactId],\r\n      messages: [payload],\r\n    };\r\n  }\r\n\r\n  // 2 –µ—Å–ª–∏ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–π –∫–æ–º–Ω–∞—Ç–µ –∏ –∏—Å—Ç–æ—á–Ω–∏–∫ –Ω–µ –º—ã (–≤ —Å–æ—Å–µ–¥–Ω–µ–π –≤–∫–ª–∞–¥–∫–µ), —Ç–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö\r\n  if (\r\n    newState.activeRoom?.userId !== contactId &&\r\n    payload.userId !== state.user.userId\r\n  ) {\r\n    return contactUnreadGather(\r\n      newState,\r\n      contactId,\r\n      (x?: number) => (x || 0) + 1,\r\n    );\r\n  }\r\n\r\n  // –æ–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç\r\n  newState.activeRoom = getFreshActiveRoom(newState);\r\n  return newState;\r\n};\r\n\r\nconst contactUnreadGather = (\r\n  state: ChatState,\r\n  userId: number,\r\n  predicate: (x?: number) => number,\r\n) => {\r\n  const newState = { ...state };\r\n\r\n  if (newState.contactGather[userId]) {\r\n    newState.contactGather[userId] = {\r\n      ...newState.contactGather[userId],\r\n      unreadCount: predicate(\r\n        newState.contactGather[userId].unreadCount,\r\n      ),\r\n    };\r\n  }\r\n\r\n  // –æ–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç\r\n  newState.activeRoom = getFreshActiveRoom(newState);\r\n\r\n  return newState;\r\n};\r\n\r\nconst groupUnreadGather = (\r\n  state: ChatState,\r\n  groupId: number,\r\n  predicate: (x?: number) => number,\r\n) => {\r\n  const newState = { ...state };\r\n\r\n  if (newState.groupGather[groupId]) {\r\n    newState.groupGather[groupId] = {\r\n      ...newState.groupGather[groupId],\r\n      unreadCount: predicate(\r\n        newState.groupGather[groupId].unreadCount,\r\n      ),\r\n    };\r\n  }\r\n\r\n  // –æ–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç\r\n  newState.activeRoom = getFreshActiveRoom(newState);\r\n\r\n  return newState;\r\n};\r\n\r\nconst revokeMessage = (\r\n  state: ChatState,\r\n  payload: MessageOperation,\r\n) => {\r\n  const { userId } = state.user;\r\n  const newState = { ...state };\r\n  const userName =\r\n    payload.username ||\r\n    newState.userGather[payload.userId as number].username;\r\n  if (payload.groupId) {\r\n    const { messages } = newState.groupGather[payload.groupId];\r\n    // –∑–∞–¥–∞–µ–º isRevoke\r\n    if (messages) {\r\n      const msg = messages.find(\r\n        message => message._id === payload._id,\r\n      );\r\n      if (msg) {\r\n        const index = messages.indexOf(msg);\r\n        messages[index] = {\r\n          ...msg,\r\n          isRevoke: true,\r\n          revokeUserName: userName,\r\n        };\r\n      }\r\n    }\r\n  } else {\r\n    const { messages } = newState.contactGather[\r\n      payload.contactId === userId\r\n        ? (payload.userId as number)\r\n        : (payload.contactId as number)\r\n    ];\r\n    // –∑–∞–¥–∞–µ–º isRevoke\r\n    if (messages) {\r\n      const msg = messages.find(\r\n        message => message._id === payload._id,\r\n      );\r\n      if (msg) {\r\n        const index = messages.indexOf(msg);\r\n        messages[index] = {\r\n          ...msg,\r\n          isRevoke: true,\r\n          revokeUserName: userName,\r\n        };\r\n      }\r\n    }\r\n  }\r\n  // –æ–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç\r\n  newState.activeRoom = getFreshActiveRoom(newState);\r\n  return newState;\r\n};\r\n\r\nconst delContact = (state: ChatState, userId: number) => {\r\n  const newState = { ...state };\r\n  const updateActiveRoom =\r\n    newState.activeRoom === newState.contactGather[userId];\r\n  delete newState.contactGather[userId];\r\n  if (updateActiveRoom) newState.activeRoom = getActiveRoom(newState);\r\n\r\n  return newState;\r\n};\r\n\r\nconst delGroup = (state: ChatState, groupId: number) => {\r\n  const newState = { ...state };\r\n  const updateActiveRoom =\r\n    newState.activeRoom === newState.groupGather[groupId];\r\n  delete newState.groupGather[groupId];\r\n  if (updateActiveRoom) newState.activeRoom = getActiveRoom(newState);\r\n\r\n  return newState;\r\n};\r\n\r\nconst delGroupMember = (state: ChatState, data: GroupMap) => {\r\n  const newState = { ...state };\r\n\r\n  const group = newState.groupGather[data.groupId];\r\n  if (group) {\r\n    group.members = group.members?.filter(\r\n      it => it.userId !== data.userId,\r\n    );\r\n  }\r\n\r\n  return newState;\r\n};\r\n\r\nconst updateGroupInfo = (state: ChatState, group: Group) => {\r\n  const newState = { ...state };\r\n\r\n  const { groupId, name, notice } = group;\r\n  const info = newState.groupGather[groupId];\r\n  if (info) {\r\n    newState.groupGather[groupId] = { ...info, name, notice };\r\n  }\r\n\r\n  // –æ–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç\r\n  newState.activeRoom = getFreshActiveRoom(newState);\r\n\r\n  return newState;\r\n};\r\n\r\nconst updateUserInfo = (state: ChatState, user: User) => {\r\n  const newState = { ...state };\r\n\r\n  const { userId, username, avatar } = user;\r\n\r\n  if (newState.userGather[userId]) {\r\n    newState.userGather[userId] = {\r\n      ...newState.userGather[userId],\r\n      username,\r\n      avatar,\r\n    };\r\n  }\r\n\r\n  if (newState.contactGather[userId]) {\r\n    newState.contactGather[userId] = {\r\n      ...newState.contactGather[userId],\r\n      username,\r\n      avatar,\r\n    };\r\n  }\r\n\r\n  // –æ–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç\r\n  newState.activeRoom = getFreshActiveRoom(newState);\r\n\r\n  return newState;\r\n};\r\n\r\nconst addGroupMember = (state: ChatState, payload: GroupMember) => {\r\n  const members: Contact[] = payload.members.map(member => ({\r\n    ...member,\r\n    isManager: 0,\r\n  }));\r\n\r\n  const newState = { ...state };\r\n\r\n  if (newState.groupGather[payload.groupId].members && members) {\r\n    newState.groupGather[payload.groupId].members = [\r\n      ...(state.groupGather[payload.groupId].members as Contact[]),\r\n      ...members,\r\n    ];\r\n  } else {\r\n    newState.groupGather[payload.groupId] = {\r\n      ...newState.groupGather[payload.groupId],\r\n      members,\r\n    };\r\n  }\r\n\r\n  // –æ–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç\r\n  newState.activeRoom = getFreshActiveRoom(newState);\r\n  return newState;\r\n};\r\n\r\nconst markPrivateMessagesRead = (\r\n  state: ChatState,\r\n  userId: number,\r\n) => {\r\n  const newState = { ...state };\r\n\r\n  if (newState.contactGather[userId]) {\r\n    const updatedValue = { ...newState.contactGather[userId] };\r\n\r\n    if (updatedValue.messages) {\r\n      for (let i = 0; i < updatedValue.messages.length; i++)\r\n        updatedValue.messages[i] = {\r\n          ...updatedValue.messages[i],\r\n          status: 1,\r\n        };\r\n    }\r\n    newState.contactGather[userId] = updatedValue;\r\n  }\r\n\r\n  // –æ–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç\r\n  newState.activeRoom = getFreshActiveRoom(newState);\r\n  // –ø–æ–º–µ—á–∞–µ–º –≤—Å–µ –Ω–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ\r\n  if (newState.activeRoom != null && newState.activeRoom.messages) {\r\n    for (let i = 0; i < newState.activeRoom.messages.length; i++)\r\n      newState.activeRoom.messages[i] = {\r\n        ...newState.activeRoom.messages[i],\r\n        status: 1,\r\n      };\r\n  }\r\n  return newState;\r\n};\r\n\r\nconst addPrivateMessages = (\r\n  state: ChatState,\r\n  data: AddPrivateMessages,\r\n) => {\r\n  const newState = { ...state };\r\n\r\n  const { messages, contactId } = data;\r\n\r\n  if (newState.contactGather[contactId]) {\r\n    newState.contactGather[contactId] = {\r\n      ...newState.contactGather[contactId],\r\n      messages: [\r\n        ...(messages || []),\r\n        ...(newState.contactGather[contactId].messages || []),\r\n      ],\r\n      noMoreData: messages?.length\r\n        ? messages?.length < data.pageSize\r\n        : true,\r\n    };\r\n  }\r\n\r\n  // –æ–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç\r\n  newState.activeRoom = getFreshActiveRoom(newState);\r\n\r\n  return newState;\r\n};\r\n\r\nconst addGroupMessages = (\r\n  state: ChatState,\r\n  data: AddGroupMessages,\r\n) => {\r\n  const newState = { ...state };\r\n\r\n  const { groupId, messages, userArr: users } = data;\r\n  if (newState.groupGather[groupId]) {\r\n    newState.groupGather[groupId] = {\r\n      ...newState.groupGather[groupId],\r\n      messages: [\r\n        ...(messages || []),\r\n        ...(newState.groupGather[groupId].messages || []),\r\n      ],\r\n      noMoreData: messages?.length\r\n        ? messages?.length < data.pageSize\r\n        : true,\r\n    };\r\n  }\r\n\r\n  newState.userGather = { ...newState.userGather };\r\n  for (const user of users) {\r\n    if (!newState.userGather[user.userId]) {\r\n      newState.userGather[user.userId] = user;\r\n    }\r\n  }\r\n\r\n  // –æ–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç\r\n  newState.activeRoom = getFreshActiveRoom(newState);\r\n\r\n  return newState;\r\n};\r\n\r\nconst setActiveRoom = (state: ChatState, data: SetActiveRoom) => {\r\n  //if (state.activeRoom && data.ifNotExists) return state;\r\n  return {\r\n    ...state,\r\n    chatOld:\r\n      state.activeRoom != null ? { ...state.activeRoom } : null,\r\n    activeRoom: data.groupId\r\n      ? state.groupGather[data.groupId]\r\n      : data.contactId\r\n      ? state.contactGather[data.contactId]\r\n      : null,\r\n  };\r\n};\r\n\r\nconst setToken = (state: ChatState, token: string): ChatState => {\r\n  return {\r\n    ...state,\r\n    token,\r\n  };\r\n};\r\n\r\nconst clearUser = (state: ChatState): ChatState => {\r\n  return {\r\n    ...state,\r\n    token: '',\r\n    user: emptyUser,\r\n  };\r\n};\r\n\r\nconst setConference = (\r\n  state: ChatState,\r\n  conference: ConferenceData,\r\n): ChatState => {\r\n  return {\r\n    ...state,\r\n    conference: {\r\n      data: { ...conference },\r\n      joined: conference?.userId === state.user.userId,\r\n      ringPlayed: conference?.userId !== state.user.userId,\r\n    },\r\n  };\r\n};\r\n\r\nconst pauseConference = (\r\n  state: ChatState,\r\n  conference: ConferenceData,\r\n): ChatState => {\r\n  if (state.conference.data?.id !== conference?.id) return state;\r\n  return {\r\n    ...state,\r\n    conference: {\r\n      data: { ...state.conference.data },\r\n      joined: false,\r\n      ringPlayed: false,\r\n    },\r\n  };\r\n};\r\n\r\nconst stopConference = (\r\n  state: ChatState,\r\n  conference: ConferenceData,\r\n): ChatState => {\r\n  if (state.conference.data?.id !== conference?.id) return state;\r\n  return {\r\n    ...state,\r\n    conference: { data: null, joined: false, ringPlayed: false },\r\n  };\r\n};\r\n\r\nfunction chatReducer(state: ChatState, action: Action): ChatState {\r\n  switch (action.type) {\r\n    case 'SET_GROUP_GATHER':\r\n      return {\r\n        ...state,\r\n        groupGather: {\r\n          ...state.groupGather,\r\n          [(action.payload as Group)\r\n            .groupId]: action.payload as Group,\r\n        },\r\n      };\r\n    case 'SET_CONTACT_GATHER':\r\n      return {\r\n        ...state,\r\n        contactGather: {\r\n          ...state.contactGather,\r\n          [(action.payload as Contact)\r\n            .userId]: action.payload as Contact,\r\n        },\r\n      };\r\n    case 'DEL_GROUP':\r\n      return delGroup(state, action.payload as number);\r\n    case 'DEL_GROUP_MEMBER':\r\n      return delGroupMember(state, action.payload as GroupMap);\r\n    case 'DEL_CONTACT':\r\n      return delContact(state, (action.payload as Contact).userId);\r\n    case 'SET_USER_GATHER':\r\n      return {\r\n        ...state,\r\n        userGather: {\r\n          ...state.userGather,\r\n          [(action.payload as User).userId]: action.payload as User,\r\n        },\r\n      };\r\n    case 'UPDATE_ACTIVE_ROOM':\r\n      return { ...state, activeRoom: getActiveRoom(state) };\r\n    case 'SET_ACTIVE_ROOM':\r\n      return setActiveRoom(state, action.payload as SetActiveRoom);\r\n    case 'USER_ONLINE':\r\n      return setUserOnline(state, action.payload as number, 1);\r\n    case 'USER_OFFLINE':\r\n      return setUserOnline(state, action.payload as number, 0);\r\n    case 'ADD_GROUP_MESSAGE':\r\n      return addGroupMessage(state, action.payload as GroupMessage);\r\n    case 'ADD_PRIVATE_MESSAGE':\r\n      return addPrivateMessage(\r\n        state,\r\n        action.payload as PrivateMessage,\r\n      );\r\n    case 'ADD_GROUP_UNREAD_GATHER':\r\n      return groupUnreadGather(\r\n        state,\r\n        action.payload as number,\r\n        (x?: number) => (x || 0) + 1,\r\n      );\r\n    case 'ADD_CONTACT_UNREAD_GATHER':\r\n      return contactUnreadGather(\r\n        state,\r\n        action.payload as number,\r\n        (x?: number) => (x || 0) + 1,\r\n      );\r\n    case 'SET_TYPING':\r\n      return { ...state, typing: action.payload as SetTyping };\r\n    case 'LOSE_GROUP_UNREAD_GATHER':\r\n      return groupUnreadGather(\r\n        state,\r\n        action.payload as number,\r\n        () => 0,\r\n      );\r\n    case 'LOSE_CONTACT_UNREAD_GATHER':\r\n      return contactUnreadGather(\r\n        state,\r\n        action.payload as number,\r\n        () => 0,\r\n      );\r\n    case 'REVOKE_MESSAGE':\r\n      return revokeMessage(state, action.payload as MessageOperation);\r\n    case 'UPDATE_GROUP_INFO':\r\n      return updateGroupInfo(state, action.payload as Group);\r\n    case 'UPDATE_USER_INFO':\r\n      return updateUserInfo(state, action.payload as User);\r\n    case 'ADD_GROUP_MEMBER':\r\n      return addGroupMember(state, action.payload as GroupMember);\r\n    case 'SET_CONFERENCE':\r\n      return setConference(state, action.payload as ConferenceData);\r\n    case 'JOIN_CONFERENCE':\r\n      return {\r\n        ...state,\r\n        conference: {\r\n          data: { ...(action.payload as ConferenceData) },\r\n          joined: true,\r\n          ringPlayed: false,\r\n        },\r\n      };\r\n    case 'PAUSE_CONFERENCE':\r\n      return pauseConference(state, action.payload as ConferenceData);\r\n    case 'STOP_CONFERENCE':\r\n      return stopConference(state, action.payload as ConferenceData);\r\n    case 'MARK_PRIVATE_MESSAGES_READ':\r\n      return markPrivateMessagesRead(state, action.payload as number);\r\n    case 'ADD_PRIVATE_MESSAGES':\r\n      return addPrivateMessages(\r\n        state,\r\n        action.payload as AddPrivateMessages,\r\n      );\r\n    case 'ADD_GROUP_MESSAGES':\r\n      return addGroupMessages(\r\n        state,\r\n        action.payload as AddGroupMessages,\r\n      );\r\n    case 'SET_LOADING':\r\n      return {\r\n        ...state,\r\n        loading: action.payload as boolean,\r\n        error: '',\r\n      };\r\n    case 'SET_ERROR':\r\n      return {\r\n        ...state,\r\n        error: action.payload as string,\r\n        success: undefined,\r\n      };\r\n    case 'SET_SUCCES':\r\n      return {\r\n        ...state,\r\n        success: action.payload as string,\r\n        error: undefined,\r\n      };\r\n    case 'SET_TOKEN':\r\n      return setToken(state, action.payload as string);\r\n    case 'SET_USER':\r\n      return {\r\n        ...state,\r\n        user: action.payload as User,\r\n      };\r\n    case 'CLEAR_USER':\r\n      return clearUser(state);\r\n    case 'CLEAR_CHAT_DATA':\r\n      return {\r\n        ...state,\r\n        activeRoom: null,\r\n        groupGather: {},\r\n        userGather: {},\r\n        contactGather: {},\r\n        conference: {\r\n          data: null,\r\n          joined: false,\r\n          ringPlayed: false,\r\n        },\r\n        typing: null,\r\n      };\r\n    case 'SET_OPERATORS':\r\n      return {\r\n        ...state,\r\n        operators: action.payload as Contact[],\r\n      };\r\n    case 'SET_VISIT_DATA':\r\n      return {\r\n        ...state,\r\n        visitData: action.payload as VisitData[],\r\n      };\r\n  }\r\n\r\n  return state;\r\n}\r\n\r\nexport type ChatDispatch = React.Dispatch<Action>;\r\nconst emptyDispatch: ChatDispatch = () => null;\r\n\r\ntype ChatProviderProps = {\r\n  defLang: string | undefined;\r\n  token: string;\r\n  refreshToken: string;\r\n  children: React.JSX.Element | React.JSX.Element[];\r\n};\r\n\r\nexport const ChatContext = React.createContext({\r\n  state: emptyChatState,\r\n  dispatch: emptyDispatch,\r\n});\r\n\r\nexport const ChatProvider: React.FC<ChatProviderProps> = (\r\n  props: ChatProviderProps,\r\n) => {\r\n  emptyUser.langCode = props.defLang;\r\n\r\n  const token = props.token;\r\n  const refreshToken = props.token;\r\n  const chatState: ChatState = {\r\n    ...emptyChatState,\r\n    token,\r\n    refreshToken,\r\n  };\r\n\r\n  const [state, dispatch] = React.useReducer(chatReducer, chatState);\r\n  const value = useMemo(() => ({ state, dispatch }), [state]);\r\n  return (\r\n    <ChatContext.Provider value={value}>\r\n      {props.children}\r\n    </ChatContext.Provider>\r\n  );\r\n};\r\n","import React from 'react';\r\nimport {\r\n  Box,\r\n  CardContent,\r\n  CircularProgress,\r\n  List,\r\n  Backdrop,\r\n  Fab,\r\n  Typography,\r\n  ListItem,\r\n  Fade,\r\n  Alert,\r\n  useMediaQuery,\r\n} from '@mui/material';\r\nimport { Theme } from '@mui/material/styles';\r\nimport { makeStyles, createStyles } from '@mui/styles';\r\nimport KeyboardArrowDown from '@mui/icons-material/KeyboardArrowDown';\r\n\r\nimport Message from './Message';\r\n\r\nimport { getChatId } from '../utils/common';\r\nimport { ChatMessage, ChatRoom, User, ContactGather } from '../types';\r\nimport { ChatContext } from '../context/ChatContext';\r\nimport useInfiniteScroll from 'react-infinite-scroll-hook';\r\nimport dayjs from 'dayjs';\r\nimport useInterval from '../hooks/useInterval';\r\n\r\nfunction isVisibleInViewport(\r\n  element: HTMLLIElement,\r\n  root: HTMLDivElement,\r\n) {\r\n  const rect = element.getBoundingClientRect();\r\n  // console.log(\r\n  //   'rect.top',\r\n  //   rect.top,\r\n  //   'rect.bottom',\r\n  //   rect.bottom,\r\n  //   root.clientHeight,\r\n  // );\r\n  return rect.top >= 50 && rect.bottom <= root.clientHeight;\r\n}\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    messageListOuter: {\r\n      flex: 1,\r\n      overflowY: 'auto',\r\n      margin: 0,\r\n      padding: 0,\r\n      height: '100%',\r\n      scrollbarWidth: 'thin',\r\n      scrollbarColor: `${theme.palette.primary.light} #fff`,\r\n    },\r\n    messageList: {},\r\n    img: {\r\n      cursor: 'pointer',\r\n      borderRadius: theme.spacing(1.2),\r\n\r\n      maxWidth: 'auto',\r\n      maxHeight: '95%',\r\n      [theme.breakpoints.down('sm')]: {\r\n        maxWidth: 'auto',\r\n        maxHeight: '95%',\r\n      },\r\n    },\r\n\r\n    arrowDown: {\r\n      position: 'absolute',\r\n      left: '94.5%',\r\n      bottom: 105,\r\n      [theme.breakpoints.down('md')]: {\r\n        left: '91.5%',\r\n        bottom: 95,\r\n      },\r\n      [theme.breakpoints.down('sm')]: {\r\n        left: '84%',\r\n        bottom: 95,\r\n      },\r\n    },\r\n  }),\r\n);\r\n\r\ntype InitialMenuState = {\r\n  message: ChatMessage | null;\r\n  mouseX: null | number;\r\n  mouseY: null | number;\r\n  canCopy: boolean;\r\n  canDelete: boolean;\r\n};\r\n\r\ntype RoomMessageListProps = {\r\n  apiUrl: string;\r\n  user: User;\r\n  users: ContactGather;\r\n  chat: ChatRoom | null;\r\n  loading: boolean;\r\n  pageSize: number;\r\n\r\n  initialMenuState: InitialMenuState;\r\n\r\n  onNeedMoreMessages: (chat: ChatRoom) => Promise<void>;\r\n  onMeesageDelete?: (chat: ChatRoom, message: ChatMessage) => void;\r\n  setMenuState: React.Dispatch<\r\n    React.SetStateAction<InitialMenuState>\r\n  >;\r\n  inModale?: boolean;\r\n  isConference: boolean;\r\n  onEnterRoom?: (chat: ChatRoom) => void;\r\n};\r\n\r\nconst RoomMessageList: React.FC<RoomMessageListProps> = (\r\n  props: RoomMessageListProps,\r\n) => {\r\n  const {\r\n    apiUrl,\r\n    user,\r\n    users,\r\n    chat,\r\n    loading,\r\n    pageSize,\r\n    setMenuState,\r\n    initialMenuState,\r\n    inModale,\r\n    isConference,\r\n    onEnterRoom,\r\n  } = props;\r\n\r\n  const classes = useStyles();\r\n  const isMobile = useMediaQuery((theme: Theme) =>\r\n    theme.breakpoints.down('sm'),\r\n  );\r\n  const DEF = 900;\r\n\r\n  const chatId = getChatId(chat);\r\n\r\n  const [viewerData, setViewerData] = React.useState<{\r\n    visible: boolean;\r\n    src: string;\r\n  }>({\r\n    visible: false,\r\n    src: '',\r\n  });\r\n\r\n  const { dispatch } = React.useContext(ChatContext);\r\n  const [scrollDownButton, setScrollDownButton] = React.useState(\r\n    false,\r\n  );\r\n\r\n  const scrollableRootRef = React.useRef<React.ElementRef<\r\n    'div'\r\n  > | null>(null);\r\n  const lastScrollDistanceToBottomRef = React.useRef<number>();\r\n  const lastMessageCount = React.useRef<number>();\r\n\r\n  const hasNextPage =\r\n    chat == null || chat?.noMoreData == null\r\n      ? true\r\n      : !chat.noMoreData;\r\n\r\n  const messages = React.useMemo(\r\n    () =>\r\n      chat?.messages\r\n        ? chat.messages.map(it => ({\r\n            ...it,\r\n            ref: React.createRef<HTMLLIElement>(),\r\n          }))\r\n        : [],\r\n    [chat?.messages],\r\n  );\r\n\r\n  const messageCount = messages?.length || 0;\r\n\r\n  const lastMessage = messageCount && messages[messageCount - 1];\r\n\r\n  const messageCountUnreaded = messages.filter(\r\n    it => it?.status != null && it.status === 0,\r\n  );\r\n\r\n  const [isVisible, setIsVisible] = React.useState<string>(\r\n    messages[messageCount - 1].cdate,\r\n  );\r\n\r\n  const loadMore = () => {\r\n    chat && props.onNeedMoreMessages(chat);\r\n  };\r\n\r\n  const [infiniteRef, { rootRef }] = useInfiniteScroll({\r\n    loading,\r\n    hasNextPage,\r\n    onLoadMore: loadMore,\r\n    disabled: false,\r\n  });\r\n\r\n  React.useEffect(() => {\r\n    if (chatId && scrollableRootRef.current && messageCount) {\r\n      setIsVisible(messages[messageCount - 1].cdate);\r\n      scrollDown();\r\n    }\r\n  }, [chatId]);\r\n\r\n  useInterval(\r\n    () => {\r\n      setIsVisible('');\r\n    },\r\n    isVisible,\r\n    3700,\r\n  );\r\n\r\n  // ------ keep the scroll position and lastMessageCount when messageCount changed ----------\r\n  React.useEffect(() => {\r\n    const scrollableRoot = scrollableRootRef.current;\r\n    const lastScrollDistanceToBottom =\r\n      lastScrollDistanceToBottomRef.current ?? 0;\r\n\r\n    if (scrollableRoot && lastMessage && chat) {\r\n      // -----  scroll to prev lastScrollDistanceToBottom -----------\r\n      if (lastMessageCount.current === messageCount - pageSize) {\r\n        scrollableRoot.scrollTop =\r\n          scrollableRoot.scrollHeight - lastScrollDistanceToBottom;\r\n      } else if (\r\n        // -----  scroll to bottom forced -----------\r\n        lastMessage.userId !== chat.userId ||\r\n        lastScrollDistanceToBottom <= DEF\r\n      ) {\r\n        scrollDown();\r\n      }\r\n    }\r\n    lastMessageCount.current = messageCount;\r\n  }, [messageCount]);\r\n\r\n  const handleRootScroll = React.useCallback(() => {\r\n    const rootNode = scrollableRootRef.current;\r\n\r\n    if (rootNode) {\r\n      const scrollDistanceToBottom =\r\n        rootNode.scrollHeight - rootNode.scrollTop;\r\n      lastScrollDistanceToBottomRef.current = scrollDistanceToBottom;\r\n\r\n      const isShowScrollButton =\r\n        hasNextPage && scrollDistanceToBottom > DEF;\r\n      setScrollDownButton(isShowScrollButton);\r\n\r\n      if (!isShowScrollButton && chatId && chat && onEnterRoom) {\r\n        onEnterRoom(chat);\r\n        dispatch({\r\n          type: 'MARK_PRIVATE_MESSAGES_READ',\r\n          payload: chat.userId,\r\n        });\r\n      }\r\n\r\n      for (let i = 0; i < messageCount; i++) {\r\n        const mess = messages[i];\r\n        // console.log(\r\n        //   '------------loop------------',\r\n        //   //mess?.ref?.current,\r\n        // );\r\n\r\n        if (mess?.ref?.current) {\r\n          const isVisibleMess = isVisibleInViewport(\r\n            mess.ref.current,\r\n            rootNode,\r\n          );\r\n          if (isVisibleMess) {\r\n            // console.log(\r\n            //   'visible',\r\n            //   dayjs(mess.cdate).format('DD.MM.YYYY'),\r\n            // );\r\n            setIsVisible(mess.cdate);\r\n            break;\r\n          }\r\n        } else {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }, [messages, chatId]);\r\n\r\n  const scrollDown = () => {\r\n    if (scrollableRootRef.current) {\r\n      scrollableRootRef.current.scrollTop =\r\n        scrollableRootRef.current.scrollHeight;\r\n    }\r\n  };\r\n\r\n  const rootRefSetter = React.useCallback(\r\n    (node: HTMLDivElement) => {\r\n      rootRef(node);\r\n      scrollableRootRef.current = node;\r\n    },\r\n    [rootRef],\r\n  );\r\n\r\n  const handleMenuPopup = (\r\n    message: ChatMessage,\r\n    event: React.MouseEvent<HTMLElement>,\r\n  ) => {\r\n    const canCopy = message.messageType === 'text';\r\n    const canDelete =\r\n      user.userId === message.userId &&\r\n      !!props.onMeesageDelete &&\r\n      new Date().getTime() - new Date(message.cdate).getTime() <=\r\n        1000 * 60 * 2;\r\n    if (!canCopy && !canDelete) {\r\n      setMenuState(initialMenuState);\r\n      return;\r\n    }\r\n    event.preventDefault();\r\n    setMenuState({\r\n      message,\r\n      mouseX: event.clientX - 2,\r\n      mouseY: event.clientY - 4,\r\n      canCopy,\r\n      canDelete,\r\n    });\r\n  };\r\n\r\n  if (chatId == null) return;\r\n\r\n  return (\r\n    <>\r\n      <Fade\r\n        in={!!isVisible}\r\n        style={\r\n          isVisible\r\n            ? {\r\n                display: 'block',\r\n                position: 'relative',\r\n                width: 'auto',\r\n              }\r\n            : { display: 'none' }\r\n        }\r\n        timeout={2000}\r\n      >\r\n        <Alert\r\n          severity=\"warning\"\r\n          icon={false}\r\n          style={{\r\n            width: 'auto',\r\n            position: 'absolute',\r\n            left: isMobile ? '50%' : isConference ? '69%' : '60%',\r\n\r\n            top: inModale ? 105 : 50,\r\n            zIndex: 10,\r\n          }}\r\n        >\r\n          <Typography variant=\"h6\" textAlign=\"center\">\r\n            {dayjs(isVisible).format('DD.MM.YYYY')}\r\n          </Typography>\r\n        </Alert>\r\n      </Fade>\r\n\r\n      <CardContent\r\n        className={classes.messageListOuter}\r\n        ref={rootRefSetter}\r\n        onScroll={handleRootScroll}\r\n      >\r\n        <List className={classes.messageList}>\r\n          {hasNextPage && (\r\n            <ListItem\r\n              ref={infiniteRef}\r\n              sx={{\r\n                justifyContent: 'center',\r\n              }}\r\n            >\r\n              <CircularProgress />\r\n            </ListItem>\r\n          )}\r\n          {(messages as ChatMessage[]).map((message, inx) => {\r\n            return (\r\n              <Message\r\n                ref={message.ref}\r\n                key={inx}\r\n                apiUrl={apiUrl}\r\n                user={user}\r\n                message={message}\r\n                owner={users[message.userId]}\r\n                isGroupMessage={!!chat?.groupId}\r\n                isUserFirst={\r\n                  inx === 0 ||\r\n                  messages[inx - 1].messageType === 'notify' ||\r\n                  messages[inx - 1].userId !== messages[inx].userId\r\n                }\r\n                isUserLast={\r\n                  inx === messages.length - 1 ||\r\n                  messages[inx + 1].messageType === 'notify' ||\r\n                  messages[inx + 1].userId !== messages[inx].userId\r\n                }\r\n                onContextMenu={event =>\r\n                  handleMenuPopup(message, event)\r\n                }\r\n                //refOnMess={defineRefOnMess(inx)}\r\n                setViewerData={setViewerData}\r\n              />\r\n            );\r\n          })}\r\n        </List>\r\n        {scrollDownButton && (\r\n          <Box className={classes.arrowDown} textAlign=\"center\">\r\n            <Fab\r\n              color=\"info\"\r\n              aria-label=\"add\"\r\n              size=\"medium\"\r\n              onClick={() => scrollDown()}\r\n            >\r\n              <KeyboardArrowDown />\r\n            </Fab>\r\n            {messageCountUnreaded != null &&\r\n              messageCountUnreaded.length > 0 && (\r\n                <Fab\r\n                  color=\"warning\"\r\n                  aria-label=\"add\"\r\n                  size=\"small\"\r\n                  sx={{\r\n                    width: 24,\r\n                    height: 24,\r\n                    minHeight: 24,\r\n                    position: 'relative',\r\n                    top: -10,\r\n                    pointerEvents: 'none',\r\n                  }}\r\n                >\r\n                  <Typography\r\n                    variant=\"body2\"\r\n                    sx={theme => ({\r\n                      color: theme.palette.background.default,\r\n                    })}\r\n                  >\r\n                    {messageCountUnreaded.length}\r\n                  </Typography>\r\n                </Fab>\r\n              )}\r\n          </Box>\r\n        )}\r\n        {viewerData.visible && (\r\n          <Backdrop\r\n            sx={{\r\n              color: '#fff',\r\n              zIndex: (theme: Theme) => theme.zIndex.drawer + 1,\r\n            }}\r\n            open={viewerData.visible}\r\n            onClick={() => {\r\n              setViewerData({ visible: false, src: '' });\r\n            }}\r\n          >\r\n            <img\r\n              src={viewerData.src}\r\n              className={classes.img}\r\n              alt=\"\"\r\n            />\r\n          </Backdrop>\r\n        )}\r\n      </CardContent>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default RoomMessageList;\r\n","import { useEffect, useRef } from 'react';\r\n\r\nexport default function useInterval(callback, state, delay) {\r\n  const savedCallback = useRef();\r\n\r\n  // Remember the latest callback.\r\n  useEffect(() => {\r\n    savedCallback.current = callback;\r\n  }, [callback]);\r\n\r\n  // Set up the interval.\r\n  useEffect(() => {\r\n    function tick() {\r\n      savedCallback.current();\r\n    }\r\n    if (state) {\r\n      let id = setInterval(tick, delay);\r\n      return () => clearInterval(id);\r\n    }\r\n  }, [state]);\r\n}\r\n","import React, { useCallback } from 'react';\r\nimport {\r\n  Box,\r\n  Card,\r\n  CardContent,\r\n  Divider,\r\n  ListItemIcon,\r\n  Menu,\r\n  MenuItem,\r\n  IconButton,\r\n  useMediaQuery,\r\n  Tooltip,\r\n} from '@mui/material';\r\nimport { Theme } from '@mui/material/styles';\r\nimport { makeStyles, createStyles } from '@mui/styles';\r\nimport FileCopyIcon from '@mui/icons-material/FileCopy';\r\nimport DeleteIcon from '@mui/icons-material/Delete';\r\nimport ArrowBackIcon from '@mui/icons-material/ArrowBack';\r\nimport Entry from './Entry';\r\nimport RoomHeader from './RoomHeader';\r\nimport RoomMessageList from './RoomMessageList';\r\nimport { useTranslation } from 'react-i18next';\r\nimport {\r\n  ChatMessage,\r\n  ChatRoom,\r\n  SendMessage,\r\n  SetTyping,\r\n  User,\r\n  Contact,\r\n  ConferenceData,\r\n  Group,\r\n  ContactGather,\r\n  VisitData,\r\n} from '../types';\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    root: {\r\n      width: '100%',\r\n      minWidth: 360,\r\n      height: '100%',\r\n      display: 'flex',\r\n      flexDirection: 'column',\r\n    },\r\n\r\n    roomHeader: {\r\n      flex: 1,\r\n    },\r\n\r\n    flexAll: {\r\n      flex: '1 1 auto',\r\n    },\r\n    flexEnd: {\r\n      justifyContent: 'flex-end',\r\n    },\r\n  }),\r\n);\r\n\r\nconst initialMenuState = {\r\n  message: null,\r\n  mouseX: null,\r\n  mouseY: null,\r\n  canCopy: false,\r\n  canDelete: false,\r\n};\r\n\r\ntype RoomProps = {\r\n  apiUrl: string;\r\n  user: User;\r\n  users: ContactGather;\r\n  chat: ChatRoom | null;\r\n  typing: SetTyping | null;\r\n  conference: ConferenceData | null;\r\n  visitData: VisitData[];\r\n  conferenceJoined: boolean;\r\n  loading: boolean;\r\n  pageSize: number;\r\n  operators: Contact[];\r\n  inModale?: boolean;\r\n  onExitRoom?: (chat: ChatRoom) => void;\r\n  onEnterRoom?: (chat: ChatRoom) => void;\r\n  onNeedMoreMessages: (chat: ChatRoom) => Promise<void>;\r\n  onMeesageDelete?: (chat: ChatRoom, message: ChatMessage) => void;\r\n  onTyping?: (chat: ChatRoom) => void;\r\n  onSendMessage?: (chat: ChatRoom, data: SendMessage) => void;\r\n  onVideoCall?: (\r\n    chat: ChatRoom,\r\n    visitId?: number,\r\n    recreate?: boolean,\r\n  ) => void;\r\n  onVideoEnd?: (chat: ConferenceData) => void;\r\n  onConferencePause?: (conference: ConferenceData) => void;\r\n  onOperatorAdd?: (chat: Group, operator: Contact) => void;\r\n  onLeaveGroup?: (chat: Group) => void;\r\n  onContactClick?: (contact: Contact) => void;\r\n};\r\n\r\nconst Room: React.FC<RoomProps> = (props: RoomProps) => {\r\n  const {\r\n    apiUrl,\r\n    user,\r\n    users,\r\n    chat,\r\n    typing,\r\n    conference,\r\n    visitData,\r\n    conferenceJoined,\r\n    loading,\r\n    pageSize,\r\n    inModale,\r\n  } = props;\r\n  const classes = useStyles();\r\n  const { t } = useTranslation();\r\n  const isMobile = useMediaQuery((theme: Theme) =>\r\n    theme.breakpoints.down('sm'),\r\n  );\r\n\r\n  const [menuState, setMenuState] = React.useState<{\r\n    message: ChatMessage | null;\r\n    mouseX: null | number;\r\n    mouseY: null | number;\r\n    canCopy: boolean;\r\n    canDelete: boolean;\r\n  }>(initialMenuState);\r\n\r\n  const handleMenuClose = () => {\r\n    setMenuState(initialMenuState);\r\n  };\r\n\r\n  const handleCopy = useCallback(() => {\r\n    const { message } = menuState;\r\n    setMenuState(initialMenuState);\r\n    if (!message) return;\r\n    navigator.clipboard.writeText(message.content);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [menuState.message]);\r\n\r\n  const handleDelete = useCallback(() => {\r\n    const { message } = menuState;\r\n    setMenuState(initialMenuState);\r\n    if (props.onMeesageDelete && chat && message)\r\n      props.onMeesageDelete(chat, message);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [menuState.message]);\r\n\r\n  return (\r\n    <Card elevation={1} className={classes.root}>\r\n      <Box display=\"flex\" flexDirection=\"row\">\r\n        {chat && isMobile && (\r\n          <Tooltip title=\"–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—é\">\r\n            <IconButton\r\n              aria-label=\"exit room\"\r\n              onClick={() =>\r\n                props.onExitRoom && props.onExitRoom(chat)\r\n              }\r\n            >\r\n              <ArrowBackIcon />\r\n            </IconButton>\r\n          </Tooltip>\r\n        )}\r\n        {/* {!isMobile && <CheckAudiVideoPerm />} */}\r\n\r\n        <RoomHeader\r\n          apiUrl={apiUrl}\r\n          user={user}\r\n          chat={chat}\r\n          typing={typing}\r\n          conference={conference}\r\n          visitData={visitData}\r\n          conferenceJoined={conferenceJoined}\r\n          operators={props.operators}\r\n          className={classes.roomHeader}\r\n          onVideoCall={props.onVideoCall}\r\n          onVideoEnd={props.onVideoEnd}\r\n          onConferencePause={props.onConferencePause}\r\n          onOperatorAdd={props.onOperatorAdd}\r\n          onLeaveGroup={props.onLeaveGroup}\r\n          onContactClick={props.onContactClick}\r\n        />\r\n      </Box>\r\n      <Divider />\r\n      <RoomMessageList\r\n        apiUrl={apiUrl}\r\n        user={user}\r\n        users={users}\r\n        chat={chat}\r\n        loading={loading}\r\n        pageSize={pageSize}\r\n        initialMenuState={initialMenuState}\r\n        onNeedMoreMessages={props.onNeedMoreMessages}\r\n        onMeesageDelete={props.onMeesageDelete}\r\n        setMenuState={setMenuState}\r\n        inModale={inModale}\r\n        isConference={!!conference?.id}\r\n        onEnterRoom={props.onEnterRoom}\r\n      />\r\n      <Divider />\r\n      <CardContent>\r\n        <Entry\r\n          chat={chat}\r\n          onTyping={props.onTyping}\r\n          onSendMessage={props.onSendMessage}\r\n        />\r\n      </CardContent>\r\n      <Menu\r\n        keepMounted\r\n        open={menuState.mouseY !== null}\r\n        onClose={handleMenuClose}\r\n        anchorReference=\"anchorPosition\"\r\n        anchorPosition={\r\n          menuState.mouseY !== null && menuState.mouseX !== null\r\n            ? { top: menuState.mouseY, left: menuState.mouseX }\r\n            : undefined\r\n        }\r\n      >\r\n        <MenuItem onClick={handleCopy} disabled={!menuState.canCopy}>\r\n          <span className={classes.flexAll}>\r\n            {t('CHAT.MESSAGE.MENU.COPY')}\r\n          </span>\r\n          <ListItemIcon className={classes.flexEnd}>\r\n            <FileCopyIcon fontSize=\"small\" />\r\n          </ListItemIcon>\r\n        </MenuItem>\r\n        <MenuItem\r\n          onClick={handleDelete}\r\n          disabled={!menuState.canDelete}\r\n        >\r\n          <span className={classes.flexAll}>\r\n            {t('CHAT.MESSAGE.MENU.DELETE')}\r\n          </span>\r\n          <ListItemIcon className={classes.flexEnd}>\r\n            <DeleteIcon fontSize=\"small\" />\r\n          </ListItemIcon>\r\n        </MenuItem>\r\n      </Menu>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default Room;\r\n","import React, { useMemo } from 'react';\r\nimport {\r\n  Avatar,\r\n  Badge,\r\n  Box,\r\n  Chip,\r\n  ListItemAvatar,\r\n  ListItemButton,\r\n  ListItemText,\r\n} from '@mui/material';\r\nimport { Theme } from '@mui/material/styles';\r\nimport { makeStyles, createStyles, withStyles } from '@mui/styles';\r\n\r\nimport GroupIcon from '@mui/icons-material/Group';\r\nimport {\r\n  combineURLs,\r\n  formatTime,\r\n  getChatName,\r\n} from '../utils/common';\r\nimport { useTranslation } from 'react-i18next';\r\nimport {\r\n  ChatMessage,\r\n  ChatRoom,\r\n  Contact,\r\n  Group,\r\n  SetTyping,\r\n} from '../types';\r\n\r\ntype RoomListItemProps = {\r\n  apiUrl: string;\r\n  chat: ChatRoom;\r\n  active: boolean;\r\n  typing: SetTyping | null;\r\n  onClick: React.MouseEventHandler<HTMLDivElement> | undefined;\r\n};\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    main: {\r\n      flex: '1 1 auto',\r\n      whiteSpace: 'nowrap',\r\n      overflow: 'hidden',\r\n      textOverflow: 'ellipsis',\r\n    },\r\n    time: {\r\n      paddingLeft: theme.spacing(1),\r\n      justifyContent: 'flex-end',\r\n      whiteSpace: 'nowrap',\r\n    },\r\n    unread: {\r\n      justifyContent: 'flex-end',\r\n      maxHeight: 20,\r\n    },\r\n    avatarGroup: {\r\n      backgroundColor: '#28B7C6',\r\n      color: '#fff',\r\n    },\r\n  }),\r\n);\r\n\r\nconst getMessageText = (\r\n  message: ChatMessage | null,\r\n  t: (key: string) => string,\r\n) => {\r\n  if (!message) return null;\r\n  switch (message.messageType) {\r\n    case 'text':\r\n      return message.content;\r\n    case 'image':\r\n      return `[${t('CHAT.MESSAGE.TYPE.IMAGE')}]`;\r\n    case 'video':\r\n      return `[${t('CHAT.MESSAGE.TYPE.VIDEO')}]`;\r\n    case 'file':\r\n      return `[${t('CHAT.MESSAGE.TYPE.FILE')}]`;\r\n    case 'notify':\r\n      return `[${t('CHAT.MESSAGE.TYPE.NOTIFY')}]`;\r\n    default:\r\n      return null;\r\n  }\r\n};\r\n\r\nconst TypingBadge = withStyles((theme: Theme) =>\r\n  createStyles({\r\n    badge: {\r\n      backgroundColor: '#44b700',\r\n      color: '#44b700',\r\n      boxShadow: `0 0 0 2px ${theme.palette.background.paper}`,\r\n      '&::after': {\r\n        position: 'absolute',\r\n        top: 0,\r\n        left: 0,\r\n        width: '100%',\r\n        height: '100%',\r\n        borderRadius: '50%',\r\n        animation: '$ripple 1.2s infinite ease-in-out',\r\n        border: '1px solid currentColor',\r\n        content: '\"\"',\r\n      },\r\n    },\r\n    '@keyframes ripple': {\r\n      '0%': {\r\n        transform: 'scale(.8)',\r\n        opacity: 1,\r\n      },\r\n      '100%': {\r\n        transform: 'scale(2.4)',\r\n        opacity: 0,\r\n      },\r\n    },\r\n  }),\r\n)(Badge);\r\n\r\nconst OnlineBadge = withStyles((theme: Theme) =>\r\n  createStyles({\r\n    badge: {\r\n      backgroundColor: theme.palette.primary.main,\r\n      boxShadow: `0 0 0 2px ${theme.palette.background.paper}`,\r\n    },\r\n  }),\r\n)(Badge);\r\n\r\nconst contactAvatar = (\r\n  apiUrl: string,\r\n  contact: Contact,\r\n  typing: SetTyping | null,\r\n): React.JSX.Element => {\r\n  const avatar = (\r\n    <Avatar\r\n      alt={contact.username}\r\n      src={contact.avatar ? combineURLs(apiUrl, contact.avatar) : ''}\r\n    />\r\n  );\r\n\r\n  const isTyping =\r\n    !!typing?.contactId && typing?.userId === contact.userId;\r\n  if (isTyping)\r\n    return (\r\n      <TypingBadge\r\n        overlap=\"circular\"\r\n        anchorOrigin={{\r\n          vertical: 'bottom',\r\n          horizontal: 'right',\r\n        }}\r\n        variant=\"dot\"\r\n      >\r\n        {avatar}\r\n      </TypingBadge>\r\n    );\r\n\r\n  if (contact?.online)\r\n    return (\r\n      <OnlineBadge\r\n        overlap=\"circular\"\r\n        anchorOrigin={{\r\n          vertical: 'bottom',\r\n          horizontal: 'right',\r\n        }}\r\n        variant=\"dot\"\r\n      >\r\n        {avatar}\r\n      </OnlineBadge>\r\n    );\r\n\r\n  return avatar;\r\n};\r\n\r\nconst RoomListItem: React.FC<RoomListItemProps> = (\r\n  props: RoomListItemProps,\r\n) => {\r\n  const classes = useStyles();\r\n  const { t } = useTranslation();\r\n  const { apiUrl, chat, typing } = props;\r\n  const roomName = getChatName(chat);\r\n\r\n  const avatar = (chat as Group).groupId ? (\r\n    <Avatar alt={roomName} className={classes.avatarGroup}>\r\n      <GroupIcon />{' '}\r\n    </Avatar>\r\n  ) : (\r\n    contactAvatar(apiUrl, chat as Contact, typing)\r\n  );\r\n\r\n  const lastMessage =\r\n    chat.messages && chat.messages.length > 0\r\n      ? chat.messages[chat.messages.length - 1]\r\n      : null;\r\n\r\n  const roomText = getMessageText(lastMessage, t);\r\n  const roomTime = lastMessage?.cdate;\r\n\r\n  const listItem = useMemo(\r\n    () => (\r\n      <ListItemButton selected={props.active} onClick={props.onClick}>\r\n        <ListItemAvatar>{avatar}</ListItemAvatar>\r\n        <ListItemText\r\n          secondaryTypographyProps={{ component: 'span' }}\r\n          primary={\r\n            <Box display=\"flex\" flexDirection=\"row\">\r\n              <span className={classes.main}>{roomName}</span>\r\n              <span className={classes.time}>\r\n                {formatTime(roomTime)}\r\n              </span>\r\n            </Box>\r\n          }\r\n          secondary={\r\n            <Box display=\"flex\" flexDirection=\"row\">\r\n              <span className={classes.main}>{roomText}</span>\r\n              {chat.unreadCount ? (\r\n                <Chip\r\n                  className={classes.unread}\r\n                  component=\"span\"\r\n                  size=\"small\"\r\n                  color=\"primary\"\r\n                  label={chat.unreadCount}\r\n                />\r\n              ) : null}\r\n            </Box>\r\n          }\r\n        />\r\n      </ListItemButton>\r\n    ),\r\n    [chat.messages?.length],\r\n  );\r\n  return listItem;\r\n};\r\nexport default RoomListItem;\r\n","import React from 'react';\r\nimport List from '@mui/material/List';\r\nimport { Theme } from '@mui/material/styles';\r\n\r\nimport { Card, CardHeader, Divider, TextField } from '@mui/material';\r\nimport RoomListItem from './RoomListItem';\r\nimport {\r\n  chatRoomComparer,\r\n  getChatId,\r\n  getChatName,\r\n  isEmpty,\r\n} from '../utils/common';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { ChatRoom, Contact, Group, SetTyping, User } from '../types';\r\nimport { makeStyles } from '@mui/styles';\r\n\r\nconst useStyles = makeStyles((theme: Theme) => ({\r\n  root: {\r\n    width: '100%',\r\n    height: '100%',\r\n  },\r\n  searchField: {\r\n    width: '100%',\r\n  },\r\n  listStyle: {\r\n    height: '89.5%',\r\n    overflowY: 'auto',\r\n    scrollbarWidth: 'thin',\r\n    scrollbarColor: `${theme.palette.primary.light} #fff`,\r\n  },\r\n}));\r\n\r\ntype RoomListProps = {\r\n  apiUrl: string;\r\n  user: User;\r\n  activeRoom: ChatRoom | null;\r\n  groups: Group[];\r\n  contacts: Contact[];\r\n  typing: SetTyping | null;\r\n  onChangeChat?: (chat: ChatRoom) => void;\r\n};\r\n\r\nconst filterChats = (\r\n  chats: ChatRoom[],\r\n  filter: string | null,\r\n): ChatRoom[] => {\r\n  if (filter === null) return chats;\r\n  const lowerFilter = filter.toLowerCase();\r\n  return chats.filter(\r\n    chat =>\r\n      getChatName(chat)\r\n        .toLowerCase()\r\n        .indexOf(lowerFilter.toLowerCase()) !== -1,\r\n  );\r\n};\r\n\r\nconst sortChats = (\r\n  userId: number,\r\n  groups: ChatRoom[],\r\n  contacts: ChatRoom[],\r\n) => {\r\n  let roomArr = [...groups, ...contacts];\r\n  //console.log('groups', groups, 'contacts', contacts);\r\n\r\n  // –°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–∫–Ω–æ —á–∞—Ç–∞ (–ø–æ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π)\r\n  roomArr = roomArr.sort(chatRoomComparer);\r\n\r\n  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–ø–∏—Å–æ–∫, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –∑–∞–∫—Ä–µ–ø–∏—Ç—å\r\n  const topChatId = localStorage.getItem(\r\n    `${userId}-topChatId`,\r\n  ) as string;\r\n  if (topChatId) {\r\n    const chat = roomArr.find(c => getChatId(c) === topChatId);\r\n    if (chat) {\r\n      // –ù–∞ –ø–µ—Ä–≤–æ–µ –º–µ—Å—Ç–æ\r\n      roomArr = roomArr.filter(k => getChatId(k) !== topChatId);\r\n      chat.isTop = true;\r\n      roomArr.unshift(chat);\r\n    }\r\n  }\r\n\r\n  return roomArr;\r\n};\r\n\r\nconst RoomList: React.FC<RoomListProps> = (props: RoomListProps) => {\r\n  const classes = useStyles();\r\n  const { t } = useTranslation();\r\n\r\n  const [chats, setChats] = React.useState<ChatRoom[]>(\r\n    sortChats(\r\n      props.user.userId,\r\n      filterChats(props.groups, null),\r\n      filterChats(props.contacts, null),\r\n    ),\r\n  );\r\n\r\n  const onSearchChange = (\r\n    e: React.ChangeEvent<HTMLInputElement>,\r\n  ): void => {\r\n    //console.log(\"e.target.value\", e.target.value);\r\n\r\n    setChats(\r\n      sortChats(\r\n        props.user.userId,\r\n        filterChats(props.groups, e.target.value),\r\n        filterChats(props.contacts, e.target.value),\r\n      ),\r\n    );\r\n  };\r\n  //const activeItem = (id: number) => id === props.activeRoom?.userId;\r\n\r\n  //console.log(\"chats\", chats);\r\n  const roomList = React.useMemo(\r\n    () =>\r\n      chats.map(chat => (\r\n        <RoomListItem\r\n          key={getChatId(chat)}\r\n          apiUrl={props.apiUrl}\r\n          chat={chat}\r\n          active={chat === props.activeRoom}\r\n          typing={props.typing}\r\n          onClick={() =>\r\n            props.onChangeChat != null && props.onChangeChat(chat)\r\n          }\r\n        />\r\n      )),\r\n    [props.activeRoom?.userId, props.typing],\r\n  );\r\n  return (\r\n    <Card elevation={1} className={classes.root}>\r\n      <CardHeader\r\n        title={\r\n          <TextField\r\n            className={classes.searchField}\r\n            label={t('CHAT.INPUT_SEARCH_CONTACT')}\r\n            variant=\"outlined\"\r\n            size=\"small\"\r\n            fullWidth\r\n            onChange={onSearchChange}\r\n          />\r\n        }\r\n      />\r\n      <Divider />\r\n      <List aria-label=\"rooms\" className={classes.listStyle}>\r\n        {roomList}\r\n      </List>\r\n    </Card>\r\n  );\r\n};\r\nexport default RoomList;\r\n","import React, { useEffect } from \"react\";\r\nimport { makeStyles } from \"@mui/styles\";\r\nimport { ConferenceData } from \"../types\";\r\nfunction updateUrlParameter(url: string, param: string, value: string) {\r\n  const regex = new RegExp(\"(\" + param + \"=)[^&]+\");\r\n  return url.replace(regex, \"$1\" + value);\r\n}\r\nconst transLang = (lang: string) =>\r\n  lang === \"ru\" ? \"rus\" : lang === \"fr\" ? \"fra\" : lang === \"en\" ? \"eng\" : \"\";\r\n\r\nconst useStyles = makeStyles(() => ({\r\n  root: {\r\n    width: \"100%\",\r\n    height: \"100%\",\r\n    borderRadius: 4\r\n  }\r\n}));\r\n\r\ntype ConferenceProps = {\r\n  conference: ConferenceData | null;\r\n  onClose: (conference: ConferenceData | null) => void;\r\n  langCode?: string | null;\r\n};\r\n\r\nconst Conference: React.FC<ConferenceProps> = ({\r\n  conference,\r\n  onClose,\r\n  langCode = \"en\"\r\n}: ConferenceProps) => {\r\n  const classes = useStyles();\r\n  const ref = React.useRef<HTMLIFrameElement>(null);\r\n  const confUrl =\r\n    conference?.url && langCode\r\n      ? updateUrlParameter(conference?.url, \"lang\", transLang(langCode))\r\n      : \"\";\r\n\r\n  useEffect(() => {\r\n    const listener = ({ source, data }: MessageEvent) => {\r\n      if (source === ref.current?.contentWindow) {\r\n        const { type } = data;\r\n\r\n        if (\r\n          [\r\n            \"notSupported\",\r\n            \"connectionFail\",\r\n            // \"loginFail\",\r\n            \"callFail\",\r\n            \"hangUp\",\r\n            \"remoteHangUp\"\r\n            // \"onParticipantLeft\"\r\n          ].includes(type)\r\n        )\r\n          onClose(conference);\r\n      }\r\n    };\r\n    window.addEventListener(\"message\", listener);\r\n    return () => {\r\n      window.removeEventListener(\"message\", listener);\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [conference?.id, langCode]);\r\n\r\n  return (\r\n    <iframe\r\n      title=\"conference\"\r\n      className={classes.root}\r\n      src={confUrl}\r\n      allowFullScreen\r\n      allow=\"microphone; camera; autoplay; display-capture\"\r\n      ref={ref}\r\n    />\r\n  );\r\n};\r\nexport default Conference;\r\n","import React from \"react\";\r\nimport { Avatar, Button, Paper } from \"@mui/material\";\r\nimport { ConferenceData, Contact } from \"../types\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { makeStyles } from \"@mui/styles\";\r\nimport { combineURLs } from \"../utils/common\";\r\n\r\nconst useStyles = makeStyles(() => ({\r\n  root: {\r\n    width: \"100%\",\r\n    height: \"100%\",\r\n    borderRadius: 8,\r\n    display: \"flex\",\r\n    flexDirection: \"column\",\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\"\r\n  },\r\n  pulse: {\r\n    height: 100,\r\n    width: 100,\r\n    borderRadius: \"50%\",\r\n    display: \"flex\",\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n    position: \"relative\",\r\n    \"&::before\": {\r\n      content: \"''\",\r\n      position: \"absolute\",\r\n      border: \"1px solid green\",\r\n      width: \"calc(100% + 40px)\",\r\n      height: \"calc(100% + 40px)\",\r\n      borderRadius: \"50%\",\r\n      animation: \"$pulse 1s linear infinite\"\r\n    },\r\n    \"&::after\": {\r\n      content: \"''\",\r\n      position: \"absolute\",\r\n      border: \"1px solid green\",\r\n      width: \"calc(100% + 40px)\",\r\n      height: \"calc(100% + 40px)\",\r\n      borderRadius: \"50%\",\r\n      animation: \"$pulse 1s linear infinite\",\r\n      animationDelay: \"0.3s\"\r\n    }\r\n  },\r\n  avatar: {\r\n    width: \"80%\",\r\n    height: \"80%\"\r\n  },\r\n  footer: {\r\n    width: \"100%\",\r\n    alignSelf: \"flex-end\",\r\n    paddingTop: 64,\r\n    display: \"flex\",\r\n    justifyContent: \"center\"\r\n  },\r\n  \"@keyframes pulse\": {\r\n    \"0%\": {\r\n      transform: \"scale(0.5)\",\r\n      opacity: 0\r\n    },\r\n    \"50%\": {\r\n      transform: \"scale(1)\",\r\n      opacity: 1\r\n    },\r\n    \"100%\": {\r\n      transform: \"scale(1.3)\",\r\n      opacity: 0\r\n    }\r\n  }\r\n}));\r\n\r\ntype ConferenceCallProps = {\r\n  conference: ConferenceData;\r\n  contact: Contact;\r\n  apiUrl: string;\r\n  onAccept: (conference: ConferenceData) => void;\r\n};\r\n\r\nconst ConferenceCall: React.FC<ConferenceCallProps> = ({\r\n  conference,\r\n  contact,\r\n  apiUrl,\r\n  onAccept\r\n}: ConferenceCallProps) => {\r\n  const classes = useStyles();\r\n  const { t } = useTranslation();\r\n\r\n  return (\r\n    <Paper className={classes.root}>\r\n      <div className={classes.pulse}>\r\n        {contact ? (\r\n          <Avatar\r\n            className={classes.avatar}\r\n            alt={contact.username}\r\n            src={contact.avatar ? combineURLs(apiUrl, contact.avatar) : \"\"}\r\n          />\r\n        ) : (\r\n          <Avatar className={classes.avatar} />\r\n        )}\r\n      </div>\r\n      <div className={classes.footer}>\r\n        <Button\r\n          variant=\"contained\"\r\n          color=\"primary\"\r\n          onClick={() => onAccept(conference)}\r\n        >\r\n          {t(\"CHAT.CONFERENCE.JOIN\")}\r\n        </Button>\r\n      </div>\r\n    </Paper>\r\n  );\r\n};\r\n\r\nexport default ConferenceCall;\r\n","/**\n * Copyright (c) 2014-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nvar runtime = (function (exports) {\n  \"use strict\";\n\n  var Op = Object.prototype;\n  var hasOwn = Op.hasOwnProperty;\n  var undefined; // More compressible than void 0.\n  var $Symbol = typeof Symbol === \"function\" ? Symbol : {};\n  var iteratorSymbol = $Symbol.iterator || \"@@iterator\";\n  var asyncIteratorSymbol = $Symbol.asyncIterator || \"@@asyncIterator\";\n  var toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\";\n\n  function define(obj, key, value) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n    return obj[key];\n  }\n  try {\n    // IE 8 has a broken Object.defineProperty that only works on DOM objects.\n    define({}, \"\");\n  } catch (err) {\n    define = function(obj, key, value) {\n      return obj[key] = value;\n    };\n  }\n\n  function wrap(innerFn, outerFn, self, tryLocsList) {\n    // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.\n    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;\n    var generator = Object.create(protoGenerator.prototype);\n    var context = new Context(tryLocsList || []);\n\n    // The ._invoke method unifies the implementations of the .next,\n    // .throw, and .return methods.\n    generator._invoke = makeInvokeMethod(innerFn, self, context);\n\n    return generator;\n  }\n  exports.wrap = wrap;\n\n  // Try/catch helper to minimize deoptimizations. Returns a completion\n  // record like context.tryEntries[i].completion. This interface could\n  // have been (and was previously) designed to take a closure to be\n  // invoked without arguments, but in all the cases we care about we\n  // already have an existing method we want to call, so there's no need\n  // to create a new function object. We can even get away with assuming\n  // the method takes exactly one argument, since that happens to be true\n  // in every case, so we don't have to touch the arguments object. The\n  // only additional allocation required is the completion record, which\n  // has a stable shape and so hopefully should be cheap to allocate.\n  function tryCatch(fn, obj, arg) {\n    try {\n      return { type: \"normal\", arg: fn.call(obj, arg) };\n    } catch (err) {\n      return { type: \"throw\", arg: err };\n    }\n  }\n\n  var GenStateSuspendedStart = \"suspendedStart\";\n  var GenStateSuspendedYield = \"suspendedYield\";\n  var GenStateExecuting = \"executing\";\n  var GenStateCompleted = \"completed\";\n\n  // Returning this object from the innerFn has the same effect as\n  // breaking out of the dispatch switch statement.\n  var ContinueSentinel = {};\n\n  // Dummy constructor functions that we use as the .constructor and\n  // .constructor.prototype properties for functions that return Generator\n  // objects. For full spec compliance, you may wish to configure your\n  // minifier not to mangle the names of these two functions.\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n\n  // This is a polyfill for %IteratorPrototype% for environments that\n  // don't natively support it.\n  var IteratorPrototype = {};\n  define(IteratorPrototype, iteratorSymbol, function () {\n    return this;\n  });\n\n  var getProto = Object.getPrototypeOf;\n  var NativeIteratorPrototype = getProto && getProto(getProto(values([])));\n  if (NativeIteratorPrototype &&\n      NativeIteratorPrototype !== Op &&\n      hasOwn.call(NativeIteratorPrototype, iteratorSymbol)) {\n    // This environment has a native %IteratorPrototype%; use it instead\n    // of the polyfill.\n    IteratorPrototype = NativeIteratorPrototype;\n  }\n\n  var Gp = GeneratorFunctionPrototype.prototype =\n    Generator.prototype = Object.create(IteratorPrototype);\n  GeneratorFunction.prototype = GeneratorFunctionPrototype;\n  define(Gp, \"constructor\", GeneratorFunctionPrototype);\n  define(GeneratorFunctionPrototype, \"constructor\", GeneratorFunction);\n  GeneratorFunction.displayName = define(\n    GeneratorFunctionPrototype,\n    toStringTagSymbol,\n    \"GeneratorFunction\"\n  );\n\n  // Helper for defining the .next, .throw, and .return methods of the\n  // Iterator interface in terms of a single ._invoke method.\n  function defineIteratorMethods(prototype) {\n    [\"next\", \"throw\", \"return\"].forEach(function(method) {\n      define(prototype, method, function(arg) {\n        return this._invoke(method, arg);\n      });\n    });\n  }\n\n  exports.isGeneratorFunction = function(genFun) {\n    var ctor = typeof genFun === \"function\" && genFun.constructor;\n    return ctor\n      ? ctor === GeneratorFunction ||\n        // For the native GeneratorFunction constructor, the best we can\n        // do is to check its .name property.\n        (ctor.displayName || ctor.name) === \"GeneratorFunction\"\n      : false;\n  };\n\n  exports.mark = function(genFun) {\n    if (Object.setPrototypeOf) {\n      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);\n    } else {\n      genFun.__proto__ = GeneratorFunctionPrototype;\n      define(genFun, toStringTagSymbol, \"GeneratorFunction\");\n    }\n    genFun.prototype = Object.create(Gp);\n    return genFun;\n  };\n\n  // Within the body of any async function, `await x` is transformed to\n  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test\n  // `hasOwn.call(value, \"__await\")` to determine if the yielded value is\n  // meant to be awaited.\n  exports.awrap = function(arg) {\n    return { __await: arg };\n  };\n\n  function AsyncIterator(generator, PromiseImpl) {\n    function invoke(method, arg, resolve, reject) {\n      var record = tryCatch(generator[method], generator, arg);\n      if (record.type === \"throw\") {\n        reject(record.arg);\n      } else {\n        var result = record.arg;\n        var value = result.value;\n        if (value &&\n            typeof value === \"object\" &&\n            hasOwn.call(value, \"__await\")) {\n          return PromiseImpl.resolve(value.__await).then(function(value) {\n            invoke(\"next\", value, resolve, reject);\n          }, function(err) {\n            invoke(\"throw\", err, resolve, reject);\n          });\n        }\n\n        return PromiseImpl.resolve(value).then(function(unwrapped) {\n          // When a yielded Promise is resolved, its final value becomes\n          // the .value of the Promise<{value,done}> result for the\n          // current iteration.\n          result.value = unwrapped;\n          resolve(result);\n        }, function(error) {\n          // If a rejected Promise was yielded, throw the rejection back\n          // into the async generator function so it can be handled there.\n          return invoke(\"throw\", error, resolve, reject);\n        });\n      }\n    }\n\n    var previousPromise;\n\n    function enqueue(method, arg) {\n      function callInvokeWithMethodAndArg() {\n        return new PromiseImpl(function(resolve, reject) {\n          invoke(method, arg, resolve, reject);\n        });\n      }\n\n      return previousPromise =\n        // If enqueue has been called before, then we want to wait until\n        // all previous Promises have been resolved before calling invoke,\n        // so that results are always delivered in the correct order. If\n        // enqueue has not been called before, then it is important to\n        // call invoke immediately, without waiting on a callback to fire,\n        // so that the async generator function has the opportunity to do\n        // any necessary setup in a predictable way. This predictability\n        // is why the Promise constructor synchronously invokes its\n        // executor callback, and why async functions synchronously\n        // execute code before the first await. Since we implement simple\n        // async functions in terms of async generators, it is especially\n        // important to get this right, even though it requires care.\n        previousPromise ? previousPromise.then(\n          callInvokeWithMethodAndArg,\n          // Avoid propagating failures to Promises returned by later\n          // invocations of the iterator.\n          callInvokeWithMethodAndArg\n        ) : callInvokeWithMethodAndArg();\n    }\n\n    // Define the unified helper method that is used to implement .next,\n    // .throw, and .return (see defineIteratorMethods).\n    this._invoke = enqueue;\n  }\n\n  defineIteratorMethods(AsyncIterator.prototype);\n  define(AsyncIterator.prototype, asyncIteratorSymbol, function () {\n    return this;\n  });\n  exports.AsyncIterator = AsyncIterator;\n\n  // Note that simple async functions are implemented on top of\n  // AsyncIterator objects; they just return a Promise for the value of\n  // the final result produced by the iterator.\n  exports.async = function(innerFn, outerFn, self, tryLocsList, PromiseImpl) {\n    if (PromiseImpl === void 0) PromiseImpl = Promise;\n\n    var iter = new AsyncIterator(\n      wrap(innerFn, outerFn, self, tryLocsList),\n      PromiseImpl\n    );\n\n    return exports.isGeneratorFunction(outerFn)\n      ? iter // If outerFn is a generator, return the full iterator.\n      : iter.next().then(function(result) {\n          return result.done ? result.value : iter.next();\n        });\n  };\n\n  function makeInvokeMethod(innerFn, self, context) {\n    var state = GenStateSuspendedStart;\n\n    return function invoke(method, arg) {\n      if (state === GenStateExecuting) {\n        throw new Error(\"Generator is already running\");\n      }\n\n      if (state === GenStateCompleted) {\n        if (method === \"throw\") {\n          throw arg;\n        }\n\n        // Be forgiving, per 25.3.3.3.3 of the spec:\n        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume\n        return doneResult();\n      }\n\n      context.method = method;\n      context.arg = arg;\n\n      while (true) {\n        var delegate = context.delegate;\n        if (delegate) {\n          var delegateResult = maybeInvokeDelegate(delegate, context);\n          if (delegateResult) {\n            if (delegateResult === ContinueSentinel) continue;\n            return delegateResult;\n          }\n        }\n\n        if (context.method === \"next\") {\n          // Setting context._sent for legacy support of Babel's\n          // function.sent implementation.\n          context.sent = context._sent = context.arg;\n\n        } else if (context.method === \"throw\") {\n          if (state === GenStateSuspendedStart) {\n            state = GenStateCompleted;\n            throw context.arg;\n          }\n\n          context.dispatchException(context.arg);\n\n        } else if (context.method === \"return\") {\n          context.abrupt(\"return\", context.arg);\n        }\n\n        state = GenStateExecuting;\n\n        var record = tryCatch(innerFn, self, context);\n        if (record.type === \"normal\") {\n          // If an exception is thrown from innerFn, we leave state ===\n          // GenStateExecuting and loop back for another invocation.\n          state = context.done\n            ? GenStateCompleted\n            : GenStateSuspendedYield;\n\n          if (record.arg === ContinueSentinel) {\n            continue;\n          }\n\n          return {\n            value: record.arg,\n            done: context.done\n          };\n\n        } else if (record.type === \"throw\") {\n          state = GenStateCompleted;\n          // Dispatch the exception by looping back around to the\n          // context.dispatchException(context.arg) call above.\n          context.method = \"throw\";\n          context.arg = record.arg;\n        }\n      }\n    };\n  }\n\n  // Call delegate.iterator[context.method](context.arg) and handle the\n  // result, either by returning a { value, done } result from the\n  // delegate iterator, or by modifying context.method and context.arg,\n  // setting context.delegate to null, and returning the ContinueSentinel.\n  function maybeInvokeDelegate(delegate, context) {\n    var method = delegate.iterator[context.method];\n    if (method === undefined) {\n      // A .throw or .return when the delegate iterator has no .throw\n      // method always terminates the yield* loop.\n      context.delegate = null;\n\n      if (context.method === \"throw\") {\n        // Note: [\"return\"] must be used for ES3 parsing compatibility.\n        if (delegate.iterator[\"return\"]) {\n          // If the delegate iterator has a return method, give it a\n          // chance to clean up.\n          context.method = \"return\";\n          context.arg = undefined;\n          maybeInvokeDelegate(delegate, context);\n\n          if (context.method === \"throw\") {\n            // If maybeInvokeDelegate(context) changed context.method from\n            // \"return\" to \"throw\", let that override the TypeError below.\n            return ContinueSentinel;\n          }\n        }\n\n        context.method = \"throw\";\n        context.arg = new TypeError(\n          \"The iterator does not provide a 'throw' method\");\n      }\n\n      return ContinueSentinel;\n    }\n\n    var record = tryCatch(method, delegate.iterator, context.arg);\n\n    if (record.type === \"throw\") {\n      context.method = \"throw\";\n      context.arg = record.arg;\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    var info = record.arg;\n\n    if (! info) {\n      context.method = \"throw\";\n      context.arg = new TypeError(\"iterator result is not an object\");\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    if (info.done) {\n      // Assign the result of the finished delegate to the temporary\n      // variable specified by delegate.resultName (see delegateYield).\n      context[delegate.resultName] = info.value;\n\n      // Resume execution at the desired location (see delegateYield).\n      context.next = delegate.nextLoc;\n\n      // If context.method was \"throw\" but the delegate handled the\n      // exception, let the outer generator proceed normally. If\n      // context.method was \"next\", forget context.arg since it has been\n      // \"consumed\" by the delegate iterator. If context.method was\n      // \"return\", allow the original .return call to continue in the\n      // outer generator.\n      if (context.method !== \"return\") {\n        context.method = \"next\";\n        context.arg = undefined;\n      }\n\n    } else {\n      // Re-yield the result returned by the delegate method.\n      return info;\n    }\n\n    // The delegate iterator is finished, so forget it and continue with\n    // the outer generator.\n    context.delegate = null;\n    return ContinueSentinel;\n  }\n\n  // Define Generator.prototype.{next,throw,return} in terms of the\n  // unified ._invoke helper method.\n  defineIteratorMethods(Gp);\n\n  define(Gp, toStringTagSymbol, \"Generator\");\n\n  // A Generator should always return itself as the iterator object when the\n  // @@iterator function is called on it. Some browsers' implementations of the\n  // iterator prototype chain incorrectly implement this, causing the Generator\n  // object to not be returned from this call. This ensures that doesn't happen.\n  // See https://github.com/facebook/regenerator/issues/274 for more details.\n  define(Gp, iteratorSymbol, function() {\n    return this;\n  });\n\n  define(Gp, \"toString\", function() {\n    return \"[object Generator]\";\n  });\n\n  function pushTryEntry(locs) {\n    var entry = { tryLoc: locs[0] };\n\n    if (1 in locs) {\n      entry.catchLoc = locs[1];\n    }\n\n    if (2 in locs) {\n      entry.finallyLoc = locs[2];\n      entry.afterLoc = locs[3];\n    }\n\n    this.tryEntries.push(entry);\n  }\n\n  function resetTryEntry(entry) {\n    var record = entry.completion || {};\n    record.type = \"normal\";\n    delete record.arg;\n    entry.completion = record;\n  }\n\n  function Context(tryLocsList) {\n    // The root entry object (effectively a try statement without a catch\n    // or a finally block) gives us a place to store values thrown from\n    // locations where there is no enclosing try statement.\n    this.tryEntries = [{ tryLoc: \"root\" }];\n    tryLocsList.forEach(pushTryEntry, this);\n    this.reset(true);\n  }\n\n  exports.keys = function(object) {\n    var keys = [];\n    for (var key in object) {\n      keys.push(key);\n    }\n    keys.reverse();\n\n    // Rather than returning an object with a next method, we keep\n    // things simple and return the next function itself.\n    return function next() {\n      while (keys.length) {\n        var key = keys.pop();\n        if (key in object) {\n          next.value = key;\n          next.done = false;\n          return next;\n        }\n      }\n\n      // To avoid creating an additional object, we just hang the .value\n      // and .done properties off the next function object itself. This\n      // also ensures that the minifier will not anonymize the function.\n      next.done = true;\n      return next;\n    };\n  };\n\n  function values(iterable) {\n    if (iterable) {\n      var iteratorMethod = iterable[iteratorSymbol];\n      if (iteratorMethod) {\n        return iteratorMethod.call(iterable);\n      }\n\n      if (typeof iterable.next === \"function\") {\n        return iterable;\n      }\n\n      if (!isNaN(iterable.length)) {\n        var i = -1, next = function next() {\n          while (++i < iterable.length) {\n            if (hasOwn.call(iterable, i)) {\n              next.value = iterable[i];\n              next.done = false;\n              return next;\n            }\n          }\n\n          next.value = undefined;\n          next.done = true;\n\n          return next;\n        };\n\n        return next.next = next;\n      }\n    }\n\n    // Return an iterator with no values.\n    return { next: doneResult };\n  }\n  exports.values = values;\n\n  function doneResult() {\n    return { value: undefined, done: true };\n  }\n\n  Context.prototype = {\n    constructor: Context,\n\n    reset: function(skipTempReset) {\n      this.prev = 0;\n      this.next = 0;\n      // Resetting context._sent for legacy support of Babel's\n      // function.sent implementation.\n      this.sent = this._sent = undefined;\n      this.done = false;\n      this.delegate = null;\n\n      this.method = \"next\";\n      this.arg = undefined;\n\n      this.tryEntries.forEach(resetTryEntry);\n\n      if (!skipTempReset) {\n        for (var name in this) {\n          // Not sure about the optimal order of these conditions:\n          if (name.charAt(0) === \"t\" &&\n              hasOwn.call(this, name) &&\n              !isNaN(+name.slice(1))) {\n            this[name] = undefined;\n          }\n        }\n      }\n    },\n\n    stop: function() {\n      this.done = true;\n\n      var rootEntry = this.tryEntries[0];\n      var rootRecord = rootEntry.completion;\n      if (rootRecord.type === \"throw\") {\n        throw rootRecord.arg;\n      }\n\n      return this.rval;\n    },\n\n    dispatchException: function(exception) {\n      if (this.done) {\n        throw exception;\n      }\n\n      var context = this;\n      function handle(loc, caught) {\n        record.type = \"throw\";\n        record.arg = exception;\n        context.next = loc;\n\n        if (caught) {\n          // If the dispatched exception was caught by a catch block,\n          // then let that catch block handle the exception normally.\n          context.method = \"next\";\n          context.arg = undefined;\n        }\n\n        return !! caught;\n      }\n\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        var record = entry.completion;\n\n        if (entry.tryLoc === \"root\") {\n          // Exception thrown outside of any try block that could handle\n          // it, so set the completion value of the entire function to\n          // throw the exception.\n          return handle(\"end\");\n        }\n\n        if (entry.tryLoc <= this.prev) {\n          var hasCatch = hasOwn.call(entry, \"catchLoc\");\n          var hasFinally = hasOwn.call(entry, \"finallyLoc\");\n\n          if (hasCatch && hasFinally) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            } else if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else if (hasCatch) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            }\n\n          } else if (hasFinally) {\n            if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else {\n            throw new Error(\"try statement without catch or finally\");\n          }\n        }\n      }\n    },\n\n    abrupt: function(type, arg) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc <= this.prev &&\n            hasOwn.call(entry, \"finallyLoc\") &&\n            this.prev < entry.finallyLoc) {\n          var finallyEntry = entry;\n          break;\n        }\n      }\n\n      if (finallyEntry &&\n          (type === \"break\" ||\n           type === \"continue\") &&\n          finallyEntry.tryLoc <= arg &&\n          arg <= finallyEntry.finallyLoc) {\n        // Ignore the finally entry if control is not jumping to a\n        // location outside the try/catch block.\n        finallyEntry = null;\n      }\n\n      var record = finallyEntry ? finallyEntry.completion : {};\n      record.type = type;\n      record.arg = arg;\n\n      if (finallyEntry) {\n        this.method = \"next\";\n        this.next = finallyEntry.finallyLoc;\n        return ContinueSentinel;\n      }\n\n      return this.complete(record);\n    },\n\n    complete: function(record, afterLoc) {\n      if (record.type === \"throw\") {\n        throw record.arg;\n      }\n\n      if (record.type === \"break\" ||\n          record.type === \"continue\") {\n        this.next = record.arg;\n      } else if (record.type === \"return\") {\n        this.rval = this.arg = record.arg;\n        this.method = \"return\";\n        this.next = \"end\";\n      } else if (record.type === \"normal\" && afterLoc) {\n        this.next = afterLoc;\n      }\n\n      return ContinueSentinel;\n    },\n\n    finish: function(finallyLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.finallyLoc === finallyLoc) {\n          this.complete(entry.completion, entry.afterLoc);\n          resetTryEntry(entry);\n          return ContinueSentinel;\n        }\n      }\n    },\n\n    \"catch\": function(tryLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc === tryLoc) {\n          var record = entry.completion;\n          if (record.type === \"throw\") {\n            var thrown = record.arg;\n            resetTryEntry(entry);\n          }\n          return thrown;\n        }\n      }\n\n      // The context.catch method must only be called with a location\n      // argument that corresponds to a known catch block.\n      throw new Error(\"illegal catch attempt\");\n    },\n\n    delegateYield: function(iterable, resultName, nextLoc) {\n      this.delegate = {\n        iterator: values(iterable),\n        resultName: resultName,\n        nextLoc: nextLoc\n      };\n\n      if (this.method === \"next\") {\n        // Deliberately forget the last sent value so that we don't\n        // accidentally pass it on to the delegate.\n        this.arg = undefined;\n      }\n\n      return ContinueSentinel;\n    }\n  };\n\n  // Regardless of whether this script is executing as a CommonJS module\n  // or not, return the runtime object so that we can declare the variable\n  // regeneratorRuntime in the outer scope, which allows this module to be\n  // injected easily by `bin/regenerator --include-runtime script.js`.\n  return exports;\n\n}(\n  // If this script is executing as a CommonJS module, use module.exports\n  // as the regeneratorRuntime namespace. Otherwise create a new empty\n  // object. Either way, the resulting object will be used to initialize\n  // the regeneratorRuntime variable at the top of this file.\n  typeof module === \"object\" ? module.exports : {}\n));\n\ntry {\n  regeneratorRuntime = runtime;\n} catch (accidentalStrictMode) {\n  // This module should not be running in strict mode, so the above\n  // assignment should always work unless something is misconfigured. Just\n  // in case runtime.js accidentally runs in strict mode, in modern engines\n  // we can explicitly access globalThis. In older engines we can escape\n  // strict mode using a global Function call. This could conceivably fail\n  // if a Content Security Policy forbids using Function, but in that case\n  // the proper solution is to fix the accidental strict mode problem. If\n  // you've misconfigured your bundler to force strict mode and applied a\n  // CSP to forbid Function, and you're not willing to fix either of those\n  // problems, please detail your unique predicament in a GitHub issue.\n  if (typeof globalThis === \"object\") {\n    globalThis.regeneratorRuntime = runtime;\n  } else {\n    Function(\"r\", \"regeneratorRuntime = r\")(runtime);\n  }\n}\n","import React, {\r\n  createContext,\r\n  useCallback,\r\n  useContext,\r\n  useMemo,\r\n} from 'react';\r\nimport { ChatContext, ChatDispatch } from './ChatContext';\r\nimport axios, { AxiosError, AxiosInstance } from 'axios';\r\nimport {\r\n  Contact,\r\n  Group,\r\n  PagingResponse,\r\n  PrivateMessage,\r\n} from '../types';\r\n\r\nexport interface IRestContext {\r\n  apiUrl: string;\r\n  pageSize: number;\r\n  fetch: AxiosInstance | null;\r\n  getPrivateMessages: (chat: Contact) => Promise<void>;\r\n  getGroupMessages: (chat: Group) => Promise<void>;\r\n  getUserByMmk: (\r\n    mmkId: string | null,\r\n    guid: string | null,\r\n  ) => Promise<number | undefined>;\r\n}\r\nconst initialContext = {} as IRestContext;\r\n\r\nexport const RestContext: React.Context<IRestContext> = createContext(\r\n  initialContext,\r\n);\r\n\r\ntype RestProviderProps = {\r\n  baseURLApi: string;\r\n  pageSize: number;\r\n  children: React.JSX.Element;\r\n};\r\n\r\nexport function clearLocalStorage() {\r\n  localStorage.removeItem('authToken');\r\n  localStorage.removeItem('refreshToken');\r\n  localStorage.removeItem('user');\r\n  localStorage.removeItem('doctor');\r\n  localStorage.removeItem('chatUser');\r\n}\r\nexport const signOut = async () => {\r\n  try {\r\n    await axios.post('auth/logout');\r\n  } catch (error) {\r\n    console.log('ERROR Logout', error);\r\n  }\r\n\r\n  clearLocalStorage();\r\n  window.location.href = '/';\r\n};\r\n\r\nexport const getRefreshToken = async (\r\n  authToken: string,\r\n  refreshToken: string,\r\n  dispatch: ChatDispatch,\r\n) => {\r\n  try {\r\n    const { data } = await axios.post('auth/refreshToken', {\r\n      authToken,\r\n      refreshToken,\r\n    });\r\n    localStorage.setItem('authToken', data?.authToken);\r\n    localStorage.setItem('refreshToken', data?.refreshToken);\r\n    window.location.href = '/';\r\n  } catch (error) {\r\n    console.log('ERROR RefreshToken', error);\r\n    dispatch({ type: 'CLEAR_USER' });\r\n    signOut();\r\n  }\r\n};\r\nexport const RestProvider: React.FC<RestProviderProps> = ({\r\n  baseURLApi,\r\n  pageSize,\r\n  children,\r\n}: RestProviderProps) => {\r\n  const { state, dispatch } = useContext(ChatContext);\r\n  const errorInterceptor = (error: AxiosError) => {\r\n    if (error.response != null && error.response.status === 401) {\r\n      getRefreshToken(state.token, state.refreshToken, dispatch);\r\n    }\r\n  };\r\n\r\n  const fetch: AxiosInstance = axios.create({\r\n    timeout: 60000, // –¢–∞–π–º–∞—É—Ç –º–∏–Ω—É—Ç–∞\r\n    baseURL: baseURLApi,\r\n    headers: {\r\n      'Cache-Control': 'no-cache',\r\n      Pragma: 'no-cache',\r\n      Authorization: `Bearer ${state.token}`,\r\n    },\r\n    withCredentials: false,\r\n  });\r\n\r\n  fetch.interceptors.response.use(\r\n    response => {\r\n      return response;\r\n    },\r\n    (error: AxiosError) => {\r\n      console.log('ERROR AxiosError');\r\n      errorInterceptor(error);\r\n      return Promise.reject(error);\r\n    },\r\n  );\r\n\r\n  const getPrivateMessages = useCallback(\r\n    async (chat: Contact, callback?: () => void) => {\r\n      const contactId = chat.userId;\r\n      const current = chat.messages?.length;\r\n      try {\r\n        dispatch({ type: 'SET_LOADING', payload: true });\r\n        const { data } = await fetch.get('/contact/messages', {\r\n          params: {\r\n            contactId,\r\n            current,\r\n            pageSize,\r\n          },\r\n        });\r\n\r\n        if (data) {\r\n          dispatch({\r\n            type: 'ADD_PRIVATE_MESSAGES',\r\n            payload: {\r\n              pageSize,\r\n              contactId,\r\n              messages: data as PrivateMessage[],\r\n            },\r\n          });\r\n          if (callback) {\r\n            callback();\r\n          }\r\n        }\r\n      } catch (error) {\r\n        const err = error as AxiosError;\r\n        dispatch({ type: 'SET_ERROR', payload: err.message });\r\n      } finally {\r\n        dispatch({ type: 'SET_LOADING', payload: false });\r\n      }\r\n    },\r\n    [dispatch],\r\n  );\r\n\r\n  const getGroupMessages = useCallback(\r\n    async (chat: Group) => {\r\n      const { groupId } = chat;\r\n      const current = chat.messages?.length;\r\n      try {\r\n        dispatch({ type: 'SET_LOADING', payload: true });\r\n        const { data }: { data: PagingResponse } = await fetch.get(\r\n          '/group/messages',\r\n          {\r\n            params: {\r\n              groupId,\r\n              current,\r\n              pageSize,\r\n            },\r\n          },\r\n        );\r\n        if (data) {\r\n          dispatch({\r\n            type: 'ADD_GROUP_MESSAGES',\r\n            payload: {\r\n              pageSize,\r\n              groupId,\r\n              ...data,\r\n            },\r\n          });\r\n        }\r\n      } catch (error) {\r\n        const err = error as AxiosError;\r\n        dispatch({ type: 'SET_ERROR', payload: err.message });\r\n      } finally {\r\n        dispatch({ type: 'SET_LOADING', payload: false });\r\n      }\r\n    },\r\n    [dispatch],\r\n  );\r\n\r\n  const getUserByMmk = async (\r\n    mmkId: string | null,\r\n    guid: string | null,\r\n  ) => {\r\n    try {\r\n      const { data }: { data: number } = await fetch.get(\r\n        '/contact/find',\r\n        {\r\n          params: {\r\n            mmkId,\r\n            guid,\r\n          },\r\n        },\r\n      );\r\n      if (data != null) {\r\n        return data;\r\n      }\r\n    } catch (error) {\r\n      console.log('err getUserByMmk', error);\r\n    }\r\n  };\r\n\r\n  const value = useMemo(\r\n    () => ({\r\n      apiUrl: baseURLApi,\r\n      pageSize,\r\n      fetch,\r\n      getPrivateMessages,\r\n      getGroupMessages,\r\n      getUserByMmk,\r\n    }),\r\n    [baseURLApi, pageSize],\r\n  );\r\n\r\n  return (\r\n    <RestContext.Provider value={value}>\r\n      {children}\r\n    </RestContext.Provider>\r\n  );\r\n};\r\n","import React, {\r\n  createContext,\r\n  useContext,\r\n  useEffect,\r\n  useMemo,\r\n} from 'react';\r\nimport { Socket } from 'socket.io-client';\r\nimport { useSocket } from '../hooks/useSocket';\r\nimport {\r\n  ChatData,\r\n  Contact,\r\n  Group,\r\n  GroupMessage,\r\n  JoinGroup,\r\n  MessageOperation,\r\n  PrivateMessage,\r\n  SetTyping,\r\n  User,\r\n  ConferenceData,\r\n  SetActiveRoom,\r\n  GroupMap,\r\n  VisitData,\r\n} from '../types';\r\nimport { ChatContext } from './ChatContext';\r\nimport { getRefreshToken } from './RestContext';\r\nimport { allMessCount } from '../utils/common';\r\n\r\n// –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞\r\ninterface ServerRes {\r\n  code: number;\r\n  msg: string;\r\n  data: unknown;\r\n}\r\n\r\nexport interface ISocketContext {\r\n  socket: Socket | null;\r\n  online: boolean;\r\n}\r\nconst initialContext = {\r\n  online: false,\r\n} as ISocketContext;\r\n\r\nexport const SocketContext: React.Context<ISocketContext> = createContext(\r\n  initialContext,\r\n);\r\n\r\ntype SocketProviderProps = {\r\n  wsUrl: string;\r\n  wsPath: string;\r\n  children: React.JSX.Element;\r\n};\r\n\r\nexport const SocketProvider: React.FC<SocketProviderProps> = ({\r\n  wsUrl,\r\n  wsPath,\r\n  children,\r\n}: SocketProviderProps) => {\r\n  const { state, dispatch } = useContext(ChatContext);\r\n  const {\r\n    socket,\r\n    online,\r\n    disconnectSocket,\r\n    connectSocket,\r\n  } = useSocket(wsUrl, wsPath, state.token);\r\n\r\n  useEffect(() => {\r\n    if (state.token) {\r\n      connectSocket();\r\n    }\r\n    if (!state.token) disconnectSocket();\r\n    return () => {\r\n      disconnectSocket();\r\n    };\r\n  }, [state.token]);\r\n\r\n  useEffect(() => {\r\n    // listen unauthorized event\r\n    const listener = (msg: string) => {\r\n      console.log('unauthorized msg', msg);\r\n      getRefreshToken(state.token, state.refreshToken, dispatch);\r\n    };\r\n    socket?.on('unauthorized', listener);\r\n\r\n    // listen chatData event\r\n    const listener1 = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n\r\n      const payload = res.data as ChatData;\r\n      const groupArr = payload.groupData;\r\n      const contactArr = payload.contactData;\r\n      const userArr = payload.userData;\r\n      dispatch({ type: 'CLEAR_CHAT_DATA' });\r\n      dispatch({ type: 'SET_USER', payload: payload.user });\r\n      if (groupArr.length) {\r\n        for (const group of groupArr) {\r\n          socket?.emit('joinGroupSocket', {\r\n            groupId: group.groupId,\r\n          });\r\n          dispatch({ type: 'SET_GROUP_GATHER', payload: group });\r\n        }\r\n      }\r\n      if (contactArr.length) {\r\n        for (const contact of contactArr) {\r\n          socket?.emit('joinPrivateSocket', {\r\n            contactId: contact.userId,\r\n          });\r\n          dispatch({ type: 'SET_CONTACT_GATHER', payload: contact });\r\n        }\r\n      }\r\n      dispatch({\r\n        type: 'SET_OPERATORS',\r\n        payload: payload.operatorData,\r\n      });\r\n      if (userArr.length) {\r\n        for (const user_ of userArr) {\r\n          dispatch({ type: 'SET_USER_GATHER', payload: user_ });\r\n        }\r\n      }\r\n      dispatch({ type: 'UPDATE_ACTIVE_ROOM' });\r\n      dispatch({\r\n        type: 'SET_CONFERENCE',\r\n        payload: payload.conferenceData,\r\n      });\r\n      dispatch({\r\n        type: 'SET_VISIT_DATA',\r\n        payload: payload.visitData,\r\n      });\r\n    };\r\n    socket?.on('chatData', listener1);\r\n\r\n    // listen user online\r\n    const listener2 = (res: ServerRes) => {\r\n      dispatch({ type: 'USER_ONLINE', payload: res.data as number });\r\n    };\r\n    socket?.on('userOnline', listener2);\r\n\r\n    // listen user offline\r\n    const listener3 = (res: ServerRes) => {\r\n      dispatch({ type: 'USER_OFFLINE', payload: res.data as number });\r\n    };\r\n    socket?.on('userOffline', listener3);\r\n\r\n    // listen private socket join\r\n    const listener4 = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      console.log('–£—Å–ø–µ—à–Ω–æ –≤–æ—à–µ–ª –≤ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π —á–∞—Ç');\r\n    };\r\n    socket?.on('joinPrivateSocket', listener4);\r\n\r\n    // typing\r\n    let timer: NodeJS.Timeout;\r\n    const listener5 = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      if (timer) clearTimeout(timer);\r\n      dispatch({\r\n        type: 'SET_TYPING',\r\n        payload: res.data as SetTyping,\r\n      });\r\n      timer = setTimeout(() => {\r\n        dispatch({ type: 'SET_TYPING', payload: null });\r\n      }, 1000);\r\n    };\r\n    socket?.on('typing', listener5);\r\n\r\n    // revoke\r\n    const listener6 = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      const data = res.data as MessageOperation;\r\n      dispatch({ type: 'REVOKE_MESSAGE', payload: data });\r\n    };\r\n    socket?.on('revokeMessage', listener6);\r\n\r\n    // set group gather\r\n    const listener7 = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      dispatch({\r\n        type: 'SET_GROUP_GATHER',\r\n        payload: res.data as Group,\r\n      });\r\n    };\r\n    socket?.on('addGroup', listener7);\r\n\r\n    // set contact gather, user gather\r\n    const listener8 = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      const data = res.data as Contact;\r\n      dispatch({ type: 'SET_CONTACT_GATHER', payload: data });\r\n      dispatch({ type: 'SET_USER_GATHER', payload: data });\r\n      socket?.emit('joinPrivateSocket', {\r\n        contactId: data.userId,\r\n      });\r\n    };\r\n    socket?.on('addContact', listener8);\r\n\r\n    // delete contact\r\n    const listener10 = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      const data = res.data as Contact;\r\n      dispatch({ type: 'DEL_CONTACT', payload: data });\r\n    };\r\n    socket?.on('deleteContact', listener10);\r\n\r\n    // update GroupInfo\r\n    const listener11 = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      const data = res.data as Group;\r\n      dispatch({ type: 'UPDATE_GROUP_INFO', payload: data });\r\n    };\r\n    socket?.on('updateGroupInfo', listener11);\r\n\r\n    // update UserInfo\r\n    const listener12 = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      const data = res.data as User;\r\n      dispatch({ type: 'UPDATE_USER_INFO', payload: data });\r\n    };\r\n    socket?.on('updateUserInfo', listener12);\r\n\r\n    // start Conference\r\n    const listener13 = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      dispatch({\r\n        type: 'SET_CONFERENCE',\r\n        payload: res.data as ConferenceData,\r\n      });\r\n    };\r\n    socket?.on('startConference', listener13);\r\n\r\n    // pause Conference\r\n    const listener14 = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      dispatch({\r\n        type: 'PAUSE_CONFERENCE',\r\n        payload: res.data as ConferenceData,\r\n      });\r\n    };\r\n    socket?.on('pauseConference', listener14);\r\n\r\n    // stop Conference\r\n    const listener15 = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      dispatch({\r\n        type: 'STOP_CONFERENCE',\r\n        payload: res.data as ConferenceData,\r\n      });\r\n    };\r\n    socket?.on('stopConference', listener15);\r\n\r\n    // add Operator\r\n    const listener16 = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n    };\r\n    socket?.on('addOperator', listener16);\r\n\r\n    // set ActiveRoom\r\n    const listener17 = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      dispatch({\r\n        type: 'SET_ACTIVE_ROOM',\r\n        payload: res.data as SetActiveRoom,\r\n      });\r\n    };\r\n    socket?.on('setActiveRoom', listener17);\r\n\r\n    // visit Data\r\n    const listener18 = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      const payload = res.data as { visitData: VisitData };\r\n      dispatch({\r\n        type: 'SET_VISIT_DATA',\r\n        payload: payload.visitData,\r\n      });\r\n    };\r\n    socket?.on('visitData', listener18);\r\n\r\n    return () => {\r\n      // detatch\r\n      socket?.off('unauthorized', listener);\r\n\r\n      socket?.off('chatData', listener1);\r\n\r\n      socket?.off('userOnline', listener2);\r\n\r\n      socket?.off('userOffline', listener3);\r\n\r\n      socket?.off('joinPrivateSocket', listener4);\r\n\r\n      if (timer) clearTimeout(timer);\r\n      socket?.off('typing', listener5);\r\n\r\n      socket?.off('revokeMessage', listener6);\r\n\r\n      socket?.off('addGroup', listener7);\r\n\r\n      socket?.off('addContact', listener8);\r\n\r\n      socket?.off('deleteContact', listener10);\r\n\r\n      socket?.off('updateGroupInfo', listener11);\r\n\r\n      socket?.off('updateUserInfo', listener12);\r\n\r\n      socket?.off('startConference', listener13);\r\n\r\n      socket?.off('pauseConference', listener14);\r\n\r\n      socket?.off('stopConference', listener15);\r\n\r\n      socket?.off('addOperator', listener16);\r\n\r\n      socket?.off('setActiveRoom', listener17);\r\n\r\n      socket?.off('visitData', listener18);\r\n    };\r\n  }, [socket?.id]);\r\n\r\n  useEffect(() => {\r\n    // group Message\r\n    const listener = async (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      const data = res.data as GroupMessage;\r\n      dispatch({ type: 'ADD_GROUP_MESSAGE', payload: data });\r\n      const { activeRoom } = state;\r\n      if (\r\n        activeRoom &&\r\n        (activeRoom as Group).groupId === data.groupId &&\r\n        data.userId !== state.user.userId\r\n      ) {\r\n        socket?.emit('markAsRead', {\r\n          groupId: data.groupId,\r\n          _id: data._id,\r\n        });\r\n      }\r\n    };\r\n    socket?.on('groupMessage', listener);\r\n\r\n    // private Message\r\n    const listener1 = async (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      const data = res.data as PrivateMessage;\r\n      if (\r\n        data.contactId === state.user.userId ||\r\n        data.userId === state.user.userId\r\n      ) {\r\n        dispatch({\r\n          type: 'ADD_PRIVATE_MESSAGE',\r\n          payload: data,\r\n        });\r\n\r\n        // –µ—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞ –∏ —ç—Ç–æ –ø—Ä–∏–≤–∞—Ç–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞ (!groupId && userId) —Å –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è (userId)\r\n        if (\r\n          state.activeRoom &&\r\n          !(state.activeRoom as Group).groupId &&\r\n          state.activeRoom?.userId === data.userId\r\n        ) {\r\n          socket?.emit('markAsRead', {\r\n            contactId: data.userId,\r\n            _id: data._id,\r\n          });\r\n        }\r\n      }\r\n    };\r\n\r\n    socket?.on('privateMessage', listener1);\r\n\r\n    return () => {\r\n      socket?.off('groupMessage', listener);\r\n      socket?.off('privateMessage', listener1);\r\n    };\r\n  }, [\r\n    socket?.id,\r\n    state.activeRoom?.userId,\r\n    state.activeRoom?.groupId,\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    // mark As Read\r\n    const listener = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      const data = res.data as MessageOperation;\r\n      if (data.userId === state.user.userId) {\r\n        if (data.groupId) {\r\n          dispatch({\r\n            type: 'LOSE_GROUP_UNREAD_GATHER',\r\n            payload: data.groupId,\r\n          });\r\n        } else {\r\n          dispatch({\r\n            type: 'LOSE_CONTACT_UNREAD_GATHER',\r\n            payload: data.contactId,\r\n          });\r\n        }\r\n      } else {\r\n        if (data.contactId)\r\n          dispatch({\r\n            type: 'MARK_PRIVATE_MESSAGES_READ',\r\n            payload: data.userId,\r\n          });\r\n      }\r\n    };\r\n    socket?.on('markAsRead', listener);\r\n\r\n    // delete Group\r\n    const listener1 = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      const data = res.data as GroupMap;\r\n      if (data.userId === state.user.userId) {\r\n        // –µ—Å–ª–∏ —É–¥–∞–ª—è–µ–º —Å–µ–±—è –∏–∑ –≥—Ä—É–ø–ø—ã\r\n        dispatch({ type: 'DEL_GROUP', payload: data.groupId });\r\n      } else {\r\n        dispatch({ type: 'DEL_GROUP_MEMBER', payload: data });\r\n      }\r\n    };\r\n    socket?.on('deleteGroup', listener1);\r\n\r\n    const listener2 = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      const { group, user: newUser } = res.data as JoinGroup;\r\n\r\n      if (!state.groupGather[group.groupId]) {\r\n        console.log('joined to a new group');\r\n        // –ï—Å–ª–∏ –≥—Ä—É–ø–ø—ã –µ—â–µ —É –Ω–∞—Å –Ω–µ—Ç, —Ç–æ –ø–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö –≤ –≥—Ä—É–ø–ø–µ\r\n        socket?.emit('chatData');\r\n      } else if (newUser.userId !== state.user.userId) {\r\n        // –ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è—é—Ç—Å—è –∫ –≥—Ä—É–ø–ø–µ\r\n        dispatch({\r\n          type: 'ADD_GROUP_MEMBER',\r\n          payload: {\r\n            groupId: group.groupId,\r\n            members: [newUser],\r\n          },\r\n        });\r\n      }\r\n    };\r\n    socket?.on('joinGroup', listener2);\r\n\r\n    // listen group socket join\r\n    const listener4 = (res: ServerRes) => {\r\n      if (res.code) {\r\n        dispatch({ type: 'SET_ERROR', payload: res.msg });\r\n        return;\r\n      }\r\n      const data = res.data as JoinGroup;\r\n      const newUser: Contact = data.user;\r\n      newUser.online = 1;\r\n      const { group } = data;\r\n      const groupObj = state.groupGather[group.groupId];\r\n      // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏ –∫ –≥—Ä—É–ø–ø–µ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\r\n      if (\r\n        groupObj &&\r\n        !groupObj.members?.find(\r\n          member => member.userId === newUser.userId,\r\n        )\r\n      ) {\r\n        newUser.isManager = 0;\r\n        groupObj.members?.push(newUser);\r\n        // Vue.prototype.$message.info(res.msg);\r\n      }\r\n      dispatch({ type: 'SET_USER_GATHER', payload: newUser });\r\n    };\r\n    socket?.on('joinGroupSocket', listener4);\r\n\r\n    return () => {\r\n      socket?.off('markAsRead', listener);\r\n\r\n      socket?.off('deleteGroup', listener1);\r\n\r\n      socket?.off('joinGroup', listener2);\r\n\r\n      socket?.off('joinGroupSocket', listener4);\r\n    };\r\n  }, [\r\n    socket?.id,\r\n    state.user.userId,\r\n    allMessCount(state.groupGather),\r\n  ]);\r\n\r\n  const value = useMemo(() => ({ socket, online }), [socket, online]);\r\n\r\n  return (\r\n    <SocketContext.Provider value={value}>\r\n      {children}\r\n    </SocketContext.Provider>\r\n  );\r\n};\r\n","import { useCallback, useEffect, useState } from \"react\";\r\nimport io, { Socket } from \"socket.io-client\";\r\n\r\nexport const useSocket = (\r\n  url: string,\r\n  path: string,\r\n  accessToken: string\r\n): {\r\n  socket: Socket | null;\r\n  online: boolean;\r\n  connectSocket: () => void;\r\n  disconnectSocket: () => void;\r\n} => {\r\n  const [socket, setSocket] = useState<Socket | null>(null);\r\n\r\n  const connectSocket = useCallback(() => {\r\n    // console.log(\"do connect\");\r\n    const socketTemp = io(url, {\r\n      path,\r\n      reconnection: true,\r\n      extraHeaders: {\r\n        Authorization: `Bearer ${accessToken}`,\r\n      },\r\n    });\r\n    setSocket(socketTemp);\r\n  }, [url, path, accessToken]);\r\n\r\n  const disconnectSocket = useCallback(() => {\r\n    // console.log(\"do disconnect\");\r\n    socket?.disconnect();\r\n    setSocket(null);\r\n  }, [socket]);\r\n\r\n  const [online, setOnline] = useState<boolean>(false);\r\n\r\n  useEffect(() => {\r\n    setOnline(socket?.connected ? true : false);\r\n  }, [socket]);\r\n\r\n  useEffect(() => {\r\n    socket?.on(\"connect\", () => {\r\n      // console.log(\"connected\");\r\n      setOnline(true);\r\n      socket.emit(\"chatData\");\r\n    });\r\n  }, [socket]);\r\n\r\n  useEffect(() => {\r\n    socket?.on(\"disconnect\", () => {\r\n      // console.log(\"disconnected\");\r\n      setOnline(false);\r\n    });\r\n  }, [socket]);\r\n\r\n  return {\r\n    socket,\r\n    online,\r\n    disconnectSocket,\r\n    connectSocket,\r\n  };\r\n};\r\n","import React from 'react';\r\nimport { IconButton, Tooltip } from '@mui/material';\r\nimport SettingsSuggestIcon from '@mui/icons-material/SettingsSuggest';\r\nimport SettingsVoiceIcon from '@mui/icons-material/SettingsVoice';\r\nimport VideoSettingsIcon from '@mui/icons-material/VideoSettings';\r\nimport { ChatContext } from '../context/ChatContext';\r\nimport { useTranslation } from 'react-i18next';\r\ntype CheckAudiVideoPermProps = {\r\n  audio: boolean;\r\n  video: boolean;\r\n};\r\n\r\nconst CheckAudiVideoPerm: React.FC<CheckAudiVideoPermProps> = ({\r\n  audio,\r\n  video,\r\n}: CheckAudiVideoPermProps) => {\r\n  const { t } = useTranslation();\r\n  //const [havePermissions, setHavePermissions] = useState(false);\r\n  const { dispatch } = React.useContext(ChatContext);\r\n  const checkPermissions = () => {\r\n    const permissions = navigator.mediaDevices.getUserMedia({\r\n      audio,\r\n      video,\r\n    });\r\n    permissions\r\n      .then(data => {\r\n        console.log('permissions', data);\r\n        dispatch({\r\n          type: 'SET_SUCCES',\r\n          payload: t('CHAT.CONFERENCE.ALLOK'),\r\n        });\r\n      })\r\n      .catch(err => {\r\n        let payload = t('CHAT.CONFERENCE.ErrorAny');\r\n        if (err.name === 'NotFoundError') {\r\n          payload = t('CHAT.CONFERENCE.NotFoundError');\r\n        }\r\n        if (err.name === 'NotAllowedError') {\r\n          payload = t('CHAT.CONFERENCE.NotAllowedError');\r\n        }\r\n\r\n        dispatch({\r\n          type: 'SET_ERROR',\r\n          payload,\r\n        });\r\n        //setHavePermissions(false);\r\n        console.log('err', `${err.name} : ${err.message}`);\r\n      });\r\n  };\r\n\r\n  const title =\r\n    audio && video\r\n      ? t('CHAT.CONFERENCE.CheckCamMic')\r\n      : audio\r\n      ? t('CHAT.CONFERENCE.CheckMic')\r\n      : t('CHAT.CONFERENCE.CheckCam');\r\n  return (\r\n    <Tooltip title={title}>\r\n      <IconButton\r\n        aria-label=\"check\"\r\n        onClick={() => checkPermissions()}\r\n        size=\"large\"\r\n      >\r\n        {audio && video ? (\r\n          <SettingsSuggestIcon />\r\n        ) : audio ? (\r\n          <SettingsVoiceIcon />\r\n        ) : (\r\n          <VideoSettingsIcon />\r\n        )}\r\n      </IconButton>\r\n    </Tooltip>\r\n  );\r\n};\r\n\r\nexport default CheckAudiVideoPerm;\r\n","import React from \"react\";\r\nimport { ChatContext } from \"../context/ChatContext\";\r\nimport { Alert, Snackbar } from \"@mui/material\";\r\n\r\nconst ChatAlert: React.FC = () => {\r\n  // const { t } = useTranslation();\r\n  //const [havePermissions, setHavePermissions] = useState(false);\r\n  const {\r\n    state: { error, success },\r\n    dispatch\r\n  } = React.useContext(ChatContext);\r\n\r\n  const handleClose = () => {\r\n    dispatch({ type: \"SET_ERROR\", payload: undefined });\r\n    dispatch({ type: \"SET_SUCCES\", payload: undefined });\r\n  };\r\n\r\n  return (\r\n    <Snackbar\r\n      anchorOrigin={{ vertical: \"top\", horizontal: \"center\" }}\r\n      open={!!error || !!success}\r\n      autoHideDuration={6000}\r\n      onClose={handleClose}\r\n    >\r\n      <Alert onClose={handleClose} severity={error ? \"error\" : \"success\"}>\r\n        {error ? error : success}\r\n      </Alert>\r\n    </Snackbar>\r\n  );\r\n};\r\n\r\nexport default ChatAlert;\r\n","import * as React from 'react';\r\nimport {\r\n  Container,\r\n  Box,\r\n  Grid,\r\n  useMediaQuery,\r\n  Paper,\r\n  IconButton,\r\n  Tooltip,\r\n} from '@mui/material';\r\nimport { makeStyles } from '@mui/styles';\r\nimport { Theme } from '@mui/material/styles';\r\nimport { Room, RoomList, Conference } from '../components';\r\nimport { ChatContext } from '../context/ChatContext';\r\nimport { RestContext } from '../context/RestContext';\r\nimport { SocketContext } from '../context/SocketContext';\r\nimport {\r\n  ChatPageProps,\r\n  Group,\r\n  Contact,\r\n  ChatMessage,\r\n  ChatRoom,\r\n  SendMessage,\r\n  ConferenceData,\r\n} from '../types';\r\nimport { getParam, isEmpty, allMessCount } from '../utils/common';\r\nimport ConferenceCall from '../components/ConferenceCall';\r\nimport { ArrowForward } from '@mui/icons-material';\r\nimport { useTranslation } from 'react-i18next';\r\nimport CheckAudiVideoPerm from '../components/CheckAudiVideoPerm';\r\nimport ChatAlert from '../components/Alert';\r\n\r\n// –û—Ç–∫–ª—é—á–∏–ª–∏ –ø—Ä–æ–∏–≥—Ä—ã—à –∑–≤—É–∫–∞\r\n// const getRingAudio = (): HTMLAudioElement => {\r\n//   const audio = new Audio(\r\n//     process.env.PUBLIC_URL + '/audio/ring-in.ogg',\r\n//   );\r\n//   audio.loop = true;\r\n//   return audio;\r\n// };\r\n\r\nconst useStyles = makeStyles((theme: Theme) => ({\r\n  root: {\r\n    height: '100%',\r\n    overflow: 'hidden',\r\n    padding: 0,\r\n    [theme.breakpoints.down('sm')]: {\r\n      width: '100%',\r\n    },\r\n  },\r\n  innerGrid: {\r\n    height: '100%',\r\n    width: '100%',\r\n  },\r\n  conAbsOnConf: {\r\n    position: 'absolute',\r\n    top: 42,\r\n    left: 25,\r\n    zIndex: 1000,\r\n    margin: theme.spacing(3),\r\n  },\r\n}));\r\n\r\nexport const ChatPage: React.FC<ChatPageProps> = ({\r\n  activeGroupId,\r\n  activeChatUserId,\r\n  inModale = false,\r\n  hideRooms = false,\r\n  fullWidth = false,\r\n  ...props\r\n}: ChatPageProps) => {\r\n  const classes = useStyles();\r\n  const isMobile = useMediaQuery((theme: Theme) =>\r\n    theme.breakpoints.down('sm'),\r\n  );\r\n  const { t } = useTranslation();\r\n  const { state, dispatch } = React.useContext(ChatContext);\r\n  const { socket } = React.useContext(SocketContext);\r\n\r\n  const {\r\n    apiUrl,\r\n    pageSize,\r\n    getPrivateMessages,\r\n    getGroupMessages,\r\n    getUserByMmk,\r\n  } = React.useContext(RestContext);\r\n\r\n  // const [ringAudio] = React.useState(getRingAudio());\r\n\r\n  const onExitActiveRoom = React.useCallback(() => {\r\n    dispatch({\r\n      type: 'SET_ACTIVE_ROOM',\r\n      payload: {},\r\n    });\r\n  }, [dispatch]);\r\n\r\n  const onNeedMoreMessages = React.useCallback(\r\n    async (chat: ChatRoom) => {\r\n      if ((chat as Group).groupId) await getGroupMessages(chat as Group);\r\n      else await getPrivateMessages(chat as Contact);\r\n    },\r\n    [getPrivateMessages, getGroupMessages],\r\n  );\r\n\r\n  const onMessageDelete = React.useCallback(\r\n    (chat: ChatRoom, message: ChatMessage) => {\r\n      socket?.emit('revokeMessage', {\r\n        groupId: (chat as Group).groupId, // –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≥—Ä—É–ø–ø—ã\r\n        contactId: chat.userId, // –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–æ–Ω—Ç–∞–∫—Ç–∞\r\n        _id: message._id, // –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\r\n      });\r\n    },\r\n    [socket?.id],\r\n  );\r\n\r\n  const onTyping = React.useCallback(\r\n    (chat: ChatRoom) => {\r\n      socket?.emit('typing', {\r\n        groupId: (chat as Group)?.groupId,\r\n        contactId: chat?.userId,\r\n      });\r\n    },\r\n    [socket?.id],\r\n  );\r\n\r\n  const onSendMessage = React.useCallback(\r\n    (chat: ChatRoom, data: SendMessage) => {\r\n      if ((chat as Group).groupId) {\r\n        socket?.emit('groupMessage', {\r\n          groupId: (chat as Group)?.groupId,\r\n          content: data.message,\r\n          width: data.width,\r\n          height: data.height,\r\n          fileName: data.fileName,\r\n          messageType: data.messageType,\r\n          size: data.size,\r\n        });\r\n      } else {\r\n        socket?.emit('privateMessage', {\r\n          contactId: chat?.userId,\r\n          content: data.message,\r\n          width: data.width,\r\n          height: data.height,\r\n          fileName: data.fileName,\r\n          messageType: data.messageType,\r\n          size: data.size,\r\n        });\r\n      }\r\n    },\r\n    [socket?.id],\r\n  );\r\n\r\n  const onChangeChat = React.useCallback(\r\n    (chat: ChatRoom) => {\r\n      dispatch({\r\n        type: 'SET_ACTIVE_ROOM',\r\n        payload: {\r\n          groupId: (chat as Group)?.groupId,\r\n          contactId: chat?.userId,\r\n        },\r\n      });\r\n      onEnterRoom(chat);\r\n    },\r\n    [socket?.id, dispatch],\r\n  );\r\n\r\n  const onEnterRoom = React.useCallback(\r\n    (chat: ChatRoom) => {\r\n      if (!chat.messages || chat.messages.length === 0) return;\r\n      if ((chat as Group).groupId) {\r\n        socket?.emit('markAsRead', {\r\n          groupId: (chat as Group).groupId,\r\n          _id: chat.messages[chat.messages.length - 1]._id,\r\n        });\r\n      } else {\r\n        socket?.emit('markAsRead', {\r\n          contactId: chat.userId,\r\n          _id: chat.messages[chat.messages.length - 1]._id,\r\n        });\r\n      }\r\n    },\r\n    [socket?.id],\r\n  );\r\n\r\n  const onVideoCall = React.useCallback(\r\n    (chat: ChatRoom, visitId?: number, recreate?: boolean) => {\r\n      socket?.emit('startConference', {\r\n        groupId: (chat as Group).groupId,\r\n        contactId: chat.userId,\r\n        visitId,\r\n        recreate,\r\n      });\r\n    },\r\n    [socket?.id],\r\n  );\r\n\r\n  const onVideoEnd = React.useCallback(\r\n    (conference: ConferenceData | null) => {\r\n      if (conference?.id != null)\r\n        socket?.emit('stopConference', {\r\n          id: conference?.id,\r\n        });\r\n    },\r\n    [socket?.id],\r\n  );\r\n\r\n  const onConferencePause = React.useCallback(\r\n    (conference: ConferenceData | null) => {\r\n      if (conference?.id != null)\r\n        socket?.emit('pauseConference', {\r\n          id: conference.id,\r\n        });\r\n    },\r\n    [socket?.id],\r\n  );\r\n\r\n  const onConferenceCallAccept = React.useCallback(\r\n    (conference: ConferenceData) => {\r\n      // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º resumeConference —á—Ç–æ–±—ã –≤–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å\r\n      if (conference?.id != null)\r\n        socket?.emit('resumeConference', {\r\n          id: conference.id,\r\n        });\r\n      dispatch({ type: 'JOIN_CONFERENCE', payload: conference });\r\n    },\r\n    [socket?.id, dispatch],\r\n  );\r\n\r\n  const onOperatorAdd = React.useCallback(\r\n    (group: Group, operator: Contact) => {\r\n      socket?.emit('addOperator', {\r\n        groupId: group.groupId,\r\n        operatorId: operator.userId,\r\n      });\r\n    },\r\n    [socket?.id],\r\n  );\r\n\r\n  const onLeaveGroup = React.useCallback(\r\n    (group: Group) => {\r\n      socket?.emit('deleteGroup', {\r\n        groupId: group.groupId,\r\n      });\r\n    },\r\n    [socket?.id],\r\n  );\r\n\r\n  React.useEffect(() => {\r\n    if (activeChatUserId != null && !isEmpty(state.contactGather)) {\r\n      const Chat = Object.values(state.contactGather).find(\r\n        item => item.userId === activeChatUserId,\r\n      );\r\n      onChangeChat(Chat);\r\n    }\r\n\r\n    const mmkId = getParam('mmk');\r\n    const guid = getParam('guid');\r\n    if (\r\n      (mmkId != null || guid != null) &&\r\n      !isEmpty(state.contactGather)\r\n    ) {\r\n      //console.log(\"mmkId\", mmkId);\r\n      const changeChatByMmkId = async () => {\r\n        const userId = await getUserByMmk(mmkId, guid);\r\n        if (userId != null) {\r\n          const Chat = Object.values(state.contactGather).find(\r\n            item => item.userId === userId,\r\n          );\r\n          onChangeChat(Chat);\r\n        }\r\n      };\r\n      changeChatByMmkId();\r\n    }\r\n  }, [state.user.userId]);\r\n\r\n  React.useEffect(() => {\r\n    if (activeGroupId != null && !isEmpty(state.groupGather)) {\r\n      const onlyChat = Object.values(state.groupGather).find(\r\n        item => item.groupId === activeGroupId,\r\n      );\r\n\r\n      if (!isEmpty(onlyChat)) {\r\n        onChangeChat(onlyChat);\r\n      }\r\n    }\r\n  }, [state.user.userId]);\r\n\r\n  // –û—Ç–∫–ª—é—á–∏–ª–∏ –ø—Ä–æ–∏–≥—Ä—ã—à –∑–≤—É–∫–∞\r\n  // React.useEffect(() => {\r\n  //   if (\r\n  //     state.conference.data?.id &&\r\n  //     state.conference.ringPlayed &&\r\n  //     !state.conference.joined\r\n  //   )\r\n  //     ringAudio.play();\r\n  //   else ringAudio.pause();\r\n  // }, [state.conference.data?.id, state.conference.ringPlayed]);\r\n\r\n  // console.log('--state--', state);\r\n  const renderRoom = state.activeRoom != null && (\r\n    <Room\r\n      apiUrl={apiUrl}\r\n      user={state.user}\r\n      users={state.userGather}\r\n      operators={state.operators}\r\n      chat={state.activeRoom}\r\n      typing={state.typing}\r\n      conference={state.conference.data}\r\n      visitData={state.visitData}\r\n      conferenceJoined={state.conference.joined}\r\n      loading={state.loading}\r\n      pageSize={pageSize}\r\n      onExitRoom={onExitActiveRoom}\r\n      onEnterRoom={onEnterRoom}\r\n      onNeedMoreMessages={onNeedMoreMessages}\r\n      onMeesageDelete={onMessageDelete}\r\n      onTyping={onTyping}\r\n      onSendMessage={onSendMessage}\r\n      onVideoCall={onVideoCall}\r\n      onVideoEnd={onVideoEnd}\r\n      onConferencePause={onConferencePause}\r\n      onOperatorAdd={onOperatorAdd}\r\n      onLeaveGroup={onLeaveGroup}\r\n      inModale={inModale}\r\n      onContactClick={props.onContactInfoClick}\r\n    />\r\n  );\r\n\r\n  const GetRoomList = () => (\r\n    <RoomList\r\n      apiUrl={apiUrl}\r\n      user={state.user}\r\n      activeRoom={state.activeRoom}\r\n      groups={Object.values(state.groupGather)}\r\n      contacts={Object.values(state.contactGather)}\r\n      typing={state.typing}\r\n      onChangeChat={onChangeChat}\r\n    />\r\n  );\r\n\r\n  const GetConferenceCall = () =>\r\n    state.conference.data && (\r\n      <ConferenceCall\r\n        apiUrl={apiUrl}\r\n        contact={\r\n          state.contactGather[\r\n            state.user.userId === state.conference.data.userId\r\n              ? state.conference.data.contactId\r\n              : state.conference.data.userId\r\n          ]\r\n        }\r\n        conference={state.conference.data}\r\n        onAccept={onConferenceCallAccept}\r\n      />\r\n    );\r\n\r\n  const GetConference = () => (\r\n    <Conference\r\n      conference={state.conference.data}\r\n      onClose={onConferencePause}\r\n      langCode={state.user.langCode}\r\n    />\r\n  );\r\n\r\n  const Gonf = () =>\r\n    state.conference.joined ? (\r\n      <>\r\n        <GetConference />\r\n        <Box className={classes.conAbsOnConf}>\r\n          <Paper style={{ borderRadius: 8 }}>\r\n            <Box display=\"flex\" flexDirection=\"row\" my={3}>\r\n              {((isEmpty(state.activeRoom) && isMobile) ||\r\n                (!isEmpty(state.activeRoom) && !isMobile)) && (\r\n                <>\r\n                  <CheckAudiVideoPerm audio={true} video={false} />\r\n                  <CheckAudiVideoPerm audio={false} video={true} />\r\n                </>\r\n              )}\r\n\r\n              {isEmpty(state.activeRoom) &&\r\n                state.chatOld != null &&\r\n                isMobile && (\r\n                  <Tooltip title={t('CHAT.CONFERENCE.BACK')}>\r\n                    <IconButton\r\n                      aria-label=\"check\"\r\n                      onClick={() =>\r\n                        state.chatOld != null &&\r\n                        onChangeChat(state.chatOld)\r\n                      }\r\n                      size=\"large\"\r\n                    >\r\n                      <ArrowForward />\r\n                    </IconButton>\r\n                  </Tooltip>\r\n                )}\r\n            </Box>\r\n          </Paper>\r\n        </Box>\r\n      </>\r\n    ) : (\r\n      <GetConferenceCall />\r\n    );\r\n\r\n  const contacts = React.useMemo(\r\n    () =>\r\n      state.conference.data?.id != null ? <Gonf /> : <GetRoomList />,\r\n    state.conference.data?.id != null\r\n      ? [state.conference.joined, state.conference.data?.id]\r\n      : [\r\n          state.activeRoom?.groupId,\r\n          state.activeRoom?.userId,\r\n          allMessCount(state.contactGather),\r\n          allMessCount(state.groupGather),\r\n        ],\r\n  );\r\n\r\n  return (\r\n    <Container\r\n      maxWidth={fullWidth ? false : \"lg\"}\r\n      className={classes.root}\r\n      sx={theme => ({\r\n        width: inModale\r\n          ? `calc(100vw - ${theme.spacing(8)})`\r\n          : '100%',\r\n      })}\r\n    >\r\n      {isMobile ? (\r\n        <React.Fragment>\r\n          {contacts}\r\n          {renderRoom}\r\n        </React.Fragment>\r\n      ) : (\r\n        <Grid container spacing={1} className={classes.innerGrid}>\r\n          {(state.conference.data?.id != null || !hideRooms) && (\r\n            <Grid\r\n              item\r\n              sm={state.conference.data?.id != null ? 6 : 4}\r\n              className={classes.innerGrid}\r\n            >\r\n              {contacts}\r\n            </Grid>\r\n          )}\r\n          <Grid\r\n            item\r\n            sm={\r\n              state.conference.data?.id != null\r\n                ? 6\r\n                : hideRooms\r\n                ? 12\r\n                : 8\r\n            }\r\n            className={classes.innerGrid}\r\n          >\r\n            {renderRoom}\r\n          </Grid>\r\n        </Grid>\r\n      )}\r\n\r\n      <ChatAlert />\r\n    </Container>\r\n  );\r\n};\r\n","import i18n from 'i18next';\r\nimport { initReactI18next } from 'react-i18next';\r\nimport en from './en.json';\r\nimport fr from './fr.json';\r\nimport ru from './ru.json';\r\n\r\nimport LanguageDetector from 'i18next-browser-languagedetector';\r\nconst getLang = () => {\r\n  const str = localStorage.getItem('user');\r\n  if (str) {\r\n    const user = JSON.parse(str);\r\n    return user?.lang;\r\n  }\r\n  return 'ru';\r\n};\r\n\r\nconst lang = getLang();\r\n\r\ni18n\r\n  .use(LanguageDetector)\r\n  .use(initReactI18next)\r\n  .init({\r\n    resources: {\r\n      ru: { translations: ru },\r\n      en: { translations: en },\r\n      fr: { translations: fr },\r\n    },\r\n    lng: lang,\r\n    load: 'languageOnly',\r\n    fallbackLng: lang,\r\n    debug: true,\r\n\r\n    // have a common namespace used around the full app\r\n    ns: ['translations'],\r\n    defaultNS: 'translations',\r\n    lowerCaseLng: true,\r\n  });\r\n\r\nexport default i18n;\r\n","import React, {\r\n  useContext,\r\n  useReducer,\r\n  Dispatch,\r\n  createContext,\r\n  useMemo,\r\n} from 'react';\r\nimport { I18nextProvider } from 'react-i18next';\r\nimport i18n from '../translations';\r\n\r\ninterface LanguageState {\r\n  language: Language;\r\n}\r\n\r\ntype Language = 'ru' | 'fr' | 'en';\r\n\r\ntype Action = {\r\n  type: 'RU' | 'FR' | 'EN';\r\n  payload: Language;\r\n};\r\ninterface LanguageContextI {\r\n  languageState: LanguageState;\r\n  dispatchLanguage: Dispatch<Action>;\r\n}\r\n\r\nconst languageWithoutCountry = (): Language => {\r\n  return i18n.language.substring(0, 2) as Language;\r\n};\r\n\r\nexport const LANGUAGES: Record<string, Language> = {\r\n  RU: 'ru',\r\n  FR: 'fr',\r\n  EN: 'en',\r\n};\r\n\r\nexport const LANGUAGES_ACTIONS = {\r\n  SET_RUSSIAN: 'SET_RUSSIAN',\r\n  SET_ENGLISH: 'SET_ENGLISH',\r\n  SET_FRENCH: 'SET_FRENCH',\r\n};\r\n\r\nconst reducer = (\r\n  state: LanguageState,\r\n  action: Action,\r\n): LanguageState => {\r\n  switch (action.type) {\r\n    case LANGUAGES_ACTIONS.SET_ENGLISH:\r\n      i18n.changeLanguage('en');\r\n      return { language: LANGUAGES.EN };\r\n    case LANGUAGES_ACTIONS.SET_FRENCH:\r\n      i18n.changeLanguage('fr');\r\n      return { language: LANGUAGES.FR };\r\n    case LANGUAGES_ACTIONS.SET_RUSSIAN:\r\n      i18n.changeLanguage('ru');\r\n      return { language: LANGUAGES.RU };\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n\r\nexport const LanguageContext = createContext({} as LanguageContextI);\r\n\r\ninterface AppLanguageProviderProps {\r\n  children: React.ReactNode;\r\n}\r\nexport const AppLanguageProvider: React.FC<AppLanguageProviderProps> = ({\r\n  children,\r\n}) => {\r\n  const [languageState, dispatchLanguage] = useReducer(reducer, {\r\n    language: languageWithoutCountry(),\r\n  });\r\n  const value = useMemo(() => ({ languageState, dispatchLanguage }), [\r\n    languageState,\r\n  ]);\r\n  return (\r\n    <LanguageContext.Provider value={value}>\r\n      <I18nextProvider i18n={i18n}>{children}</I18nextProvider>\r\n    </LanguageContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useLanguageValue = () => useContext(LanguageContext);\r\n","import React from 'react';\r\nimport { ChatProps } from '../../types'; // TODO: upgrade to latest eslint tooling\r\n\r\nimport { AppLanguageProvider } from '../../context/LanguageContext';\r\nimport { ChatProvider } from '../../context/ChatContext';\r\nimport { RestProvider } from '../../context/RestContext';\r\nimport { SocketProvider } from '../../context/SocketContext';\r\nimport { ChatPage } from '../../pages/chat';\r\n\r\nexport const ChatIndex: React.FC<ChatProps> = ({\r\n  lang,\r\n  chatBaseURLApi,\r\n  chatWsUrl,\r\n  chatWsPath,\r\n  token,\r\n  refreshToken,\r\n  ...props\r\n}: ChatProps) => {\r\n  return (\r\n    <AppLanguageProvider>\r\n      <ChatProvider\r\n        defLang={lang}\r\n        token={token}\r\n        refreshToken={refreshToken}\r\n      >\r\n        <RestProvider baseURLApi={chatBaseURLApi} pageSize={25}>\r\n          <SocketProvider wsUrl={chatWsUrl} wsPath={chatWsPath}>\r\n            <ChatPage {...props} />\r\n          </SocketProvider>\r\n        </RestProvider>\r\n      </ChatProvider>\r\n    </AppLanguageProvider>\r\n  );\r\n};\r\n"],"names":["MessageStatus","Role","ContextMenuType","useStyles","makeStyles","createStyles","item","cursor","Emoji","props","classes","emojiClick","e","onSelect","target","innerText","Item","itemProps","React","Box","m","component","onClick","className","emoji","display","flexDirection","theme","typingText","paddingLeft","spacing","typingDot","verticalAlign","width","height","margin","background","palette","primary","main","borderRadius","opacity","animation","&:nth-child(1)","animationDelay","&:nth-child(2)","&:nth-child(3)","@keyframes loadingFade","0%","50%","100%","Typing","createElement","Typography","color","variant","message","input","flex","inputUpload","attachmentIcon","fill","stroke","Entry","chat","t","useTranslation","_React$useState","useState","empjiEl","setEmojiEl","_React$useState2","text","setText","_React$useState3","time","lastTyping","setLastTyping","handleEmojiClose","sendMessage","data","onSendMessage","submit","trim","length","messageType","emojiOpen","Boolean","enojiId","undefined","TextField","placeholder","autoFocus","InputProps","disableUnderline","startAdornment","InputAdornment","position","accept","id","type","onChange","event","currentTarget","files","file","includes","image","Image","url","window","URL","webkitURL","src","createObjectURL","onload","imageSize","fileName","name","size","htmlFor","IconButton","aria-label","SvgIcon","d","strokeWidth","strokeLinecap","strokeLinejoin","aria-describedby","InsertEmoticon","endAdornment","edge","preventDefault","Send","value","_ref","onTyping","Date","now","onKeyPress","key","Popover","open","anchorEl","onClose","anchorOrigin","vertical","horizontal","transformOrigin","ContactStatus","isTyping","contact","online","isEmpty","Object","keys","formatTime","format","dayjs","add","startOf","isAfter","getChatId","groupId","userId","getChatName","username","allMessCount","chats","values","map","it","messages","reduce","a","b","chatRoomComparer","hasMessagesA","Array","isArray","hasMessagesB","cdate","getTime","getParam","param","QueryString","location","search","URLSearchParams","get","combineURLs","baseURL","relativeURL","queryParams","replace","toString","star","fontSize","ContactList","apiUrl","contacts","owner","List","_extends","ListItemButton","onContactClick","ListItemAvatar","Avatar","alt","avatar","ListItemText","StarIcon","secondary","AddContact","_useTranslation","Dialog","aria-labelledby","DialogTitle","Transition","forwardRef","ref","Slide","direction","AlertDialog","children","setOpen","_ref$severity","severity","handleClose","TransitionComponent","keepMounted","DialogContent","Alert","DialogActions","Button","AlertModale","modaleInfo","setModaleInfo","strTime","useMemo","textAlign","ConferenceTime","_ref2","finishDate","_useState","currTime","finTime","diffTimeSec","Math","round","_useCounter","max","counter","setCounter","counterRef","useRef","useEffect","current","setInterval","prev","clearInterval","handlerRefresh","useCounter","minutes","seconds","_hhMmSs","totalSeconds","hours","floor","strHours","hhMmSs","ConfirmDialogSlide","contentText","callback","StyledMenu","styled","Menu","elevation","& .MuiPaper-root","marginTop","minWidth","mode","grey","boxShadow","& .MuiMenu-list","padding","& .MuiMenuItem-root","& .MuiSvgIcon-root","marginRight","&:active","backgroundColor","alpha","action","selectedOpacity","ConferenceButton","setAnchorEl","visitId","setVisitId","confirmReCreateVisit","setConfirmReCreateVisit","visitData","filter","contactId","aria-controls","aria-haspopup","aria-expanded","disableElevation","startIcon","VideoCallIcon","endIcon","KeyboardArrowDownIcon","disabled","onVideoCall","MenuListProps","MenuItem","conferenceStatus","handleStart","disableRipple","RestartAltIcon","PlayArrowIcon","visit","visitDate","plExamName","duration","paper","avatarGroup","getGroupStatus","group","status","_group$members","members","onlineCount","sum","push","join","RoomHeader","user","typing","conference","conferenceJoined","operators","onVideoEnd","onConferencePause","onOperatorAdd","onLeaveGroup","_useState2","addOperatorOpen","setAddOperatorOpen","confirmFinishConf","setConfirmFinishConf","CardHeader","title","subheader","_group$members2","closeTimer","handlePopoverIn","clearTimeout","handlePopoverClose","handlePopoverOut","setTimeout","GroupIcon","Fragment","aria-owns","onMouseEnter","onMouseLeave","sx","pointerEvents","disableRestoreFocus","role","PersonAddIcon","operator","find","DeleteIcon","CallEndIcon","style","marginLeft","fileIcon","fileBody","File","meta","content","split","date","getFileMeta","_splitFileName","idx","lastIndexOf","ext","slice","splitFileName","toUpperCase","_mediaContent","mediaContent","maxWidth","breakpoints","down","Video","isConference","JSON","parse","controls","muted","preload","_img","_aspect","img","maxHeight","aspect","setViewerData","AspectRatio","ratio","visible","MessageContent","_message","rootContact","& span","float","& $message","borderTopRightRadius","borderBottomRightRadius","& $firstMessage","borderTopLeftRadius","& $lastMessage","borderBottomLeftRadius","marginBottom","rootUser","paddingRight","justifyContent","contrastText","rootNotify","& > *","fontWeight","firstMessage","lastMessage","flexWrap","header","overflow","body","wordBreak","alignSelf","statusImage","Message","memo","isGroupMessage","isUserFirst","isUserLast","ListItem","isRevoke","align","revokeUserName","isMine","onContextMenu","child","Link","underline","href","download","wrapMessage","Done","DoneAll","displayName","emptyUser","password","langCode","emptyChatState","token","refreshToken","activeRoom","chatOld","groupGather","userGather","contactGather","initialContactId","joined","ringPlayed","loading","error","success","getFreshActiveRoom","state","getActiveRoom","newActiveRoom","rooms","concat","sort","setUserOnline","newState","_i","_Object$values","member","index","indexOf","findIndex","contactUnreadGather","predicate","unreadCount","groupUnreadGather","chatReducer","_extends2","payload","_extends3","updateActiveRoom","delGroup","delGroupMember","delContact","_extends4","setActiveRoom","x","addGroupMessage","_newState$activeRoom","addPrivateMessage","userName","msg","_id","revokeMessage","info","notice","updateGroupInfo","updateUserInfo","isManager","addGroupMember","setConference","_state$conference$dat","pauseConference","_state$conference$dat2","stopConference","updatedValue","i","markPrivateMessagesRead","noMoreData","pageSize","addPrivateMessages","users","userArr","_step","_iterator","_createForOfIteratorHelperLoose","done","addGroupMessages","setToken","clearUser","ChatContext","createContext","dispatch","ChatProvider","defLang","chatState","_React$useReducer","useReducer","Provider","_arrowDown","messageListOuter","overflowY","scrollbarWidth","scrollbarColor","light","messageList","arrowDown","left","bottom","RoomMessageList","savedCallback","setMenuState","initialMenuState","inModale","onEnterRoom","isMobile","useMediaQuery","chatId","viewerData","useContext","scrollDownButton","setScrollDownButton","scrollableRootRef","lastScrollDistanceToBottomRef","lastMessageCount","hasNextPage","createRef","messageCount","messageCountUnreaded","isVisible","setIsVisible","_useInfiniteScroll","useInfiniteScroll","onLoadMore","onNeedMoreMessages","infiniteRef","rootRef","scrollDown","scrollableRoot","lastScrollDistanceToBottom","_lastScrollDistanceTo","scrollTop","scrollHeight","handleRootScroll","useCallback","root","rect","rootNode","scrollDistanceToBottom","isShowScrollButton","_mess$ref","mess","getBoundingClientRect","top","clientHeight","rootRefSetter","node","Fade","in","timeout","icon","zIndex","CardContent","onScroll","CircularProgress","inx","canCopy","canDelete","onMeesageDelete","mouseX","clientX","mouseY","clientY","handleMenuPopup","Fab","KeyboardArrowDown","minHeight","Backdrop","drawer","roomHeader","flexAll","flexEnd","Room","menuState","handleCopy","navigator","clipboard","writeText","handleDelete","Card","Tooltip","onExitRoom","ArrowBackIcon","Divider","anchorReference","anchorPosition","ListItemIcon","FileCopyIcon","whiteSpace","textOverflow","unread","TypingBadge","withStyles","badge","&::after","border","@keyframes ripple","transform","Badge","OnlineBadge","RoomListItem","roomName","overlap","contactAvatar","roomText","getMessageText","roomTime","selected","active","secondaryTypographyProps","Chip","label","_chat$messages","searchField","listStyle","filterChats","lowerFilter","toLowerCase","sortChats","groups","roomArr","topChatId","localStorage","getItem","c","k","isTop","unshift","RoomList","setChats","roomList","onChangeChat","_props$activeRoom","fullWidth","Conference","regex","_ref$langCode","confUrl","lang","transLang","RegExp","listener","source","_ref$current","contentWindow","addEventListener","removeEventListener","allowFullScreen","allow","alignItems","pulse","&::before","footer","paddingTop","@keyframes pulse","ConferenceCall","onAccept","Paper","runtime","exports","Op","prototype","hasOwn","hasOwnProperty","$Symbol","Symbol","iteratorSymbol","iterator","asyncIteratorSymbol","asyncIterator","toStringTagSymbol","toStringTag","define","obj","defineProperty","enumerable","configurable","writable","err","wrap","innerFn","outerFn","self","tryLocsList","generator","create","Generator","context","Context","_invoke","method","arg","Error","delegate","delegateResult","maybeInvokeDelegate","ContinueSentinel","sent","_sent","dispatchException","abrupt","record","tryCatch","makeInvokeMethod","fn","call","GeneratorFunction","GeneratorFunctionPrototype","IteratorPrototype","this","getProto","getPrototypeOf","NativeIteratorPrototype","Gp","defineIteratorMethods","forEach","AsyncIterator","PromiseImpl","previousPromise","callInvokeWithMethodAndArg","resolve","reject","invoke","result","__await","then","unwrapped","TypeError","resultName","next","nextLoc","pushTryEntry","locs","entry","tryLoc","catchLoc","finallyLoc","afterLoc","tryEntries","resetTryEntry","completion","reset","iterable","iteratorMethod","isNaN","doneResult","isGeneratorFunction","genFun","ctor","constructor","mark","setPrototypeOf","__proto__","awrap","async","Promise","iter","object","reverse","pop","skipTempReset","charAt","stop","rootRecord","rval","exception","handle","loc","caught","hasCatch","hasFinally","finallyEntry","complete","finish","catch","thrown","delegateYield","module","regeneratorRuntime","accidentalStrictMode","globalThis","Function","RestContext","clearLocalStorage","removeItem","signOut","_asyncToGenerator","_regeneratorRuntime","_callee","_context","axios","post","t0","console","log","apply","arguments","getRefreshToken","_callee2","authToken","_context2","setItem","_x","_x2","_x3","RestProvider","_ref3","baseURLApi","_useContext","fetch","headers","Cache-Control","Pragma","Authorization","withCredentials","interceptors","response","use","errorInterceptor","getPrivateMessages","_ref4","_callee3","_context3","params","_x4","_x5","getGroupMessages","_ref5","_callee4","_chat$messages2","_context4","_x6","getUserByMmk","_ref6","_callee5","mmkId","guid","_context5","_x7","_x8","SocketContext","SocketProvider","wsUrl","wsPath","_useSocket","path","accessToken","socket","setSocket","connectSocket","socketTemp","io","reconnection","extraHeaders","disconnectSocket","disconnect","setOnline","connected","on","emit","useSocket","listener1","res","code","groupArr","groupData","contactArr","contactData","userData","_step2","_iterator2","operatorData","_step3","_iterator3","conferenceData","listener2","listener3","timer","listener4","listener5","listener6","listener7","listener8","listener10","listener11","listener12","listener13","listener14","listener15","listener16","listener17","listener18","off","_state$activeRoom","_state$activeRoom2","_state$activeRoom3","_res$data","newUser","_groupObj$members2","groupObj","_groupObj$members","CheckAudiVideoPerm","audio","video","mediaDevices","getUserMedia","SettingsSuggestIcon","SettingsVoiceIcon","VideoSettingsIcon","ChatAlert","_React$useContext","_React$useContext$sta","Snackbar","autoHideDuration","_root","innerGrid","conAbsOnConf","ChatPage","activeGroupId","activeChatUserId","_ref$inModale","_ref$hideRooms","hideRooms","_ref$fullWidth","_objectWithoutPropertiesLoose","_excluded","_React$useContext3","onExitActiveRoom","onMessageDelete","recreate","onConferenceCallAccept","operatorId","Chat","_Chat","changeChatByMmkId","onlyChat","renderRoom","onContactInfoClick","GetRoomList","GetConferenceCall","GetConference","Gonf","my","ArrowForward","_state$conference$dat3","Container","Grid","container","_state$conference$dat4","sm","_state$conference$dat5","_state$conference$dat6","str","getLang","i18n","LanguageDetector","initReactI18next","init","resources","ru","translations","en","fr","lng","load","fallbackLng","debug","ns","defaultNS","lowerCaseLng","reducer","changeLanguage","language","LanguageContext","AppLanguageProvider","_useReducer","substring","languageState","dispatchLanguage","I18nextProvider","chatBaseURLApi","chatWsUrl","chatWsPath"],"mappings":"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"}