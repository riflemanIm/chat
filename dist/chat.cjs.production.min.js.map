{"version":3,"file":"chat.cjs.production.min.js","sources":["../src/types/index.ts","../src/utils/common.ts","../src/components/Typing.tsx","../src/components/ContactStatus.tsx","../src/components/ContactList.tsx","../src/components/AddContact.tsx","../src/components/Conference.tsx","../src/components/ConferenceCall.tsx","../src/components/Emoji.tsx","../src/components/MessageContent/File.tsx","../src/components/MessageContent/Image.tsx","../src/components/MessageContent/Video.tsx","../src/components/MessageContent/index.tsx","../src/components/styles.ts","../src/components/Message.tsx","../node_modules/regenerator-runtime/runtime.js","../src/components/Entry.tsx","../src/components/ConfirmDialogSlide.tsx","../src/components/ConferenceButton.tsx","../src/components/AlertDialog.tsx","../src/components/ConferenceTime.tsx","../src/hooks/useCounter.ts","../src/components/RoomHeader.tsx","../src/components/MessageDateIndicator.tsx","../src/components/MessageScrollButton.tsx","../src/components/RoomMessageList.tsx","../src/hooks/useInterval.js","../src/hooks/useMessageScroll.ts","../src/components/Room.tsx","../src/context/ChatContext.tsx","../src/context/RestContext.tsx","../src/components/RoomListItem.tsx","../src/components/RoomList.tsx","../src/components/Alert.tsx","../src/components/ChatContainer.tsx","../src/components/ChatLayout.tsx","../src/components/CheckAudiVideoPerm.tsx","../src/components/ConferenceControls.tsx","../src/components/ConferenceSection.tsx","../src/context/SocketContext.tsx","../src/hooks/useSocket.ts","../src/pages/chat.tsx","../src/i18next/dist/esm/i18next.js","../src/translations/index.ts","../src/context/LanguageContext.tsx","../src/components/ChatIndex/index.tsx"],"sourcesContent":["// Этот интерфейс используется для типизации всех ответов от сервера. Когда сервер отправляет данные через сокет, они приходят в таком формате:\n\nexport interface ServerRes {\n  code: number; // Код ответа (0 - успех, другие значения - ошибки)\n  msg: string; // Сообщение (обычно сообщение об ошибке)\n  data: unknown; // Данные ответа (могут быть разных типов)\n}\nexport interface ChatPageProps {\n  activeGroupId?: number;\n  activeChatUserId?: number;\n  hideRooms?: boolean;\n  fullWidth?: boolean;\n  onContactInfoClick?: (contact: Contact) => void;\n}\n\nexport interface ChatProps extends ChatPageProps {\n  lang: \"ru\" | \"en\" | \"fr\";\n  chatBaseURLApi: string;\n  baseUrl: string;\n  chatWsUrl: string;\n  chatWsPath: string;\n  token: string;\n  refreshToken: string;\n}\n\n// Тип сообщения\nexport type MessageType =\n  | \"text\"\n  | \"image\"\n  | \"file\"\n  | \"video\"\n  | \"notify\"\n  | \"video_conference\";\n\nexport enum MessageStatus {\n  sent = 0,\n  read = 1,\n}\n\nexport enum Role {\n  Unknown = 0,\n  Client = 1,\n  Agent = 2,\n  Specialist = 3,\n  Operator = 4,\n}\n\nexport interface User {\n  userId: number;\n  username: string;\n  password: string;\n  avatar: string;\n  role?: Role;\n  online?: 1 | 0; // В сети\n  langCode?: string;\n}\n\n// Приватные сообщения\nexport interface PrivateMessage {\n  _id?: number;\n  userId: number;\n  contactId: number;\n  content: string;\n  messageType: MessageType;\n  status: MessageStatus;\n  cdate: string;\n  type?: string;\n  isRevoke?: boolean;\n  revokeUserName?: string;\n  ref?: React.RefObject<HTMLLIElement>;\n}\n\n// Контакт\nexport interface Contact {\n  userId: number;\n  groupId?: number;\n  username: string;\n  avatar?: string;\n  role?: Role;\n  messages?: PrivateMessage[];\n  unreadCount?: number;\n  isTop?: boolean;\n  online?: 1 | 0;\n  isManager?: 1 | 0;\n  noMoreData?: boolean;\n}\nexport interface VisitData {\n  chatFrom: Date;\n  conferenceStatus: \"started\" | \"finished\" | \"none\";\n  contactId: number;\n  duration: number;\n  plExamName: string;\n  planningId: number;\n  visitDate: Date;\n  visitId: number;\n}\n\n// Информация о друзьях\nexport interface ContactGather {\n  [userId: number]: Contact;\n}\n\n// Групповое сообщение\nexport interface GroupMessage {\n  _id?: number;\n  userId: number;\n  groupId: number;\n  content: string;\n  messageType: MessageType;\n  cdate: string;\n  isRevoke?: boolean;\n  revokeUserName?: string;\n  status?: MessageStatus;\n  ref?: React.RefObject<HTMLLIElement>;\n}\n\n// Группа\nexport interface Group {\n  groupId: number;\n  userId: number; // владелец\n  name: string;\n  notice: string;\n  messages?: GroupMessage[];\n  unreadCount?: number;\n  cdate: string;\n  isTop?: boolean;\n  members?: Contact[];\n  noMoreData?: boolean;\n}\n\n// Группы\nexport interface GroupGather {\n  [groupId: number]: Group;\n}\n\n// Ассоциации групп и пользователей\nexport interface GroupMap {\n  groupId: number;\n  userId: number;\n}\n\n// Ассоциации пользователей и друзей\nexport interface ContactMap {\n  contactId: number;\n  userId: number;\n}\n\nexport interface SendMessage {\n  message: string | File;\n  width?: number;\n  height?: number;\n  fileName?: string;\n  messageType: MessageType[0] | MessageType[1];\n  size?: number;\n}\n\n// Размер изображения\nexport interface ImageSize {\n  width: number;\n  height: number;\n}\n\n// Непрочитанные сообщения\nexport interface UnReadGather {\n  [key: string]: number;\n}\n\n// Получить сообщения постранично\nexport interface PagingParams {\n  groupId?: number;\n  userId?: number;\n  contactId?: number;\n  current: number;\n  pageSize: number;\n}\n\n// Постраничный ответ для групповых сообщений\nexport interface PagingResponse {\n  // messageArr: GroupMessage[]; - fix on messages\n  messages: GroupMessage[];\n  userArr: User[];\n}\n\nexport interface ContactUserMap {\n  contactId: number;\n  contactUserName: string;\n}\n\n// информация о том, что контакт печатает текст\nexport interface SetTyping {\n  userId?: number;\n  groupId?: number;\n  contactId?: number;\n}\n\n// Операция с сообщением\nexport interface MessageOperation {\n  userId?: number;\n  username: string;\n  groupId?: number;\n  contactId?: number;\n  _id: number;\n}\n\n// Данные конференции\nexport interface ConferenceData {\n  userId: number;\n  contactId: number;\n  id: string;\n  url?: string;\n  serverAddress?: string;\n  user?: string;\n  password?: string;\n  currentDate?: Date;\n  finishDate?: Date;\n}\n\n// Данные чата\nexport interface ChatData {\n  user: User;\n  groupData: Group[];\n  contactData: Contact[];\n  userData: User[];\n  operatorData: Contact[];\n  conferenceData: ConferenceData;\n  visitData: VisitData[];\n}\n\nexport interface GroupMember {\n  groupId: number;\n  members: Contact[];\n}\n\nexport interface AddPrivateMessages {\n  pageSize: number;\n  contactId: number;\n  messages: PrivateMessage[];\n}\n\nexport interface AddGroupMessages extends PagingResponse {\n  pageSize: number;\n  groupId: number;\n}\n\nexport interface SetActiveRoom {\n  groupId?: number;\n  contactId?: number;\n}\n\nexport interface JoinGroup {\n  group: Group;\n  user: Contact;\n}\n\nexport interface SetUser {\n  user: User;\n  token: string;\n}\n\nexport type ChatRoom = Group | Contact;\nexport type ChatMessage = GroupMessage | PrivateMessage;\n\n// Операции контекстного меню\nexport enum ContextMenuType {\n  COPY = \"COPY\", // Скопировать\n  REVOKE = \"REVOKE\", // Удалить сообщение\n  TOP_REVERT = \"TOP_REVERT\", // Открепить\n  TOP = \"TOP\", // Закрепить\n  READ = \"READ\", // Прочесть всё\n  DELETE = \"DELETE\", // Удалить\n}\n\nexport const CHAT_ACTIONS = {\n  SET_ACTIVE_ROOM: \"SET_ACTIVE_ROOM\",\n  SET_LOADING: \"SET_LOADING\",\n  SET_ERROR: \"SET_ERROR\",\n  REVOKE_MESSAGE: \"REVOKE_MESSAGE\",\n  MARK_PRIVATE_MESSAGES_READ: \"MARK_PRIVATE_MESSAGES_READ\",\n} as const;\n\nexport type ChatActionType = keyof typeof CHAT_ACTIONS;\n\nexport interface ChatAction {\n  type: ChatActionType;\n  payload?: unknown;\n}\n","import dayjs from \"dayjs\";\nimport { ChatRoom, Contact, ContactGather, Group, GroupGather } from \"../types\";\n\nexport function isEmpty(value: unknown): boolean {\n  return (\n    value == null ||\n    (typeof value === \"object\" && Object.keys(value).length === 0) ||\n    (typeof value === \"string\" && value.trim().length === 0)\n  );\n}\n\n// string contains string\nexport function isContainStr(str1: string, str2: string): boolean {\n  return str2.indexOf(str1) >= 0;\n}\n\n/**\n * check URL\n * @param text\n */\nexport function isUrl(text: string): boolean {\n  // parse url\n  const UrlReg = new RegExp(/http(s)?:\\/\\/([\\w-]+\\.)+[\\w-]+(\\/[\\w- ./?%&=]*)?/);\n  return UrlReg.test(text);\n}\n\nexport const compareDates = (\n  d1: Date | string | undefined,\n  d2: Date | string | undefined,\n  period:\n    | \"day\"\n    | \"millisecond\"\n    | \"second\"\n    | \"minute\"\n    | \"hour\"\n    | \"month\"\n    | \"year\"\n    | \"date\"\n    | \"milliseconds\"\n    | \"seconds\"\n    | \"minutes\"\n    | \"hours\"\n    | \"days\" = \"day\",\n  count = 0\n) => {\n  const date1 = dayjs(d1).startOf(\"date\");\n  const date2 = dayjs(d2).startOf(\"date\");\n\n  // console.log(\n  //   'diff',\n  //   dayjs(date1).format('DD.MM.YYYY'),\n  //   dayjs(date2).format('DD.MM.YYYY'),\n  //   date1.diff(date2, period) === count,\n  // );\n  return date1.diff(date2, period) === count;\n};\n\n/**\n * Формитирование времени сообщения\n * @param time\n */\nexport function formatTime(\n  time: Date | string | undefined,\n  format = \"DD.MM.YYYY HH:mm\"\n) {\n  if (typeof time === \"undefined\") return null;\n  if (typeof time === \"string\") time = new Date(time);\n  // больше чем вчера\n  if (dayjs().add(-1, \"days\").startOf(\"day\").isAfter(time)) {\n    return dayjs(time).format(format);\n  }\n  // вчера\n  if (dayjs().startOf(\"day\").isAfter(time)) {\n    return `Вчера в ${dayjs(time).format(\"HH:mm\")}`;\n  }\n\n  return dayjs(time).format(\"HH:mm\");\n}\n\n/**\n * Раскрыть содержимое\n * @param content - данные в строке\n */\nexport function getFileMeta(content: string): {\n  date: string;\n  userId: string;\n  size: string;\n  name: string;\n} {\n  // Формат  [date]$[userId]$[size]$[fileName]\n  // Например fileName = 1606980397047$1a01e20f-3780-4227-84b5-5c69ca766ee5$15.41KB$123.docx\n  const meta = content.split(\"$\");\n  const [date, userId, size, name] = meta;\n  return {\n    date,\n    userId,\n    size,\n    name,\n  };\n}\n\nexport function getImageMeta(content: string): {\n  date: string;\n  userId: string;\n  width: string;\n  height: string;\n} {\n  // Формат [date]$[userId]$[width]$[height]$...\n  const meta = content.split(\"$\");\n  const [date, userId, width, height] = meta;\n  return {\n    date,\n    userId,\n    width,\n    height,\n  };\n}\n\nexport function splitFileName(name: string): { name: string; ext: string } {\n  const idx = name.lastIndexOf(\".\");\n  if (idx === -1)\n    return {\n      name,\n      ext: \"\",\n    };\n  return {\n    name: name.slice(0, idx),\n    ext: name.slice(idx + 1),\n  };\n}\n\nexport const getChatId = (chat: ChatRoom | null): string | null => {\n  if (!chat) return null;\n  return (chat as Group).groupId\n    ? `group:${(chat as Group).groupId}`\n    : `user:${chat.userId}`;\n};\n\nexport const getChatName = (chat: ChatRoom): string => {\n  return (chat as Group).groupId\n    ? (chat as Group).name\n    : (chat as Contact).username;\n};\n\nexport const isGroup = (chat: ChatRoom): chat is Group => {\n  return \"groupId\" in chat;\n};\n\nexport const allGather = (chats: GroupGather | ContactGather) => {\n  return Object.values(chats)\n    .map((it) => (it?.messages != null ? it?.messages.length : 0))\n    .reduce((a: number, b: number) => a + b, 0);\n};\n\nexport const chatRoomComparer = (a: ChatRoom, b: ChatRoom): number => {\n  const hasMessagesA = Array.isArray(a.messages) && a.messages.length > 0;\n  const hasMessagesB = Array.isArray(b.messages) && b.messages.length > 0;\n  if (\n    hasMessagesA &&\n    hasMessagesB &&\n    b.messages != null &&\n    a.messages != null\n  ) {\n    // !!! if cdate === undefined !!!\n    const bb =\n      b.messages[b.messages.length - 1].cdate != null\n        ? new Date(b.messages[b.messages.length - 1].cdate).getTime()\n        : new Date().getTime();\n\n    const aa =\n      a.messages[a.messages.length - 1].cdate != null\n        ? new Date(a.messages[a.messages.length - 1].cdate).getTime()\n        : new Date().getTime() - 1;\n    const res = bb - aa;\n\n    //console.log('res', res);\n    return res;\n  }\n  if (hasMessagesA) {\n    return -1;\n  }\n  return 1;\n};\n\nexport const getParam = (param: string) => {\n  const QueryString = window.location.search;\n  const urlParams = new URLSearchParams(QueryString);\n  return urlParams.get(param);\n};\n\nexport const combineURLs = (\n  baseURL: string,\n  relativeURL: string,\n  queryParams?: Record<string, string>\n): string => {\n  const url = relativeURL\n    ? baseURL.replace(/\\/?\\/$/, \"\") + \"/\" + relativeURL.replace(/^\\/+/, \"\")\n    : baseURL;\n  if (!queryParams) return url;\n\n  return (\n    url +\n    (url.includes(\"?\") ? \"&\" : \"?\") +\n    new URLSearchParams(queryParams).toString()\n  );\n};\n","import React from \"react\";\nimport { Typography } from \"@mui/material\";\nimport { Theme } from '@mui/material/styles';\nimport { makeStyles, createStyles } from '@mui/styles';\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    typingText: {\n      paddingLeft: theme.spacing(0.5),\n    },\n    typingDot: {\n      display: \"inline-block\",\n      verticalAlign: \"middle\",\n      width: 4,\n      height: 4,\n      margin: \"0px 2px\",\n      background: theme.palette.primary.main,\n      borderRadius: \"50%\",\n      opacity: \"0\",\n      animation: \"$loadingFade 1s infinite\",\n      \"&:nth-child(1)\": {\n        animationDelay: \"0s\",\n      },\n      \"&:nth-child(2)\": {\n        animationDelay: \"0.2s\",\n      },\n      \"&:nth-child(3)\": {\n        animationDelay: \"0.4s\",\n      },\n    },\n    \"@keyframes loadingFade\": {\n      \"0%\": {\n        opacity: 0,\n      },\n      \"50%\": {\n        opacity: 0.8,\n      },\n      \"100%\": {\n        opacity: 0,\n      },\n    },\n  })\n);\n\ntype TypingProps = {\n  message: string;\n};\n\nconst Typing: React.FC<TypingProps> = (props: TypingProps) => {\n  const classes = useStyles();\n  return (\n    <Typography color=\"primary\" variant=\"body2\" component=\"span\">\n      <span className={classes.typingDot} />\n      <span className={classes.typingDot} />\n      <span className={classes.typingDot} />\n      <span className={classes.typingText}>{props.message}</span>\n    </Typography>\n  );\n};\nexport default Typing;\n","import { Typography } from \"@mui/material\";\nimport React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { Contact } from \"../types\";\nimport Typing from \"./Typing\";\n\ntype ContactStatusProps = {\n  contact: Contact;\n  isTyping: boolean;\n};\n\nconst ContactStatus: React.FC<ContactStatusProps> = (\n  props: ContactStatusProps\n) => {\n  const { t } = useTranslation();\n\n  if (props.isTyping) return <Typing message={t(\"CHAT.STATUS.TYPING\")} />;\n  if (props.contact.online === 1)\n    return (\n      <Typography variant=\"body2\" color=\"primary\" component=\"span\">\n        {t(\"CHAT.STATUS.ONLINE\")}\n      </Typography>\n    );\n  return (\n    <Typography variant=\"body2\" color=\"textSecondary\" component=\"span\">\n      {t(\"CHAT.STATUS.OFFLINE\")}\n    </Typography>\n  );\n};\n\nexport default ContactStatus;\n","import StarIcon from \"@mui/icons-material/Star\";\nimport {\n  Avatar,\n  List,\n  ListItemAvatar,\n  ListItemButton,\n  ListItemText,\n  ListProps,\n} from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport React from \"react\";\nimport { Contact } from \"../types\";\nimport { combineURLs } from \"../utils/common\";\nimport ContactStatus from \"./ContactStatus\";\n\nconst useStyles = makeStyles(() => ({\n  star: {\n    fontSize: \"0.85rem\",\n    verticalAlign: \"middle\",\n  },\n}));\n\ntype ContactListProps = {\n  apiUrl: string;\n  contacts: Contact[];\n  owner?: number;\n  onContactClick?: (contact: Contact) => void;\n};\n\nconst ContactList: React.FC<ListProps & ContactListProps> = (\n  props: ListProps & ContactListProps\n) => {\n  const classes = useStyles();\n  const { apiUrl, contacts, owner, onContactClick, ...listProps } = props;\n\n  return (\n    <List {...listProps} aria-label=\"contacts\">\n      {contacts.map((contact) => (\n        <ListItemButton\n          key={contact.userId}\n          onClick={() => onContactClick && onContactClick(contact)}\n        >\n          <ListItemAvatar>\n            <Avatar\n              alt={contact.username}\n              src={contact.avatar ? combineURLs(apiUrl, contact.avatar) : \"\"}\n            />\n          </ListItemAvatar>\n          <ListItemText\n            primary={\n              <span>\n                {contact.username}{\" \"}\n                {owner === contact.userId && (\n                  <StarIcon className={classes.star} color=\"primary\" />\n                )}\n              </span>\n            }\n            secondary={<ContactStatus contact={contact} isTyping={false} />}\n          />\n        </ListItemButton>\n      ))}\n    </List>\n  );\n};\nexport default ContactList;\n","import { Dialog, DialogTitle } from \"@mui/material\";\nimport React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { Contact } from \"../types\";\nimport ContactList from \"./ContactList\";\n\ninterface AddContactProps {\n  open: boolean;\n  apiUrl: string;\n  contacts: Contact[];\n  onClose: (value?: Contact) => void;\n}\n\nconst AddContact: React.FC<AddContactProps> = (\n  props: AddContactProps\n) => {\n  const { onClose, open, apiUrl, contacts } = props;\n  const { t } = useTranslation();\n\n  const handleClose = () => {\n    onClose();\n  };\n\n  const handleListItemClick = (contact: Contact) => {\n    onClose(contact);\n  };\n\n  return (\n    <Dialog\n      onClose={handleClose}\n      aria-labelledby=\"add-contact-title\"\n      open={open}\n    >\n      <DialogTitle id=\"switch-operator-title\">\n        {t(\"CHAT.ADD_CONTACT\")}\n      </DialogTitle>\n      <ContactList\n        apiUrl={apiUrl}\n        contacts={contacts}\n        onContactClick={handleListItemClick}\n      />\n    </Dialog>\n  );\n};\n\nexport default AddContact;","import { makeStyles } from \"@mui/styles\";\nimport React, { useEffect } from \"react\";\nimport { ConferenceData } from \"../types\";\nfunction updateUrlParameter(url: string, param: string, value: string) {\n  const regex = new RegExp(\"(\" + param + \"=)[^&]+\");\n  return url.replace(regex, \"$1\" + value);\n}\nconst transLang = (lang: string) =>\n  lang === \"ru\" ? \"rus\" : lang === \"fr\" ? \"fra\" : lang === \"en\" ? \"eng\" : \"\";\n\nconst useStyles = makeStyles(() => ({\n  root: {\n    width: \"100%\",\n    height: \"100%\",\n    borderRadius: 4,\n  },\n}));\n\ntype ConferenceProps = {\n  conference: ConferenceData | null;\n  onClose: (conference: ConferenceData | null) => void;\n  langCode?: string | null;\n};\n\nconst Conference: React.FC<ConferenceProps> = ({\n  conference,\n  onClose,\n  langCode = \"en\",\n}: ConferenceProps) => {\n  const classes = useStyles();\n  const ref = React.useRef<HTMLIFrameElement>(null);\n  const confUrl =\n    conference?.url && langCode\n      ? updateUrlParameter(conference?.url, \"lang\", transLang(langCode))\n      : \"\";\n\n  useEffect(() => {\n    const listener = ({ source, data }: MessageEvent) => {\n      if (source === ref.current?.contentWindow) {\n        const { type } = data;\n\n        if (\n          [\n            \"notSupported\",\n            \"connectionFail\",\n            // \"loginFail\",\n            \"callFail\",\n            \"hangUp\",\n            \"remoteHangUp\",\n            // \"onParticipantLeft\"\n          ].includes(type)\n        )\n          onClose(conference);\n      }\n    };\n    window.addEventListener(\"message\", listener);\n    return () => {\n      window.removeEventListener(\"message\", listener);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [conference?.id, langCode]);\n\n  return (\n    <iframe\n      title=\"conference\"\n      className={classes.root}\n      src={confUrl}\n      allowFullScreen\n      allow=\"microphone; camera; autoplay; display-capture\"\n      ref={ref}\n    />\n  );\n};\nexport default Conference;\n","import { Avatar, Button, Paper } from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { ConferenceData, Contact } from \"../types\";\nimport { combineURLs } from \"../utils/common\";\n\nconst useStyles = makeStyles(() => ({\n  root: {\n    width: \"100%\",\n    height: \"100%\",\n    borderRadius: 8,\n    display: \"flex\",\n    flexDirection: \"column\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n  },\n  pulse: {\n    height: 100,\n    width: 100,\n    borderRadius: \"50%\",\n    display: \"flex\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    position: \"relative\",\n    \"&::before\": {\n      content: \"''\",\n      position: \"absolute\",\n      border: \"1px solid green\",\n      width: \"calc(100% + 40px)\",\n      height: \"calc(100% + 40px)\",\n      borderRadius: \"50%\",\n      animation: \"$pulse 1s linear infinite\",\n    },\n    \"&::after\": {\n      content: \"''\",\n      position: \"absolute\",\n      border: \"1px solid green\",\n      width: \"calc(100% + 40px)\",\n      height: \"calc(100% + 40px)\",\n      borderRadius: \"50%\",\n      animation: \"$pulse 1s linear infinite\",\n      animationDelay: \"0.3s\",\n    },\n  },\n  avatar: {\n    width: \"80%\",\n    height: \"80%\",\n  },\n  footer: {\n    width: \"100%\",\n    alignSelf: \"flex-end\",\n    paddingTop: 64,\n    display: \"flex\",\n    justifyContent: \"center\",\n  },\n  \"@keyframes pulse\": {\n    \"0%\": {\n      transform: \"scale(0.5)\",\n      opacity: 0,\n    },\n    \"50%\": {\n      transform: \"scale(1)\",\n      opacity: 1,\n    },\n    \"100%\": {\n      transform: \"scale(1.3)\",\n      opacity: 0,\n    },\n  },\n}));\n\ntype ConferenceCallProps = {\n  conference: ConferenceData;\n  contact: Contact;\n  apiUrl: string;\n  onAccept: (conference: ConferenceData) => void;\n};\n\nconst ConferenceCall: React.FC<ConferenceCallProps> = ({\n  conference,\n  contact,\n  apiUrl,\n  onAccept,\n}: ConferenceCallProps) => {\n  const classes = useStyles();\n  const { t } = useTranslation();\n\n  return (\n    <Paper className={classes.root}>\n      <div className={classes.pulse}>\n        {contact ? (\n          <Avatar\n            className={classes.avatar}\n            alt={contact.username}\n            src={contact.avatar ? combineURLs(apiUrl, contact.avatar) : \"\"}\n          />\n        ) : (\n          <Avatar className={classes.avatar} />\n        )}\n      </div>\n      <div className={classes.footer}>\n        <Button\n          variant=\"contained\"\n          color=\"primary\"\n          onClick={() => onAccept(conference)}\n        >\n          {t(\"CHAT.CONFERENCE.JOIN\")}\n        </Button>\n      </div>\n    </Paper>\n  );\n};\n\nexport default ConferenceCall;\n","import { Box } from \"@mui/material\";\nimport { createStyles, makeStyles } from \"@mui/styles\";\nimport * as React from \"react\";\n\nconst useStyles = makeStyles(() =>\n  createStyles({\n    item: {\n      cursor: \"pointer\",\n    },\n  })\n);\n\ntype EmojiProps = {\n  onSelect?: (emoji: string) => void;\n};\n\ntype EmojiItemProps = {\n  emoji: string;\n};\n\nconst Emoji: React.FC<EmojiProps> = (props: EmojiProps) => {\n  const classes = useStyles();\n  const emojiClick = (e: React.MouseEvent<HTMLDivElement>) => {\n    if (props.onSelect) {\n      props.onSelect((e.target as HTMLDivElement).innerText);\n    }\n  };\n\n  const Item = (itemProps: EmojiItemProps) => {\n    return (\n      <Box\n        m={0.5}\n        component=\"span\"\n        onClick={emojiClick}\n        className={classes.item}\n      >\n        {itemProps.emoji}\n      </Box>\n    );\n  };\n\n  return (\n    <Box>\n      <Box display=\"flex\" flexDirection=\"row\">\n        <Item emoji=\"😃\" />\n        <Item emoji=\"😁\" />\n        <Item emoji=\"😂\" />\n        <Item emoji=\"😄\" />\n        <Item emoji=\"😅\" />\n        <Item emoji=\"😆\" />\n        <Item emoji=\"😇\" />\n        <Item emoji=\"😈\" />\n        <Item emoji=\"😉\" />\n      </Box>\n      <Box display=\"flex\" flexDirection=\"row\">\n        <Item emoji=\"😊\" />\n        <Item emoji=\"😋\" />\n        <Item emoji=\"😌\" />\n        <Item emoji=\"😍\" />\n        <Item emoji=\"😎\" />\n        <Item emoji=\"😏\" />\n        <Item emoji=\"😐\" />\n        <Item emoji=\"😒\" />\n        <Item emoji=\"😓\" />\n      </Box>\n      <Box display=\"flex\" flexDirection=\"row\">\n        <Item emoji=\"❓\" />\n        <Item emoji=\"😕\" />\n        <Item emoji=\"😖\" />\n        <Item emoji=\"😗\" />\n        <Item emoji=\"😘\" />\n        <Item emoji=\"😙\" />\n        <Item emoji=\"😚\" />\n        <Item emoji=\"😜\" />\n        <Item emoji=\"😝\" />\n      </Box>\n      <Box display=\"flex\" flexDirection=\"row\">\n        <Item emoji=\"😞\" />\n        <Item emoji=\"😟\" />\n        <Item emoji=\"😠\" />\n        <Item emoji=\"😡\" />\n        <Item emoji=\"😢\" />\n        <Item emoji=\"😣\" />\n        <Item emoji=\"😤\" />\n        <Item emoji=\"😥\" />\n        <Item emoji=\"😦\" />\n      </Box>\n      <Box display=\"flex\" flexDirection=\"row\">\n        <Item emoji=\"😨\" />\n        <Item emoji=\"😩\" />\n        <Item emoji=\"😪\" />\n        <Item emoji=\"😫\" />\n        <Item emoji=\"😬\" />\n        <Item emoji=\"😭\" />\n        <Item emoji=\"😮\" />\n        <Item emoji=\"😯\" />\n        <Item emoji=\"😰\" />\n      </Box>\n      <Box display=\"flex\" flexDirection=\"row\">\n        <Item emoji=\"😲\" />\n        <Item emoji=\"😳\" />\n        <Item emoji=\"😴\" />\n        <Item emoji=\"😵\" />\n        <Item emoji=\"🧐\" />\n        <Item emoji=\"😷\" />\n        <Item emoji=\"🙁\" />\n        <Item emoji=\"🙂\" />\n        <Item emoji=\"🙃\" />\n      </Box>\n      <Box display=\"flex\" flexDirection=\"row\">\n        <Item emoji=\"🤐\" />\n        <Item emoji=\"🤑\" />\n        <Item emoji=\"🤒\" />\n        <Item emoji=\"🤓\" />\n        <Item emoji=\"🤔\" />\n        <Item emoji=\"🤕\" />\n        <Item emoji=\"🤠\" />\n        <Item emoji=\"🤡\" />\n        <Item emoji=\"🤢\" />\n      </Box>\n      <Box display=\"flex\" flexDirection=\"row\">\n        <Item emoji=\"🤤\" />\n        <Item emoji=\"🤥\" />\n        <Item emoji=\"🤧\" />\n        <Item emoji=\"🤨\" />\n        <Item emoji=\"🤩\" />\n        <Item emoji=\"🤪\" />\n        <Item emoji=\"🤫\" />\n        <Item emoji=\"🤬\" />\n        <Item emoji=\"🤭\" />\n      </Box>\n    </Box>\n  );\n};\nexport default Emoji;\n","import { Avatar, Box } from \"@mui/material\";\nimport { Theme } from \"@mui/material/styles\";\nimport { createStyles, makeStyles } from \"@mui/styles\";\nimport React from \"react\";\nimport { ChatMessage } from \"../../types\";\nimport { getFileMeta, splitFileName } from \"../../utils/common\";\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    fileIcon: {\n      fontSize: \"0.75rem\",\n    },\n    fileBody: {\n      paddingLeft: theme.spacing(1.2),\n    },\n  })\n);\ntype FileProps = {\n  message: ChatMessage;\n};\n\nconst File: React.FC<FileProps> = ({ message }: FileProps) => {\n  const classes = useStyles();\n  const meta = getFileMeta(message.content);\n  const { name, ext } = splitFileName(meta.name);\n  return (\n    <Box display=\"flex\" flexDirection=\"row\">\n      <Avatar className={classes.fileIcon}>{ext.toUpperCase()}</Avatar>\n      <Box display=\"flex\" flexDirection=\"column\" className={classes.fileBody}>\n        {name}\n        <span>{`${ext} ${meta.size}`}</span>\n      </Box>\n    </Box>\n  );\n};\n\nexport default File;\n","import React from \"react\";\n\nimport { Theme } from \"@mui/material/styles\";\nimport { createStyles, makeStyles } from \"@mui/styles\";\nimport { AspectRatio } from \"react-aspect-ratio\";\nimport { ChatMessage } from \"../../types\";\nimport { combineURLs } from \"../../utils/common\";\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    img: {\n      cursor: \"pointer\",\n      borderRadius: theme.spacing(1.2),\n      maxWidth: 284,\n      maxHeight: 190,\n      [theme.breakpoints.down(\"sm\")]: {\n        maxWidth: 250,\n        maxHeight: 170,\n      },\n    },\n    aspect: {\n      maxWidth: 284,\n      height: 190,\n      [theme.breakpoints.down(\"sm\")]: {\n        maxWidth: 250,\n        height: 170,\n      },\n    },\n  })\n);\ntype ImageProrps = {\n  apiUrl: string;\n  message: ChatMessage;\n  setViewerData: (value: { visible: boolean; src: string }) => void;\n};\n\nconst Image: React.FC<ImageProrps> = ({\n  apiUrl,\n  message,\n  setViewerData,\n}: ImageProrps) => {\n  const classes = useStyles();\n  //const meta = getImageMeta(message.content);\n\n  return (\n    <AspectRatio ratio=\"3/4\" className={classes.aspect}>\n      <img\n        src={combineURLs(apiUrl, `/static/image/${message.content}`)}\n        onClick={() => {\n          setViewerData({\n            visible: true,\n\n            src: combineURLs(apiUrl, `/static/image/${message.content}`),\n          });\n        }}\n        className={classes.img}\n        alt={message.cdate}\n      />\n    </AspectRatio>\n  );\n};\n\nexport default Image;\n","import { Theme } from \"@mui/material/styles\";\nimport { makeStyles } from \"@mui/styles\";\nimport React from \"react\";\nimport { ChatMessage } from \"../../types\";\nimport { combineURLs } from \"../../utils/common\";\n\nconst useStyles = makeStyles((theme: Theme) => ({\n  mediaContent: {\n    backgroundColor: theme.palette.secondary.main,\n    borderRadius: theme.spacing(1.2),\n    maxWidth: 284,\n    height: 190,\n    [theme.breakpoints.down(\"sm\")]: {\n      maxWidth: 250,\n      height: 170,\n    },\n  },\n}));\n\ntype VideoProps = {\n  apiUrl: string;\n  message: ChatMessage;\n  isConference: boolean;\n};\n\nconst Video: React.FC<VideoProps> = ({\n  apiUrl,\n  message,\n  isConference,\n}: VideoProps) => {\n  const classes = useStyles();\n  let src = \"\";\n  if (isConference) {\n    const meta = JSON.parse(message.content);\n    src = combineURLs(apiUrl, `/static/conf/${meta.visitId}/${meta.name}`);\n  } else src = combineURLs(apiUrl, `/static/file/${message.content}`);\n  return (\n    <video\n      src={src}\n      className={classes.mediaContent}\n      controls\n      muted\n      preload=\"none\"\n    >\n      Ваш браузер не поддерживает тег video.\n    </video>\n  );\n};\n\nexport default Video;\n","import React from \"react\";\nimport { ChatMessage } from \"../../types\";\nimport File from \"./File\";\nimport Image from \"./Image\";\nimport Video from \"./Video\";\n\ntype MessageProps = {\n  apiUrl: string;\n  message: ChatMessage;\n  setViewerData: (value: { visible: boolean; src: string }) => void;\n};\nconst MessageContent: React.FC<MessageProps> = ({\n  apiUrl,\n  message,\n  setViewerData,\n}: MessageProps) => {\n  switch (message.messageType) {\n    case \"text\":\n      return <React.Fragment>{message.content}</React.Fragment>;\n    case \"video\":\n    case \"video_conference\":\n      return (\n        <Video\n          message={message}\n          apiUrl={apiUrl}\n          isConference={message.messageType === \"video_conference\"}\n        />\n      );\n    case \"image\":\n      return (\n        <Image\n          message={message}\n          apiUrl={apiUrl}\n          setViewerData={setViewerData}\n        />\n      );\n    case \"file\":\n      return <File message={message} />;\n  }\n  return null;\n};\n\nexport default MessageContent;\n","import { Theme } from \"@mui/material/styles\";\nimport { makeStyles, createStyles } from \"@mui/styles\";\n\nexport default makeStyles((theme: Theme) =>\n  createStyles({\n    rootContact: {\n      padding: 1,\n      paddingLeft: theme.spacing(2),\n      \"& span\": {\n        float: \"right\",\n        color: theme.palette.text.secondary,\n        fontSize: \"0.8rem\"\n      },\n      \"& $message\": {\n        backgroundColor: theme.palette.grey[200],\n        color: theme.palette.text.primary,\n        borderTopRightRadius: theme.spacing(3),\n        borderBottomRightRadius: theme.spacing(3)\n      },\n      \"& $firstMessage\": {\n        borderTopLeftRadius: theme.spacing(3),\n        marginTop: 10\n      },\n      \"& $lastMessage\": {\n        borderTopRightRadius: theme.spacing(3),\n        borderBottomLeftRadius: 0,\n        borderBottomRightRadius: theme.spacing(3),\n        marginBottom: 10\n      }\n    },\n    rootUser: {\n      padding: 1,\n      paddingRight: theme.spacing(2),\n      justifyContent: \"flex-end\",\n      \"& span\": {\n        float: \"right\",\n        color: \"#D9DEEC\",\n        fontSize: \"0.8rem\"\n      },\n      \"& $message\": {\n        backgroundColor: theme.palette.primary.main,\n        color: theme.palette.primary.contrastText,\n        borderTopLeftRadius: theme.spacing(3),\n        borderBottomLeftRadius: theme.spacing(3)\n      },\n      \"& $firstMessage\": {\n        borderTopRightRadius: theme.spacing(3),\n        marginTop: 10\n      },\n      \"& $lastMessage\": {\n        borderTopLeftRadius: theme.spacing(3),\n        borderBottomRightRadius: 0,\n        marginBottom: 10\n      }\n    },\n    rootNotify: {\n      justifyContent: \"center\",\n      \"& span\": {\n        float: \"right\",\n        color: theme.palette.text.secondary,\n        fontSize: \"0.8rem\"\n      },\n      \"& > *\": {\n        //padding: `0px ${theme.spacing(1)}`,\n        borderRadius: theme.spacing(3),\n        fontWeight: 500\n      }\n    },\n    message: {\n      //maxWidth: \"55%\",\n      //minWidth: \"50%\",\n      maxWidth: \"65%\",\n\n      [theme.breakpoints.down(\"md\")]: {\n        maxWidth: \"95%\"\n      },\n      [theme.breakpoints.down(\"sm\")]: {\n        maxWidth: \"85%\"\n      },\n      borderRadius: theme.spacing(0.6),\n      padding: theme.spacing(0.9),\n      paddingLeft: theme.spacing(1.8),\n      paddingRight: theme.spacing(1.8)\n    },\n    firstMessage: {},\n    lastMessage: {},\n\n    file: {\n      display: \"flex\",\n      flexDirection: \"row\",\n      flexWrap: \"wrap\",\n      cursor: \"pointer\"\n    },\n    header: {\n      flex: \"0 0 100%\",\n      overflow: \"hidden\",\n      fontWeight: \"bold\"\n    },\n    body: {\n      flex: \"1 1 auto\",\n      wordBreak: \"break-word\",\n      overflow: \"hidden\"\n    },\n    status: {\n      paddingLeft: theme.spacing(1),\n      flex: \"1 1 auto\",\n      alignSelf: \"flex-end\"\n    },\n    statusImage: {\n      fontSize: \"1rem\",\n      marginRight: theme.spacing(0.5),\n      verticalAlign: \"middle\"\n    }\n  })\n);\n","import { Box, Link, ListItem, Typography } from \"@mui/material\";\nimport React, { forwardRef, memo } from \"react\";\n\nimport { Done, DoneAll } from \"@mui/icons-material\";\nimport { Alert } from \"@mui/material\";\nimport { useTranslation } from \"react-i18next\";\nimport { ChatMessage, Contact, PrivateMessage, User } from \"../types\";\nimport { combineURLs, formatTime } from \"../utils/common\";\nimport MessageContent from \"./MessageContent\";\n\n/* styles */\nimport useStyles from \"./styles\";\n\ntype MessageProps = {\n  apiUrl: string;\n  user: User;\n  message: ChatMessage;\n  owner: Contact;\n  isGroupMessage: boolean; // сообщение в группу\n  isUserFirst: boolean; // начинает группу сообщений от одного пользователя\n  isUserLast: boolean; // завершает группу сообщений от одного пользователя\n  onContextMenu: (event: React.MouseEvent<HTMLElement>) => void;\n  setViewerData: (value: { visible: boolean; src: string }) => void;\n  //refOnMess: React.RefObject<HTMLDivElement> | null;\n};\n\nconst wrapMessage = (\n  apiUrl: string,\n  message: ChatMessage,\n  classes: ReturnType<typeof useStyles>,\n  isUserFirst: boolean,\n  isUserLast: boolean,\n  onContextMenu: ((event: React.MouseEvent<HTMLElement>) => void) | undefined,\n  child: React.JSX.Element\n) => {\n  const { messageType } = message;\n\n  const className =\n    isUserFirst && isUserLast\n      ? `${classes.message} ${classes.firstMessage} ${classes.lastMessage}`\n      : isUserFirst\n        ? `${classes.message} ${classes.firstMessage}`\n        : isUserLast\n          ? `${classes.message} ${classes.lastMessage}`\n          : classes.message;\n\n  if (messageType === \"file\") {\n    return (\n      <Link\n        className={`${className} ${classes.file}`}\n        underline=\"none\"\n        href={combineURLs(apiUrl, `/static/file/${message.content}`)}\n        target=\"_blank\"\n        download\n        onContextMenu={onContextMenu}\n      >\n        {child}\n      </Link>\n    );\n  }\n  const isMedia =\n    messageType === \"image\" ||\n    messageType === \"video\" ||\n    messageType === \"video_conference\";\n  return (\n    <Box\n      display=\"flex\"\n      flexDirection={isMedia ? \"column\" : \"row\"}\n      flexWrap=\"wrap\"\n      className={className}\n      onContextMenu={onContextMenu}\n    >\n      {child}\n    </Box>\n  );\n};\n\nconst Message = memo(\n  forwardRef<HTMLLIElement, MessageProps>((props, ref) => {\n    const classes = useStyles();\n    const { t } = useTranslation();\n\n    const {\n      apiUrl,\n      message,\n      owner,\n\n      user,\n      isGroupMessage,\n      isUserFirst,\n      isUserLast,\n      setViewerData,\n      //refOnMess,\n    } = props;\n    //console.log('message', message);\n\n    if (message.messageType === \"notify\") {\n      // Уведомление - особый случай\n      const content =\n        message.content[0] === \"{\"\n          ? JSON.parse(message.content)\n          : message.content;\n      return (\n        <ListItem className={classes.rootNotify} ref={ref}>\n          <Alert\n            //ref={refOnMess}\n            severity={typeof content === \"string\" ? \"info\" : content.severity}\n          >\n            {typeof content === \"string\" ? content : content.message}\n          </Alert>\n        </ListItem>\n      );\n    }\n\n    if (message.isRevoke) {\n      // Удаленное сообщение\n      return (\n        <ListItem className={classes.rootNotify} ref={ref}>\n          <Typography\n            variant=\"body2\"\n            align=\"center\"\n            //ref={refOnMess}\n          >\n            {message.userId === user.userId\n              ? t(\"CHAT.MESSAGE.REVOKED.YOU\")\n              : `${message.revokeUserName} ${t(\n                  \"CHAT.MESSAGE.REVOKED.CONTACT\"\n                )}`}\n          </Typography>\n        </ListItem>\n      );\n    }\n\n    const isMine = user.userId === message.userId;\n\n    return (\n      <ListItem\n        ref={ref}\n        className={\n          message.messageType === \"video_conference\"\n            ? classes.rootNotify\n            : isMine\n              ? classes.rootUser\n              : classes.rootContact\n        }\n      >\n        {wrapMessage(\n          apiUrl,\n          message,\n          classes,\n          isUserFirst,\n          isUserLast,\n          props.onContextMenu,\n          <React.Fragment>\n            {!isMine && isGroupMessage && owner && isUserFirst && (\n              <div className={classes.header}>{owner.username}</div>\n            )}\n            <div\n              className={classes.body}\n              //ref={refOnMess}\n            >\n              <MessageContent\n                message={message}\n                apiUrl={apiUrl}\n                setViewerData={setViewerData}\n              />\n            </div>\n            <div className={classes.status}>\n              <span>\n                {isMine ? (\n                  (message as PrivateMessage).status === 0 ? (\n                    <Done className={classes.statusImage} />\n                  ) : (\n                    <DoneAll className={classes.statusImage} />\n                  )\n                ) : null}\n                {formatTime(message.cdate)}\n              </span>\n            </div>\n          </React.Fragment>\n        )}\n      </ListItem>\n    );\n  })\n);\nMessage.displayName = \"Message\";\nexport default Message;\n","/**\n * Copyright (c) 2014-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nvar runtime = (function (exports) {\n  \"use strict\";\n\n  var Op = Object.prototype;\n  var hasOwn = Op.hasOwnProperty;\n  var undefined; // More compressible than void 0.\n  var $Symbol = typeof Symbol === \"function\" ? Symbol : {};\n  var iteratorSymbol = $Symbol.iterator || \"@@iterator\";\n  var asyncIteratorSymbol = $Symbol.asyncIterator || \"@@asyncIterator\";\n  var toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\";\n\n  function define(obj, key, value) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n    return obj[key];\n  }\n  try {\n    // IE 8 has a broken Object.defineProperty that only works on DOM objects.\n    define({}, \"\");\n  } catch (err) {\n    define = function(obj, key, value) {\n      return obj[key] = value;\n    };\n  }\n\n  function wrap(innerFn, outerFn, self, tryLocsList) {\n    // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.\n    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;\n    var generator = Object.create(protoGenerator.prototype);\n    var context = new Context(tryLocsList || []);\n\n    // The ._invoke method unifies the implementations of the .next,\n    // .throw, and .return methods.\n    generator._invoke = makeInvokeMethod(innerFn, self, context);\n\n    return generator;\n  }\n  exports.wrap = wrap;\n\n  // Try/catch helper to minimize deoptimizations. Returns a completion\n  // record like context.tryEntries[i].completion. This interface could\n  // have been (and was previously) designed to take a closure to be\n  // invoked without arguments, but in all the cases we care about we\n  // already have an existing method we want to call, so there's no need\n  // to create a new function object. We can even get away with assuming\n  // the method takes exactly one argument, since that happens to be true\n  // in every case, so we don't have to touch the arguments object. The\n  // only additional allocation required is the completion record, which\n  // has a stable shape and so hopefully should be cheap to allocate.\n  function tryCatch(fn, obj, arg) {\n    try {\n      return { type: \"normal\", arg: fn.call(obj, arg) };\n    } catch (err) {\n      return { type: \"throw\", arg: err };\n    }\n  }\n\n  var GenStateSuspendedStart = \"suspendedStart\";\n  var GenStateSuspendedYield = \"suspendedYield\";\n  var GenStateExecuting = \"executing\";\n  var GenStateCompleted = \"completed\";\n\n  // Returning this object from the innerFn has the same effect as\n  // breaking out of the dispatch switch statement.\n  var ContinueSentinel = {};\n\n  // Dummy constructor functions that we use as the .constructor and\n  // .constructor.prototype properties for functions that return Generator\n  // objects. For full spec compliance, you may wish to configure your\n  // minifier not to mangle the names of these two functions.\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n\n  // This is a polyfill for %IteratorPrototype% for environments that\n  // don't natively support it.\n  var IteratorPrototype = {};\n  define(IteratorPrototype, iteratorSymbol, function () {\n    return this;\n  });\n\n  var getProto = Object.getPrototypeOf;\n  var NativeIteratorPrototype = getProto && getProto(getProto(values([])));\n  if (NativeIteratorPrototype &&\n      NativeIteratorPrototype !== Op &&\n      hasOwn.call(NativeIteratorPrototype, iteratorSymbol)) {\n    // This environment has a native %IteratorPrototype%; use it instead\n    // of the polyfill.\n    IteratorPrototype = NativeIteratorPrototype;\n  }\n\n  var Gp = GeneratorFunctionPrototype.prototype =\n    Generator.prototype = Object.create(IteratorPrototype);\n  GeneratorFunction.prototype = GeneratorFunctionPrototype;\n  define(Gp, \"constructor\", GeneratorFunctionPrototype);\n  define(GeneratorFunctionPrototype, \"constructor\", GeneratorFunction);\n  GeneratorFunction.displayName = define(\n    GeneratorFunctionPrototype,\n    toStringTagSymbol,\n    \"GeneratorFunction\"\n  );\n\n  // Helper for defining the .next, .throw, and .return methods of the\n  // Iterator interface in terms of a single ._invoke method.\n  function defineIteratorMethods(prototype) {\n    [\"next\", \"throw\", \"return\"].forEach(function(method) {\n      define(prototype, method, function(arg) {\n        return this._invoke(method, arg);\n      });\n    });\n  }\n\n  exports.isGeneratorFunction = function(genFun) {\n    var ctor = typeof genFun === \"function\" && genFun.constructor;\n    return ctor\n      ? ctor === GeneratorFunction ||\n        // For the native GeneratorFunction constructor, the best we can\n        // do is to check its .name property.\n        (ctor.displayName || ctor.name) === \"GeneratorFunction\"\n      : false;\n  };\n\n  exports.mark = function(genFun) {\n    if (Object.setPrototypeOf) {\n      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);\n    } else {\n      genFun.__proto__ = GeneratorFunctionPrototype;\n      define(genFun, toStringTagSymbol, \"GeneratorFunction\");\n    }\n    genFun.prototype = Object.create(Gp);\n    return genFun;\n  };\n\n  // Within the body of any async function, `await x` is transformed to\n  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test\n  // `hasOwn.call(value, \"__await\")` to determine if the yielded value is\n  // meant to be awaited.\n  exports.awrap = function(arg) {\n    return { __await: arg };\n  };\n\n  function AsyncIterator(generator, PromiseImpl) {\n    function invoke(method, arg, resolve, reject) {\n      var record = tryCatch(generator[method], generator, arg);\n      if (record.type === \"throw\") {\n        reject(record.arg);\n      } else {\n        var result = record.arg;\n        var value = result.value;\n        if (value &&\n            typeof value === \"object\" &&\n            hasOwn.call(value, \"__await\")) {\n          return PromiseImpl.resolve(value.__await).then(function(value) {\n            invoke(\"next\", value, resolve, reject);\n          }, function(err) {\n            invoke(\"throw\", err, resolve, reject);\n          });\n        }\n\n        return PromiseImpl.resolve(value).then(function(unwrapped) {\n          // When a yielded Promise is resolved, its final value becomes\n          // the .value of the Promise<{value,done}> result for the\n          // current iteration.\n          result.value = unwrapped;\n          resolve(result);\n        }, function(error) {\n          // If a rejected Promise was yielded, throw the rejection back\n          // into the async generator function so it can be handled there.\n          return invoke(\"throw\", error, resolve, reject);\n        });\n      }\n    }\n\n    var previousPromise;\n\n    function enqueue(method, arg) {\n      function callInvokeWithMethodAndArg() {\n        return new PromiseImpl(function(resolve, reject) {\n          invoke(method, arg, resolve, reject);\n        });\n      }\n\n      return previousPromise =\n        // If enqueue has been called before, then we want to wait until\n        // all previous Promises have been resolved before calling invoke,\n        // so that results are always delivered in the correct order. If\n        // enqueue has not been called before, then it is important to\n        // call invoke immediately, without waiting on a callback to fire,\n        // so that the async generator function has the opportunity to do\n        // any necessary setup in a predictable way. This predictability\n        // is why the Promise constructor synchronously invokes its\n        // executor callback, and why async functions synchronously\n        // execute code before the first await. Since we implement simple\n        // async functions in terms of async generators, it is especially\n        // important to get this right, even though it requires care.\n        previousPromise ? previousPromise.then(\n          callInvokeWithMethodAndArg,\n          // Avoid propagating failures to Promises returned by later\n          // invocations of the iterator.\n          callInvokeWithMethodAndArg\n        ) : callInvokeWithMethodAndArg();\n    }\n\n    // Define the unified helper method that is used to implement .next,\n    // .throw, and .return (see defineIteratorMethods).\n    this._invoke = enqueue;\n  }\n\n  defineIteratorMethods(AsyncIterator.prototype);\n  define(AsyncIterator.prototype, asyncIteratorSymbol, function () {\n    return this;\n  });\n  exports.AsyncIterator = AsyncIterator;\n\n  // Note that simple async functions are implemented on top of\n  // AsyncIterator objects; they just return a Promise for the value of\n  // the final result produced by the iterator.\n  exports.async = function(innerFn, outerFn, self, tryLocsList, PromiseImpl) {\n    if (PromiseImpl === void 0) PromiseImpl = Promise;\n\n    var iter = new AsyncIterator(\n      wrap(innerFn, outerFn, self, tryLocsList),\n      PromiseImpl\n    );\n\n    return exports.isGeneratorFunction(outerFn)\n      ? iter // If outerFn is a generator, return the full iterator.\n      : iter.next().then(function(result) {\n          return result.done ? result.value : iter.next();\n        });\n  };\n\n  function makeInvokeMethod(innerFn, self, context) {\n    var state = GenStateSuspendedStart;\n\n    return function invoke(method, arg) {\n      if (state === GenStateExecuting) {\n        throw new Error(\"Generator is already running\");\n      }\n\n      if (state === GenStateCompleted) {\n        if (method === \"throw\") {\n          throw arg;\n        }\n\n        // Be forgiving, per 25.3.3.3.3 of the spec:\n        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume\n        return doneResult();\n      }\n\n      context.method = method;\n      context.arg = arg;\n\n      while (true) {\n        var delegate = context.delegate;\n        if (delegate) {\n          var delegateResult = maybeInvokeDelegate(delegate, context);\n          if (delegateResult) {\n            if (delegateResult === ContinueSentinel) continue;\n            return delegateResult;\n          }\n        }\n\n        if (context.method === \"next\") {\n          // Setting context._sent for legacy support of Babel's\n          // function.sent implementation.\n          context.sent = context._sent = context.arg;\n\n        } else if (context.method === \"throw\") {\n          if (state === GenStateSuspendedStart) {\n            state = GenStateCompleted;\n            throw context.arg;\n          }\n\n          context.dispatchException(context.arg);\n\n        } else if (context.method === \"return\") {\n          context.abrupt(\"return\", context.arg);\n        }\n\n        state = GenStateExecuting;\n\n        var record = tryCatch(innerFn, self, context);\n        if (record.type === \"normal\") {\n          // If an exception is thrown from innerFn, we leave state ===\n          // GenStateExecuting and loop back for another invocation.\n          state = context.done\n            ? GenStateCompleted\n            : GenStateSuspendedYield;\n\n          if (record.arg === ContinueSentinel) {\n            continue;\n          }\n\n          return {\n            value: record.arg,\n            done: context.done\n          };\n\n        } else if (record.type === \"throw\") {\n          state = GenStateCompleted;\n          // Dispatch the exception by looping back around to the\n          // context.dispatchException(context.arg) call above.\n          context.method = \"throw\";\n          context.arg = record.arg;\n        }\n      }\n    };\n  }\n\n  // Call delegate.iterator[context.method](context.arg) and handle the\n  // result, either by returning a { value, done } result from the\n  // delegate iterator, or by modifying context.method and context.arg,\n  // setting context.delegate to null, and returning the ContinueSentinel.\n  function maybeInvokeDelegate(delegate, context) {\n    var method = delegate.iterator[context.method];\n    if (method === undefined) {\n      // A .throw or .return when the delegate iterator has no .throw\n      // method always terminates the yield* loop.\n      context.delegate = null;\n\n      if (context.method === \"throw\") {\n        // Note: [\"return\"] must be used for ES3 parsing compatibility.\n        if (delegate.iterator[\"return\"]) {\n          // If the delegate iterator has a return method, give it a\n          // chance to clean up.\n          context.method = \"return\";\n          context.arg = undefined;\n          maybeInvokeDelegate(delegate, context);\n\n          if (context.method === \"throw\") {\n            // If maybeInvokeDelegate(context) changed context.method from\n            // \"return\" to \"throw\", let that override the TypeError below.\n            return ContinueSentinel;\n          }\n        }\n\n        context.method = \"throw\";\n        context.arg = new TypeError(\n          \"The iterator does not provide a 'throw' method\");\n      }\n\n      return ContinueSentinel;\n    }\n\n    var record = tryCatch(method, delegate.iterator, context.arg);\n\n    if (record.type === \"throw\") {\n      context.method = \"throw\";\n      context.arg = record.arg;\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    var info = record.arg;\n\n    if (! info) {\n      context.method = \"throw\";\n      context.arg = new TypeError(\"iterator result is not an object\");\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    if (info.done) {\n      // Assign the result of the finished delegate to the temporary\n      // variable specified by delegate.resultName (see delegateYield).\n      context[delegate.resultName] = info.value;\n\n      // Resume execution at the desired location (see delegateYield).\n      context.next = delegate.nextLoc;\n\n      // If context.method was \"throw\" but the delegate handled the\n      // exception, let the outer generator proceed normally. If\n      // context.method was \"next\", forget context.arg since it has been\n      // \"consumed\" by the delegate iterator. If context.method was\n      // \"return\", allow the original .return call to continue in the\n      // outer generator.\n      if (context.method !== \"return\") {\n        context.method = \"next\";\n        context.arg = undefined;\n      }\n\n    } else {\n      // Re-yield the result returned by the delegate method.\n      return info;\n    }\n\n    // The delegate iterator is finished, so forget it and continue with\n    // the outer generator.\n    context.delegate = null;\n    return ContinueSentinel;\n  }\n\n  // Define Generator.prototype.{next,throw,return} in terms of the\n  // unified ._invoke helper method.\n  defineIteratorMethods(Gp);\n\n  define(Gp, toStringTagSymbol, \"Generator\");\n\n  // A Generator should always return itself as the iterator object when the\n  // @@iterator function is called on it. Some browsers' implementations of the\n  // iterator prototype chain incorrectly implement this, causing the Generator\n  // object to not be returned from this call. This ensures that doesn't happen.\n  // See https://github.com/facebook/regenerator/issues/274 for more details.\n  define(Gp, iteratorSymbol, function() {\n    return this;\n  });\n\n  define(Gp, \"toString\", function() {\n    return \"[object Generator]\";\n  });\n\n  function pushTryEntry(locs) {\n    var entry = { tryLoc: locs[0] };\n\n    if (1 in locs) {\n      entry.catchLoc = locs[1];\n    }\n\n    if (2 in locs) {\n      entry.finallyLoc = locs[2];\n      entry.afterLoc = locs[3];\n    }\n\n    this.tryEntries.push(entry);\n  }\n\n  function resetTryEntry(entry) {\n    var record = entry.completion || {};\n    record.type = \"normal\";\n    delete record.arg;\n    entry.completion = record;\n  }\n\n  function Context(tryLocsList) {\n    // The root entry object (effectively a try statement without a catch\n    // or a finally block) gives us a place to store values thrown from\n    // locations where there is no enclosing try statement.\n    this.tryEntries = [{ tryLoc: \"root\" }];\n    tryLocsList.forEach(pushTryEntry, this);\n    this.reset(true);\n  }\n\n  exports.keys = function(object) {\n    var keys = [];\n    for (var key in object) {\n      keys.push(key);\n    }\n    keys.reverse();\n\n    // Rather than returning an object with a next method, we keep\n    // things simple and return the next function itself.\n    return function next() {\n      while (keys.length) {\n        var key = keys.pop();\n        if (key in object) {\n          next.value = key;\n          next.done = false;\n          return next;\n        }\n      }\n\n      // To avoid creating an additional object, we just hang the .value\n      // and .done properties off the next function object itself. This\n      // also ensures that the minifier will not anonymize the function.\n      next.done = true;\n      return next;\n    };\n  };\n\n  function values(iterable) {\n    if (iterable) {\n      var iteratorMethod = iterable[iteratorSymbol];\n      if (iteratorMethod) {\n        return iteratorMethod.call(iterable);\n      }\n\n      if (typeof iterable.next === \"function\") {\n        return iterable;\n      }\n\n      if (!isNaN(iterable.length)) {\n        var i = -1, next = function next() {\n          while (++i < iterable.length) {\n            if (hasOwn.call(iterable, i)) {\n              next.value = iterable[i];\n              next.done = false;\n              return next;\n            }\n          }\n\n          next.value = undefined;\n          next.done = true;\n\n          return next;\n        };\n\n        return next.next = next;\n      }\n    }\n\n    // Return an iterator with no values.\n    return { next: doneResult };\n  }\n  exports.values = values;\n\n  function doneResult() {\n    return { value: undefined, done: true };\n  }\n\n  Context.prototype = {\n    constructor: Context,\n\n    reset: function(skipTempReset) {\n      this.prev = 0;\n      this.next = 0;\n      // Resetting context._sent for legacy support of Babel's\n      // function.sent implementation.\n      this.sent = this._sent = undefined;\n      this.done = false;\n      this.delegate = null;\n\n      this.method = \"next\";\n      this.arg = undefined;\n\n      this.tryEntries.forEach(resetTryEntry);\n\n      if (!skipTempReset) {\n        for (var name in this) {\n          // Not sure about the optimal order of these conditions:\n          if (name.charAt(0) === \"t\" &&\n              hasOwn.call(this, name) &&\n              !isNaN(+name.slice(1))) {\n            this[name] = undefined;\n          }\n        }\n      }\n    },\n\n    stop: function() {\n      this.done = true;\n\n      var rootEntry = this.tryEntries[0];\n      var rootRecord = rootEntry.completion;\n      if (rootRecord.type === \"throw\") {\n        throw rootRecord.arg;\n      }\n\n      return this.rval;\n    },\n\n    dispatchException: function(exception) {\n      if (this.done) {\n        throw exception;\n      }\n\n      var context = this;\n      function handle(loc, caught) {\n        record.type = \"throw\";\n        record.arg = exception;\n        context.next = loc;\n\n        if (caught) {\n          // If the dispatched exception was caught by a catch block,\n          // then let that catch block handle the exception normally.\n          context.method = \"next\";\n          context.arg = undefined;\n        }\n\n        return !! caught;\n      }\n\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        var record = entry.completion;\n\n        if (entry.tryLoc === \"root\") {\n          // Exception thrown outside of any try block that could handle\n          // it, so set the completion value of the entire function to\n          // throw the exception.\n          return handle(\"end\");\n        }\n\n        if (entry.tryLoc <= this.prev) {\n          var hasCatch = hasOwn.call(entry, \"catchLoc\");\n          var hasFinally = hasOwn.call(entry, \"finallyLoc\");\n\n          if (hasCatch && hasFinally) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            } else if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else if (hasCatch) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            }\n\n          } else if (hasFinally) {\n            if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else {\n            throw new Error(\"try statement without catch or finally\");\n          }\n        }\n      }\n    },\n\n    abrupt: function(type, arg) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc <= this.prev &&\n            hasOwn.call(entry, \"finallyLoc\") &&\n            this.prev < entry.finallyLoc) {\n          var finallyEntry = entry;\n          break;\n        }\n      }\n\n      if (finallyEntry &&\n          (type === \"break\" ||\n           type === \"continue\") &&\n          finallyEntry.tryLoc <= arg &&\n          arg <= finallyEntry.finallyLoc) {\n        // Ignore the finally entry if control is not jumping to a\n        // location outside the try/catch block.\n        finallyEntry = null;\n      }\n\n      var record = finallyEntry ? finallyEntry.completion : {};\n      record.type = type;\n      record.arg = arg;\n\n      if (finallyEntry) {\n        this.method = \"next\";\n        this.next = finallyEntry.finallyLoc;\n        return ContinueSentinel;\n      }\n\n      return this.complete(record);\n    },\n\n    complete: function(record, afterLoc) {\n      if (record.type === \"throw\") {\n        throw record.arg;\n      }\n\n      if (record.type === \"break\" ||\n          record.type === \"continue\") {\n        this.next = record.arg;\n      } else if (record.type === \"return\") {\n        this.rval = this.arg = record.arg;\n        this.method = \"return\";\n        this.next = \"end\";\n      } else if (record.type === \"normal\" && afterLoc) {\n        this.next = afterLoc;\n      }\n\n      return ContinueSentinel;\n    },\n\n    finish: function(finallyLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.finallyLoc === finallyLoc) {\n          this.complete(entry.completion, entry.afterLoc);\n          resetTryEntry(entry);\n          return ContinueSentinel;\n        }\n      }\n    },\n\n    \"catch\": function(tryLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc === tryLoc) {\n          var record = entry.completion;\n          if (record.type === \"throw\") {\n            var thrown = record.arg;\n            resetTryEntry(entry);\n          }\n          return thrown;\n        }\n      }\n\n      // The context.catch method must only be called with a location\n      // argument that corresponds to a known catch block.\n      throw new Error(\"illegal catch attempt\");\n    },\n\n    delegateYield: function(iterable, resultName, nextLoc) {\n      this.delegate = {\n        iterator: values(iterable),\n        resultName: resultName,\n        nextLoc: nextLoc\n      };\n\n      if (this.method === \"next\") {\n        // Deliberately forget the last sent value so that we don't\n        // accidentally pass it on to the delegate.\n        this.arg = undefined;\n      }\n\n      return ContinueSentinel;\n    }\n  };\n\n  // Regardless of whether this script is executing as a CommonJS module\n  // or not, return the runtime object so that we can declare the variable\n  // regeneratorRuntime in the outer scope, which allows this module to be\n  // injected easily by `bin/regenerator --include-runtime script.js`.\n  return exports;\n\n}(\n  // If this script is executing as a CommonJS module, use module.exports\n  // as the regeneratorRuntime namespace. Otherwise create a new empty\n  // object. Either way, the resulting object will be used to initialize\n  // the regeneratorRuntime variable at the top of this file.\n  typeof module === \"object\" ? module.exports : {}\n));\n\ntry {\n  regeneratorRuntime = runtime;\n} catch (accidentalStrictMode) {\n  // This module should not be running in strict mode, so the above\n  // assignment should always work unless something is misconfigured. Just\n  // in case runtime.js accidentally runs in strict mode, in modern engines\n  // we can explicitly access globalThis. In older engines we can escape\n  // strict mode using a global Function call. This could conceivably fail\n  // if a Content Security Policy forbids using Function, but in that case\n  // the proper solution is to fix the accidental strict mode problem. If\n  // you've misconfigured your bundler to force strict mode and applied a\n  // CSP to forbid Function, and you're not willing to fix either of those\n  // problems, please detail your unique predicament in a GitHub issue.\n  if (typeof globalThis === \"object\") {\n    globalThis.regeneratorRuntime = runtime;\n  } else {\n    Function(\"r\", \"regeneratorRuntime = r\")(runtime);\n  }\n}\n","import { InsertEmoticon, Send } from \"@mui/icons-material\";\nimport {\n  Box,\n  CircularProgress,\n  IconButton,\n  InputAdornment,\n  Popover,\n  SvgIcon,\n  TextField,\n} from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport React, { KeyboardEvent, useCallback, useRef, useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { ChatRoom, ImageSize, SendMessage } from \"../types\";\nimport Emoji from \"./Emoji\";\n\nconst MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB\nconst ALLOWED_FILE_TYPES = {\n  image: [\"image/jpeg\", \"image/png\", \"image/gif\", \"image/bmp\"],\n  video: [\"video/mp4\", \"video/webm\"],\n  file: [\"application/pdf\"],\n};\n\nconst MAX_IMAGE_DIMENSION = 335;\n\nconst useStyles = makeStyles(() => ({\n  input: {\n    flex: \"auto\",\n  },\n  inputUpload: {\n    display: \"none\",\n  },\n  attachmentIcon: {\n    fill: \"none\",\n    stroke: \"currentColor\",\n  },\n  error: {\n    color: \"red\",\n    fontSize: \"0.75rem\",\n    marginTop: \"4px\",\n  },\n}));\n\ninterface EntryProps {\n  chat: ChatRoom | null;\n  onTyping?: (chat: ChatRoom) => void;\n  onSendMessage?: (chat: ChatRoom, data: SendMessage) => void;\n  maxMessageLength?: number;\n}\n\nconst getImageSize = (data: ImageSize): ImageSize => {\n  let { width, height } = data;\n\n  if (width > MAX_IMAGE_DIMENSION || height > MAX_IMAGE_DIMENSION) {\n    if (width > height) {\n      height = MAX_IMAGE_DIMENSION * (height / width);\n      width = MAX_IMAGE_DIMENSION;\n    } else {\n      width = MAX_IMAGE_DIMENSION * (width / height);\n      height = MAX_IMAGE_DIMENSION;\n    }\n  }\n\n  return { width, height };\n};\n\nconst Entry: React.FC<EntryProps> = ({\n  chat,\n  onTyping,\n  onSendMessage,\n  maxMessageLength = 1000,\n}) => {\n  const classes = useStyles();\n  const { t } = useTranslation();\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const [emojiAnchorEl, setEmojiAnchorEl] = useState<HTMLButtonElement | null>(\n    null\n  );\n\n  const textRef = useRef<HTMLInputElement>(null);\n  const textValueRef = useRef(\"\");\n\n  const [error, setError] = useState<string>(\"\");\n  const [isUploading, setIsUploading] = useState(false);\n  const [lastTyping, setLastTyping] = useState({\n    chat,\n    time: 0,\n  });\n\n  const handleEmojiClick = (event: React.MouseEvent<HTMLButtonElement>) => {\n    setEmojiAnchorEl(event.currentTarget);\n  };\n\n  const handleEmojiClose = () => {\n    setEmojiAnchorEl(null);\n  };\n\n  const emojiSelect = useCallback((emoji: string) => {\n    if (textRef.current) {\n      const newValue = textValueRef.current + emoji;\n      textValueRef.current = newValue;\n      textRef.current.value = newValue;\n    }\n    handleEmojiClose();\n  }, []);\n\n  const handleTyping = useCallback(\n    (e: React.ChangeEvent<HTMLInputElement>) => {\n      const newText = e.target.value;\n      textValueRef.current = newText;\n\n      if (\n        chat &&\n        onTyping &&\n        (lastTyping.chat !== chat || Date.now() - lastTyping.time >= 500)\n      ) {\n        setLastTyping({\n          chat,\n          time: Date.now(),\n        });\n        onTyping(chat);\n      }\n    },\n    [chat, onTyping, lastTyping.chat]\n  );\n\n  const sendMessage = useCallback(\n    (data: SendMessage) => {\n      if (!chat || !onSendMessage) return;\n      onSendMessage(chat, data);\n    },\n    [chat, onSendMessage]\n  );\n\n  const validateMessage = (message: string): boolean => {\n    if (message.trim().length === 0) {\n      setError(t(\"CHAT.ERROR.EMPTY_MESSAGE\"));\n      return false;\n    }\n    if (message.length > maxMessageLength) {\n      setError(t(\"CHAT.ERROR.MESSAGE_TOO_LONG\"));\n      return false;\n    }\n    setError(\"\");\n    return true;\n  };\n\n  const handleSubmit = useCallback(() => {\n    const currentText = textValueRef.current;\n    if (!validateMessage(currentText)) return;\n\n    sendMessage({ message: currentText, messageType: \"text\" });\n\n    if (textRef.current) {\n      textRef.current.value = \"\";\n      textValueRef.current = \"\";\n    }\n    setError(\"\");\n  }, [sendMessage]);\n\n  const handleFileUpload = async (\n    event: React.ChangeEvent<HTMLInputElement>\n  ) => {\n    const file = event.target.files?.[0];\n    if (!file) return;\n\n    if (file.size > MAX_FILE_SIZE) {\n      setError(t(\"CHAT.ERROR.FILE_TOO_LARGE\"));\n      return;\n    }\n\n    try {\n      setIsUploading(true);\n      setError(\"\");\n\n      const messageType =\n        Object.entries(ALLOWED_FILE_TYPES).find(([, types]) =>\n          types.includes(file.type)\n        )?.[0] || \"file\";\n\n      if (messageType === \"image\") {\n        const imageSize = await new Promise<ImageSize>((resolve) => {\n          const image = new Image();\n          const url = URL.createObjectURL(file);\n          image.onload = () => {\n            URL.revokeObjectURL(url);\n            resolve(\n              getImageSize({\n                width: image.width,\n                height: image.height,\n              })\n            );\n          };\n          image.src = url;\n        });\n\n        sendMessage({\n          message: file,\n          width: imageSize.width,\n          height: imageSize.height,\n          messageType,\n        });\n      } else {\n        sendMessage({\n          message: file,\n          messageType,\n          fileName: file.name,\n          size: file.size,\n        });\n      }\n    } catch (err) {\n      setError(t(\"CHAT.ERROR.UPLOAD_FAILED\"));\n    } finally {\n      setIsUploading(false);\n      if (fileInputRef.current) {\n        fileInputRef.current.value = \"\";\n      }\n    }\n  };\n\n  const onKeyDown = (event: KeyboardEvent<HTMLInputElement>) => {\n    if (event.key === \"Enter\" && !event.shiftKey) {\n      event.preventDefault();\n      handleSubmit();\n    }\n  };\n\n  return (\n    <Box display=\"flex\" flexDirection=\"column\">\n      <TextField\n        className={classes.input}\n        placeholder={t(\"CHAT.INPUT_MESSAGE\") || \"\"}\n        autoFocus\n        variant=\"standard\"\n        error={!!error}\n        disabled={isUploading}\n        inputRef={textRef}\n        slotProps={{\n          input: {\n            autoComplete: \"off\",\n            inputProps: {\n              maxLength: maxMessageLength,\n            },\n\n            disableUnderline: true,\n            startAdornment: (\n              <InputAdornment position=\"start\">\n                <input\n                  ref={fileInputRef}\n                  accept={Object.values(ALLOWED_FILE_TYPES).flat().join(\",\")}\n                  className={classes.inputUpload}\n                  id=\"icon-button-file\"\n                  type=\"file\"\n                  onChange={handleFileUpload}\n                  disabled={isUploading}\n                />\n                <label htmlFor=\"icon-button-file\">\n                  <IconButton\n                    color=\"primary\"\n                    aria-label=\"upload\"\n                    component=\"span\"\n                    size=\"small\"\n                    disabled={isUploading}\n                  >\n                    {isUploading ? (\n                      <CircularProgress size={24} />\n                    ) : (\n                      <SvgIcon className={classes.attachmentIcon}>\n                        <path\n                          d=\"M16.768 13.5767L11.6961 18.6486C9.35886 20.9859 5.56937 20.9859 3.23208 18.6486V18.6486C0.894789 16.3114 0.894789 12.5219 3.23208 10.1846L10.4479 2.96872C12.0875 1.32914 14.7458 1.32914 16.3854 2.96873V2.96873C18.025 4.60831 18.025 7.26659 16.3854 8.90617L9.16515 16.1264C8.23032 17.0612 6.71466 17.0612 5.77982 16.1264V16.1264C4.84499 15.1916 4.84499 13.6759 5.77982 12.7411L10.8896 7.63131\"\n                          strokeWidth=\"1.6\"\n                          strokeLinecap=\"round\"\n                          strokeLinejoin=\"round\"\n                        />\n                      </SvgIcon>\n                    )}\n                  </IconButton>\n                </label>\n                <IconButton\n                  aria-describedby={\n                    Boolean(emojiAnchorEl) ? \"emoji-popover\" : undefined\n                  }\n                  onClick={handleEmojiClick}\n                  color=\"primary\"\n                  size=\"small\"\n                  disabled={isUploading}\n                >\n                  <InsertEmoticon />\n                </IconButton>\n              </InputAdornment>\n            ),\n            endAdornment: (\n              <IconButton\n                edge=\"end\"\n                color=\"inherit\"\n                size=\"small\"\n                onClick={handleSubmit}\n                disabled={isUploading || !textValueRef.current.trim()}\n              >\n                <Send />\n              </IconButton>\n            ),\n            onKeyDown,\n          },\n        }}\n        onChange={handleTyping}\n      />\n      {error && <div className={classes.error}>{error}</div>}\n      <Popover\n        id=\"emoji-popover\"\n        open={Boolean(emojiAnchorEl)}\n        anchorEl={emojiAnchorEl}\n        onClose={handleEmojiClose}\n        anchorOrigin={{\n          vertical: \"top\",\n          horizontal: \"center\",\n        }}\n        transformOrigin={{\n          vertical: \"bottom\",\n          horizontal: \"left\",\n        }}\n      >\n        <Emoji onSelect={emojiSelect} />\n      </Popover>\n    </Box>\n  );\n};\n\nexport default Entry;\n","import { Typography } from \"@mui/material\";\nimport Button from \"@mui/material/Button\";\nimport Dialog from \"@mui/material/Dialog\";\nimport DialogActions from \"@mui/material/DialogActions\";\nimport DialogContent from \"@mui/material/DialogContent\";\nimport Slide from \"@mui/material/Slide\";\nimport { TransitionProps } from \"@mui/material/transitions\";\nimport * as React from \"react\";\nimport { useTranslation } from \"react-i18next\";\n\nconst Transition = React.forwardRef(function Transition(\n  props: TransitionProps & {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    children: React.ReactElement<any, any>;\n  },\n  ref: React.Ref<unknown>\n) {\n  return <Slide direction=\"up\" ref={ref} {...props} />;\n});\n\ntype ConfirmDialogSlideProps = {\n  open: boolean;\n  contentText: string;\n  setOpen: (open: boolean) => void;\n  callback: () => void;\n};\nexport default function ConfirmDialogSlide({\n  open,\n  setOpen,\n  contentText,\n  callback,\n}: ConfirmDialogSlideProps) {\n  const { t } = useTranslation();\n\n  const handleClose = () => {\n    setOpen(false);\n  };\n  const handleCloseOk = () => {\n    setOpen(false);\n    callback();\n  };\n\n  return (\n    <React.Fragment>\n      <Dialog\n        open={open}\n        TransitionComponent={Transition}\n        keepMounted\n        onClose={handleClose}\n        aria-describedby=\"alert-dialog-slide-description\"\n      >\n        <DialogContent>\n          <Typography variant=\"h6\">{contentText}</Typography>\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={handleClose} color=\"primary\">\n            {t(\"CHAT.BUT_CLOSE\")}\n          </Button>\n          <Button onClick={handleCloseOk} color=\"warning\">\n            {t(\"CHAT.BUT_CONFIRM\")}\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </React.Fragment>\n  );\n}\n","import KeyboardArrowDownIcon from \"@mui/icons-material/KeyboardArrowDown\";\nimport PlayArrowIcon from \"@mui/icons-material/PlayArrow\";\nimport RestartAltIcon from \"@mui/icons-material/RestartAlt\";\nimport VideoCallIcon from \"@mui/icons-material/VideoCall\";\nimport Button from \"@mui/material/Button\";\nimport Menu, { MenuProps } from \"@mui/material/Menu\";\nimport MenuItem from \"@mui/material/MenuItem\";\nimport { alpha, styled } from \"@mui/material/styles\";\nimport React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { ChatRoom, VisitData } from \"../types\";\nimport { formatTime } from \"../utils/common\";\nimport ConfirmDialogSlide from \"./ConfirmDialogSlide\";\n\nconst StyledMenu = styled((props: MenuProps) => (\n  <Menu\n    elevation={0}\n    anchorOrigin={{\n      vertical: \"bottom\",\n      horizontal: \"right\",\n    }}\n    transformOrigin={{\n      vertical: \"top\",\n      horizontal: \"right\",\n    }}\n    {...props}\n  />\n))(({ theme }) => ({\n  \"& .MuiPaper-root\": {\n    borderRadius: 6,\n    marginTop: theme.spacing(1),\n    minWidth: 180,\n    color:\n      theme.palette.mode === \"light\"\n        ? \"rgb(55, 65, 81)\"\n        : theme.palette.grey[300],\n    boxShadow:\n      \"rgb(255, 255, 255) 0px 0px 0px 0px, rgba(0, 0, 0, 0.05) 0px 0px 0px 1px, rgba(0, 0, 0, 0.1) 0px 10px 15px -3px, rgba(0, 0, 0, 0.05) 0px 4px 6px -2px\",\n    \"& .MuiMenu-list\": {\n      padding: \"4px 0\",\n    },\n    \"& .MuiMenuItem-root\": {\n      \"& .MuiSvgIcon-root\": {\n        fontSize: 18,\n        color: theme.palette.text.secondary,\n        marginRight: theme.spacing(1.5),\n      },\n      \"&:active\": {\n        backgroundColor: alpha(\n          theme.palette.primary.main,\n          theme.palette.action.selectedOpacity\n        ),\n      },\n    },\n  },\n}));\n\ntype ConferenceButtonProps = {\n  visitData: VisitData[];\n  chat: ChatRoom;\n  onVideoCall: (chat: ChatRoom, visitId?: number, recreate?: boolean) => void;\n};\n\nconst getVisitMessage = (visit: VisitData) => {\n  const visitDate = new Date(visit.visitDate);\n\n  return `${visit.plExamName} (${formatTime(visitDate, \"HH:mm\")} - ${formatTime(\n    new Date(visitDate.getTime() + visit.duration * 60_000),\n    \"HH:mm\"\n  )})`;\n};\n\nexport default function ConferenceButton(props: ConferenceButtonProps) {\n  const { t } = useTranslation();\n  const [anchorEl, setAnchorEl] = React.useState<null | HTMLElement>(null);\n\n  const [visitId, setVisitId] = React.useState<number | null>(null);\n  const [confirmReCreateVisit, setConfirmReCreateVisit] = React.useState(false);\n  const open = Boolean(anchorEl);\n  const handleClick = (event: React.MouseEvent<HTMLElement>) => {\n    setAnchorEl(event.currentTarget);\n  };\n  const handleClose = () => {\n    setAnchorEl(null);\n  };\n\n  const handleStart = (item: VisitData) => {\n    setAnchorEl(null);\n    setVisitId(item.visitId);\n    if (item.conferenceStatus === \"finished\") {\n      setConfirmReCreateVisit(true);\n    } else {\n      props.onVideoCall(props.chat, item.visitId);\n    }\n  };\n\n  const visitData = React.useMemo(() => {\n    return props.visitData.filter((it) => it.contactId === props.chat.userId);\n  }, [props.visitData, props.chat]);\n\n  /**\n   * <Button\n                  aria-label=\"video call\"\n                  variant=\"contained\"\n                  color=\"primary\"\n                  size=\"small\"\n                  startIcon={<VideoCallIcon />}\n                  onClick={() =>\n                    visitId &&\n                    !isEmpty(\n                      visitData.find(\n                        (it) =>\n                          it.conferenceStatus === 'finished' &&\n                          it.visitId === Number(visitId),\n                      ),\n                    )\n                      ? setConfirmReCreateVisit(true)\n                      : onVideoCall(contact, null)\n                  }\n                  fullWidth\n                >\n                  {t(\n                    visitId\n                      ? 'CHAT.CONFERENCE.RESTART'\n                      : 'CHAT.CONFERENCE.START',\n                  )}\n                </Button>              \n   */\n\n  return (\n    <div>\n      <Button\n        id=\"conference-button\"\n        aria-controls={open ? \"conference-menu\" : undefined}\n        aria-haspopup=\"true\"\n        aria-expanded={open ? \"true\" : undefined}\n        color=\"primary\"\n        size=\"small\"\n        variant=\"contained\"\n        disableElevation\n        onClick={handleClick}\n        startIcon={<VideoCallIcon />}\n        endIcon={<KeyboardArrowDownIcon />}\n        disabled={visitData.length === 0}\n      >\n        {t(\"CHAT.CONFERENCE.START\")}\n      </Button>\n      <ConfirmDialogSlide\n        open={confirmReCreateVisit}\n        setOpen={setConfirmReCreateVisit}\n        contentText={t(\"CHAT.CONFERENCE.CONFIRM_RECREATE_CONF\")}\n        callback={() => {\n          if (visitId && confirmReCreateVisit) {\n            props.onVideoCall(props.chat, visitId, true);\n          }\n        }}\n      />\n      <StyledMenu\n        id=\"conference-menu\"\n        MenuListProps={{\n          \"aria-labelledby\": \"conference-button\",\n        }}\n        anchorEl={anchorEl}\n        open={open}\n        onClose={handleClose}\n      >\n        {visitData.map((item) => {\n          return (\n            <MenuItem\n              onClick={() => handleStart(item)}\n              key={item.visitId}\n              value={item.visitId}\n              disableRipple\n            >\n              {item.conferenceStatus === \"finished\" ? (\n                <RestartAltIcon />\n              ) : (\n                <PlayArrowIcon />\n              )}\n              {getVisitMessage(item)}\n            </MenuItem>\n          );\n        })}\n      </StyledMenu>\n    </div>\n  );\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport {\n  Alert,\n  AlertColor,\n  Button,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  Slide,\n  Typography,\n} from \"@mui/material\";\nimport React from \"react\";\nimport { useTranslation } from \"react-i18next\";\n\nimport { TransitionProps } from \"@mui/material/transitions\";\n\nconst Transition = React.forwardRef(function Transition(\n  props: TransitionProps & {\n    children: React.ReactElement<any, any>;\n  },\n  ref: React.Ref<unknown>\n) {\n  return <Slide direction=\"up\" ref={ref} {...props} />;\n});\n\ntype AlertDialogProps = {\n  children: React.JSX.Element | React.JSX.Element[] | string;\n  open: boolean;\n  setOpen: (value: boolean) => void;\n  severity: AlertColor;\n};\n\nexport default function AlertDialog({\n  children,\n  open,\n  setOpen,\n  severity = \"warning\",\n}: AlertDialogProps) {\n  const { t } = useTranslation();\n\n  const handleClose = () => {\n    setOpen(false);\n  };\n  return (\n    <Dialog\n      open={open}\n      TransitionComponent={Transition}\n      keepMounted\n      onClose={handleClose}\n      aria-labelledby=\"alert-dialog-title\"\n      aria-describedby=\"alert-dialog-description\"\n    >\n      <DialogContent>\n        <Alert severity={severity}>\n          {typeof children === \"string\" ? (\n            <Typography variant=\"body2\">{children}</Typography>\n          ) : (\n            children\n          )}\n        </Alert>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={handleClose} variant=\"text\">\n          {t(\"CHAT.BUT_CLOSE\")}\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n}\n","import { Box, Typography } from \"@mui/material\";\nimport React, { useEffect, useMemo, useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport useCounter from \"../hooks/useCounter\";\nimport AlertDialog from \"./AlertDialog\";\n//import { useTranslation } from \"react-i18next\";\n\nconst hhMmSs = (totalSeconds: number) => {\n  const hours = Math.floor(totalSeconds / 3600);\n  const strHours = hours < 10 ? `0${hours}` : hours;\n  totalSeconds %= 3600;\n  const minutes = Math.floor(totalSeconds / 60);\n  const strMinutes = minutes < 10 ? `0${minutes}` : minutes;\n  const seconds = totalSeconds % 60;\n  const strSeconds = seconds < 10 ? `0${seconds}` : seconds;\n\n  const strTime = `${strHours}:${strMinutes}:${strSeconds}`;\n  return { hours, minutes, seconds, strTime };\n};\ntype AlertModaleProps = {\n  modaleInfo: boolean;\n  setModaleInfo: (vars: boolean) => void;\n  strTime: string;\n};\nconst AlertModale: React.FC<AlertModaleProps> = ({\n  modaleInfo,\n  setModaleInfo,\n  strTime,\n}) => {\n  const { t } = useTranslation();\n  return useMemo(\n    () => (\n      <AlertDialog open={modaleInfo} setOpen={setModaleInfo} severity=\"info\">\n        <Typography variant=\"body1\" textAlign=\"center\">\n          {t(\"CHAT.CONFERENCE.UntillTheEnd\")}:\n        </Typography>\n        <Typography variant=\"h6\" textAlign=\"center\">\n          {strTime}\n        </Typography>\n      </AlertDialog>\n    ),\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [modaleInfo]\n  );\n};\n\ntype ConferenceTimeProps = {\n  finishDate: Date;\n};\nconst ConferenceTime: React.FC<ConferenceTimeProps> = ({\n  finishDate,\n}: ConferenceTimeProps) => {\n  const { t } = useTranslation();\n  const [modaleInfo, setModaleInfo] = useState(false);\n  const currTime = Date.now();\n  // console.log(\"currentDate server\", currentDate);\n  // console.log(\"currTime client\", currTime);\n  const finTime = new Date(finishDate).getTime();\n\n  //const diffTimeMin = Math.round((finTime - currTime) / (1000 * 60));\n  const diffTimeSec = Math.round((finTime - currTime) / 1000);\n\n  const { counter } = useCounter(diffTimeSec);\n  const { minutes, seconds, strTime } = hhMmSs(diffTimeSec);\n\n  useEffect(() => {\n    if (minutes && minutes === 3 && seconds != null && seconds === 0) {\n      setModaleInfo(true);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [counter]);\n\n  if (diffTimeSec < 1) return null;\n\n  return (\n    <Box textAlign=\"center\">\n      <Typography variant=\"body2\" component=\"span\">\n        {t(\"CHAT.CONFERENCE.LEFT_TIME\")}:{\" \"}\n      </Typography>\n      <Typography variant=\"button\" component=\"span\">\n        {strTime}\n      </Typography>\n      <AlertModale\n        modaleInfo={modaleInfo}\n        setModaleInfo={setModaleInfo}\n        strTime={strTime}\n      />\n    </Box>\n  );\n};\n\nexport default ConferenceTime;\n","import { useEffect, useRef, useState } from \"react\";\n\nexport default function useCounter(max = 30000) {\n  const [counter, setCounter] = useState(max);\n  const counterRef = useRef<ReturnType<typeof setInterval> | null>(null);\n\n  const handlerRefresh = () => {\n    setCounter(max);\n  };\n\n  // Counter\n  useEffect(() => {\n    if (counter > 0)\n      counterRef.current = setInterval(\n        () => setCounter(prev => prev - 1),\n        1000\n      );\n\n    return () => {\n      if (counterRef.current) clearInterval(counterRef.current);\n    };\n  }, [counter]);\n\n  return { counter, handlerRefresh };\n}\n","import CallEndIcon from \"@mui/icons-material/CallEnd\";\nimport DeleteIcon from \"@mui/icons-material/Delete\";\nimport GroupIcon from \"@mui/icons-material/Group\";\nimport PauseIcon from \"@mui/icons-material/Pause\";\nimport PersonAddIcon from \"@mui/icons-material/PersonAdd\";\nimport {\n  Avatar,\n  Button,\n  CardHeader,\n  IconButton,\n  Popover,\n  Typography,\n} from \"@mui/material\";\nimport { Theme } from \"@mui/material/styles\";\nimport { createStyles, makeStyles } from \"@mui/styles\";\nimport React, { useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport {\n  ChatRoom,\n  ConferenceData,\n  Contact,\n  Group,\n  SetTyping,\n  User,\n  VisitData,\n} from \"../types\";\nimport { combineURLs, isEmpty } from \"../utils/common\";\nimport AddContact from \"./AddContact\";\nimport ConferenceButton from \"./ConferenceButton\";\nimport ConferenceTime from \"./ConferenceTime\";\nimport ConfirmDialogSlide from \"./ConfirmDialogSlide\";\nimport ContactList from \"./ContactList\";\nimport ContactStatus from \"./ContactStatus\";\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    paper: {\n      padding: theme.spacing(1),\n    },\n    avatarGroup: {\n      backgroundColor: \"#28B7C6\",\n      color: \"#fff\",\n    },\n  })\n);\n\ntype RoomHeaderProps = {\n  apiUrl: string;\n  user: User;\n  chat: ChatRoom | null;\n  typing: SetTyping | null;\n  conference: ConferenceData | null;\n  conferenceJoined: boolean;\n  className: string;\n  operators: Contact[];\n  visitData: VisitData[];\n  onVideoCall?: (chat: ChatRoom, visitId?: number, recreate?: boolean) => void;\n  onVideoEnd?: (conference: ConferenceData) => void;\n  onConferencePause?: (conference: ConferenceData) => void;\n  onOperatorAdd?: (chat: Group, operator: Contact) => void;\n  onLeaveGroup?: (chat: Group) => void;\n  onContactClick?: (contact: Contact) => void;\n};\n\nconst getGroupStatus = (group: Group, t: (key: string) => string) => {\n  const status = [`${group.members?.length} ${t(\"CHAT.MEMBERS\")}`];\n  const onlineCount = (group.members || []).reduce(\n    (sum: number, contact) => (contact.online ? sum + 1 : sum),\n    0\n  );\n  if (onlineCount) status.push(`${onlineCount} ${t(\"CHAT.STATUS.ONLINE\")}`);\n  return status.join(\", \");\n};\n\nconst RoomHeader: React.FC<RoomHeaderProps> = ({\n  apiUrl,\n  user,\n  chat,\n  typing,\n  conference,\n  visitData,\n  conferenceJoined,\n  className,\n  operators,\n  onVideoCall,\n  onVideoEnd,\n  onConferencePause,\n  onOperatorAdd,\n  onLeaveGroup,\n  onContactClick,\n}: RoomHeaderProps) => {\n  const classes = useStyles();\n  const { t } = useTranslation();\n  const [anchorEl, setAnchorEl] = useState<HTMLElement | null>(null);\n  const [addOperatorOpen, setAddOperatorOpen] = useState(false);\n  const [confirmFinishConf, setConfirmFinishConf] = React.useState(false);\n  if (!chat)\n    return (\n      <CardHeader\n        avatar={<Avatar />}\n        title=\"\"\n        subheader=\"\"\n        className={className}\n      />\n    );\n\n  let closeTimer: NodeJS.Timeout | null = null;\n  const handlePopoverIn = (\n    event: React.MouseEvent<HTMLElement, MouseEvent>\n  ) => {\n    if (!anchorEl) {\n      setAnchorEl(event.currentTarget);\n    }\n    if (closeTimer) {\n      clearTimeout(closeTimer);\n      closeTimer = null;\n    }\n  };\n\n  const handlePopoverClose = () => {\n    setAnchorEl(null);\n    if (closeTimer) {\n      clearTimeout(closeTimer);\n      closeTimer = null;\n    }\n  };\n\n  const handlePopoverOut = () => {\n    if (!closeTimer) {\n      closeTimer = setTimeout(() => {\n        handlePopoverClose();\n      }, 1000);\n    }\n  };\n\n  const handleAddOperatorOpen = () => {\n    setAddOperatorOpen(true);\n  };\n\n  const handleAddOperatorClose = (operator?: Contact) => {\n    setAddOperatorOpen(false);\n    if (onOperatorAdd && operator && chat)\n      onOperatorAdd(chat as Group, operator);\n  };\n\n  const group = chat as Group;\n  if (group.groupId) {\n    // группа\n    return (\n      <CardHeader\n        avatar={\n          <Avatar alt={group.name} className={classes.avatarGroup}>\n            <GroupIcon />\n          </Avatar>\n        }\n        title={group.name}\n        subheader={\n          <React.Fragment>\n            <span\n              id=\"mouse-over-span\"\n              aria-owns={anchorEl ? \"mouse-over-popover\" : undefined}\n              aria-haspopup=\"true\"\n              onMouseEnter={handlePopoverIn}\n              onMouseLeave={handlePopoverOut}\n            >\n              {getGroupStatus(group, t)}\n            </span>\n            <Popover\n              id=\"mouse-over-popover\"\n              classes={{\n                paper: classes.paper,\n              }}\n              sx={{ pointerEvents: \"none\" }}\n              open={!!anchorEl}\n              anchorEl={anchorEl}\n              anchorOrigin={{\n                vertical: \"bottom\",\n                horizontal: \"left\",\n              }}\n              transformOrigin={{\n                vertical: \"top\",\n                horizontal: \"left\",\n              }}\n              onClose={handlePopoverClose}\n              disableRestoreFocus\n            >\n              <ContactList\n                apiUrl={apiUrl}\n                contacts={group.members as Contact[]}\n                onContactClick={onContactClick}\n                owner={group.userId}\n                onMouseEnter={handlePopoverIn}\n                onMouseLeave={handlePopoverOut}\n                sx={{ pointerEvents: \"all\" }}\n              />\n            </Popover>\n          </React.Fragment>\n        }\n        className={className}\n        action={\n          <React.Fragment>\n            {user.role === 4 && (\n              <React.Fragment>\n                <IconButton\n                  aria-label=\"add user\"\n                  onClick={handleAddOperatorOpen}\n                >\n                  <PersonAddIcon />\n                </IconButton>\n                <AddContact\n                  apiUrl={apiUrl}\n                  open={addOperatorOpen}\n                  contacts={operators}\n                  onClose={handleAddOperatorClose}\n                />\n              </React.Fragment>\n            )}\n            {user.role === 4 &&\n              group.members?.find(\n                (it) => it.userId !== user.userId && it.role === 4\n              ) &&\n              onLeaveGroup && (\n                <IconButton\n                  aria-label=\"leave group\"\n                  onClick={() => onLeaveGroup(group)}\n                >\n                  <DeleteIcon />\n                </IconButton>\n              )}\n          </React.Fragment>\n        }\n      />\n    );\n  }\n  const contact = chat as Contact;\n  const isTyping = !!typing?.contactId && typing?.userId === contact.userId;\n\n  return (\n    <CardHeader\n      avatar={\n        <Avatar\n          alt={contact.username}\n          src={contact.avatar ? combineURLs(apiUrl, contact.avatar) : \"\"}\n        />\n      }\n      title={\n        <Typography\n          variant=\"h6\"\n          sx={(theme) => ({\n            whiteSpace: \"nowrap\",\n            overflow: \"hidden\",\n            textOverflow: \"ellipsis\",\n            fontSize: \"0.9rem\",\n            [theme.breakpoints.down(\"md\")]: {\n              fontSize: \"0.8rem\",\n            },\n\n            [theme.breakpoints.down(\"sm\")]: {\n              whiteSpace: \"wrap\",\n              fontSize: \"0.7rem\",\n            },\n          })}\n        >\n          {contact.username}\n        </Typography>\n      }\n      subheader={<ContactStatus contact={contact} isTyping={isTyping} />}\n      className={className}\n      action={\n        <React.Fragment>\n          {user.role !== 1 &&\n            conferenceJoined &&\n            conference &&\n            !isEmpty(conference) &&\n            onConferencePause != null && (\n              <Button\n                aria-label=\"cancel call\"\n                variant=\"contained\"\n                color=\"secondary\"\n                size=\"small\"\n                startIcon={<PauseIcon color=\"primary\" />}\n                onClick={() => onConferencePause(conference)}\n              >\n                {t(\"CHAT.CONFERENCE.PAUSE\")}\n              </Button>\n            )}\n\n          {conference &&\n            !isEmpty(conference) &&\n            onVideoEnd != null &&\n            user.role != null &&\n            [3, 4].includes(user.role) && (\n              <>\n                <Button\n                  aria-label=\"cancel call\"\n                  variant=\"contained\"\n                  color=\"warning\"\n                  size=\"small\"\n                  startIcon={<CallEndIcon color=\"inherit\" />}\n                  onClick={() => setConfirmFinishConf(true)}\n                  style={{ marginLeft: 8 }}\n                >\n                  {t(\"CHAT.CONFERENCE.FINISH\")}\n                </Button>\n                <ConfirmDialogSlide\n                  open={confirmFinishConf}\n                  setOpen={setConfirmFinishConf}\n                  contentText={t(\"CHAT.CONFERENCE.CONFIRM_FINISH_CONF\")}\n                  callback={() => {\n                    onVideoEnd(conference);\n                  }}\n                />\n              </>\n            )}\n\n          {isEmpty(conference) &&\n            onVideoCall != null &&\n            user.role &&\n            [3, 4].includes(user.role) && (\n              <ConferenceButton\n                visitData={visitData}\n                chat={contact}\n                onVideoCall={onVideoCall}\n              />\n            )}\n\n          {conference?.finishDate != null && (\n            <ConferenceTime finishDate={conference.finishDate} />\n          )}\n        </React.Fragment>\n      }\n    />\n  );\n};\n\nexport default RoomHeader;\n","import { Alert, Box, Fade, Typography } from \"@mui/material\";\nimport dayjs from \"dayjs\";\nimport React from \"react\";\n\ninterface DateIndicatorProps {\n  date: string;\n}\n\nexport const MessageDateIndicator: React.FC<DateIndicatorProps> = ({\n  date,\n}) => {\n  return (\n    <Box sx={{ position: \"relative\", height: 0, margin: \"8px 0\" }}>\n      <Fade in={!!date} timeout={2000}>\n        <Alert\n          severity=\"warning\"\n          icon={false}\n          sx={() => ({\n            position: \"absolute\",\n            top: \"50%\",\n            left: \"50%\",\n            transform: \"translate(-50%, -50%)\",\n            width: 150,\n            mx: \"auto\",\n            justifyContent: \"center\",\n            zIndex: 1000,\n          })}\n        >\n          <Typography variant=\"h6\" textAlign=\"center\">\n            {date && dayjs(date).format(\"DD.MM.YYYY\")}\n          </Typography>\n        </Alert>\n      </Fade>\n    </Box>\n  );\n};\n","import KeyboardArrowDown from \"@mui/icons-material/KeyboardArrowDown\";\nimport { Box, Fab, Typography } from \"@mui/material\";\nimport { Theme } from \"@mui/material/styles\";\nimport { makeStyles } from \"@mui/styles\";\nimport React from \"react\";\n\nconst useStyles = makeStyles((theme: Theme) => ({\n  arrowDown: {\n    position: \"absolute\",\n    left: \"94.5%\",\n    bottom: 105,\n    [theme.breakpoints.down(\"md\")]: {\n      left: \"91.5%\",\n      bottom: 95,\n    },\n    [theme.breakpoints.down(\"sm\")]: {\n      left: \"84%\",\n      bottom: 95,\n    },\n  },\n}));\n\ninterface ScrollButtonProps {\n  visible: boolean;\n  unreadCount: number;\n  onScrollDown: () => void;\n}\n\nexport const MessageScrollButton: React.FC<ScrollButtonProps> = ({\n  visible,\n  unreadCount,\n  onScrollDown,\n}) => {\n  const classes = useStyles();\n\n  if (!visible) return null;\n\n  return (\n    <Box className={classes.arrowDown} textAlign=\"center\">\n      <Fab\n        color=\"info\"\n        aria-label=\"scroll-down\"\n        size=\"medium\"\n        onClick={onScrollDown}\n      >\n        <KeyboardArrowDown />\n      </Fab>\n      {unreadCount > 0 && (\n        <Fab\n          color=\"warning\"\n          size=\"small\"\n          sx={{\n            width: 24,\n            height: 24,\n            minHeight: 24,\n            position: \"relative\",\n            top: -10,\n            pointerEvents: \"none\",\n          }}\n        >\n          <Typography\n            variant=\"body2\"\n            sx={(theme) => ({ color: theme.palette.background.default })}\n          >\n            {unreadCount}\n          </Typography>\n        </Fab>\n      )}\n    </Box>\n  );\n};\n","import {\n  Backdrop,\n  CardContent,\n  CircularProgress,\n  List,\n  ListItem,\n} from \"@mui/material\";\nimport { Theme } from \"@mui/material/styles\";\nimport { makeStyles } from \"@mui/styles\";\nimport React from \"react\";\nimport useInfiniteScroll from \"react-infinite-scroll-hook\";\nimport useInterval from \"../hooks/useInterval\";\n\nimport { useMessageScroll } from \"../hooks/useMessageScroll\";\nimport { ChatMessage, ChatRoom, ContactGather, User } from \"../types\";\nimport { getChatId } from \"../utils/common\";\nimport Message from \"./Message\";\nimport { MessageDateIndicator } from \"./MessageDateIndicator\";\nimport { MessageScrollButton } from \"./MessageScrollButton\";\n\nconst useStyles = makeStyles((theme: Theme) => ({\n  messageListOuter: {\n    flex: 1,\n    overflowY: \"auto\",\n    margin: 0,\n    padding: 0,\n    height: \"100%\",\n    scrollbarWidth: \"thin\",\n    scrollbarColor: `${theme.palette.primary.light} #fff`,\n  },\n  messageList: {},\n  img: {\n    cursor: \"pointer\",\n    borderRadius: theme.spacing(1.2),\n    maxWidth: \"auto\",\n    maxHeight: \"95%\",\n    [theme.breakpoints.down(\"sm\")]: {\n      maxWidth: \"auto\",\n      maxHeight: \"95%\",\n    },\n  },\n}));\ninterface ViewerData {\n  visible: boolean;\n  src: string;\n}\n\ninterface InitialMenuState {\n  message: ChatMessage | null;\n  mouseX: null | number;\n  mouseY: null | number;\n  canCopy: boolean;\n  canDelete: boolean;\n}\n\ninterface RoomMessageListProps {\n  apiUrl: string;\n  user: User;\n  users: ContactGather;\n  chat: ChatRoom | null;\n  loading: boolean;\n  pageSize: number;\n  initialMenuState: InitialMenuState;\n  onNeedMoreMessages: (chat: ChatRoom) => Promise<void>;\n  onMessageDelete?: (chat: ChatRoom, message: ChatMessage) => void;\n  setMenuState: React.Dispatch<React.SetStateAction<InitialMenuState>>;\n  onEnterRoom?: (chat: ChatRoom) => void;\n}\nconst RoomMessageList: React.FC<RoomMessageListProps> = ({\n  apiUrl,\n  user,\n  users,\n  chat,\n  loading,\n  pageSize,\n  initialMenuState,\n  onNeedMoreMessages,\n  onMessageDelete,\n  setMenuState,\n  onEnterRoom,\n}) => {\n  const classes = useStyles();\n  const scrollableRootRef = React.useRef<HTMLDivElement | null>(null);\n\n  const chatId = React.useMemo(() => getChatId(chat), [chat]);\n\n  const [viewerData, setViewerData] = React.useState<ViewerData>({\n    visible: false,\n    src: \"\",\n  });\n\n  const [isVisible, setIsVisible] = React.useState<string>(\"\");\n\n  const messages =\n    chat?.messages?.map((it) => ({\n      ...it,\n      ref: React.createRef<HTMLLIElement>(),\n    })) || [];\n\n  const hasNextPage = React.useMemo(\n    () => (chat == null || chat?.noMoreData == null ? true : !chat.noMoreData),\n    [chat?.noMoreData]\n  );\n\n  const { scrollDown, handleRootScroll, scrollDownButton, unreadCount } =\n    useMessageScroll({\n      chatId,\n      messages,\n      scrollableRootRef,\n      pageSize,\n      hasNextPage,\n      chat,\n      onEnterRoom,\n      setIsVisible,\n    });\n\n  const [infiniteRef, { rootRef }] = useInfiniteScroll({\n    loading,\n    hasNextPage,\n    onLoadMore: () => chat && onNeedMoreMessages(chat),\n    disabled: false,\n  });\n\n  const rootRefSetter = React.useCallback(\n    (node: HTMLDivElement) => {\n      rootRef(node);\n      scrollableRootRef.current = node;\n    },\n    [rootRef]\n  );\n\n  useInterval(\n    () => {\n      setIsVisible(\"\");\n    },\n    isVisible,\n    4700\n  );\n\n  const handleMenuPopup = (\n    message: ChatMessage,\n    event: React.MouseEvent<HTMLElement>\n  ) => {\n    const canCopy = message.messageType === \"text\";\n    const canDelete =\n      user.userId === message.userId &&\n      !!onMessageDelete &&\n      new Date().getTime() - new Date(message.cdate).getTime() <= 1000 * 60 * 2;\n\n    if (!canCopy && !canDelete) {\n      setMenuState(initialMenuState);\n      return;\n    }\n\n    event.preventDefault();\n    setMenuState({\n      message,\n      mouseX: event.clientX - 2,\n      mouseY: event.clientY - 4,\n      canCopy,\n      canDelete,\n    });\n  };\n\n  if (!chatId) return null;\n  const messageList = React.useMemo(() => {\n    return messages.map((message, index) => (\n      <Message\n        ref={message.ref}\n        key={message._id || index} // Better to use unique ID if available\n        apiUrl={apiUrl}\n        user={user}\n        message={message}\n        owner={users[message.userId]}\n        isGroupMessage={!!chat?.groupId}\n        isUserFirst={\n          index === 0 ||\n          messages[index - 1].messageType === \"notify\" ||\n          messages[index - 1].userId !== messages[index].userId\n        }\n        isUserLast={\n          index === messages.length - 1 ||\n          messages[index + 1]?.messageType === \"notify\" ||\n          messages[index + 1]?.userId !== messages[index].userId\n        }\n        onContextMenu={(event) => handleMenuPopup(message, event)}\n        setViewerData={setViewerData}\n      />\n    ));\n  }, [\n    (messages || []).filter((it) => it._id).length,\n    unreadCount,\n    apiUrl,\n    user,\n    users,\n    chat?.groupId,\n    scrollDownButton,\n    isVisible,\n  ]);\n  // console.count(\"RoomMessageList - render\");\n  // console.log(\"unreadCount\", unreadCount);\n\n  return (\n    <>\n      <MessageDateIndicator date={isVisible} />\n\n      <CardContent\n        className={classes.messageListOuter}\n        ref={rootRefSetter}\n        onScroll={handleRootScroll}\n      >\n        <List className={classes.messageList}>\n          {hasNextPage && (\n            <ListItem ref={infiniteRef} sx={{ justifyContent: \"center\" }}>\n              <CircularProgress />\n            </ListItem>\n          )}\n\n          {messageList}\n        </List>\n\n        <MessageScrollButton\n          visible={scrollDownButton}\n          unreadCount={unreadCount}\n          onScrollDown={scrollDown}\n        />\n\n        {viewerData.visible && (\n          <Backdrop\n            sx={{\n              color: \"#fff\",\n              zIndex: (theme) => theme.zIndex.drawer + 1,\n            }}\n            open={viewerData.visible}\n            onClick={() => setViewerData({ visible: false, src: \"\" })}\n          >\n            <img src={viewerData.src} className={classes.img} alt=\"\" />\n          </Backdrop>\n        )}\n      </CardContent>\n    </>\n  );\n};\nexport default RoomMessageList;\n\n// export default React.memo(RoomMessageList, (prevProps, nextProps) => {\n//   console.log(\"RoomMessageList memo\");\n//   return (\n//     (prevProps.chat?.messages || []).filter((it) => it._id) ===\n//       (nextProps.chat?.messages || []).filter((it) => it._id) &&\n//     prevProps.loading === nextProps.loading &&\n//     prevProps.user === nextProps.user &&\n//     prevProps.users === nextProps.users &&\n//     prevProps.chat?.groupId === nextProps.chat?.groupId &&\n//     prevProps.apiUrl === nextProps.apiUrl\n//   );\n// });\n","import { useEffect, useRef } from 'react';\n\nexport default function useInterval(callback, state, delay) {\n  const savedCallback = useRef();\n\n  // Remember the latest callback.\n  useEffect(() => {\n    savedCallback.current = callback;\n  }, [callback]);\n\n  // Set up the interval.\n  useEffect(() => {\n    function tick() {\n      savedCallback.current();\n    }\n    if (state) {\n      let id = setInterval(tick, delay);\n      return () => clearInterval(id);\n    }\n  }, [state]);\n}\n","import { useCallback, useEffect, useRef, useState } from \"react\";\nimport { ChatMessage, ChatRoom } from \"../types\";\n\nfunction isVisibleInViewport(element: HTMLLIElement, root: HTMLDivElement) {\n  const rect = element.getBoundingClientRect();\n  // console.log(\n  //   'rect.top',\n  //   rect.top,\n  //   'rect.bottom',\n  //   rect.bottom,\n  //   root.clientHeight,\n  // );\n  return rect.top >= 150 && rect.bottom <= root.clientHeight;\n}\ninterface UseMessageScrollProps {\n  chatId: string | null;\n  messages: ChatMessage[];\n  scrollableRootRef: React.RefObject<HTMLDivElement>;\n  pageSize: number;\n  hasNextPage: boolean;\n  chat: ChatRoom | null;\n  onEnterRoom?: (chat: ChatRoom) => void;\n  setIsVisible: React.Dispatch<React.SetStateAction<string>>;\n}\n\nexport const useMessageScroll = ({\n  chatId,\n  messages,\n  scrollableRootRef,\n  pageSize,\n  hasNextPage,\n  chat,\n  onEnterRoom,\n  setIsVisible,\n}: UseMessageScrollProps) => {\n  const [scrollDownButton, setScrollDownButton] = useState(false);\n  const lastScrollDistanceToBottomRef = useRef<number>();\n  const lastMessageCount = useRef<number>();\n  const messageCount = messages?.length || 0;\n  const lastMessage = messageCount && messages[messageCount - 1];\n  const SCROLL_THRESHOLD = 900;\n\n  const scrollDown = useCallback(() => {\n    if (scrollableRootRef.current) {\n      scrollableRootRef.current.scrollTop =\n        scrollableRootRef.current.scrollHeight;\n      if (onEnterRoom && chat) {\n        onEnterRoom(chat);\n      }\n    }\n  }, [chatId, onEnterRoom]);\n\n  const handleRootScroll = useCallback(() => {\n    const rootNode = scrollableRootRef.current;\n\n    if (rootNode) {\n      const scrollDistanceToBottom = rootNode.scrollHeight - rootNode.scrollTop;\n      lastScrollDistanceToBottomRef.current = scrollDistanceToBottom;\n\n      const isShowScrollButton =\n        hasNextPage && scrollDistanceToBottom > SCROLL_THRESHOLD;\n      setScrollDownButton(isShowScrollButton);\n\n      for (let i = 0; i < messageCount; i++) {\n        const mess = messages[i];\n        // console.log(\n        //   '------------loop------------',\n        //   //mess?.ref?.current,\n        // );\n\n        if (mess?.ref?.current) {\n          const isVisibleMess = isVisibleInViewport(mess.ref.current, rootNode);\n          if (isVisibleMess) {\n            // console.log(\n            //   'visible',\n            //   dayjs(mess.cdate).format('DD.MM.YYYY'),\n            // );\n            setIsVisible(mess.cdate);\n            break;\n          }\n        } else {\n          break;\n        }\n      }\n    }\n  }, [messages, chatId]);\n\n  useEffect(() => {\n    if (chatId && scrollableRootRef.current && messages.length) {\n      setIsVisible(messages[messageCount - 1]?.cdate ?? \"\");\n      scrollDown();\n    }\n  }, [chatId]);\n\n  // ------ keep the scroll position and lastMessageCount when messageCount changed ----------\n  useEffect(() => {\n    const scrollableRoot = scrollableRootRef.current;\n    const lastScrollDistanceToBottom =\n      lastScrollDistanceToBottomRef.current ?? 0;\n\n    if (scrollableRoot && lastMessage && chat) {\n      // -----  scroll to prev lastScrollDistanceToBottom -----------\n      if (lastMessageCount.current === messageCount - pageSize) {\n        scrollableRoot.scrollTop =\n          scrollableRoot.scrollHeight - lastScrollDistanceToBottom;\n      } else if (\n        // -----  scroll to bottom forced -----------\n        lastMessage.userId !== chat.userId ||\n        lastScrollDistanceToBottom <= SCROLL_THRESHOLD\n      ) {\n        scrollDown();\n      }\n    }\n    lastMessageCount.current = messageCount;\n  }, [messageCount, chatId]);\n\n  return {\n    scrollDown,\n    handleRootScroll,\n    scrollDownButton,\n    setScrollDownButton,\n    unreadCount: messages.filter((m) => m.status === 0).length,\n  };\n};\n","import DeleteIcon from \"@mui/icons-material/Delete\";\nimport FileCopyIcon from \"@mui/icons-material/FileCopy\";\nimport {\n  Box,\n  Card,\n  CardContent,\n  Divider,\n  ListItemIcon,\n  Menu,\n  MenuItem,\n} from \"@mui/material\";\nimport { Theme } from \"@mui/material/styles\";\nimport { createStyles, makeStyles } from \"@mui/styles\";\nimport React, { useCallback } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport {\n  ChatMessage,\n  ChatRoom,\n  ConferenceData,\n  Contact,\n  ContactGather,\n  Group,\n  SendMessage,\n  SetTyping,\n  User,\n  VisitData,\n} from \"../types\";\nimport Entry from \"./Entry\";\nimport RoomHeader from \"./RoomHeader\";\nimport RoomMessageList from \"./RoomMessageList\";\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {\n      width: \"100%\",\n      minWidth: 360,\n      height: \"100%\",\n      display: \"flex\",\n      flexDirection: \"column\",\n    },\n\n    roomHeader: {\n      flex: 1,\n    },\n\n    flexAll: {\n      flex: \"1 1 auto\",\n    },\n    flexEnd: {\n      justifyContent: \"flex-end\",\n    },\n  })\n);\n\nconst initialMenuState = {\n  message: null,\n  mouseX: null,\n  mouseY: null,\n  canCopy: false,\n  canDelete: false,\n};\n\ntype RoomProps = {\n  apiUrl: string;\n  user: User;\n  users: ContactGather;\n  chat: ChatRoom | null;\n  typing: SetTyping | null;\n  conference: ConferenceData | null;\n  visitData: VisitData[];\n  conferenceJoined: boolean;\n  loading: boolean;\n  pageSize: number;\n  operators: Contact[];\n\n  onExitRoom?: (chat: ChatRoom) => void;\n  onEnterRoom?: (chat: ChatRoom) => void;\n  onNeedMoreMessages: (chat: ChatRoom) => Promise<void>;\n  onMessageDelete?: (chat: ChatRoom, message: ChatMessage) => void;\n  onTyping?: (chat: ChatRoom) => void;\n  onSendMessage?: (chat: ChatRoom, data: SendMessage) => void;\n  onVideoCall?: (chat: ChatRoom, visitId?: number, recreate?: boolean) => void;\n  onVideoEnd?: (chat: ConferenceData) => void;\n  onConferencePause?: (conference: ConferenceData) => void;\n  onOperatorAdd?: (chat: Group, operator: Contact) => void;\n  onLeaveGroup?: (chat: Group) => void;\n  onContactClick?: (contact: Contact) => void;\n  isMobile: boolean;\n};\n\nconst Room: React.FC<RoomProps> = (props: RoomProps) => {\n  const {\n    apiUrl,\n    user,\n    users,\n    chat,\n    typing,\n    conference,\n    visitData,\n    conferenceJoined,\n    loading,\n    pageSize,\n    isMobile,\n    onEnterRoom,\n  } = props;\n\n  const classes = useStyles();\n  const { t } = useTranslation();\n\n  const [menuState, setMenuState] = React.useState<{\n    message: ChatMessage | null;\n    mouseX: null | number;\n    mouseY: null | number;\n    canCopy: boolean;\n    canDelete: boolean;\n  }>(initialMenuState);\n\n  const handleMenuClose = () => {\n    setMenuState(initialMenuState);\n  };\n\n  const handleCopy = useCallback(() => {\n    const { message } = menuState;\n    setMenuState(initialMenuState);\n    if (!message) return;\n    navigator.clipboard.writeText(message.content);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [menuState.message]);\n\n  const handleDelete = useCallback(() => {\n    const { message } = menuState;\n    setMenuState(initialMenuState);\n    if (props.onMessageDelete && chat && message)\n      props.onMessageDelete(chat, message);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [menuState.message]);\n\n  return (\n    <Card elevation={1} className={classes.root}>\n      <Box display=\"flex\" flexDirection=\"row\">\n        <RoomHeader\n          apiUrl={apiUrl}\n          user={user}\n          chat={chat}\n          typing={typing}\n          conference={conference}\n          visitData={visitData}\n          conferenceJoined={conferenceJoined}\n          operators={props.operators}\n          className={classes.roomHeader}\n          onVideoCall={props.onVideoCall}\n          onVideoEnd={props.onVideoEnd}\n          onConferencePause={props.onConferencePause}\n          onOperatorAdd={props.onOperatorAdd}\n          onLeaveGroup={props.onLeaveGroup}\n          onContactClick={props.onContactClick}\n        />\n      </Box>\n      <Divider />\n      <RoomMessageList\n        apiUrl={apiUrl}\n        user={user}\n        users={users}\n        chat={chat}\n        loading={loading}\n        pageSize={pageSize}\n        initialMenuState={initialMenuState}\n        onNeedMoreMessages={props.onNeedMoreMessages}\n        onMessageDelete={props.onMessageDelete}\n        setMenuState={setMenuState}\n        onEnterRoom={onEnterRoom}\n      />\n      <Divider />\n      <CardContent>\n        <Entry\n          chat={chat}\n          onTyping={props.onTyping}\n          onSendMessage={props.onSendMessage}\n        />\n      </CardContent>\n      <Menu\n        keepMounted\n        open={menuState.mouseY !== null}\n        onClose={handleMenuClose}\n        anchorReference=\"anchorPosition\"\n        anchorPosition={\n          menuState.mouseY !== null && menuState.mouseX !== null\n            ? { top: menuState.mouseY, left: menuState.mouseX }\n            : undefined\n        }\n      >\n        <MenuItem onClick={handleCopy} disabled={!menuState.canCopy}>\n          <span className={classes.flexAll}>{t(\"CHAT.MESSAGE.MENU.COPY\")}</span>\n          <ListItemIcon className={classes.flexEnd}>\n            <FileCopyIcon fontSize=\"small\" />\n          </ListItemIcon>\n        </MenuItem>\n        <MenuItem onClick={handleDelete} disabled={!menuState.canDelete}>\n          <span className={classes.flexAll}>\n            {t(\"CHAT.MESSAGE.MENU.DELETE\")}\n          </span>\n          <ListItemIcon className={classes.flexEnd}>\n            <DeleteIcon fontSize=\"small\" />\n          </ListItemIcon>\n        </MenuItem>\n      </Menu>\n    </Card>\n  );\n};\n\nexport default Room;\n","import React, { useMemo } from \"react\";\nimport {\n  AddGroupMessages,\n  AddPrivateMessages,\n  ChatRoom,\n  ConferenceData,\n  Contact,\n  ContactGather,\n  Group,\n  GroupGather,\n  GroupMap,\n  GroupMember,\n  GroupMessage,\n  MessageOperation,\n  PrivateMessage,\n  SetActiveRoom,\n  //SetUser,\n  SetTyping,\n  User,\n  VisitData,\n} from \"../types\";\nimport { chatRoomComparer } from \"../utils/common\";\n\nexport interface ChatState {\n  user: User;\n  token: string;\n  refreshToken: string;\n  activeRoom: ChatRoom | null;\n  chatOld: ChatRoom | null;\n\n  groupGather: GroupGather;\n  userGather: ContactGather;\n  contactGather: ContactGather;\n  operators: Contact[];\n  initialContactId: number | null;\n  conference: {\n    data: ConferenceData | null;\n    joined: boolean;\n    ringPlayed: boolean;\n  };\n  typing: SetTyping | null;\n  loading: boolean;\n  error?: string;\n  success?: string;\n  visitData: VisitData[];\n}\n\nconst emptyUser: User = {\n  userId: 0,\n  username: \"\",\n  password: \"\",\n  avatar: \"\",\n  langCode: \"\",\n};\n\nconst emptyChatState: ChatState = {\n  user: emptyUser, // пользователь\n  token: \"\", // токен\n  refreshToken: \"\",\n  activeRoom: null, // активная комната\n  chatOld: null, // активная комната\n\n  groupGather: {}, // список групп\n  userGather: {}, // список онлайн\n  contactGather: {}, // контакты\n  operators: [], // операторы\n  initialContactId: null, // начальный контакт\n  conference: {\n    data: null, // данные конференции\n    joined: false,\n    ringPlayed: false,\n  },\n  typing: null, // кто печатает текст\n  loading: false, // загрузка данных\n  error: undefined, // ошибка\n  success: undefined, // НЕ ошибка\n  visitData: [],\n};\n\ntype ChatActionType =\n  | \"ADD_GROUP_MEMBER\"\n  | \"ADD_GROUP_MESSAGE\"\n  | \"ADD_GROUP_MESSAGES\"\n  | \"SET_GROUP_MESSAGES\"\n  | \"ADD_PRIVATE_MESSAGE\"\n  | \"ADD_PRIVATE_MESSAGES\"\n  | \"SET_PRIVATE_MESSAGES\"\n  | \"SET_ACTIVE_ROOM\"\n  | \"UPDATE_ACTIVE_ROOM\"\n  | \"SET_GROUP_GATHER\"\n  | \"SET_CONTACT_GATHER\"\n  | \"SET_USER_GATHER\"\n  | \"DEL_GROUP\"\n  | \"DEL_GROUP_MEMBER\"\n  | \"DEL_CONTACT\"\n  | \"ADD_CONTACT_UNREAD_GATHER\"\n  | \"LOSE_CONTACT_UNREAD_GATHER\"\n  | \"ADD_GROUP_UNREAD_GATHER\"\n  | \"LOSE_GROUP_UNREAD_GATHER\"\n  | \"REVOKE_MESSAGE\"\n  | \"USER_ONLINE\"\n  | \"USER_OFFLINE\"\n  | \"UPDATE_USER_INFO\"\n  | \"SET_INITIAL_CONTACT_ID\"\n  | \"SET_CONFERENCE\"\n  | \"JOIN_CONFERENCE\"\n  | \"PAUSE_CONFERENCE\"\n  | \"STOP_CONFERENCE\"\n  | \"SET_TYPING\"\n  | \"MARK_AS_READ\"\n  | \"UPDATE_GROUP_INFO\"\n  | \"MARK_PRIVATE_MESSAGES_READ\"\n  | \"SET_LOADING\"\n  | \"SET_ERROR\"\n  | \"SET_SUCCES\"\n  | \"SET_USER\"\n  | \"SET_TOKEN\"\n  | \"CLEAR_USER\"\n  | \"CLEAR_CHAT_DATA\"\n  | \"SET_OPERATORS\"\n  | \"SET_VISIT_DATA\";\n\ntype Action = {\n  type: ChatActionType;\n  payload?:\n    | null\n    | boolean\n    | number\n    | string\n    | Group\n    | Contact\n    | User\n    | PrivateMessage\n    | GroupMessage\n    | SetTyping\n    | MessageOperation\n    | GroupMember\n    | AddPrivateMessages\n    | AddGroupMessages\n    | SetActiveRoom\n    | ConferenceData\n    | Contact[]\n    | GroupMap\n    | VisitData[];\n};\n\nconst getFreshActiveRoom = (state: ChatState) => {\n  if (state.activeRoom)\n    return (\n      state.groupGather[(state.activeRoom as Group).groupId] ||\n      state.contactGather[state.activeRoom.userId]\n    );\n  return null;\n};\n\nconst getActiveRoom = (state: ChatState) => {\n  const { activeRoom, initialContactId, contactGather } = state;\n  let newActiveRoom: ChatRoom | null = null;\n  if (initialContactId) {\n    newActiveRoom = contactGather[initialContactId];\n  } else if (activeRoom) {\n    newActiveRoom = getFreshActiveRoom(state);\n  } else {\n    // ищем комнату с самым свежим сообщением\n    const rooms = [\n      ...Object.values(state.contactGather),\n      ...Object.values(state.groupGather),\n    ].sort(chatRoomComparer);\n    if (rooms.length > 0) newActiveRoom = rooms[0];\n  }\n  return newActiveRoom;\n};\n\nconst setUserOnline = (\n  state: ChatState,\n  userId: number,\n  online: 0 | 1\n): ChatState => {\n  const newState = { ...state };\n  // Обновить статусы приватных чатов\n  if (state.contactGather[userId])\n    newState.contactGather[userId] = {\n      ...newState.contactGather[userId],\n      online,\n    };\n\n  // Обновить статус участника в группах\n  for (const group of Object.values(state.groupGather) as Group[]) {\n    if (!group.members) continue;\n    const member = group.members.find((m) => m.userId === userId);\n    if (member) {\n      const index = group.members.indexOf(member);\n      group.members[index] = { ...member, online };\n    }\n  }\n  // Обновить статус операторов\n  const idx = newState.operators.findIndex((it) => it.userId === userId);\n  if (idx !== -1)\n    newState.operators[idx] = { ...newState.operators[idx], online };\n  // обновляем активный чат\n  newState.activeRoom = getFreshActiveRoom(newState);\n  return newState;\n};\n\nconst addGroupMessage = (state: ChatState, payload: GroupMessage) => {\n  const newState = { ...state };\n  const { groupId } = payload;\n  if (newState.groupGather[groupId]) {\n    if (newState.groupGather[groupId].messages) {\n      newState.groupGather[groupId].messages = [\n        ...(newState.groupGather[groupId].messages as GroupMessage[]),\n        payload,\n      ];\n    } else {\n      newState.groupGather[groupId] = {\n        ...state.groupGather[groupId],\n        messages: [payload],\n      };\n    }\n  }\n\n  // увеличиваем счетчик новых сообщений, если это не активная комната и сообщение не от нас\n  const { activeRoom } = newState;\n  if (\n    activeRoom &&\n    (activeRoom as Group).groupId !== groupId &&\n    payload.userId !== state.user.userId\n  ) {\n    return groupUnreadGather(newState, groupId, (x?: number) => (x || 0) + 1);\n  }\n\n  // обновляем активный чат\n  newState.activeRoom = getFreshActiveRoom(newState);\n  return newState;\n};\n\nconst addPrivateMessage = (state: ChatState, payload: PrivateMessage) => {\n  const newState = { ...state };\n  const contactId =\n    payload.contactId === state.user.userId\n      ? payload.userId\n      : payload.contactId;\n\n  // 1 добавляем сообщение\n  if (newState.contactGather[contactId].messages) {\n    newState.contactGather[contactId].messages = [\n      ...(newState.contactGather[contactId].messages as PrivateMessage[]),\n      payload,\n    ];\n  } else {\n    newState.contactGather[contactId] = {\n      ...newState.contactGather[contactId],\n      messages: [payload],\n    };\n  }\n\n  // 2 если это сообщение в неактивной комнате и источник не мы (в соседней вкладке), то увеличиваем счетчик непрочитанных\n  if (\n    newState.activeRoom?.userId !== contactId &&\n    payload.userId !== state.user.userId\n  ) {\n    return contactUnreadGather(\n      newState,\n      contactId,\n      (x?: number) => (x || 0) + 1\n    );\n  }\n\n  // обновляем активный чат\n  newState.activeRoom = getFreshActiveRoom(newState);\n  return newState;\n};\n\nconst contactUnreadGather = (\n  state: ChatState,\n  userId: number,\n  predicate: (x?: number) => number\n) => {\n  const newState = { ...state };\n\n  if (newState.contactGather[userId]) {\n    newState.contactGather[userId] = {\n      ...newState.contactGather[userId],\n      unreadCount: predicate(newState.contactGather[userId].unreadCount),\n    };\n  }\n\n  // обновляем активный чат\n  newState.activeRoom = getFreshActiveRoom(newState);\n\n  return newState;\n};\n\nconst groupUnreadGather = (\n  state: ChatState,\n  groupId: number,\n  predicate: (x?: number) => number\n) => {\n  const newState = { ...state };\n\n  if (newState.groupGather[groupId]) {\n    newState.groupGather[groupId] = {\n      ...newState.groupGather[groupId],\n      unreadCount: predicate(newState.groupGather[groupId].unreadCount),\n    };\n  }\n\n  // обновляем активный чат\n  newState.activeRoom = getFreshActiveRoom(newState);\n\n  return newState;\n};\n\nconst revokeMessage = (state: ChatState, payload: MessageOperation) => {\n  const { userId } = state.user;\n  const newState = { ...state };\n  const userName =\n    payload.username || newState.userGather[payload.userId as number].username;\n  if (payload.groupId) {\n    const { messages } = newState.groupGather[payload.groupId];\n    // задаем isRevoke\n    if (messages) {\n      const msg = messages.find((message) => message._id === payload._id);\n      if (msg) {\n        const index = messages.indexOf(msg);\n        messages[index] = {\n          ...msg,\n          isRevoke: true,\n          revokeUserName: userName,\n        };\n      }\n    }\n  } else {\n    const { messages } =\n      newState.contactGather[\n        payload.contactId === userId\n          ? (payload.userId as number)\n          : (payload.contactId as number)\n      ];\n    // задаем isRevoke\n    if (messages) {\n      const msg = messages.find((message) => message._id === payload._id);\n      if (msg) {\n        const index = messages.indexOf(msg);\n        messages[index] = {\n          ...msg,\n          isRevoke: true,\n          revokeUserName: userName,\n        };\n      }\n    }\n  }\n  // обновляем активный чат\n  newState.activeRoom = getFreshActiveRoom(newState);\n  return newState;\n};\n\nconst delContact = (state: ChatState, userId: number) => {\n  const newState = { ...state };\n  const updateActiveRoom =\n    newState.activeRoom === newState.contactGather[userId];\n  delete newState.contactGather[userId];\n  if (updateActiveRoom) newState.activeRoom = getActiveRoom(newState);\n\n  return newState;\n};\n\nconst delGroup = (state: ChatState, groupId: number) => {\n  const newState = { ...state };\n  const updateActiveRoom =\n    newState.activeRoom === newState.groupGather[groupId];\n  delete newState.groupGather[groupId];\n  if (updateActiveRoom) newState.activeRoom = getActiveRoom(newState);\n\n  return newState;\n};\n\nconst delGroupMember = (state: ChatState, data: GroupMap) => {\n  const newState = { ...state };\n\n  const group = newState.groupGather[data.groupId];\n  if (group) {\n    group.members = group.members?.filter((it) => it.userId !== data.userId);\n  }\n\n  return newState;\n};\n\nconst updateGroupInfo = (state: ChatState, group: Group) => {\n  const newState = { ...state };\n\n  const { groupId, name, notice } = group;\n  const info = newState.groupGather[groupId];\n  if (info) {\n    newState.groupGather[groupId] = { ...info, name, notice };\n  }\n\n  // обновляем активный чат\n  newState.activeRoom = getFreshActiveRoom(newState);\n\n  return newState;\n};\n\nconst updateUserInfo = (state: ChatState, user: User) => {\n  const newState = { ...state };\n\n  const { userId, username, avatar } = user;\n\n  if (newState.userGather[userId]) {\n    newState.userGather[userId] = {\n      ...newState.userGather[userId],\n      username,\n      avatar,\n    };\n  }\n\n  if (newState.contactGather[userId]) {\n    newState.contactGather[userId] = {\n      ...newState.contactGather[userId],\n      username,\n      avatar,\n    };\n  }\n\n  // обновляем активный чат\n  newState.activeRoom = getFreshActiveRoom(newState);\n\n  return newState;\n};\n\nconst addGroupMember = (state: ChatState, payload: GroupMember) => {\n  const members: Contact[] = payload.members.map((member) => ({\n    ...member,\n    isManager: 0,\n  }));\n\n  const newState = { ...state };\n\n  if (newState.groupGather[payload.groupId].members && members) {\n    newState.groupGather[payload.groupId].members = [\n      ...(state.groupGather[payload.groupId].members as Contact[]),\n      ...members,\n    ];\n  } else {\n    newState.groupGather[payload.groupId] = {\n      ...newState.groupGather[payload.groupId],\n      members,\n    };\n  }\n\n  // обновляем активный чат\n  newState.activeRoom = getFreshActiveRoom(newState);\n  return newState;\n};\n\nconst markPrivateMessagesRead = (state: ChatState, userId: number) => {\n  const newState = { ...state };\n\n  if (newState.contactGather[userId]) {\n    const updatedValue = { ...newState.contactGather[userId] };\n\n    if (updatedValue.messages) {\n      for (let i = 0; i < updatedValue.messages.length; i++)\n        updatedValue.messages[i] = {\n          ...updatedValue.messages[i],\n          status: 1,\n        };\n    }\n    newState.contactGather[userId] = updatedValue;\n  }\n\n  // обновляем активный чат\n  newState.activeRoom = getFreshActiveRoom(newState);\n  // помечаем все не прочитанные как прочитанные\n  if (newState.activeRoom != null && newState.activeRoom.messages) {\n    for (let i = 0; i < newState.activeRoom.messages.length; i++)\n      newState.activeRoom.messages[i] = {\n        ...newState.activeRoom.messages[i],\n        status: 1,\n      };\n  }\n  return newState;\n};\n\nconst addPrivateMessages = (state: ChatState, data: AddPrivateMessages) => {\n  const newState = { ...state };\n\n  const { messages, contactId } = data;\n\n  if (newState.contactGather[contactId]) {\n    newState.contactGather[contactId] = {\n      ...newState.contactGather[contactId],\n      messages: [\n        ...(messages || []),\n        ...(newState.contactGather[contactId].messages || []),\n      ],\n      noMoreData: messages?.length ? messages?.length < data.pageSize : true,\n    };\n  }\n\n  // обновляем активный чат\n  newState.activeRoom = getFreshActiveRoom(newState);\n\n  return newState;\n};\n\nconst addGroupMessages = (state: ChatState, data: AddGroupMessages) => {\n  const newState = { ...state };\n\n  const { groupId, messages, userArr: users } = data;\n  if (newState.groupGather[groupId]) {\n    newState.groupGather[groupId] = {\n      ...newState.groupGather[groupId],\n      messages: [\n        ...(messages || []),\n        ...(newState.groupGather[groupId].messages || []),\n      ],\n      noMoreData: messages?.length ? messages?.length < data.pageSize : true,\n    };\n  }\n\n  newState.userGather = { ...newState.userGather };\n  for (const user of users) {\n    if (!newState.userGather[user.userId]) {\n      newState.userGather[user.userId] = user;\n    }\n  }\n\n  // обновляем активный чат\n  newState.activeRoom = getFreshActiveRoom(newState);\n\n  return newState;\n};\n\nconst setActiveRoom = (state: ChatState, data: SetActiveRoom) => {\n  //if (state.activeRoom && data.ifNotExists) return state;\n  return {\n    ...state,\n    chatOld: state.activeRoom != null ? { ...state.activeRoom } : null,\n    activeRoom: data.groupId\n      ? state.groupGather[data.groupId]\n      : data.contactId\n        ? state.contactGather[data.contactId]\n        : null,\n  };\n};\n\nconst setToken = (state: ChatState, token: string): ChatState => {\n  return {\n    ...state,\n    token,\n  };\n};\n\nconst clearUser = (state: ChatState): ChatState => {\n  return {\n    ...state,\n    token: \"\",\n    user: emptyUser,\n  };\n};\n\nconst setConference = (\n  state: ChatState,\n  conference: ConferenceData\n): ChatState => {\n  return {\n    ...state,\n    conference: {\n      data: { ...conference },\n      joined: conference?.userId === state.user.userId,\n      ringPlayed: conference?.userId !== state.user.userId,\n    },\n  };\n};\n\nconst pauseConference = (\n  state: ChatState,\n  conference: ConferenceData\n): ChatState => {\n  if (state.conference.data?.id !== conference?.id) return state;\n  return {\n    ...state,\n    conference: {\n      data: { ...state.conference.data },\n      joined: false,\n      ringPlayed: false,\n    },\n  };\n};\n\nconst stopConference = (\n  state: ChatState,\n  conference: ConferenceData\n): ChatState => {\n  if (state.conference.data?.id !== conference?.id) return state;\n  return {\n    ...state,\n    conference: { data: null, joined: false, ringPlayed: false },\n  };\n};\n\nfunction chatReducer(state: ChatState, action: Action): ChatState {\n  switch (action.type) {\n    case \"SET_GROUP_GATHER\":\n      return {\n        ...state,\n        groupGather: {\n          ...state.groupGather,\n          [(action.payload as Group).groupId]: action.payload as Group,\n        },\n      };\n    case \"SET_CONTACT_GATHER\":\n      return {\n        ...state,\n        contactGather: {\n          ...state.contactGather,\n          [(action.payload as Contact).userId]: action.payload as Contact,\n        },\n      };\n    case \"DEL_GROUP\":\n      return delGroup(state, action.payload as number);\n    case \"DEL_GROUP_MEMBER\":\n      return delGroupMember(state, action.payload as GroupMap);\n    case \"DEL_CONTACT\":\n      return delContact(state, (action.payload as Contact).userId);\n    case \"SET_USER_GATHER\":\n      return {\n        ...state,\n        userGather: {\n          ...state.userGather,\n          [(action.payload as User).userId]: action.payload as User,\n        },\n      };\n    case \"UPDATE_ACTIVE_ROOM\":\n      return { ...state, activeRoom: getActiveRoom(state) };\n    case \"SET_ACTIVE_ROOM\":\n      return setActiveRoom(state, action.payload as SetActiveRoom);\n    case \"USER_ONLINE\":\n      return setUserOnline(state, action.payload as number, 1);\n    case \"USER_OFFLINE\":\n      return setUserOnline(state, action.payload as number, 0);\n    case \"ADD_GROUP_MESSAGE\":\n      return addGroupMessage(state, action.payload as GroupMessage);\n    case \"ADD_PRIVATE_MESSAGE\":\n      return addPrivateMessage(state, action.payload as PrivateMessage);\n    case \"ADD_GROUP_UNREAD_GATHER\":\n      return groupUnreadGather(\n        state,\n        action.payload as number,\n        (x?: number) => (x || 0) + 1\n      );\n    case \"ADD_CONTACT_UNREAD_GATHER\":\n      return contactUnreadGather(\n        state,\n        action.payload as number,\n        (x?: number) => (x || 0) + 1\n      );\n    case \"SET_TYPING\":\n      return { ...state, typing: action.payload as SetTyping };\n    case \"LOSE_GROUP_UNREAD_GATHER\":\n      return groupUnreadGather(state, action.payload as number, () => 0);\n    case \"LOSE_CONTACT_UNREAD_GATHER\":\n      return contactUnreadGather(state, action.payload as number, () => 0);\n    case \"REVOKE_MESSAGE\":\n      return revokeMessage(state, action.payload as MessageOperation);\n    case \"UPDATE_GROUP_INFO\":\n      return updateGroupInfo(state, action.payload as Group);\n    case \"UPDATE_USER_INFO\":\n      return updateUserInfo(state, action.payload as User);\n    case \"ADD_GROUP_MEMBER\":\n      return addGroupMember(state, action.payload as GroupMember);\n    case \"SET_CONFERENCE\":\n      return setConference(state, action.payload as ConferenceData);\n    case \"JOIN_CONFERENCE\":\n      return {\n        ...state,\n        conference: {\n          data: { ...(action.payload as ConferenceData) },\n          joined: true,\n          ringPlayed: false,\n        },\n      };\n    case \"PAUSE_CONFERENCE\":\n      return pauseConference(state, action.payload as ConferenceData);\n    case \"STOP_CONFERENCE\":\n      return stopConference(state, action.payload as ConferenceData);\n    case \"MARK_PRIVATE_MESSAGES_READ\":\n      return markPrivateMessagesRead(state, action.payload as number);\n    case \"ADD_PRIVATE_MESSAGES\":\n      return addPrivateMessages(state, action.payload as AddPrivateMessages);\n    case \"ADD_GROUP_MESSAGES\":\n      return addGroupMessages(state, action.payload as AddGroupMessages);\n    case \"SET_LOADING\":\n      return {\n        ...state,\n        loading: action.payload as boolean,\n        error: \"\",\n      };\n    case \"SET_ERROR\":\n      return {\n        ...state,\n        error: action.payload as string,\n        success: undefined,\n      };\n    case \"SET_SUCCES\":\n      return {\n        ...state,\n        success: action.payload as string,\n        error: undefined,\n      };\n    case \"SET_TOKEN\":\n      return setToken(state, action.payload as string);\n    case \"SET_USER\":\n      return {\n        ...state,\n        user: action.payload as User,\n      };\n    case \"CLEAR_USER\":\n      return clearUser(state);\n    case \"CLEAR_CHAT_DATA\":\n      return {\n        ...state,\n        activeRoom: null,\n        groupGather: {},\n        userGather: {},\n        contactGather: {},\n        conference: {\n          data: null,\n          joined: false,\n          ringPlayed: false,\n        },\n        typing: null,\n      };\n    case \"SET_OPERATORS\":\n      return {\n        ...state,\n        operators: action.payload as Contact[],\n      };\n    case \"SET_VISIT_DATA\":\n      return {\n        ...state,\n        visitData: action.payload as VisitData[],\n      };\n  }\n\n  return state;\n}\n\nexport type ChatDispatch = React.Dispatch<Action>;\nconst emptyDispatch: ChatDispatch = () => null;\n\ntype ChatProviderProps = {\n  defLang: string | undefined;\n  token: string;\n  refreshToken: string;\n  children: React.JSX.Element | React.JSX.Element[];\n};\n\nexport const ChatContext = React.createContext({\n  state: emptyChatState,\n  dispatch: emptyDispatch,\n});\n\nexport const ChatProvider: React.FC<ChatProviderProps> = (\n  props: ChatProviderProps\n) => {\n  emptyUser.langCode = props.defLang;\n\n  const token = props.token;\n  const refreshToken = props.token;\n  const chatState: ChatState = {\n    ...emptyChatState,\n    token,\n    refreshToken,\n  };\n\n  const [state, dispatch] = React.useReducer(chatReducer, chatState);\n  const value = useMemo(() => ({ state, dispatch }), [state]);\n  return (\n    <ChatContext.Provider value={value}>{props.children}</ChatContext.Provider>\n  );\n};\n","import axios, { AxiosError, AxiosInstance } from \"axios\";\nimport React, { createContext, useCallback, useContext, useMemo } from \"react\";\nimport { Contact, Group, PagingResponse, PrivateMessage } from \"../types\";\nimport { ChatContext, ChatDispatch } from \"./ChatContext\";\n\nexport interface IRestContext {\n  apiUrl: string;\n  pageSize: number;\n  fetch: AxiosInstance | null;\n  getPrivateMessages: (chat: Contact) => Promise<void>;\n  getGroupMessages: (chat: Group) => Promise<void>;\n  getUserByMmk: (\n    mmkId: string | null,\n    guid: string | null\n  ) => Promise<number | undefined>;\n}\nconst initialContext = {} as IRestContext;\n\nexport const RestContext: React.Context<IRestContext> =\n  createContext(initialContext);\n\ntype RestProviderProps = {\n  chatBaseURLApi: string;\n  pageSize: number;\n  children: React.JSX.Element;\n  baseUrl: string;\n};\n\nexport function clearLocalStorage() {\n  localStorage.removeItem(\"authToken\");\n  localStorage.removeItem(\"refreshToken\");\n  localStorage.removeItem(\"user\");\n  localStorage.removeItem(\"doctor\");\n  localStorage.removeItem(\"chatUser\");\n}\n\nexport async function getRefreshToken(\n  authToken: string,\n  refreshToken: string,\n  baseUrl: string\n) {\n  localStorage.removeItem(\"authToken\");\n  localStorage.removeItem(\"refreshToken\");\n  try {\n    const { data } = await axios.post(`${baseUrl}/auth/refreshToken`, {\n      authToken,\n      refreshToken,\n    });\n    localStorage.setItem(\"authToken\", data?.authToken);\n    localStorage.setItem(\"refreshToken\", data?.refreshToken);\n  } catch (error) {\n    console.log(\"ERROR RefreshToken\", error);\n  }\n  window.location.reload();\n}\n\nexport const RestProvider: React.FC<RestProviderProps> = ({\n  chatBaseURLApi,\n  pageSize,\n  children,\n  baseUrl,\n}: RestProviderProps) => {\n  const { state, dispatch } = useContext(ChatContext);\n  const errorInterceptor = (error: AxiosError) => {\n    if (\n      state.token &&\n      error.response != null &&\n      error.response.status === 401\n    ) {\n      getRefreshToken(state.token, state.refreshToken, baseUrl);\n    }\n  };\n\n  const fetch: AxiosInstance = axios.create({\n    timeout: 60000, // Таймаут минута\n    baseURL: chatBaseURLApi,\n    headers: {\n      \"Cache-Control\": \"no-cache\",\n      Pragma: \"no-cache\",\n      Authorization: `Bearer ${state.token}`,\n    },\n    withCredentials: false,\n  });\n\n  fetch.interceptors.response.use(\n    (response) => {\n      return response;\n    },\n    (error: AxiosError) => {\n      console.log(\"ERROR AxiosError\");\n      errorInterceptor(error);\n      return Promise.reject(error);\n    }\n  );\n\n  const getPrivateMessages = useCallback(\n    async (chat: Contact, callback?: () => void) => {\n      const contactId = chat.userId;\n      const current = chat.messages?.length;\n      try {\n        dispatch({ type: \"SET_LOADING\", payload: true });\n        const { data } = await fetch.get(\"/contact/messages\", {\n          params: {\n            contactId,\n            current,\n            pageSize,\n          },\n        });\n\n        if (data) {\n          dispatch({\n            type: \"ADD_PRIVATE_MESSAGES\",\n            payload: {\n              pageSize,\n              contactId,\n              messages: data as PrivateMessage[],\n            },\n          });\n          if (callback) {\n            callback();\n          }\n        }\n      } catch (error) {\n        const err = error as AxiosError;\n        dispatch({ type: \"SET_ERROR\", payload: err.message });\n      } finally {\n        dispatch({ type: \"SET_LOADING\", payload: false });\n      }\n    },\n    [dispatch]\n  );\n\n  const getGroupMessages = useCallback(\n    async (chat: Group) => {\n      const { groupId } = chat;\n      const current = chat.messages?.length;\n      try {\n        dispatch({ type: \"SET_LOADING\", payload: true });\n        const { data }: { data: PagingResponse } = await fetch.get(\n          \"/group/messages\",\n          {\n            params: {\n              groupId,\n              current,\n              pageSize,\n            },\n          }\n        );\n        if (data) {\n          dispatch({\n            type: \"ADD_GROUP_MESSAGES\",\n            payload: {\n              pageSize,\n              groupId,\n              ...data,\n            },\n          });\n        }\n      } catch (error) {\n        const err = error as AxiosError;\n        dispatch({ type: \"SET_ERROR\", payload: err.message });\n      } finally {\n        dispatch({ type: \"SET_LOADING\", payload: false });\n      }\n    },\n    [dispatch]\n  );\n\n  const getUserByMmk = async (mmkId: string | null, guid: string | null) => {\n    try {\n      const { data }: { data: number } = await fetch.get(\"/contact/find\", {\n        params: {\n          mmkId,\n          guid,\n        },\n      });\n      if (data != null) {\n        return data;\n      }\n    } catch (error) {\n      console.log(\"err getUserByMmk\", error);\n    }\n  };\n\n  const value = useMemo(\n    () => ({\n      apiUrl: chatBaseURLApi,\n      pageSize,\n      fetch,\n      getPrivateMessages,\n      getGroupMessages,\n      getUserByMmk,\n    }),\n    [chatBaseURLApi, pageSize]\n  );\n\n  return <RestContext.Provider value={value}>{children}</RestContext.Provider>;\n};\n","import {\n  Avatar,\n  Badge,\n  Box,\n  Chip,\n  ListItemAvatar,\n  ListItemButton,\n  ListItemText,\n} from \"@mui/material\";\nimport { Theme } from \"@mui/material/styles\";\nimport { createStyles, makeStyles, withStyles } from \"@mui/styles\";\nimport React from \"react\";\n\nimport GroupIcon from \"@mui/icons-material/Group\";\nimport { useTranslation } from \"react-i18next\";\nimport { ChatMessage, ChatRoom, Contact, Group, SetTyping } from \"../types\";\nimport { combineURLs, formatTime, getChatName } from \"../utils/common\";\n\ntype RoomListItemProps = {\n  apiUrl: string;\n  chat: ChatRoom;\n  active: boolean;\n  typing: SetTyping | null;\n  onClick: React.MouseEventHandler<HTMLDivElement> | undefined;\n};\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    main: {\n      flex: \"1 1 auto\",\n      whiteSpace: \"nowrap\",\n      overflow: \"hidden\",\n      textOverflow: \"ellipsis\",\n    },\n    time: {\n      paddingLeft: theme.spacing(1),\n      justifyContent: \"flex-end\",\n      whiteSpace: \"nowrap\",\n    },\n    unread: {\n      justifyContent: \"flex-end\",\n      maxHeight: 20,\n    },\n    avatarGroup: {\n      backgroundColor: \"#28B7C6\",\n      color: \"#fff\",\n    },\n  })\n);\n\nconst getMessageText = (\n  message: ChatMessage | null,\n  t: (key: string) => string\n) => {\n  if (!message) return null;\n  switch (message.messageType) {\n    case \"text\":\n      return message.content;\n    case \"image\":\n      return `[${t(\"CHAT.MESSAGE.TYPE.IMAGE\")}]`;\n    case \"video\":\n      return `[${t(\"CHAT.MESSAGE.TYPE.VIDEO\")}]`;\n    case \"file\":\n      return `[${t(\"CHAT.MESSAGE.TYPE.FILE\")}]`;\n    case \"notify\":\n      return `[${t(\"CHAT.MESSAGE.TYPE.NOTIFY\")}]`;\n    default:\n      return null;\n  }\n};\n\nconst TypingBadge = withStyles((theme: Theme) =>\n  createStyles({\n    badge: {\n      backgroundColor: \"#44b700\",\n      color: \"#44b700\",\n      boxShadow: `0 0 0 2px ${theme.palette.background.paper}`,\n      \"&::after\": {\n        position: \"absolute\",\n        top: 0,\n        left: 0,\n        width: \"100%\",\n        height: \"100%\",\n        borderRadius: \"50%\",\n        animation: \"$ripple 1.2s infinite ease-in-out\",\n        border: \"1px solid currentColor\",\n        content: '\"\"',\n      },\n    },\n    \"@keyframes ripple\": {\n      \"0%\": {\n        transform: \"scale(.8)\",\n        opacity: 1,\n      },\n      \"100%\": {\n        transform: \"scale(2.4)\",\n        opacity: 0,\n      },\n    },\n  })\n)(Badge);\n\nconst OnlineBadge = withStyles((theme: Theme) =>\n  createStyles({\n    badge: {\n      backgroundColor: theme.palette.primary.main,\n      boxShadow: `0 0 0 2px ${theme.palette.background.paper}`,\n    },\n  })\n)(Badge);\n\nconst contactAvatar = (\n  apiUrl: string,\n  contact: Contact,\n  typing: SetTyping | null\n): React.JSX.Element => {\n  const avatar = (\n    <Avatar\n      alt={contact.username}\n      src={contact.avatar ? combineURLs(apiUrl, contact.avatar) : \"\"}\n    />\n  );\n\n  const isTyping = !!typing?.contactId && typing?.userId === contact.userId;\n  if (isTyping)\n    return (\n      <TypingBadge\n        overlap=\"circular\"\n        anchorOrigin={{\n          vertical: \"bottom\",\n          horizontal: \"right\",\n        }}\n        variant=\"dot\"\n      >\n        {avatar}\n      </TypingBadge>\n    );\n\n  if (contact?.online)\n    return (\n      <OnlineBadge\n        overlap=\"circular\"\n        anchorOrigin={{\n          vertical: \"bottom\",\n          horizontal: \"right\",\n        }}\n        variant=\"dot\"\n      >\n        {avatar}\n      </OnlineBadge>\n    );\n\n  return avatar;\n};\n\nconst RoomListItem: React.FC<RoomListItemProps> = (\n  props: RoomListItemProps\n) => {\n  const classes = useStyles();\n  const { t } = useTranslation();\n  const { apiUrl, chat, typing } = props;\n  const roomName = getChatName(chat);\n\n  const avatar = (chat as Group).groupId ? (\n    <Avatar alt={roomName} className={classes.avatarGroup}>\n      <GroupIcon />{\" \"}\n    </Avatar>\n  ) : (\n    contactAvatar(apiUrl, chat as Contact, typing)\n  );\n\n  const lastMessage =\n    chat.messages && chat.messages.length > 0\n      ? chat.messages[chat.messages.length - 1]\n      : null;\n\n  const roomText = getMessageText(lastMessage, t);\n  const roomTime = lastMessage?.cdate;\n\n  return (\n    <ListItemButton selected={props.active} onClick={props.onClick}>\n      <ListItemAvatar>{avatar}</ListItemAvatar>\n      <ListItemText\n        secondaryTypographyProps={{ component: \"span\" }}\n        primary={\n          <Box display=\"flex\" flexDirection=\"row\">\n            <span className={classes.main}>{roomName}</span>\n            <span className={classes.time}>{formatTime(roomTime)}</span>\n          </Box>\n        }\n        secondary={\n          <Box display=\"flex\" flexDirection=\"row\">\n            <span className={classes.main}>{roomText}</span>\n            {chat.unreadCount ? (\n              <Chip\n                className={classes.unread}\n                component=\"span\"\n                size=\"small\"\n                color=\"primary\"\n                label={chat.unreadCount}\n              />\n            ) : null}\n          </Box>\n        }\n      />\n    </ListItemButton>\n  );\n};\nexport default RoomListItem;\n","import List from \"@mui/material/List\";\nimport { Theme } from \"@mui/material/styles\";\nimport React, { ChangeEvent, FC, useContext, useState } from \"react\";\n\nimport { Card, CardHeader, Divider, TextField } from \"@mui/material\";\nimport { makeStyles } from \"@mui/styles\";\nimport { useTranslation } from \"react-i18next\";\nimport { RestContext } from \"../context/RestContext\";\nimport { ChatRoom, Contact, Group, SetTyping, User } from \"../types\";\nimport { chatRoomComparer, getChatId, getChatName } from \"../utils/common\";\nimport RoomListItem from \"./RoomListItem\";\n\nconst useStyles = makeStyles((theme: Theme) => ({\n  root: {\n    width: \"100%\",\n    height: \"100%\",\n  },\n  searchField: {\n    width: \"100%\",\n  },\n  listStyle: {\n    height: \"89.5%\",\n    overflowY: \"auto\",\n    scrollbarWidth: \"thin\",\n    scrollbarColor: `${theme.palette.primary.light} #fff`,\n  },\n}));\n\ntype RoomListProps = {\n  user: User;\n  activeRoom: ChatRoom | null;\n  groups: Group[];\n  contacts: Contact[];\n  typing: SetTyping | null;\n  onChangeChat: (chat: ChatRoom) => void;\n};\n\nconst filterChats = (chats: ChatRoom[], filter: string | null): ChatRoom[] => {\n  if (!filter) return chats;\n  const lowerFilter = filter.toLowerCase();\n  return chats.filter((chat) =>\n    getChatName(chat).toLowerCase().includes(lowerFilter)\n  );\n};\n\nconst sortChats = (\n  userId: number,\n  groups: ChatRoom[],\n  contacts: ChatRoom[]\n) => {\n  let roomArr = [...groups, ...contacts];\n\n  // Сортировать окно чата (по времени последних сообщений)\n  roomArr = roomArr.sort(chatRoomComparer);\n\n  // Проверяем, есть ли список, который нужно закрепить\n  const topChatId = localStorage.getItem(`${userId}-topChatId`) as string;\n  if (topChatId) {\n    const chat = roomArr.find((c) => getChatId(c) === topChatId);\n    if (chat) {\n      // На первое место\n      roomArr = roomArr.filter((k) => getChatId(k) !== topChatId);\n      chat.isTop = true;\n      roomArr.unshift(chat);\n    }\n  }\n\n  return roomArr;\n};\n\nconst getRoomList = (\n  userId: number,\n  groups: ChatRoom[],\n  contacts: ChatRoom[],\n  filter: string | null\n) => {\n  return sortChats(\n    userId,\n    filterChats(groups, filter),\n    filterChats(contacts, filter)\n  );\n};\n\nconst RoomList: FC<RoomListProps> = ({\n  user,\n  activeRoom,\n  groups,\n  contacts,\n  typing,\n  onChangeChat,\n}: RoomListProps) => {\n  console.log(\" -- RoomList -- \");\n  const classes = useStyles();\n  const { t } = useTranslation();\n  const { apiUrl } = useContext(RestContext);\n\n  // Add search state\n  const [searchFilter, setSearchFilter] = useState<string>(\"\");\n\n  // Memoize the chat list\n  const allContacts = React.useMemo(\n    () => getRoomList(user.userId, groups, contacts, searchFilter),\n    [user.userId, groups, contacts, searchFilter]\n  );\n\n  const onSearchChange = (e: ChangeEvent<HTMLInputElement>): void => {\n    setSearchFilter(e.target.value);\n  };\n\n  return (\n    <Card elevation={1} className={classes.root}>\n      <CardHeader\n        title={\n          <TextField\n            className={classes.searchField}\n            label={t(\"CHAT.INPUT_SEARCH_CONTACT\")}\n            variant=\"outlined\"\n            size=\"small\"\n            fullWidth\n            onChange={onSearchChange}\n            value={searchFilter}\n          />\n        }\n      />\n      <Divider />\n      <List aria-label=\"rooms\" className={classes.listStyle}>\n        {allContacts.map((chat: ChatRoom) => (\n          <RoomListItem\n            key={getChatId(chat)}\n            apiUrl={apiUrl}\n            chat={chat}\n            active={chat === activeRoom}\n            typing={typing}\n            onClick={() => onChangeChat(chat)}\n          />\n        ))}\n      </List>\n    </Card>\n  );\n};\nexport default RoomList;\n","import { Alert, Snackbar } from \"@mui/material\";\nimport React from \"react\";\nimport { ChatContext } from \"../context/ChatContext\";\n\nconst ChatAlert: React.FC = () => {\n  // const { t } = useTranslation();\n  //const [havePermissions, setHavePermissions] = useState(false);\n  const {\n    state: { error, success },\n    dispatch,\n  } = React.useContext(ChatContext);\n\n  const handleClose = () => {\n    dispatch({ type: \"SET_ERROR\", payload: undefined });\n    dispatch({ type: \"SET_SUCCES\", payload: undefined });\n  };\n\n  return (\n    <Snackbar\n      anchorOrigin={{ vertical: \"top\", horizontal: \"center\" }}\n      open={!!error || !!success}\n      autoHideDuration={6000}\n      onClose={handleClose}\n    >\n      <Alert onClose={handleClose} severity={error ? \"error\" : \"success\"}>\n        {error ? error : success}\n      </Alert>\n    </Snackbar>\n  );\n};\n\nexport default ChatAlert;\n","import { Container } from \"@mui/material\";\nimport { Theme } from \"@mui/material/styles\";\nimport { makeStyles } from \"@mui/styles\";\nimport React from \"react\";\n\nconst useStyles = makeStyles((theme: Theme) => ({\n  root: {\n    height: \"100%\",\n    overflow: \"hidden\",\n    padding: 0,\n    [theme.breakpoints.up(\"lg\")]: {\n      minWidth: 1200,\n    },\n  },\n}));\n\nconst ChatContainer: React.FC<{ children: React.ReactNode }> = ({\n  children,\n}) => {\n  const classes = useStyles();\n  return (\n    <Container maxWidth={false} className={classes.root}>\n      {children}\n    </Container>\n  );\n};\n\nexport default ChatContainer;\n","import RecentActorsIcon from \"@mui/icons-material/RecentActors\";\nimport VideocamIcon from \"@mui/icons-material/Videocam\";\nimport { Box, Grid2 as Grid, IconButton } from \"@mui/material\";\nimport React from \"react\";\nimport { ChatRoom, User } from \"../types\";\n\ninterface ChatLayoutProps {\n  isMobile: boolean;\n  conferenceActive: boolean;\n  hideRooms: boolean;\n  contactsList: React.ReactNode;\n  chatRoom: React.ReactNode;\n  activeRoom: ChatRoom | null;\n  chatOld: ChatRoom | null;\n  user: User;\n  onExitRoom?: (chat: ChatRoom) => void;\n  onChangeChat: (chat: ChatRoom) => void;\n}\n\nconst ChatLayout: React.FC<ChatLayoutProps> = ({\n  isMobile,\n  conferenceActive,\n  hideRooms,\n  contactsList,\n  chatRoom,\n  activeRoom,\n  user,\n  onExitRoom,\n  onChangeChat,\n  chatOld,\n}) => {\n  if (isMobile) {\n    return (\n      <>\n        {conferenceActive && (\n          <Box\n            sx={{\n              position: \"absolute\",\n              overflow: \"hidden\",\n              zIndex: 1400,\n              top: user?.role && [3, 4].includes(user.role) ? -56 : -12,\n              left: user?.role && [3, 4].includes(user.role) ? 32 : 218,\n            }}\n          >\n            <Box\n              display=\"flex\"\n              flexDirection=\"row\"\n              columnGap={3}\n              my={3}\n              sx={{\n                position: \"relative\",\n              }}\n            >\n              <IconButton\n                aria-label=\"exit room\"\n                sx={{\n                  color: \"#fff\",\n                  background: \"#000\",\n                  \"&:hover\": {\n                    background: \"#eee\",\n                    color: \"#000\",\n                    boxShadow: \"none\",\n                  },\n                }}\n                onClick={() => {\n                  if (activeRoom && onExitRoom) onExitRoom(activeRoom);\n                  else if (chatOld && onChangeChat) {\n                    console.log(\"onChangeChat\");\n                    onChangeChat(chatOld);\n                  }\n                }}\n              >\n                {activeRoom ? <VideocamIcon /> : <RecentActorsIcon />}\n              </IconButton>\n            </Box>\n          </Box>\n        )}\n        {contactsList}\n        {chatRoom}\n      </>\n    );\n  }\n\n  return (\n    <>\n      <Grid container spacing={1} sx={{ height: \"100%\" }}>\n        {(conferenceActive || !hideRooms) && (\n          <Grid\n            size={\n              activeRoom\n                ? {\n                    sm: conferenceActive ? 6 : 4,\n                    lg: conferenceActive ? 6 : 4,\n                    xl: conferenceActive ? 6 : 3,\n                  }\n                : 12\n            }\n            sx={{ height: \"100%\" }}\n          >\n            {contactsList}\n          </Grid>\n        )}\n        {activeRoom && (\n          <Grid\n            size={{\n              sm: conferenceActive ? 6 : hideRooms ? 12 : 8,\n              lg: conferenceActive ? 6 : hideRooms ? 12 : 8,\n              xl: conferenceActive ? 6 : hideRooms ? 12 : 9,\n            }}\n            sx={{ height: \"100%\" }}\n          >\n            {chatRoom}\n          </Grid>\n        )}\n      </Grid>\n    </>\n  );\n};\n\nexport default ChatLayout;\n","import SettingsSuggestIcon from \"@mui/icons-material/SettingsSuggest\";\nimport SettingsVoiceIcon from \"@mui/icons-material/SettingsVoice\";\nimport VideocamIcon from \"@mui/icons-material/Videocam\";\nimport { Button, IconButton, Tooltip, useMediaQuery } from \"@mui/material\";\nimport { Theme } from \"@mui/material/styles\";\nimport React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { ChatContext } from \"../context/ChatContext\";\n\ntype CheckAudiVideoPermProps = {\n  audio: boolean;\n  video: boolean;\n};\n\nconst CheckAudiVideoPerm: React.FC<CheckAudiVideoPermProps> = ({\n  audio,\n  video,\n}: CheckAudiVideoPermProps) => {\n  const { t } = useTranslation();\n  const isMobile = useMediaQuery((theme: Theme) =>\n    theme.breakpoints.down(\"md\")\n  );\n  const { dispatch } = React.useContext(ChatContext);\n  const checkPermissions = () => {\n    const permissions = navigator.mediaDevices.getUserMedia({\n      audio,\n      video,\n    });\n    permissions\n      .then((data) => {\n        console.log(\"permissions\", data);\n        dispatch({\n          type: \"SET_SUCCES\",\n          payload: t(\"CHAT.CONFERENCE.ALLOK\"),\n        });\n      })\n      .catch((err) => {\n        let payload = t(\"CHAT.CONFERENCE.ErrorAny\");\n        if (err.name === \"NotFoundError\") {\n          payload = t(\"CHAT.CONFERENCE.NotFoundError\");\n        }\n        if (err.name === \"NotAllowedError\") {\n          payload = t(\"CHAT.CONFERENCE.NotAllowedError\");\n        }\n\n        dispatch({\n          type: \"SET_ERROR\",\n          payload,\n        });\n        //setHavePermissions(false);\n        console.log(\"err\", `${err.name} : ${err.message}`);\n      });\n  };\n\n  const title =\n    audio && video\n      ? t(\"CHAT.CONFERENCE.CheckCamMic\")\n      : audio\n        ? t(\"CHAT.CONFERENCE.CheckMic\")\n        : t(\"CHAT.CONFERENCE.CheckCam\");\n\n  return !isMobile ? (\n    <Button\n      aria-label=\"cancel call\"\n      variant=\"contained\"\n      sx={{\n        color: \"#fff\",\n        background: \"#000\",\n        \"&:hover\": {\n          background: \"#eee\",\n          color: \"#000\",\n          boxShadow: \"none\",\n        },\n      }}\n      size=\"small\"\n      startIcon={\n        audio && video ? (\n          <SettingsSuggestIcon />\n        ) : audio ? (\n          <SettingsVoiceIcon />\n        ) : (\n          <VideocamIcon />\n        )\n      }\n      onClick={() => checkPermissions()}\n    >\n      {title}\n    </Button>\n  ) : (\n    <Tooltip title={title}>\n      <IconButton\n        sx={{\n          color: \"#fff\",\n          background: \"#000\",\n          \"&:hover\": {\n            background: \"#eee\",\n            color: \"#000\",\n            boxShadow: \"none\",\n          },\n        }}\n        aria-label=\"check\"\n        onClick={() => checkPermissions()}\n        size=\"large\"\n      >\n        {audio && video ? (\n          <SettingsSuggestIcon />\n        ) : audio ? (\n          <SettingsVoiceIcon />\n        ) : (\n          <VideocamIcon />\n        )}\n      </IconButton>\n    </Tooltip>\n  );\n};\n\nexport default CheckAudiVideoPerm;\n","import { Box } from \"@mui/material\";\nimport * as React from \"react\";\nimport CheckAudiVideoPerm from \"./CheckAudiVideoPerm\";\nimport { User } from \"../types\";\n\ninterface ConferenceControlsProps {\n  user: User;\n}\n\nconst ConferenceControls: React.FC<ConferenceControlsProps> = ({ user }) => {\n  return (\n    <Box\n      sx={(theme) => ({\n        position: \"absolute\",\n        overflow: \"hidden\",\n        top: user?.role && [3, 4].includes(user.role) ? 50 : 110,\n        left: user?.role && [3, 4].includes(user.role) ? 50 : 30,\n        zIndex: 1000,\n        [theme.breakpoints.down(\"sm\")]: {\n          top: 98,\n          left: 26,\n        },\n      })}\n    >\n      <Box\n        display=\"flex\"\n        flexDirection=\"row\"\n        columnGap={3}\n        my={3}\n        sx={{\n          position: \"relative\",\n        }}\n      >\n        <CheckAudiVideoPerm audio={true} video={false} />\n        <CheckAudiVideoPerm audio={false} video={true} />\n      </Box>\n    </Box>\n  );\n};\n\nexport default ConferenceControls;\n","import * as React from \"react\";\nimport { ChatRoom } from \"../types\";\nimport Conference from \"./Conference\";\nimport ConferenceCall from \"./ConferenceCall\";\nimport ConferenceControls from \"./ConferenceControls\";\n\ninterface ConferenceSectionProps {\n  conference: {\n    data: any;\n    joined: boolean;\n  };\n  onClose: (conference: any) => void;\n  onAccept: (conference: any) => void;\n  isMobile: boolean;\n  user: any;\n  activeRoom: ChatRoom | null;\n  onChangeChat: (chat: ChatRoom) => void;\n  apiUrl: string;\n}\n\nexport const ConferenceSection: React.FC<ConferenceSectionProps> = ({\n  conference,\n  onClose,\n  onAccept,\n  isMobile,\n  user,\n  activeRoom,\n  onChangeChat,\n  apiUrl,\n}) => {\n  if (!conference.data) return null;\n\n  if (conference.joined) {\n    return (\n      <>\n        <Conference\n          conference={conference.data}\n          onClose={onClose}\n          langCode={user.langCode}\n        />\n        {((!activeRoom && isMobile) || !isMobile) && (\n          <ConferenceControls user={user} />\n        )}\n      </>\n    );\n  }\n\n  return (\n    <ConferenceCall\n      apiUrl={apiUrl}\n      contact={\n        user.userId === conference.data.userId\n          ? conference.data.contactId\n          : conference.data.userId\n      }\n      conference={conference.data}\n      onAccept={onAccept}\n    />\n  );\n};\n\nexport default ConferenceSection;\n","import React, { createContext, useContext, useEffect, useMemo } from \"react\";\nimport { Socket } from \"socket.io-client\";\nimport { useSocket } from \"../hooks/useSocket\";\nimport {\n  ChatData,\n  ConferenceData,\n  Contact,\n  Group,\n  GroupMap,\n  GroupMessage,\n  JoinGroup,\n  MessageOperation,\n  PrivateMessage,\n  SetActiveRoom,\n  SetTyping,\n  User,\n  VisitData,\n} from \"../types\";\nimport { allGather } from \"../utils/common\";\nimport { ChatContext, ChatDispatch } from \"./ChatContext\";\nimport { getRefreshToken } from \"./RestContext\";\n\n// Формат ответа сервера\ninterface ServerRes {\n  code: number;\n  msg: string;\n  data: unknown;\n}\n\nexport interface ISocketContext {\n  socket: Socket | null;\n  online: boolean;\n}\nconst initialContext = {\n  online: false,\n} as ISocketContext;\n\nexport const SocketContext: React.Context<ISocketContext> =\n  createContext(initialContext);\n\ntype SocketProviderProps = {\n  wsUrl: string;\n  wsPath: string;\n  baseUrl: string;\n  children: React.JSX.Element;\n};\n\nexport const SocketProvider: React.FC<SocketProviderProps> = ({\n  wsUrl,\n  wsPath,\n  baseUrl,\n  children,\n}: SocketProviderProps) => {\n  const { state, dispatch } = useContext(ChatContext);\n  const { socket, online, disconnectSocket, connectSocket } = useSocket(\n    wsUrl,\n    wsPath,\n    state.token\n  );\n\n  useEffect(() => {\n    if (state.token) {\n      connectSocket();\n    }\n    if (!state.token) disconnectSocket();\n    return () => {\n      disconnectSocket();\n    };\n  }, [state.token]);\n\n  // Consider creating a reusable error handler\n  const handleSocketError = (res: ServerRes, dispatch: ChatDispatch) => {\n    if (res.code) {\n      dispatch({ type: \"SET_ERROR\", payload: res.msg });\n      return true;\n    }\n    return false;\n  };\n\n  useEffect(() => {\n    // listen unauthorized event\n    const listener = (msg: string) => {\n      console.log(\"unauthorized msg\", msg);\n      getRefreshToken(state.token, state.refreshToken, baseUrl);\n    };\n    socket?.on(\"unauthorized\", listener);\n\n    // listen chatData event\n    const listener1 = (res: ServerRes) => {\n      if (handleSocketError(res, dispatch)) return;\n\n      const payload = res.data as ChatData;\n      const groupArr = payload.groupData;\n      const contactArr = payload.contactData;\n      const userArr = payload.userData;\n      dispatch({ type: \"CLEAR_CHAT_DATA\" });\n      dispatch({ type: \"SET_USER\", payload: payload.user });\n      if (groupArr.length) {\n        for (const group of groupArr) {\n          socket?.emit(\"joinGroupSocket\", {\n            groupId: group.groupId,\n          });\n          dispatch({ type: \"SET_GROUP_GATHER\", payload: group });\n        }\n      }\n      if (contactArr.length) {\n        for (const contact of contactArr) {\n          socket?.emit(\"joinPrivateSocket\", {\n            contactId: contact.userId,\n          });\n          dispatch({ type: \"SET_CONTACT_GATHER\", payload: contact });\n        }\n      }\n      dispatch({\n        type: \"SET_OPERATORS\",\n        payload: payload.operatorData,\n      });\n      if (userArr.length) {\n        for (const user_ of userArr) {\n          dispatch({ type: \"SET_USER_GATHER\", payload: user_ });\n        }\n      }\n      dispatch({ type: \"UPDATE_ACTIVE_ROOM\" });\n      dispatch({\n        type: \"SET_CONFERENCE\",\n        payload: payload.conferenceData,\n      });\n      dispatch({\n        type: \"SET_VISIT_DATA\",\n        payload: payload.visitData,\n      });\n    };\n    socket?.on(\"chatData\", listener1);\n\n    // listen user online\n    const listener2 = (res: ServerRes) => {\n      dispatch({ type: \"USER_ONLINE\", payload: res.data as number });\n    };\n    socket?.on(\"userOnline\", listener2);\n\n    // listen user offline\n    const listener3 = (res: ServerRes) => {\n      dispatch({ type: \"USER_OFFLINE\", payload: res.data as number });\n    };\n    socket?.on(\"userOffline\", listener3);\n\n    // listen private socket join\n    const listener4 = (res: ServerRes) => {\n      if (handleSocketError(res, dispatch)) return;\n      console.log(\"Успешно вошел в приватный чат\");\n    };\n    socket?.on(\"joinPrivateSocket\", listener4);\n\n    // typing\n    let typingTimer: NodeJS.Timeout;\n    const listener5 = (res: ServerRes) => {\n      if (handleSocketError(res, dispatch)) return;\n      if (typingTimer) clearTimeout(typingTimer);\n      dispatch({\n        type: \"SET_TYPING\",\n        payload: res.data as SetTyping,\n      });\n      typingTimer = setTimeout(() => {\n        dispatch({ type: \"SET_TYPING\", payload: null });\n      }, 1000);\n    };\n    socket?.on(\"typing\", listener5);\n\n    // revoke\n    const listener6 = (res: ServerRes) => {\n      if (handleSocketError(res, dispatch)) return;\n      const data = res.data as MessageOperation;\n      dispatch({ type: \"REVOKE_MESSAGE\", payload: data });\n      console.log(\"REVOKE_MESSAGE\");\n    };\n    socket?.on(\"revokeMessage\", listener6);\n\n    // set group gather\n    const listener7 = (res: ServerRes) => {\n      if (handleSocketError(res, dispatch)) return;\n      dispatch({\n        type: \"SET_GROUP_GATHER\",\n        payload: res.data as Group,\n      });\n    };\n    socket?.on(\"addGroup\", listener7);\n\n    // set contact gather, user gather\n    const listener8 = (res: ServerRes) => {\n      if (handleSocketError(res, dispatch)) return;\n      const data = res.data as Contact;\n      dispatch({ type: \"SET_CONTACT_GATHER\", payload: data });\n      dispatch({ type: \"SET_USER_GATHER\", payload: data });\n      socket?.emit(\"joinPrivateSocket\", {\n        contactId: data.userId,\n      });\n    };\n    socket?.on(\"addContact\", listener8);\n\n    // delete contact\n    const listener10 = (res: ServerRes) => {\n      if (handleSocketError(res, dispatch)) return;\n      const data = res.data as Contact;\n      dispatch({ type: \"DEL_CONTACT\", payload: data });\n    };\n    socket?.on(\"deleteContact\", listener10);\n\n    // update GroupInfo\n    const listener11 = (res: ServerRes) => {\n      if (handleSocketError(res, dispatch)) return;\n      const data = res.data as Group;\n      dispatch({ type: \"UPDATE_GROUP_INFO\", payload: data });\n    };\n    socket?.on(\"updateGroupInfo\", listener11);\n\n    // update UserInfo\n    const listener12 = (res: ServerRes) => {\n      if (handleSocketError(res, dispatch)) return;\n      const data = res.data as User;\n      dispatch({ type: \"UPDATE_USER_INFO\", payload: data });\n    };\n    socket?.on(\"updateUserInfo\", listener12);\n\n    // start Conference\n    const listener13 = (res: ServerRes) => {\n      if (handleSocketError(res, dispatch)) return;\n      dispatch({\n        type: \"SET_CONFERENCE\",\n        payload: res.data as ConferenceData,\n      });\n    };\n    socket?.on(\"startConference\", listener13);\n\n    // pause Conference\n    const listener14 = (res: ServerRes) => {\n      if (handleSocketError(res, dispatch)) return;\n      dispatch({\n        type: \"PAUSE_CONFERENCE\",\n        payload: res.data as ConferenceData,\n      });\n    };\n    socket?.on(\"pauseConference\", listener14);\n\n    // stop Conference\n    const listener15 = (res: ServerRes) => {\n      if (handleSocketError(res, dispatch)) return;\n      dispatch({\n        type: \"STOP_CONFERENCE\",\n        payload: res.data as ConferenceData,\n      });\n    };\n    socket?.on(\"stopConference\", listener15);\n\n    // add Operator\n    const listener16 = (res: ServerRes) => {\n      if (handleSocketError(res, dispatch)) return;\n    };\n    socket?.on(\"addOperator\", listener16);\n\n    // set ActiveRoom\n    const listener17 = (res: ServerRes) => {\n      if (handleSocketError(res, dispatch)) return;\n      dispatch({\n        type: \"SET_ACTIVE_ROOM\",\n        payload: res.data as SetActiveRoom,\n      });\n    };\n    socket?.on(\"setActiveRoom\", listener17);\n\n    // visit Data\n    const listener18 = (res: ServerRes) => {\n      if (handleSocketError(res, dispatch)) return;\n      const payload = res.data as { visitData: VisitData };\n      dispatch({\n        type: \"SET_VISIT_DATA\",\n        payload: payload.visitData,\n      });\n    };\n    socket?.on(\"visitData\", listener18);\n\n    return () => {\n      // detach\n      socket?.off(\"unauthorized\", listener);\n\n      socket?.off(\"chatData\", listener1);\n\n      socket?.off(\"userOnline\", listener2);\n\n      socket?.off(\"userOffline\", listener3);\n\n      socket?.off(\"joinPrivateSocket\", listener4);\n\n      if (typingTimer) clearTimeout(typingTimer);\n      socket?.off(\"typing\", listener5);\n\n      socket?.off(\"revokeMessage\", listener6);\n\n      socket?.off(\"addGroup\", listener7);\n\n      socket?.off(\"addContact\", listener8);\n\n      socket?.off(\"deleteContact\", listener10);\n\n      socket?.off(\"updateGroupInfo\", listener11);\n\n      socket?.off(\"updateUserInfo\", listener12);\n\n      socket?.off(\"startConference\", listener13);\n\n      socket?.off(\"pauseConference\", listener14);\n\n      socket?.off(\"stopConference\", listener15);\n\n      socket?.off(\"addOperator\", listener16);\n\n      socket?.off(\"setActiveRoom\", listener17);\n\n      socket?.off(\"visitData\", listener18);\n    };\n  }, [socket?.id]);\n\n  // group Message\n  useEffect(() => {\n    const listener = async (res: ServerRes) => {\n      if (handleSocketError(res, dispatch)) return;\n      const data = res.data as GroupMessage;\n      dispatch({ type: \"ADD_GROUP_MESSAGE\", payload: data });\n      if (data.userId !== state.user.userId) {\n        socket?.emit(\"markAsRead\", {\n          groupId: data.groupId,\n          _id: data._id,\n        });\n      }\n    };\n    socket?.on(\"groupMessage\", listener);\n\n    // private Message\n    const listener1 = async (res: ServerRes) => {\n      if (handleSocketError(res, dispatch)) return;\n      const data = res.data as PrivateMessage;\n      if (\n        data.contactId === state.user.userId ||\n        data.userId === state.user.userId\n      ) {\n        dispatch({\n          type: \"ADD_PRIVATE_MESSAGE\",\n          payload: data,\n        });\n\n        // если есть активная комната и это приватная комната (!groupId && userId) с отправителем сообщения (userId)\n        if (state.activeRoom && state.activeRoom?.userId === data.userId) {\n          socket?.emit(\"markAsRead\", {\n            contactId: data.userId,\n            _id: data._id,\n          });\n        }\n      }\n    };\n\n    socket?.on(\"privateMessage\", listener1);\n\n    return () => {\n      socket?.off(\"groupMessage\", listener);\n      socket?.off(\"privateMessage\", listener1);\n    };\n  }, [socket?.id, state.activeRoom?.userId, state.activeRoom?.groupId]);\n\n  useEffect(() => {\n    // mark As Read\n    const listener = (res: ServerRes) => {\n      if (handleSocketError(res, dispatch)) return;\n      const data = res.data as MessageOperation;\n      if (data.userId === state.user.userId) {\n        if (data.groupId) {\n          dispatch({\n            type: \"LOSE_GROUP_UNREAD_GATHER\",\n            payload: data.groupId,\n          });\n        } else {\n          dispatch({\n            type: \"LOSE_CONTACT_UNREAD_GATHER\",\n            payload: data.contactId,\n          });\n        }\n      } else {\n        if (data.contactId)\n          dispatch({\n            type: \"MARK_PRIVATE_MESSAGES_READ\",\n            payload: data.userId,\n          });\n      }\n    };\n    socket?.on(\"markAsRead\", listener);\n\n    // delete Group\n    const listener1 = (res: ServerRes) => {\n      if (handleSocketError(res, dispatch)) return;\n      const data = res.data as GroupMap;\n      if (data.userId === state.user.userId) {\n        // если удаляем себя из группы\n        dispatch({ type: \"DEL_GROUP\", payload: data.groupId });\n      } else {\n        dispatch({ type: \"DEL_GROUP_MEMBER\", payload: data });\n      }\n    };\n    socket?.on(\"deleteGroup\", listener1);\n\n    const listener2 = (res: ServerRes) => {\n      if (handleSocketError(res, dispatch)) return;\n      const { group, user: newUser } = res.data as JoinGroup;\n\n      if (!state.groupGather[group.groupId]) {\n        console.log(\"joined to a new group\");\n        // Если группы еще у нас нет, то получаем информацию о пользователях в группе\n        socket?.emit(\"chatData\");\n      } else if (newUser.userId !== state.user.userId) {\n        // Новые пользователи присоединяются к группе\n        dispatch({\n          type: \"ADD_GROUP_MEMBER\",\n          payload: {\n            groupId: group.groupId,\n            members: [newUser],\n          },\n        });\n      }\n    };\n    socket?.on(\"joinGroup\", listener2);\n\n    // listen group socket join\n    const listener4 = (res: ServerRes) => {\n      if (handleSocketError(res, dispatch)) return;\n      const data = res.data as JoinGroup;\n      const newUser: Contact = data.user;\n      newUser.online = 1;\n      const { group } = data;\n      const groupObj = state.groupGather[group.groupId];\n      // Информация о присоединении к группе новых пользователей\n      if (\n        groupObj &&\n        !groupObj.members?.find((member) => member.userId === newUser.userId)\n      ) {\n        newUser.isManager = 0;\n        groupObj.members?.push(newUser);\n        // Vue.prototype.$message.info(res.msg);\n      }\n      dispatch({ type: \"SET_USER_GATHER\", payload: newUser });\n    };\n    socket?.on(\"joinGroupSocket\", listener4);\n\n    return () => {\n      socket?.off(\"markAsRead\", listener);\n\n      socket?.off(\"deleteGroup\", listener1);\n\n      socket?.off(\"joinGroup\", listener2);\n\n      socket?.off(\"joinGroupSocket\", listener4);\n    };\n  }, [socket?.id, state.user.userId, allGather(state.groupGather)]);\n\n  const value = useMemo(() => ({ socket, online }), [socket, online]);\n\n  return (\n    <SocketContext.Provider value={value}>{children}</SocketContext.Provider>\n  );\n};\n","import { useCallback, useEffect, useState } from \"react\";\nimport io, { Socket } from \"socket.io-client\";\n\nexport const useSocket = (\n  url: string,\n  path: string,\n  accessToken: string\n): {\n  socket: Socket | null;\n  online: boolean;\n  connectSocket: () => void;\n  disconnectSocket: () => void;\n} => {\n  const [socket, setSocket] = useState<Socket | null>(null);\n\n  const connectSocket = useCallback(() => {\n    // console.log(\"do connect\");\n    const socketTemp = io(url, {\n      path,\n      reconnection: true,\n      extraHeaders: {\n        Authorization: `Bearer ${accessToken}`,\n      },\n    });\n    setSocket(socketTemp);\n  }, [url, path, accessToken]);\n\n  const disconnectSocket = useCallback(() => {\n    // console.log(\"do disconnect\");\n    socket?.disconnect();\n    setSocket(null);\n  }, [socket]);\n\n  const [online, setOnline] = useState<boolean>(false);\n\n  useEffect(() => {\n    setOnline(socket?.connected ? true : false);\n  }, [socket]);\n\n  useEffect(() => {\n    socket?.on(\"connect\", () => {\n      // console.log(\"connected\");\n      setOnline(true);\n      socket.emit(\"chatData\");\n    });\n  }, [socket]);\n\n  useEffect(() => {\n    socket?.on(\"disconnect\", () => {\n      // console.log(\"disconnected\");\n      setOnline(false);\n    });\n  }, [socket]);\n\n  return {\n    socket,\n    online,\n    disconnectSocket,\n    connectSocket,\n  };\n};\n","import { useMediaQuery } from \"@mui/material\";\nimport { Theme } from \"@mui/material/styles\";\nimport * as React from \"react\";\nimport { Room, RoomList } from \"../components\";\nimport ChatAlert from \"../components/Alert\";\nimport ChatContainer from \"../components/ChatContainer\";\nimport ChatLayout from \"../components/ChatLayout\";\nimport ConferenceSection from \"../components/ConferenceSection\";\nimport { ChatContext } from \"../context/ChatContext\";\nimport { RestContext } from \"../context/RestContext\";\nimport { SocketContext } from \"../context/SocketContext\";\nimport {\n  ChatMessage,\n  ChatPageProps,\n  ChatRoom,\n  ConferenceData,\n  Contact,\n  Group,\n  SendMessage,\n} from \"../types\";\nimport { getParam, isEmpty, isGroup } from \"../utils/common\";\n\n// Отключили проигрыш звука\n// const getRingAudio = (): HTMLAudioElement => {\n//   const audio = new Audio(\n//     process.env.PUBLIC_URL + '/audio/ring-in.ogg',\n//   );\n//   audio.loop = true;\n//   return audio;\n// };\n\n// Add at the top of the file after imports\n\nexport const ChatPage: React.FC<ChatPageProps> = ({\n  activeGroupId,\n  activeChatUserId,\n  hideRooms = false,\n  fullWidth = false,\n  ...props\n}: ChatPageProps) => {\n  const isMobile = useMediaQuery((theme: Theme) =>\n    theme.breakpoints.down(\"md\")\n  );\n\n  // Update context usage\n  const { state, dispatch } = React.useContext(ChatContext);\n\n  const { socket } = React.useContext(SocketContext);\n\n  const {\n    apiUrl,\n    pageSize,\n    getPrivateMessages,\n    getGroupMessages,\n    getUserByMmk,\n  } = React.useContext(RestContext);\n\n  // const [ringAudio] = React.useState(getRingAudio());\n\n  const onExitActiveRoom = React.useCallback(() => {\n    dispatch({\n      type: \"SET_ACTIVE_ROOM\",\n      payload: {},\n    });\n  }, [dispatch]);\n\n  // Добавляем утилитарную функцию для безопасной отправки сообщений через сокет\n  const emitSocketEvent = React.useCallback(\n    (eventName: string, data: unknown) => {\n      if (!socket) {\n        console.warn(`Socket not connected, cannot emit ${eventName}`);\n        return;\n      }\n\n      try {\n        socket.emit(eventName, data);\n      } catch (error) {\n        console.error(`Error emitting ${eventName}:`, error);\n        dispatch({\n          type: \"SET_ERROR\",\n          payload: `Failed to send ${eventName}`,\n        });\n      }\n    },\n    [socket, dispatch]\n  );\n\n  const onNeedMoreMessages = React.useCallback(\n    async (chat: ChatRoom) => {\n      try {\n        dispatch({ type: \"SET_LOADING\", payload: true });\n        if (isGroup(chat)) {\n          await getGroupMessages(chat);\n        } else {\n          await getPrivateMessages(chat as Contact);\n        }\n      } catch (error) {\n        console.error(\"Failed to load messages:\", error);\n        dispatch({ type: \"SET_ERROR\", payload: \"Failed to load messages\" });\n      } finally {\n        dispatch({ type: \"SET_LOADING\", payload: false });\n      }\n    },\n    [getPrivateMessages, getGroupMessages, dispatch]\n  );\n\n  const onMessageDelete = React.useCallback(\n    (chat: ChatRoom, message: ChatMessage) => {\n      emitSocketEvent(\"revokeMessage\", {\n        groupId: isGroup(chat) ? chat.groupId : undefined,\n        contactId: chat.userId,\n        _id: message._id,\n      });\n    },\n    [emitSocketEvent]\n  );\n\n  const onTyping = React.useCallback(\n    (chat: ChatRoom) => {\n      emitSocketEvent(\"typing\", {\n        groupId: isGroup(chat) ? chat.groupId : undefined,\n        contactId: chat.userId,\n      });\n    },\n    [emitSocketEvent]\n  );\n\n  const onSendMessage = React.useCallback(\n    (chat: ChatRoom, data: SendMessage) => {\n      const baseMessage = {\n        content: data.message,\n        width: data.width,\n        height: data.height,\n        fileName: data.fileName,\n        messageType: data.messageType,\n        size: data.size,\n      };\n\n      if (isGroup(chat)) {\n        emitSocketEvent(\"groupMessage\", {\n          ...baseMessage,\n          groupId: chat.groupId,\n        });\n      } else {\n        emitSocketEvent(\"privateMessage\", {\n          ...baseMessage,\n          contactId: chat.userId,\n        });\n      }\n    },\n    [emitSocketEvent]\n  );\n\n  // Обновляем onEnterRoom для безопасного доступа к данным\n  const onEnterRoom = React.useCallback(\n    (chat: ChatRoom) => {\n      if (!chat?.messages?.length || !socket) return;\n\n      try {\n        const lastMessage = chat.messages[chat.messages.length - 1];\n        if (!lastMessage?._id) return;\n\n        if (isGroup(chat)) {\n          socket.emit(\"markAsRead\", {\n            groupId: chat.groupId,\n            _id: lastMessage._id,\n          });\n          //} else if (chat.userId === lastMessage.userId) {\n        } else {\n          dispatch({\n            type: \"MARK_PRIVATE_MESSAGES_READ\",\n            payload: chat.userId,\n          });\n          socket.emit(\"markAsRead\", {\n            contactId: chat.userId,\n            _id: lastMessage._id,\n          });\n        }\n      } catch (error) {\n        console.error(\"Error marking messages as read:\", error);\n        dispatch({\n          type: \"SET_ERROR\",\n          payload: \"Failed to mark messages as read\",\n        });\n      }\n    },\n    [socket, dispatch]\n  );\n\n  // Обновляем функцию onChangeChat\n  const onChangeChat = React.useCallback(\n    (chat: ChatRoom) => {\n      if (!chat) return;\n\n      try {\n        // Устанавливаем активную комнату\n        dispatch({\n          type: \"SET_ACTIVE_ROOM\",\n          payload: {\n            groupId: isGroup(chat) ? chat.groupId : undefined,\n            contactId: chat?.userId,\n          },\n        });\n\n        // Помечаем сообщения как прочитанные\n        onEnterRoom(chat);\n      } catch (error) {\n        console.error(\"Error changing chat:\", error);\n        dispatch({\n          type: \"SET_ERROR\",\n          payload: \"Failed to change chat room\",\n        });\n      }\n    },\n    [dispatch, onEnterRoom, socket] // Добавляем socket в зависимости\n  );\n\n  const onVideoCall = React.useCallback(\n    (chat: ChatRoom, visitId?: number, recreate?: boolean) => {\n      emitSocketEvent(\"startConference\", {\n        groupId: isGroup(chat) ? chat.groupId : undefined,\n        contactId: chat.userId,\n        visitId,\n        recreate,\n      });\n    },\n    [emitSocketEvent]\n  );\n\n  const onVideoEnd = React.useCallback(\n    (conference: ConferenceData | null) => {\n      if (conference?.id) {\n        emitSocketEvent(\"stopConference\", {\n          id: conference.id,\n        });\n      }\n    },\n    [emitSocketEvent]\n  );\n\n  const onConferencePause = React.useCallback(\n    (conference: ConferenceData | null) => {\n      if (conference?.id) {\n        emitSocketEvent(\"pauseConference\", {\n          id: conference.id,\n        });\n      }\n    },\n    [emitSocketEvent]\n  );\n\n  const onConferenceCallAccept = React.useCallback(\n    (conference: ConferenceData) => {\n      if (conference?.id) {\n        emitSocketEvent(\"resumeConference\", {\n          id: conference.id,\n        });\n        dispatch({ type: \"JOIN_CONFERENCE\", payload: conference });\n      }\n    },\n    [emitSocketEvent, dispatch]\n  );\n\n  const onOperatorAdd = React.useCallback(\n    (group: Group, operator: Contact) => {\n      emitSocketEvent(\"addOperator\", {\n        groupId: group.groupId,\n        operatorId: operator.userId,\n      });\n    },\n    [emitSocketEvent]\n  );\n\n  const onLeaveGroup = React.useCallback(\n    (group: Group) => {\n      emitSocketEvent(\"deleteGroup\", {\n        groupId: group.groupId,\n      });\n    },\n    [emitSocketEvent]\n  );\n\n  // First useEffect for initialization\n  React.useEffect(() => {\n    let mounted = true;\n    const initializeChat = async () => {\n      if (activeGroupId != null && !isEmpty(state.groupGather)) {\n        const onlyChat = Object.values(state.groupGather).find(\n          (item) => item.groupId === activeGroupId\n        );\n\n        if (!isEmpty(onlyChat) && mounted) {\n          onChangeChat(onlyChat);\n          return;\n        }\n      }\n\n      if (activeChatUserId != null && !isEmpty(state.contactGather)) {\n        const chat = Object.values(state.contactGather).find(\n          (item) => item.userId === activeChatUserId\n        );\n        if (chat && mounted) {\n          onChangeChat(chat);\n          return;\n        }\n      }\n\n      const mmkId = getParam(\"mmk\");\n      const guid = getParam(\"guid\");\n\n      if ((mmkId != null || guid != null) && !isEmpty(state.contactGather)) {\n        //console.log(\"mmkId\", mmkId);\n        try {\n          const userId = await getUserByMmk(mmkId, guid);\n          if (userId != null) {\n            const chat = Object.values(state.contactGather).find(\n              (item) => item.userId === userId\n            );\n            if (chat && mounted) {\n              onChangeChat(chat);\n              return;\n            }\n          }\n        } catch (error) {\n          console.error(\"Failed to get user by MMK:\", error);\n        }\n      }\n      return () => {\n        mounted = false;\n      };\n    };\n\n    initializeChat();\n\n    return () => {\n      mounted = false;\n    };\n  }, [state.user.userId]);\n\n  // Отключили проигрыш звука\n  // React.useEffect(() => {\n  //   if (\n  //     state.conference.data?.id &&\n  //     state.conference.ringPlayed &&\n  //     !state.conference.joined\n  //   )\n  //     ringAudio.play();\n  //   else ringAudio.pause();\n  // }, [state.conference.data?.id, state.conference.ringPlayed]);\n\n  // console.log(\"--state--\", state);\n  const renderRoom = state.activeRoom != null && (\n    <Room\n      apiUrl={apiUrl}\n      user={state.user}\n      users={state.userGather}\n      operators={state.operators}\n      chat={state.activeRoom}\n      typing={state.typing}\n      conference={state.conference.data}\n      visitData={state.visitData}\n      conferenceJoined={state.conference.joined}\n      loading={state.loading}\n      pageSize={pageSize}\n      onExitRoom={onExitActiveRoom}\n      onEnterRoom={onEnterRoom}\n      onNeedMoreMessages={onNeedMoreMessages}\n      onMessageDelete={onMessageDelete}\n      onTyping={onTyping}\n      onSendMessage={onSendMessage}\n      onVideoCall={onVideoCall}\n      onVideoEnd={onVideoEnd}\n      onConferencePause={onConferencePause}\n      onOperatorAdd={onOperatorAdd}\n      onLeaveGroup={onLeaveGroup}\n      onContactClick={props.onContactInfoClick}\n      isMobile={isMobile}\n    />\n  );\n\n  return (\n    <ChatContainer>\n      <ChatLayout\n        isMobile={isMobile}\n        conferenceActive={!!state.conference.data?.id}\n        hideRooms={hideRooms}\n        contactsList={\n          state.conference.data?.id != null && activeGroupId == null ? (\n            <ConferenceSection\n              conference={state.conference}\n              onClose={onConferencePause}\n              onAccept={onConferenceCallAccept}\n              user={state.user}\n              activeRoom={state.activeRoom}\n              onChangeChat={onChangeChat}\n              apiUrl={apiUrl}\n              isMobile={isMobile}\n            />\n          ) : (\n            <RoomList\n              user={state.user}\n              activeRoom={state.activeRoom}\n              groups={Object.values(state.groupGather)}\n              contacts={Object.values(state.contactGather)}\n              typing={state.typing}\n              onChangeChat={onChangeChat}\n            />\n          )\n        }\n        chatRoom={renderRoom}\n        activeRoom={state.activeRoom}\n        user={state.user}\n        onExitRoom={onExitActiveRoom}\n        onChangeChat={onChangeChat}\n        chatOld={state.chatOld}\n      />\n      <ChatAlert />\n    </ChatContainer>\n  );\n};\n","const isString = obj => typeof obj === 'string';\nconst defer = () => {\n  let res;\n  let rej;\n  const promise = new Promise((resolve, reject) => {\n    res = resolve;\n    rej = reject;\n  });\n  promise.resolve = res;\n  promise.reject = rej;\n  return promise;\n};\nconst makeString = object => {\n  if (object == null) return '';\n  return '' + object;\n};\nconst copy = (a, s, t) => {\n  a.forEach(m => {\n    if (s[m]) t[m] = s[m];\n  });\n};\nconst lastOfPathSeparatorRegExp = /###/g;\nconst cleanKey = key => key && key.indexOf('###') > -1 ? key.replace(lastOfPathSeparatorRegExp, '.') : key;\nconst canNotTraverseDeeper = object => !object || isString(object);\nconst getLastOfPath = (object, path, Empty) => {\n  const stack = !isString(path) ? path : path.split('.');\n  let stackIndex = 0;\n  while (stackIndex < stack.length - 1) {\n    if (canNotTraverseDeeper(object)) return {};\n    const key = cleanKey(stack[stackIndex]);\n    if (!object[key] && Empty) object[key] = new Empty();\n    if (Object.prototype.hasOwnProperty.call(object, key)) {\n      object = object[key];\n    } else {\n      object = {};\n    }\n    ++stackIndex;\n  }\n  if (canNotTraverseDeeper(object)) return {};\n  return {\n    obj: object,\n    k: cleanKey(stack[stackIndex])\n  };\n};\nconst setPath = (object, path, newValue) => {\n  const {\n    obj,\n    k\n  } = getLastOfPath(object, path, Object);\n  if (obj !== undefined || path.length === 1) {\n    obj[k] = newValue;\n    return;\n  }\n  let e = path[path.length - 1];\n  let p = path.slice(0, path.length - 1);\n  let last = getLastOfPath(object, p, Object);\n  while (last.obj === undefined && p.length) {\n    e = `${p[p.length - 1]}.${e}`;\n    p = p.slice(0, p.length - 1);\n    last = getLastOfPath(object, p, Object);\n    if (last && last.obj && typeof last.obj[`${last.k}.${e}`] !== 'undefined') {\n      last.obj = undefined;\n    }\n  }\n  last.obj[`${last.k}.${e}`] = newValue;\n};\nconst pushPath = (object, path, newValue, concat) => {\n  const {\n    obj,\n    k\n  } = getLastOfPath(object, path, Object);\n  obj[k] = obj[k] || [];\n  obj[k].push(newValue);\n};\nconst getPath = (object, path) => {\n  const {\n    obj,\n    k\n  } = getLastOfPath(object, path);\n  if (!obj) return undefined;\n  return obj[k];\n};\nconst getPathWithDefaults = (data, defaultData, key) => {\n  const value = getPath(data, key);\n  if (value !== undefined) {\n    return value;\n  }\n  return getPath(defaultData, key);\n};\nconst deepExtend = (target, source, overwrite) => {\n  for (const prop in source) {\n    if (prop !== '__proto__' && prop !== 'constructor') {\n      if (prop in target) {\n        if (isString(target[prop]) || target[prop] instanceof String || isString(source[prop]) || source[prop] instanceof String) {\n          if (overwrite) target[prop] = source[prop];\n        } else {\n          deepExtend(target[prop], source[prop], overwrite);\n        }\n      } else {\n        target[prop] = source[prop];\n      }\n    }\n  }\n  return target;\n};\nconst regexEscape = str => str.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, '\\\\$&');\nvar _entityMap = {\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;',\n  '\"': '&quot;',\n  \"'\": '&#39;',\n  '/': '&#x2F;'\n};\nconst escape = data => {\n  if (isString(data)) {\n    return data.replace(/[&<>\"'\\/]/g, s => _entityMap[s]);\n  }\n  return data;\n};\nclass RegExpCache {\n  constructor(capacity) {\n    this.capacity = capacity;\n    this.regExpMap = new Map();\n    this.regExpQueue = [];\n  }\n  getRegExp(pattern) {\n    const regExpFromCache = this.regExpMap.get(pattern);\n    if (regExpFromCache !== undefined) {\n      return regExpFromCache;\n    }\n    const regExpNew = new RegExp(pattern);\n    if (this.regExpQueue.length === this.capacity) {\n      this.regExpMap.delete(this.regExpQueue.shift());\n    }\n    this.regExpMap.set(pattern, regExpNew);\n    this.regExpQueue.push(pattern);\n    return regExpNew;\n  }\n}\nconst chars = [' ', ',', '?', '!', ';'];\nconst looksLikeObjectPathRegExpCache = new RegExpCache(20);\nconst looksLikeObjectPath = (key, nsSeparator, keySeparator) => {\n  nsSeparator = nsSeparator || '';\n  keySeparator = keySeparator || '';\n  const possibleChars = chars.filter(c => nsSeparator.indexOf(c) < 0 && keySeparator.indexOf(c) < 0);\n  if (possibleChars.length === 0) return true;\n  const r = looksLikeObjectPathRegExpCache.getRegExp(`(${possibleChars.map(c => c === '?' ? '\\\\?' : c).join('|')})`);\n  let matched = !r.test(key);\n  if (!matched) {\n    const ki = key.indexOf(keySeparator);\n    if (ki > 0 && !r.test(key.substring(0, ki))) {\n      matched = true;\n    }\n  }\n  return matched;\n};\nconst deepFind = function (obj, path) {\n  let keySeparator = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : '.';\n  if (!obj) return undefined;\n  if (obj[path]) return obj[path];\n  const tokens = path.split(keySeparator);\n  let current = obj;\n  for (let i = 0; i < tokens.length;) {\n    if (!current || typeof current !== 'object') {\n      return undefined;\n    }\n    let next;\n    let nextPath = '';\n    for (let j = i; j < tokens.length; ++j) {\n      if (j !== i) {\n        nextPath += keySeparator;\n      }\n      nextPath += tokens[j];\n      next = current[nextPath];\n      if (next !== undefined) {\n        if (['string', 'number', 'boolean'].indexOf(typeof next) > -1 && j < tokens.length - 1) {\n          continue;\n        }\n        i += j - i + 1;\n        break;\n      }\n    }\n    current = next;\n  }\n  return current;\n};\nconst getCleanedCode = code => code && code.replace('_', '-');\n\nconst consoleLogger = {\n  type: 'logger',\n  log(args) {\n    this.output('log', args);\n  },\n  warn(args) {\n    this.output('warn', args);\n  },\n  error(args) {\n    this.output('error', args);\n  },\n  output(type, args) {\n    if (console && console[type]) console[type].apply(console, args);\n  }\n};\nclass Logger {\n  constructor(concreteLogger) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    this.init(concreteLogger, options);\n  }\n  init(concreteLogger) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    this.prefix = options.prefix || 'i18next:';\n    this.logger = concreteLogger || consoleLogger;\n    this.options = options;\n    this.debug = options.debug;\n  }\n  log() {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    return this.forward(args, 'log', '', true);\n  }\n  warn() {\n    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      args[_key2] = arguments[_key2];\n    }\n    return this.forward(args, 'warn', '', true);\n  }\n  error() {\n    for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n      args[_key3] = arguments[_key3];\n    }\n    return this.forward(args, 'error', '');\n  }\n  deprecate() {\n    for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n      args[_key4] = arguments[_key4];\n    }\n    return this.forward(args, 'warn', 'WARNING DEPRECATED: ', true);\n  }\n  forward(args, lvl, prefix, debugOnly) {\n    if (debugOnly && !this.debug) return null;\n    if (isString(args[0])) args[0] = `${prefix}${this.prefix} ${args[0]}`;\n    return this.logger[lvl](args);\n  }\n  create(moduleName) {\n    return new Logger(this.logger, {\n      ...{\n        prefix: `${this.prefix}:${moduleName}:`\n      },\n      ...this.options\n    });\n  }\n  clone(options) {\n    options = options || this.options;\n    options.prefix = options.prefix || this.prefix;\n    return new Logger(this.logger, options);\n  }\n}\nvar baseLogger = new Logger();\n\nclass EventEmitter {\n  constructor() {\n    this.observers = {};\n  }\n  on(events, listener) {\n    events.split(' ').forEach(event => {\n      if (!this.observers[event]) this.observers[event] = new Map();\n      const numListeners = this.observers[event].get(listener) || 0;\n      this.observers[event].set(listener, numListeners + 1);\n    });\n    return this;\n  }\n  off(event, listener) {\n    if (!this.observers[event]) return;\n    if (!listener) {\n      delete this.observers[event];\n      return;\n    }\n    this.observers[event].delete(listener);\n  }\n  emit(event) {\n    for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      args[_key - 1] = arguments[_key];\n    }\n    if (this.observers[event]) {\n      const cloned = Array.from(this.observers[event].entries());\n      cloned.forEach(_ref => {\n        let [observer, numTimesAdded] = _ref;\n        for (let i = 0; i < numTimesAdded; i++) {\n          observer(...args);\n        }\n      });\n    }\n    if (this.observers['*']) {\n      const cloned = Array.from(this.observers['*'].entries());\n      cloned.forEach(_ref2 => {\n        let [observer, numTimesAdded] = _ref2;\n        for (let i = 0; i < numTimesAdded; i++) {\n          observer.apply(observer, [event, ...args]);\n        }\n      });\n    }\n  }\n}\n\nclass ResourceStore extends EventEmitter {\n  constructor(data) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n      ns: ['translation'],\n      defaultNS: 'translation'\n    };\n    super();\n    this.data = data || {};\n    this.options = options;\n    if (this.options.keySeparator === undefined) {\n      this.options.keySeparator = '.';\n    }\n    if (this.options.ignoreJSONStructure === undefined) {\n      this.options.ignoreJSONStructure = true;\n    }\n  }\n  addNamespaces(ns) {\n    if (this.options.ns.indexOf(ns) < 0) {\n      this.options.ns.push(ns);\n    }\n  }\n  removeNamespaces(ns) {\n    const index = this.options.ns.indexOf(ns);\n    if (index > -1) {\n      this.options.ns.splice(index, 1);\n    }\n  }\n  getResource(lng, ns, key) {\n    let options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n    const keySeparator = options.keySeparator !== undefined ? options.keySeparator : this.options.keySeparator;\n    const ignoreJSONStructure = options.ignoreJSONStructure !== undefined ? options.ignoreJSONStructure : this.options.ignoreJSONStructure;\n    let path;\n    if (lng.indexOf('.') > -1) {\n      path = lng.split('.');\n    } else {\n      path = [lng, ns];\n      if (key) {\n        if (Array.isArray(key)) {\n          path.push(...key);\n        } else if (isString(key) && keySeparator) {\n          path.push(...key.split(keySeparator));\n        } else {\n          path.push(key);\n        }\n      }\n    }\n    const result = getPath(this.data, path);\n    if (!result && !ns && !key && lng.indexOf('.') > -1) {\n      lng = path[0];\n      ns = path[1];\n      key = path.slice(2).join('.');\n    }\n    if (result || !ignoreJSONStructure || !isString(key)) return result;\n    return deepFind(this.data && this.data[lng] && this.data[lng][ns], key, keySeparator);\n  }\n  addResource(lng, ns, key, value) {\n    let options = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {\n      silent: false\n    };\n    const keySeparator = options.keySeparator !== undefined ? options.keySeparator : this.options.keySeparator;\n    let path = [lng, ns];\n    if (key) path = path.concat(keySeparator ? key.split(keySeparator) : key);\n    if (lng.indexOf('.') > -1) {\n      path = lng.split('.');\n      value = ns;\n      ns = path[1];\n    }\n    this.addNamespaces(ns);\n    setPath(this.data, path, value);\n    if (!options.silent) this.emit('added', lng, ns, key, value);\n  }\n  addResources(lng, ns, resources) {\n    let options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {\n      silent: false\n    };\n    for (const m in resources) {\n      if (isString(resources[m]) || Array.isArray(resources[m])) this.addResource(lng, ns, m, resources[m], {\n        silent: true\n      });\n    }\n    if (!options.silent) this.emit('added', lng, ns, resources);\n  }\n  addResourceBundle(lng, ns, resources, deep, overwrite) {\n    let options = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : {\n      silent: false,\n      skipCopy: false\n    };\n    let path = [lng, ns];\n    if (lng.indexOf('.') > -1) {\n      path = lng.split('.');\n      deep = resources;\n      resources = ns;\n      ns = path[1];\n    }\n    this.addNamespaces(ns);\n    let pack = getPath(this.data, path) || {};\n    if (!options.skipCopy) resources = JSON.parse(JSON.stringify(resources));\n    if (deep) {\n      deepExtend(pack, resources, overwrite);\n    } else {\n      pack = {\n        ...pack,\n        ...resources\n      };\n    }\n    setPath(this.data, path, pack);\n    if (!options.silent) this.emit('added', lng, ns, resources);\n  }\n  removeResourceBundle(lng, ns) {\n    if (this.hasResourceBundle(lng, ns)) {\n      delete this.data[lng][ns];\n    }\n    this.removeNamespaces(ns);\n    this.emit('removed', lng, ns);\n  }\n  hasResourceBundle(lng, ns) {\n    return this.getResource(lng, ns) !== undefined;\n  }\n  getResourceBundle(lng, ns) {\n    if (!ns) ns = this.options.defaultNS;\n    if (this.options.compatibilityAPI === 'v1') return {\n      ...{},\n      ...this.getResource(lng, ns)\n    };\n    return this.getResource(lng, ns);\n  }\n  getDataByLanguage(lng) {\n    return this.data[lng];\n  }\n  hasLanguageSomeTranslations(lng) {\n    const data = this.getDataByLanguage(lng);\n    const n = data && Object.keys(data) || [];\n    return !!n.find(v => data[v] && Object.keys(data[v]).length > 0);\n  }\n  toJSON() {\n    return this.data;\n  }\n}\n\nvar postProcessor = {\n  processors: {},\n  addPostProcessor(module) {\n    this.processors[module.name] = module;\n  },\n  handle(processors, value, key, options, translator) {\n    processors.forEach(processor => {\n      if (this.processors[processor]) value = this.processors[processor].process(value, key, options, translator);\n    });\n    return value;\n  }\n};\n\nconst checkedLoadedFor = {};\nclass Translator extends EventEmitter {\n  constructor(services) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    super();\n    copy(['resourceStore', 'languageUtils', 'pluralResolver', 'interpolator', 'backendConnector', 'i18nFormat', 'utils'], services, this);\n    this.options = options;\n    if (this.options.keySeparator === undefined) {\n      this.options.keySeparator = '.';\n    }\n    this.logger = baseLogger.create('translator');\n  }\n  changeLanguage(lng) {\n    if (lng) this.language = lng;\n  }\n  exists(key) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n      interpolation: {}\n    };\n    if (key === undefined || key === null) {\n      return false;\n    }\n    const resolved = this.resolve(key, options);\n    return resolved && resolved.res !== undefined;\n  }\n  extractFromKey(key, options) {\n    let nsSeparator = options.nsSeparator !== undefined ? options.nsSeparator : this.options.nsSeparator;\n    if (nsSeparator === undefined) nsSeparator = ':';\n    const keySeparator = options.keySeparator !== undefined ? options.keySeparator : this.options.keySeparator;\n    let namespaces = options.ns || this.options.defaultNS || [];\n    const wouldCheckForNsInKey = nsSeparator && key.indexOf(nsSeparator) > -1;\n    const seemsNaturalLanguage = !this.options.userDefinedKeySeparator && !options.keySeparator && !this.options.userDefinedNsSeparator && !options.nsSeparator && !looksLikeObjectPath(key, nsSeparator, keySeparator);\n    if (wouldCheckForNsInKey && !seemsNaturalLanguage) {\n      const m = key.match(this.interpolator.nestingRegexp);\n      if (m && m.length > 0) {\n        return {\n          key,\n          namespaces: isString(namespaces) ? [namespaces] : namespaces\n        };\n      }\n      const parts = key.split(nsSeparator);\n      if (nsSeparator !== keySeparator || nsSeparator === keySeparator && this.options.ns.indexOf(parts[0]) > -1) namespaces = parts.shift();\n      key = parts.join(keySeparator);\n    }\n    return {\n      key,\n      namespaces: isString(namespaces) ? [namespaces] : namespaces\n    };\n  }\n  translate(keys, options, lastKey) {\n    if (typeof options !== 'object' && this.options.overloadTranslationOptionHandler) {\n      options = this.options.overloadTranslationOptionHandler(arguments);\n    }\n    if (typeof options === 'object') options = {\n      ...options\n    };\n    if (!options) options = {};\n    if (keys === undefined || keys === null) return '';\n    if (!Array.isArray(keys)) keys = [String(keys)];\n    const returnDetails = options.returnDetails !== undefined ? options.returnDetails : this.options.returnDetails;\n    const keySeparator = options.keySeparator !== undefined ? options.keySeparator : this.options.keySeparator;\n    const {\n      key,\n      namespaces\n    } = this.extractFromKey(keys[keys.length - 1], options);\n    const namespace = namespaces[namespaces.length - 1];\n    const lng = options.lng || this.language;\n    const appendNamespaceToCIMode = options.appendNamespaceToCIMode || this.options.appendNamespaceToCIMode;\n    if (lng && lng.toLowerCase() === 'cimode') {\n      if (appendNamespaceToCIMode) {\n        const nsSeparator = options.nsSeparator || this.options.nsSeparator;\n        if (returnDetails) {\n          return {\n            res: `${namespace}${nsSeparator}${key}`,\n            usedKey: key,\n            exactUsedKey: key,\n            usedLng: lng,\n            usedNS: namespace,\n            usedParams: this.getUsedParamsDetails(options)\n          };\n        }\n        return `${namespace}${nsSeparator}${key}`;\n      }\n      if (returnDetails) {\n        return {\n          res: key,\n          usedKey: key,\n          exactUsedKey: key,\n          usedLng: lng,\n          usedNS: namespace,\n          usedParams: this.getUsedParamsDetails(options)\n        };\n      }\n      return key;\n    }\n    const resolved = this.resolve(keys, options);\n    let res = resolved && resolved.res;\n    const resUsedKey = resolved && resolved.usedKey || key;\n    const resExactUsedKey = resolved && resolved.exactUsedKey || key;\n    const resType = Object.prototype.toString.apply(res);\n    const noObject = ['[object Number]', '[object Function]', '[object RegExp]'];\n    const joinArrays = options.joinArrays !== undefined ? options.joinArrays : this.options.joinArrays;\n    const handleAsObjectInI18nFormat = !this.i18nFormat || this.i18nFormat.handleAsObject;\n    const handleAsObject = !isString(res) && typeof res !== 'boolean' && typeof res !== 'number';\n    if (handleAsObjectInI18nFormat && res && handleAsObject && noObject.indexOf(resType) < 0 && !(isString(joinArrays) && Array.isArray(res))) {\n      if (!options.returnObjects && !this.options.returnObjects) {\n        if (!this.options.returnedObjectHandler) {\n          this.logger.warn('accessing an object - but returnObjects options is not enabled!');\n        }\n        const r = this.options.returnedObjectHandler ? this.options.returnedObjectHandler(resUsedKey, res, {\n          ...options,\n          ns: namespaces\n        }) : `key '${key} (${this.language})' returned an object instead of string.`;\n        if (returnDetails) {\n          resolved.res = r;\n          resolved.usedParams = this.getUsedParamsDetails(options);\n          return resolved;\n        }\n        return r;\n      }\n      if (keySeparator) {\n        const resTypeIsArray = Array.isArray(res);\n        const copy = resTypeIsArray ? [] : {};\n        const newKeyToUse = resTypeIsArray ? resExactUsedKey : resUsedKey;\n        for (const m in res) {\n          if (Object.prototype.hasOwnProperty.call(res, m)) {\n            const deepKey = `${newKeyToUse}${keySeparator}${m}`;\n            copy[m] = this.translate(deepKey, {\n              ...options,\n              ...{\n                joinArrays: false,\n                ns: namespaces\n              }\n            });\n            if (copy[m] === deepKey) copy[m] = res[m];\n          }\n        }\n        res = copy;\n      }\n    } else if (handleAsObjectInI18nFormat && isString(joinArrays) && Array.isArray(res)) {\n      res = res.join(joinArrays);\n      if (res) res = this.extendTranslation(res, keys, options, lastKey);\n    } else {\n      let usedDefault = false;\n      let usedKey = false;\n      const needsPluralHandling = options.count !== undefined && !isString(options.count);\n      const hasDefaultValue = Translator.hasDefaultValue(options);\n      const defaultValueSuffix = needsPluralHandling ? this.pluralResolver.getSuffix(lng, options.count, options) : '';\n      const defaultValueSuffixOrdinalFallback = options.ordinal && needsPluralHandling ? this.pluralResolver.getSuffix(lng, options.count, {\n        ordinal: false\n      }) : '';\n      const needsZeroSuffixLookup = needsPluralHandling && !options.ordinal && options.count === 0 && this.pluralResolver.shouldUseIntlApi();\n      const defaultValue = needsZeroSuffixLookup && options[`defaultValue${this.options.pluralSeparator}zero`] || options[`defaultValue${defaultValueSuffix}`] || options[`defaultValue${defaultValueSuffixOrdinalFallback}`] || options.defaultValue;\n      if (!this.isValidLookup(res) && hasDefaultValue) {\n        usedDefault = true;\n        res = defaultValue;\n      }\n      if (!this.isValidLookup(res)) {\n        usedKey = true;\n        res = key;\n      }\n      const missingKeyNoValueFallbackToKey = options.missingKeyNoValueFallbackToKey || this.options.missingKeyNoValueFallbackToKey;\n      const resForMissing = missingKeyNoValueFallbackToKey && usedKey ? undefined : res;\n      const updateMissing = hasDefaultValue && defaultValue !== res && this.options.updateMissing;\n      if (usedKey || usedDefault || updateMissing) {\n        this.logger.log(updateMissing ? 'updateKey' : 'missingKey', lng, namespace, key, updateMissing ? defaultValue : res);\n        if (keySeparator) {\n          const fk = this.resolve(key, {\n            ...options,\n            keySeparator: false\n          });\n          if (fk && fk.res) this.logger.warn('Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.');\n        }\n        let lngs = [];\n        const fallbackLngs = this.languageUtils.getFallbackCodes(this.options.fallbackLng, options.lng || this.language);\n        if (this.options.saveMissingTo === 'fallback' && fallbackLngs && fallbackLngs[0]) {\n          for (let i = 0; i < fallbackLngs.length; i++) {\n            lngs.push(fallbackLngs[i]);\n          }\n        } else if (this.options.saveMissingTo === 'all') {\n          lngs = this.languageUtils.toResolveHierarchy(options.lng || this.language);\n        } else {\n          lngs.push(options.lng || this.language);\n        }\n        const send = (l, k, specificDefaultValue) => {\n          const defaultForMissing = hasDefaultValue && specificDefaultValue !== res ? specificDefaultValue : resForMissing;\n          if (this.options.missingKeyHandler) {\n            this.options.missingKeyHandler(l, namespace, k, defaultForMissing, updateMissing, options);\n          } else if (this.backendConnector && this.backendConnector.saveMissing) {\n            this.backendConnector.saveMissing(l, namespace, k, defaultForMissing, updateMissing, options);\n          }\n          this.emit('missingKey', l, namespace, k, res);\n        };\n        if (this.options.saveMissing) {\n          if (this.options.saveMissingPlurals && needsPluralHandling) {\n            lngs.forEach(language => {\n              const suffixes = this.pluralResolver.getSuffixes(language, options);\n              if (needsZeroSuffixLookup && options[`defaultValue${this.options.pluralSeparator}zero`] && suffixes.indexOf(`${this.options.pluralSeparator}zero`) < 0) {\n                suffixes.push(`${this.options.pluralSeparator}zero`);\n              }\n              suffixes.forEach(suffix => {\n                send([language], key + suffix, options[`defaultValue${suffix}`] || defaultValue);\n              });\n            });\n          } else {\n            send(lngs, key, defaultValue);\n          }\n        }\n      }\n      res = this.extendTranslation(res, keys, options, resolved, lastKey);\n      if (usedKey && res === key && this.options.appendNamespaceToMissingKey) res = `${namespace}:${key}`;\n      if ((usedKey || usedDefault) && this.options.parseMissingKeyHandler) {\n        if (this.options.compatibilityAPI !== 'v1') {\n          res = this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey ? `${namespace}:${key}` : key, usedDefault ? res : undefined);\n        } else {\n          res = this.options.parseMissingKeyHandler(res);\n        }\n      }\n    }\n    if (returnDetails) {\n      resolved.res = res;\n      resolved.usedParams = this.getUsedParamsDetails(options);\n      return resolved;\n    }\n    return res;\n  }\n  extendTranslation(res, key, options, resolved, lastKey) {\n    var _this = this;\n    if (this.i18nFormat && this.i18nFormat.parse) {\n      res = this.i18nFormat.parse(res, {\n        ...this.options.interpolation.defaultVariables,\n        ...options\n      }, options.lng || this.language || resolved.usedLng, resolved.usedNS, resolved.usedKey, {\n        resolved\n      });\n    } else if (!options.skipInterpolation) {\n      if (options.interpolation) this.interpolator.init({\n        ...options,\n        ...{\n          interpolation: {\n            ...this.options.interpolation,\n            ...options.interpolation\n          }\n        }\n      });\n      const skipOnVariables = isString(res) && (options && options.interpolation && options.interpolation.skipOnVariables !== undefined ? options.interpolation.skipOnVariables : this.options.interpolation.skipOnVariables);\n      let nestBef;\n      if (skipOnVariables) {\n        const nb = res.match(this.interpolator.nestingRegexp);\n        nestBef = nb && nb.length;\n      }\n      let data = options.replace && !isString(options.replace) ? options.replace : options;\n      if (this.options.interpolation.defaultVariables) data = {\n        ...this.options.interpolation.defaultVariables,\n        ...data\n      };\n      res = this.interpolator.interpolate(res, data, options.lng || this.language || resolved.usedLng, options);\n      if (skipOnVariables) {\n        const na = res.match(this.interpolator.nestingRegexp);\n        const nestAft = na && na.length;\n        if (nestBef < nestAft) options.nest = false;\n      }\n      if (!options.lng && this.options.compatibilityAPI !== 'v1' && resolved && resolved.res) options.lng = this.language || resolved.usedLng;\n      if (options.nest !== false) res = this.interpolator.nest(res, function () {\n        for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n          args[_key] = arguments[_key];\n        }\n        if (lastKey && lastKey[0] === args[0] && !options.context) {\n          _this.logger.warn(`It seems you are nesting recursively key: ${args[0]} in key: ${key[0]}`);\n          return null;\n        }\n        return _this.translate(...args, key);\n      }, options);\n      if (options.interpolation) this.interpolator.reset();\n    }\n    const postProcess = options.postProcess || this.options.postProcess;\n    const postProcessorNames = isString(postProcess) ? [postProcess] : postProcess;\n    if (res !== undefined && res !== null && postProcessorNames && postProcessorNames.length && options.applyPostProcessor !== false) {\n      res = postProcessor.handle(postProcessorNames, res, key, this.options && this.options.postProcessPassResolved ? {\n        i18nResolved: {\n          ...resolved,\n          usedParams: this.getUsedParamsDetails(options)\n        },\n        ...options\n      } : options, this);\n    }\n    return res;\n  }\n  resolve(keys) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    let found;\n    let usedKey;\n    let exactUsedKey;\n    let usedLng;\n    let usedNS;\n    if (isString(keys)) keys = [keys];\n    keys.forEach(k => {\n      if (this.isValidLookup(found)) return;\n      const extracted = this.extractFromKey(k, options);\n      const key = extracted.key;\n      usedKey = key;\n      let namespaces = extracted.namespaces;\n      if (this.options.fallbackNS) namespaces = namespaces.concat(this.options.fallbackNS);\n      const needsPluralHandling = options.count !== undefined && !isString(options.count);\n      const needsZeroSuffixLookup = needsPluralHandling && !options.ordinal && options.count === 0 && this.pluralResolver.shouldUseIntlApi();\n      const needsContextHandling = options.context !== undefined && (isString(options.context) || typeof options.context === 'number') && options.context !== '';\n      const codes = options.lngs ? options.lngs : this.languageUtils.toResolveHierarchy(options.lng || this.language, options.fallbackLng);\n      namespaces.forEach(ns => {\n        if (this.isValidLookup(found)) return;\n        usedNS = ns;\n        if (!checkedLoadedFor[`${codes[0]}-${ns}`] && this.utils && this.utils.hasLoadedNamespace && !this.utils.hasLoadedNamespace(usedNS)) {\n          checkedLoadedFor[`${codes[0]}-${ns}`] = true;\n          this.logger.warn(`key \"${usedKey}\" for languages \"${codes.join(', ')}\" won't get resolved as namespace \"${usedNS}\" was not yet loaded`, 'This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!');\n        }\n        codes.forEach(code => {\n          if (this.isValidLookup(found)) return;\n          usedLng = code;\n          const finalKeys = [key];\n          if (this.i18nFormat && this.i18nFormat.addLookupKeys) {\n            this.i18nFormat.addLookupKeys(finalKeys, key, code, ns, options);\n          } else {\n            let pluralSuffix;\n            if (needsPluralHandling) pluralSuffix = this.pluralResolver.getSuffix(code, options.count, options);\n            const zeroSuffix = `${this.options.pluralSeparator}zero`;\n            const ordinalPrefix = `${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;\n            if (needsPluralHandling) {\n              finalKeys.push(key + pluralSuffix);\n              if (options.ordinal && pluralSuffix.indexOf(ordinalPrefix) === 0) {\n                finalKeys.push(key + pluralSuffix.replace(ordinalPrefix, this.options.pluralSeparator));\n              }\n              if (needsZeroSuffixLookup) {\n                finalKeys.push(key + zeroSuffix);\n              }\n            }\n            if (needsContextHandling) {\n              const contextKey = `${key}${this.options.contextSeparator}${options.context}`;\n              finalKeys.push(contextKey);\n              if (needsPluralHandling) {\n                finalKeys.push(contextKey + pluralSuffix);\n                if (options.ordinal && pluralSuffix.indexOf(ordinalPrefix) === 0) {\n                  finalKeys.push(contextKey + pluralSuffix.replace(ordinalPrefix, this.options.pluralSeparator));\n                }\n                if (needsZeroSuffixLookup) {\n                  finalKeys.push(contextKey + zeroSuffix);\n                }\n              }\n            }\n          }\n          let possibleKey;\n          while (possibleKey = finalKeys.pop()) {\n            if (!this.isValidLookup(found)) {\n              exactUsedKey = possibleKey;\n              found = this.getResource(code, ns, possibleKey, options);\n            }\n          }\n        });\n      });\n    });\n    return {\n      res: found,\n      usedKey,\n      exactUsedKey,\n      usedLng,\n      usedNS\n    };\n  }\n  isValidLookup(res) {\n    return res !== undefined && !(!this.options.returnNull && res === null) && !(!this.options.returnEmptyString && res === '');\n  }\n  getResource(code, ns, key) {\n    let options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n    if (this.i18nFormat && this.i18nFormat.getResource) return this.i18nFormat.getResource(code, ns, key, options);\n    return this.resourceStore.getResource(code, ns, key, options);\n  }\n  getUsedParamsDetails() {\n    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    const optionsKeys = ['defaultValue', 'ordinal', 'context', 'replace', 'lng', 'lngs', 'fallbackLng', 'ns', 'keySeparator', 'nsSeparator', 'returnObjects', 'returnDetails', 'joinArrays', 'postProcess', 'interpolation'];\n    const useOptionsReplaceForData = options.replace && !isString(options.replace);\n    let data = useOptionsReplaceForData ? options.replace : options;\n    if (useOptionsReplaceForData && typeof options.count !== 'undefined') {\n      data.count = options.count;\n    }\n    if (this.options.interpolation.defaultVariables) {\n      data = {\n        ...this.options.interpolation.defaultVariables,\n        ...data\n      };\n    }\n    if (!useOptionsReplaceForData) {\n      data = {\n        ...data\n      };\n      for (const key of optionsKeys) {\n        delete data[key];\n      }\n    }\n    return data;\n  }\n  static hasDefaultValue(options) {\n    const prefix = 'defaultValue';\n    for (const option in options) {\n      if (Object.prototype.hasOwnProperty.call(options, option) && prefix === option.substring(0, prefix.length) && undefined !== options[option]) {\n        return true;\n      }\n    }\n    return false;\n  }\n}\n\nconst capitalize = string => string.charAt(0).toUpperCase() + string.slice(1);\nclass LanguageUtil {\n  constructor(options) {\n    this.options = options;\n    this.supportedLngs = this.options.supportedLngs || false;\n    this.logger = baseLogger.create('languageUtils');\n  }\n  getScriptPartFromCode(code) {\n    code = getCleanedCode(code);\n    if (!code || code.indexOf('-') < 0) return null;\n    const p = code.split('-');\n    if (p.length === 2) return null;\n    p.pop();\n    if (p[p.length - 1].toLowerCase() === 'x') return null;\n    return this.formatLanguageCode(p.join('-'));\n  }\n  getLanguagePartFromCode(code) {\n    code = getCleanedCode(code);\n    if (!code || code.indexOf('-') < 0) return code;\n    const p = code.split('-');\n    return this.formatLanguageCode(p[0]);\n  }\n  formatLanguageCode(code) {\n    if (isString(code) && code.indexOf('-') > -1) {\n      if (typeof Intl !== 'undefined' && typeof Intl.getCanonicalLocales !== 'undefined') {\n        try {\n          let formattedCode = Intl.getCanonicalLocales(code)[0];\n          if (formattedCode && this.options.lowerCaseLng) {\n            formattedCode = formattedCode.toLowerCase();\n          }\n          if (formattedCode) return formattedCode;\n        } catch (e) {}\n      }\n      const specialCases = ['hans', 'hant', 'latn', 'cyrl', 'cans', 'mong', 'arab'];\n      let p = code.split('-');\n      if (this.options.lowerCaseLng) {\n        p = p.map(part => part.toLowerCase());\n      } else if (p.length === 2) {\n        p[0] = p[0].toLowerCase();\n        p[1] = p[1].toUpperCase();\n        if (specialCases.indexOf(p[1].toLowerCase()) > -1) p[1] = capitalize(p[1].toLowerCase());\n      } else if (p.length === 3) {\n        p[0] = p[0].toLowerCase();\n        if (p[1].length === 2) p[1] = p[1].toUpperCase();\n        if (p[0] !== 'sgn' && p[2].length === 2) p[2] = p[2].toUpperCase();\n        if (specialCases.indexOf(p[1].toLowerCase()) > -1) p[1] = capitalize(p[1].toLowerCase());\n        if (specialCases.indexOf(p[2].toLowerCase()) > -1) p[2] = capitalize(p[2].toLowerCase());\n      }\n      return p.join('-');\n    }\n    return this.options.cleanCode || this.options.lowerCaseLng ? code.toLowerCase() : code;\n  }\n  isSupportedCode(code) {\n    if (this.options.load === 'languageOnly' || this.options.nonExplicitSupportedLngs) {\n      code = this.getLanguagePartFromCode(code);\n    }\n    return !this.supportedLngs || !this.supportedLngs.length || this.supportedLngs.indexOf(code) > -1;\n  }\n  getBestMatchFromCodes(codes) {\n    if (!codes) return null;\n    let found;\n    codes.forEach(code => {\n      if (found) return;\n      const cleanedLng = this.formatLanguageCode(code);\n      if (!this.options.supportedLngs || this.isSupportedCode(cleanedLng)) found = cleanedLng;\n    });\n    if (!found && this.options.supportedLngs) {\n      codes.forEach(code => {\n        if (found) return;\n        const lngOnly = this.getLanguagePartFromCode(code);\n        if (this.isSupportedCode(lngOnly)) return found = lngOnly;\n        found = this.options.supportedLngs.find(supportedLng => {\n          if (supportedLng === lngOnly) return supportedLng;\n          if (supportedLng.indexOf('-') < 0 && lngOnly.indexOf('-') < 0) return;\n          if (supportedLng.indexOf('-') > 0 && lngOnly.indexOf('-') < 0 && supportedLng.substring(0, supportedLng.indexOf('-')) === lngOnly) return supportedLng;\n          if (supportedLng.indexOf(lngOnly) === 0 && lngOnly.length > 1) return supportedLng;\n        });\n      });\n    }\n    if (!found) found = this.getFallbackCodes(this.options.fallbackLng)[0];\n    return found;\n  }\n  getFallbackCodes(fallbacks, code) {\n    if (!fallbacks) return [];\n    if (typeof fallbacks === 'function') fallbacks = fallbacks(code);\n    if (isString(fallbacks)) fallbacks = [fallbacks];\n    if (Array.isArray(fallbacks)) return fallbacks;\n    if (!code) return fallbacks.default || [];\n    let found = fallbacks[code];\n    if (!found) found = fallbacks[this.getScriptPartFromCode(code)];\n    if (!found) found = fallbacks[this.formatLanguageCode(code)];\n    if (!found) found = fallbacks[this.getLanguagePartFromCode(code)];\n    if (!found) found = fallbacks.default;\n    return found || [];\n  }\n  toResolveHierarchy(code, fallbackCode) {\n    const fallbackCodes = this.getFallbackCodes(fallbackCode || this.options.fallbackLng || [], code);\n    const codes = [];\n    const addCode = c => {\n      if (!c) return;\n      if (this.isSupportedCode(c)) {\n        codes.push(c);\n      } else {\n        this.logger.warn(`rejecting language code not found in supportedLngs: ${c}`);\n      }\n    };\n    if (isString(code) && (code.indexOf('-') > -1 || code.indexOf('_') > -1)) {\n      if (this.options.load !== 'languageOnly') addCode(this.formatLanguageCode(code));\n      if (this.options.load !== 'languageOnly' && this.options.load !== 'currentOnly') addCode(this.getScriptPartFromCode(code));\n      if (this.options.load !== 'currentOnly') addCode(this.getLanguagePartFromCode(code));\n    } else if (isString(code)) {\n      addCode(this.formatLanguageCode(code));\n    }\n    fallbackCodes.forEach(fc => {\n      if (codes.indexOf(fc) < 0) addCode(this.formatLanguageCode(fc));\n    });\n    return codes;\n  }\n}\n\nlet sets = [{\n  lngs: ['ach', 'ak', 'am', 'arn', 'br', 'fil', 'gun', 'ln', 'mfe', 'mg', 'mi', 'oc', 'pt', 'pt-BR', 'tg', 'tl', 'ti', 'tr', 'uz', 'wa'],\n  nr: [1, 2],\n  fc: 1\n}, {\n  lngs: ['af', 'an', 'ast', 'az', 'bg', 'bn', 'ca', 'da', 'de', 'dev', 'el', 'en', 'eo', 'es', 'et', 'eu', 'fi', 'fo', 'fur', 'fy', 'gl', 'gu', 'ha', 'hi', 'hu', 'hy', 'ia', 'it', 'kk', 'kn', 'ku', 'lb', 'mai', 'ml', 'mn', 'mr', 'nah', 'nap', 'nb', 'ne', 'nl', 'nn', 'no', 'nso', 'pa', 'pap', 'pms', 'ps', 'pt-PT', 'rm', 'sco', 'se', 'si', 'so', 'son', 'sq', 'sv', 'sw', 'ta', 'te', 'tk', 'ur', 'yo'],\n  nr: [1, 2],\n  fc: 2\n}, {\n  lngs: ['ay', 'bo', 'cgg', 'fa', 'ht', 'id', 'ja', 'jbo', 'ka', 'km', 'ko', 'ky', 'lo', 'ms', 'sah', 'su', 'th', 'tt', 'ug', 'vi', 'wo', 'zh'],\n  nr: [1],\n  fc: 3\n}, {\n  lngs: ['be', 'bs', 'cnr', 'dz', 'hr', 'ru', 'sr', 'uk'],\n  nr: [1, 2, 5],\n  fc: 4\n}, {\n  lngs: ['ar'],\n  nr: [0, 1, 2, 3, 11, 100],\n  fc: 5\n}, {\n  lngs: ['cs', 'sk'],\n  nr: [1, 2, 5],\n  fc: 6\n}, {\n  lngs: ['csb', 'pl'],\n  nr: [1, 2, 5],\n  fc: 7\n}, {\n  lngs: ['cy'],\n  nr: [1, 2, 3, 8],\n  fc: 8\n}, {\n  lngs: ['fr'],\n  nr: [1, 2],\n  fc: 9\n}, {\n  lngs: ['ga'],\n  nr: [1, 2, 3, 7, 11],\n  fc: 10\n}, {\n  lngs: ['gd'],\n  nr: [1, 2, 3, 20],\n  fc: 11\n}, {\n  lngs: ['is'],\n  nr: [1, 2],\n  fc: 12\n}, {\n  lngs: ['jv'],\n  nr: [0, 1],\n  fc: 13\n}, {\n  lngs: ['kw'],\n  nr: [1, 2, 3, 4],\n  fc: 14\n}, {\n  lngs: ['lt'],\n  nr: [1, 2, 10],\n  fc: 15\n}, {\n  lngs: ['lv'],\n  nr: [1, 2, 0],\n  fc: 16\n}, {\n  lngs: ['mk'],\n  nr: [1, 2],\n  fc: 17\n}, {\n  lngs: ['mnk'],\n  nr: [0, 1, 2],\n  fc: 18\n}, {\n  lngs: ['mt'],\n  nr: [1, 2, 11, 20],\n  fc: 19\n}, {\n  lngs: ['or'],\n  nr: [2, 1],\n  fc: 2\n}, {\n  lngs: ['ro'],\n  nr: [1, 2, 20],\n  fc: 20\n}, {\n  lngs: ['sl'],\n  nr: [5, 1, 2, 3],\n  fc: 21\n}, {\n  lngs: ['he', 'iw'],\n  nr: [1, 2, 20, 21],\n  fc: 22\n}];\nlet _rulesPluralsTypes = {\n  1: n => Number(n > 1),\n  2: n => Number(n != 1),\n  3: n => 0,\n  4: n => Number(n % 10 == 1 && n % 100 != 11 ? 0 : n % 10 >= 2 && n % 10 <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 1 : 2),\n  5: n => Number(n == 0 ? 0 : n == 1 ? 1 : n == 2 ? 2 : n % 100 >= 3 && n % 100 <= 10 ? 3 : n % 100 >= 11 ? 4 : 5),\n  6: n => Number(n == 1 ? 0 : n >= 2 && n <= 4 ? 1 : 2),\n  7: n => Number(n == 1 ? 0 : n % 10 >= 2 && n % 10 <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 1 : 2),\n  8: n => Number(n == 1 ? 0 : n == 2 ? 1 : n != 8 && n != 11 ? 2 : 3),\n  9: n => Number(n >= 2),\n  10: n => Number(n == 1 ? 0 : n == 2 ? 1 : n < 7 ? 2 : n < 11 ? 3 : 4),\n  11: n => Number(n == 1 || n == 11 ? 0 : n == 2 || n == 12 ? 1 : n > 2 && n < 20 ? 2 : 3),\n  12: n => Number(n % 10 != 1 || n % 100 == 11),\n  13: n => Number(n !== 0),\n  14: n => Number(n == 1 ? 0 : n == 2 ? 1 : n == 3 ? 2 : 3),\n  15: n => Number(n % 10 == 1 && n % 100 != 11 ? 0 : n % 10 >= 2 && (n % 100 < 10 || n % 100 >= 20) ? 1 : 2),\n  16: n => Number(n % 10 == 1 && n % 100 != 11 ? 0 : n !== 0 ? 1 : 2),\n  17: n => Number(n == 1 || n % 10 == 1 && n % 100 != 11 ? 0 : 1),\n  18: n => Number(n == 0 ? 0 : n == 1 ? 1 : 2),\n  19: n => Number(n == 1 ? 0 : n == 0 || n % 100 > 1 && n % 100 < 11 ? 1 : n % 100 > 10 && n % 100 < 20 ? 2 : 3),\n  20: n => Number(n == 1 ? 0 : n == 0 || n % 100 > 0 && n % 100 < 20 ? 1 : 2),\n  21: n => Number(n % 100 == 1 ? 1 : n % 100 == 2 ? 2 : n % 100 == 3 || n % 100 == 4 ? 3 : 0),\n  22: n => Number(n == 1 ? 0 : n == 2 ? 1 : (n < 0 || n > 10) && n % 10 == 0 ? 2 : 3)\n};\nconst nonIntlVersions = ['v1', 'v2', 'v3'];\nconst intlVersions = ['v4'];\nconst suffixesOrder = {\n  zero: 0,\n  one: 1,\n  two: 2,\n  few: 3,\n  many: 4,\n  other: 5\n};\nconst createRules = () => {\n  const rules = {};\n  sets.forEach(set => {\n    set.lngs.forEach(l => {\n      rules[l] = {\n        numbers: set.nr,\n        plurals: _rulesPluralsTypes[set.fc]\n      };\n    });\n  });\n  return rules;\n};\nclass PluralResolver {\n  constructor(languageUtils) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    this.languageUtils = languageUtils;\n    this.options = options;\n    this.logger = baseLogger.create('pluralResolver');\n    if ((!this.options.compatibilityJSON || intlVersions.includes(this.options.compatibilityJSON)) && (typeof Intl === 'undefined' || !Intl.PluralRules)) {\n      this.options.compatibilityJSON = 'v3';\n      this.logger.error('Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.');\n    }\n    this.rules = createRules();\n    this.pluralRulesCache = {};\n  }\n  addRule(lng, obj) {\n    this.rules[lng] = obj;\n  }\n  clearCache() {\n    this.pluralRulesCache = {};\n  }\n  getRule(code) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    if (this.shouldUseIntlApi()) {\n      const cleanedCode = getCleanedCode(code === 'dev' ? 'en' : code);\n      const type = options.ordinal ? 'ordinal' : 'cardinal';\n      const cacheKey = JSON.stringify({\n        cleanedCode,\n        type\n      });\n      if (cacheKey in this.pluralRulesCache) {\n        return this.pluralRulesCache[cacheKey];\n      }\n      let rule;\n      try {\n        rule = new Intl.PluralRules(cleanedCode, {\n          type\n        });\n      } catch (err) {\n        if (!code.match(/-|_/)) return;\n        const lngPart = this.languageUtils.getLanguagePartFromCode(code);\n        rule = this.getRule(lngPart, options);\n      }\n      this.pluralRulesCache[cacheKey] = rule;\n      return rule;\n    }\n    return this.rules[code] || this.rules[this.languageUtils.getLanguagePartFromCode(code)];\n  }\n  needsPlural(code) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    const rule = this.getRule(code, options);\n    if (this.shouldUseIntlApi()) {\n      return rule && rule.resolvedOptions().pluralCategories.length > 1;\n    }\n    return rule && rule.numbers.length > 1;\n  }\n  getPluralFormsOfKey(code, key) {\n    let options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    return this.getSuffixes(code, options).map(suffix => `${key}${suffix}`);\n  }\n  getSuffixes(code) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    const rule = this.getRule(code, options);\n    if (!rule) {\n      return [];\n    }\n    if (this.shouldUseIntlApi()) {\n      return rule.resolvedOptions().pluralCategories.sort((pluralCategory1, pluralCategory2) => suffixesOrder[pluralCategory1] - suffixesOrder[pluralCategory2]).map(pluralCategory => `${this.options.prepend}${options.ordinal ? `ordinal${this.options.prepend}` : ''}${pluralCategory}`);\n    }\n    return rule.numbers.map(number => this.getSuffix(code, number, options));\n  }\n  getSuffix(code, count) {\n    let options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    const rule = this.getRule(code, options);\n    if (rule) {\n      if (this.shouldUseIntlApi()) {\n        return `${this.options.prepend}${options.ordinal ? `ordinal${this.options.prepend}` : ''}${rule.select(count)}`;\n      }\n      return this.getSuffixRetroCompatible(rule, count);\n    }\n    this.logger.warn(`no plural rule found for: ${code}`);\n    return '';\n  }\n  getSuffixRetroCompatible(rule, count) {\n    const idx = rule.noAbs ? rule.plurals(count) : rule.plurals(Math.abs(count));\n    let suffix = rule.numbers[idx];\n    if (this.options.simplifyPluralSuffix && rule.numbers.length === 2 && rule.numbers[0] === 1) {\n      if (suffix === 2) {\n        suffix = 'plural';\n      } else if (suffix === 1) {\n        suffix = '';\n      }\n    }\n    const returnSuffix = () => this.options.prepend && suffix.toString() ? this.options.prepend + suffix.toString() : suffix.toString();\n    if (this.options.compatibilityJSON === 'v1') {\n      if (suffix === 1) return '';\n      if (typeof suffix === 'number') return `_plural_${suffix.toString()}`;\n      return returnSuffix();\n    } else if (this.options.compatibilityJSON === 'v2') {\n      return returnSuffix();\n    } else if (this.options.simplifyPluralSuffix && rule.numbers.length === 2 && rule.numbers[0] === 1) {\n      return returnSuffix();\n    }\n    return this.options.prepend && idx.toString() ? this.options.prepend + idx.toString() : idx.toString();\n  }\n  shouldUseIntlApi() {\n    return !nonIntlVersions.includes(this.options.compatibilityJSON);\n  }\n}\n\nconst deepFindWithDefaults = function (data, defaultData, key) {\n  let keySeparator = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : '.';\n  let ignoreJSONStructure = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : true;\n  let path = getPathWithDefaults(data, defaultData, key);\n  if (!path && ignoreJSONStructure && isString(key)) {\n    path = deepFind(data, key, keySeparator);\n    if (path === undefined) path = deepFind(defaultData, key, keySeparator);\n  }\n  return path;\n};\nconst regexSafe = val => val.replace(/\\$/g, '$$$$');\nclass Interpolator {\n  constructor() {\n    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    this.logger = baseLogger.create('interpolator');\n    this.options = options;\n    this.format = options.interpolation && options.interpolation.format || (value => value);\n    this.init(options);\n  }\n  init() {\n    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    if (!options.interpolation) options.interpolation = {\n      escapeValue: true\n    };\n    const {\n      escape: escape$1,\n      escapeValue,\n      useRawValueToEscape,\n      prefix,\n      prefixEscaped,\n      suffix,\n      suffixEscaped,\n      formatSeparator,\n      unescapeSuffix,\n      unescapePrefix,\n      nestingPrefix,\n      nestingPrefixEscaped,\n      nestingSuffix,\n      nestingSuffixEscaped,\n      nestingOptionsSeparator,\n      maxReplaces,\n      alwaysFormat\n    } = options.interpolation;\n    this.escape = escape$1 !== undefined ? escape$1 : escape;\n    this.escapeValue = escapeValue !== undefined ? escapeValue : true;\n    this.useRawValueToEscape = useRawValueToEscape !== undefined ? useRawValueToEscape : false;\n    this.prefix = prefix ? regexEscape(prefix) : prefixEscaped || '{{';\n    this.suffix = suffix ? regexEscape(suffix) : suffixEscaped || '}}';\n    this.formatSeparator = formatSeparator || ',';\n    this.unescapePrefix = unescapeSuffix ? '' : unescapePrefix || '-';\n    this.unescapeSuffix = this.unescapePrefix ? '' : unescapeSuffix || '';\n    this.nestingPrefix = nestingPrefix ? regexEscape(nestingPrefix) : nestingPrefixEscaped || regexEscape('$t(');\n    this.nestingSuffix = nestingSuffix ? regexEscape(nestingSuffix) : nestingSuffixEscaped || regexEscape(')');\n    this.nestingOptionsSeparator = nestingOptionsSeparator || ',';\n    this.maxReplaces = maxReplaces || 1000;\n    this.alwaysFormat = alwaysFormat !== undefined ? alwaysFormat : false;\n    this.resetRegExp();\n  }\n  reset() {\n    if (this.options) this.init(this.options);\n  }\n  resetRegExp() {\n    const getOrResetRegExp = (existingRegExp, pattern) => {\n      if (existingRegExp && existingRegExp.source === pattern) {\n        existingRegExp.lastIndex = 0;\n        return existingRegExp;\n      }\n      return new RegExp(pattern, 'g');\n    };\n    this.regexp = getOrResetRegExp(this.regexp, `${this.prefix}(.+?)${this.suffix}`);\n    this.regexpUnescape = getOrResetRegExp(this.regexpUnescape, `${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`);\n    this.nestingRegexp = getOrResetRegExp(this.nestingRegexp, `${this.nestingPrefix}(.+?)${this.nestingSuffix}`);\n  }\n  interpolate(str, data, lng, options) {\n    let match;\n    let value;\n    let replaces;\n    const defaultData = this.options && this.options.interpolation && this.options.interpolation.defaultVariables || {};\n    const handleFormat = key => {\n      if (key.indexOf(this.formatSeparator) < 0) {\n        const path = deepFindWithDefaults(data, defaultData, key, this.options.keySeparator, this.options.ignoreJSONStructure);\n        return this.alwaysFormat ? this.format(path, undefined, lng, {\n          ...options,\n          ...data,\n          interpolationkey: key\n        }) : path;\n      }\n      const p = key.split(this.formatSeparator);\n      const k = p.shift().trim();\n      const f = p.join(this.formatSeparator).trim();\n      return this.format(deepFindWithDefaults(data, defaultData, k, this.options.keySeparator, this.options.ignoreJSONStructure), f, lng, {\n        ...options,\n        ...data,\n        interpolationkey: k\n      });\n    };\n    this.resetRegExp();\n    const missingInterpolationHandler = options && options.missingInterpolationHandler || this.options.missingInterpolationHandler;\n    const skipOnVariables = options && options.interpolation && options.interpolation.skipOnVariables !== undefined ? options.interpolation.skipOnVariables : this.options.interpolation.skipOnVariables;\n    const todos = [{\n      regex: this.regexpUnescape,\n      safeValue: val => regexSafe(val)\n    }, {\n      regex: this.regexp,\n      safeValue: val => this.escapeValue ? regexSafe(this.escape(val)) : regexSafe(val)\n    }];\n    todos.forEach(todo => {\n      replaces = 0;\n      while (match = todo.regex.exec(str)) {\n        const matchedVar = match[1].trim();\n        value = handleFormat(matchedVar);\n        if (value === undefined) {\n          if (typeof missingInterpolationHandler === 'function') {\n            const temp = missingInterpolationHandler(str, match, options);\n            value = isString(temp) ? temp : '';\n          } else if (options && Object.prototype.hasOwnProperty.call(options, matchedVar)) {\n            value = '';\n          } else if (skipOnVariables) {\n            value = match[0];\n            continue;\n          } else {\n            this.logger.warn(`missed to pass in variable ${matchedVar} for interpolating ${str}`);\n            value = '';\n          }\n        } else if (!isString(value) && !this.useRawValueToEscape) {\n          value = makeString(value);\n        }\n        const safeValue = todo.safeValue(value);\n        str = str.replace(match[0], safeValue);\n        if (skipOnVariables) {\n          todo.regex.lastIndex += value.length;\n          todo.regex.lastIndex -= match[0].length;\n        } else {\n          todo.regex.lastIndex = 0;\n        }\n        replaces++;\n        if (replaces >= this.maxReplaces) {\n          break;\n        }\n      }\n    });\n    return str;\n  }\n  nest(str, fc) {\n    let options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    let match;\n    let value;\n    let clonedOptions;\n    const handleHasOptions = (key, inheritedOptions) => {\n      const sep = this.nestingOptionsSeparator;\n      if (key.indexOf(sep) < 0) return key;\n      const c = key.split(new RegExp(`${sep}[ ]*{`));\n      let optionsString = `{${c[1]}`;\n      key = c[0];\n      optionsString = this.interpolate(optionsString, clonedOptions);\n      const matchedSingleQuotes = optionsString.match(/'/g);\n      const matchedDoubleQuotes = optionsString.match(/\"/g);\n      if (matchedSingleQuotes && matchedSingleQuotes.length % 2 === 0 && !matchedDoubleQuotes || matchedDoubleQuotes.length % 2 !== 0) {\n        optionsString = optionsString.replace(/'/g, '\"');\n      }\n      try {\n        clonedOptions = JSON.parse(optionsString);\n        if (inheritedOptions) clonedOptions = {\n          ...inheritedOptions,\n          ...clonedOptions\n        };\n      } catch (e) {\n        this.logger.warn(`failed parsing options string in nesting for key ${key}`, e);\n        return `${key}${sep}${optionsString}`;\n      }\n      if (clonedOptions.defaultValue && clonedOptions.defaultValue.indexOf(this.prefix) > -1) delete clonedOptions.defaultValue;\n      return key;\n    };\n    while (match = this.nestingRegexp.exec(str)) {\n      let formatters = [];\n      clonedOptions = {\n        ...options\n      };\n      clonedOptions = clonedOptions.replace && !isString(clonedOptions.replace) ? clonedOptions.replace : clonedOptions;\n      clonedOptions.applyPostProcessor = false;\n      delete clonedOptions.defaultValue;\n      let doReduce = false;\n      if (match[0].indexOf(this.formatSeparator) !== -1 && !/{.*}/.test(match[1])) {\n        const r = match[1].split(this.formatSeparator).map(elem => elem.trim());\n        match[1] = r.shift();\n        formatters = r;\n        doReduce = true;\n      }\n      value = fc(handleHasOptions.call(this, match[1].trim(), clonedOptions), clonedOptions);\n      if (value && match[0] === str && !isString(value)) return value;\n      if (!isString(value)) value = makeString(value);\n      if (!value) {\n        this.logger.warn(`missed to resolve ${match[1]} for nesting ${str}`);\n        value = '';\n      }\n      if (doReduce) {\n        value = formatters.reduce((v, f) => this.format(v, f, options.lng, {\n          ...options,\n          interpolationkey: match[1].trim()\n        }), value.trim());\n      }\n      str = str.replace(match[0], value);\n      this.regexp.lastIndex = 0;\n    }\n    return str;\n  }\n}\n\nconst parseFormatStr = formatStr => {\n  let formatName = formatStr.toLowerCase().trim();\n  const formatOptions = {};\n  if (formatStr.indexOf('(') > -1) {\n    const p = formatStr.split('(');\n    formatName = p[0].toLowerCase().trim();\n    const optStr = p[1].substring(0, p[1].length - 1);\n    if (formatName === 'currency' && optStr.indexOf(':') < 0) {\n      if (!formatOptions.currency) formatOptions.currency = optStr.trim();\n    } else if (formatName === 'relativetime' && optStr.indexOf(':') < 0) {\n      if (!formatOptions.range) formatOptions.range = optStr.trim();\n    } else {\n      const opts = optStr.split(';');\n      opts.forEach(opt => {\n        if (opt) {\n          const [key, ...rest] = opt.split(':');\n          const val = rest.join(':').trim().replace(/^'+|'+$/g, '');\n          const trimmedKey = key.trim();\n          if (!formatOptions[trimmedKey]) formatOptions[trimmedKey] = val;\n          if (val === 'false') formatOptions[trimmedKey] = false;\n          if (val === 'true') formatOptions[trimmedKey] = true;\n          if (!isNaN(val)) formatOptions[trimmedKey] = parseInt(val, 10);\n        }\n      });\n    }\n  }\n  return {\n    formatName,\n    formatOptions\n  };\n};\nconst createCachedFormatter = fn => {\n  const cache = {};\n  return (val, lng, options) => {\n    let optForCache = options;\n    if (options && options.interpolationkey && options.formatParams && options.formatParams[options.interpolationkey] && options[options.interpolationkey]) {\n      optForCache = {\n        ...optForCache,\n        [options.interpolationkey]: undefined\n      };\n    }\n    const key = lng + JSON.stringify(optForCache);\n    let formatter = cache[key];\n    if (!formatter) {\n      formatter = fn(getCleanedCode(lng), options);\n      cache[key] = formatter;\n    }\n    return formatter(val);\n  };\n};\nclass Formatter {\n  constructor() {\n    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    this.logger = baseLogger.create('formatter');\n    this.options = options;\n    this.formats = {\n      number: createCachedFormatter((lng, opt) => {\n        const formatter = new Intl.NumberFormat(lng, {\n          ...opt\n        });\n        return val => formatter.format(val);\n      }),\n      currency: createCachedFormatter((lng, opt) => {\n        const formatter = new Intl.NumberFormat(lng, {\n          ...opt,\n          style: 'currency'\n        });\n        return val => formatter.format(val);\n      }),\n      datetime: createCachedFormatter((lng, opt) => {\n        const formatter = new Intl.DateTimeFormat(lng, {\n          ...opt\n        });\n        return val => formatter.format(val);\n      }),\n      relativetime: createCachedFormatter((lng, opt) => {\n        const formatter = new Intl.RelativeTimeFormat(lng, {\n          ...opt\n        });\n        return val => formatter.format(val, opt.range || 'day');\n      }),\n      list: createCachedFormatter((lng, opt) => {\n        const formatter = new Intl.ListFormat(lng, {\n          ...opt\n        });\n        return val => formatter.format(val);\n      })\n    };\n    this.init(options);\n  }\n  init(services) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n      interpolation: {}\n    };\n    this.formatSeparator = options.interpolation.formatSeparator || ',';\n  }\n  add(name, fc) {\n    this.formats[name.toLowerCase().trim()] = fc;\n  }\n  addCached(name, fc) {\n    this.formats[name.toLowerCase().trim()] = createCachedFormatter(fc);\n  }\n  format(value, format, lng) {\n    let options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n    const formats = format.split(this.formatSeparator);\n    if (formats.length > 1 && formats[0].indexOf('(') > 1 && formats[0].indexOf(')') < 0 && formats.find(f => f.indexOf(')') > -1)) {\n      const lastIndex = formats.findIndex(f => f.indexOf(')') > -1);\n      formats[0] = [formats[0], ...formats.splice(1, lastIndex)].join(this.formatSeparator);\n    }\n    const result = formats.reduce((mem, f) => {\n      const {\n        formatName,\n        formatOptions\n      } = parseFormatStr(f);\n      if (this.formats[formatName]) {\n        let formatted = mem;\n        try {\n          const valOptions = options && options.formatParams && options.formatParams[options.interpolationkey] || {};\n          const l = valOptions.locale || valOptions.lng || options.locale || options.lng || lng;\n          formatted = this.formats[formatName](mem, l, {\n            ...formatOptions,\n            ...options,\n            ...valOptions\n          });\n        } catch (error) {\n          this.logger.warn(error);\n        }\n        return formatted;\n      } else {\n        this.logger.warn(`there was no format function for ${formatName}`);\n      }\n      return mem;\n    }, value);\n    return result;\n  }\n}\n\nconst removePending = (q, name) => {\n  if (q.pending[name] !== undefined) {\n    delete q.pending[name];\n    q.pendingCount--;\n  }\n};\nclass Connector extends EventEmitter {\n  constructor(backend, store, services) {\n    let options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n    super();\n    this.backend = backend;\n    this.store = store;\n    this.services = services;\n    this.languageUtils = services.languageUtils;\n    this.options = options;\n    this.logger = baseLogger.create('backendConnector');\n    this.waitingReads = [];\n    this.maxParallelReads = options.maxParallelReads || 10;\n    this.readingCalls = 0;\n    this.maxRetries = options.maxRetries >= 0 ? options.maxRetries : 5;\n    this.retryTimeout = options.retryTimeout >= 1 ? options.retryTimeout : 350;\n    this.state = {};\n    this.queue = [];\n    if (this.backend && this.backend.init) {\n      this.backend.init(services, options.backend, options);\n    }\n  }\n  queueLoad(languages, namespaces, options, callback) {\n    const toLoad = {};\n    const pending = {};\n    const toLoadLanguages = {};\n    const toLoadNamespaces = {};\n    languages.forEach(lng => {\n      let hasAllNamespaces = true;\n      namespaces.forEach(ns => {\n        const name = `${lng}|${ns}`;\n        if (!options.reload && this.store.hasResourceBundle(lng, ns)) {\n          this.state[name] = 2;\n        } else if (this.state[name] < 0) ; else if (this.state[name] === 1) {\n          if (pending[name] === undefined) pending[name] = true;\n        } else {\n          this.state[name] = 1;\n          hasAllNamespaces = false;\n          if (pending[name] === undefined) pending[name] = true;\n          if (toLoad[name] === undefined) toLoad[name] = true;\n          if (toLoadNamespaces[ns] === undefined) toLoadNamespaces[ns] = true;\n        }\n      });\n      if (!hasAllNamespaces) toLoadLanguages[lng] = true;\n    });\n    if (Object.keys(toLoad).length || Object.keys(pending).length) {\n      this.queue.push({\n        pending,\n        pendingCount: Object.keys(pending).length,\n        loaded: {},\n        errors: [],\n        callback\n      });\n    }\n    return {\n      toLoad: Object.keys(toLoad),\n      pending: Object.keys(pending),\n      toLoadLanguages: Object.keys(toLoadLanguages),\n      toLoadNamespaces: Object.keys(toLoadNamespaces)\n    };\n  }\n  loaded(name, err, data) {\n    const s = name.split('|');\n    const lng = s[0];\n    const ns = s[1];\n    if (err) this.emit('failedLoading', lng, ns, err);\n    if (!err && data) {\n      this.store.addResourceBundle(lng, ns, data, undefined, undefined, {\n        skipCopy: true\n      });\n    }\n    this.state[name] = err ? -1 : 2;\n    if (err && data) this.state[name] = 0;\n    const loaded = {};\n    this.queue.forEach(q => {\n      pushPath(q.loaded, [lng], ns);\n      removePending(q, name);\n      if (err) q.errors.push(err);\n      if (q.pendingCount === 0 && !q.done) {\n        Object.keys(q.loaded).forEach(l => {\n          if (!loaded[l]) loaded[l] = {};\n          const loadedKeys = q.loaded[l];\n          if (loadedKeys.length) {\n            loadedKeys.forEach(n => {\n              if (loaded[l][n] === undefined) loaded[l][n] = true;\n            });\n          }\n        });\n        q.done = true;\n        if (q.errors.length) {\n          q.callback(q.errors);\n        } else {\n          q.callback();\n        }\n      }\n    });\n    this.emit('loaded', loaded);\n    this.queue = this.queue.filter(q => !q.done);\n  }\n  read(lng, ns, fcName) {\n    let tried = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n    let wait = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : this.retryTimeout;\n    let callback = arguments.length > 5 ? arguments[5] : undefined;\n    if (!lng.length) return callback(null, {});\n    if (this.readingCalls >= this.maxParallelReads) {\n      this.waitingReads.push({\n        lng,\n        ns,\n        fcName,\n        tried,\n        wait,\n        callback\n      });\n      return;\n    }\n    this.readingCalls++;\n    const resolver = (err, data) => {\n      this.readingCalls--;\n      if (this.waitingReads.length > 0) {\n        const next = this.waitingReads.shift();\n        this.read(next.lng, next.ns, next.fcName, next.tried, next.wait, next.callback);\n      }\n      if (err && data && tried < this.maxRetries) {\n        setTimeout(() => {\n          this.read.call(this, lng, ns, fcName, tried + 1, wait * 2, callback);\n        }, wait);\n        return;\n      }\n      callback(err, data);\n    };\n    const fc = this.backend[fcName].bind(this.backend);\n    if (fc.length === 2) {\n      try {\n        const r = fc(lng, ns);\n        if (r && typeof r.then === 'function') {\n          r.then(data => resolver(null, data)).catch(resolver);\n        } else {\n          resolver(null, r);\n        }\n      } catch (err) {\n        resolver(err);\n      }\n      return;\n    }\n    return fc(lng, ns, resolver);\n  }\n  prepareLoading(languages, namespaces) {\n    let options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    let callback = arguments.length > 3 ? arguments[3] : undefined;\n    if (!this.backend) {\n      this.logger.warn('No backend was added via i18next.use. Will not load resources.');\n      return callback && callback();\n    }\n    if (isString(languages)) languages = this.languageUtils.toResolveHierarchy(languages);\n    if (isString(namespaces)) namespaces = [namespaces];\n    const toLoad = this.queueLoad(languages, namespaces, options, callback);\n    if (!toLoad.toLoad.length) {\n      if (!toLoad.pending.length) callback();\n      return null;\n    }\n    toLoad.toLoad.forEach(name => {\n      this.loadOne(name);\n    });\n  }\n  load(languages, namespaces, callback) {\n    this.prepareLoading(languages, namespaces, {}, callback);\n  }\n  reload(languages, namespaces, callback) {\n    this.prepareLoading(languages, namespaces, {\n      reload: true\n    }, callback);\n  }\n  loadOne(name) {\n    let prefix = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n    const s = name.split('|');\n    const lng = s[0];\n    const ns = s[1];\n    this.read(lng, ns, 'read', undefined, undefined, (err, data) => {\n      if (err) this.logger.warn(`${prefix}loading namespace ${ns} for language ${lng} failed`, err);\n      if (!err && data) this.logger.log(`${prefix}loaded namespace ${ns} for language ${lng}`, data);\n      this.loaded(name, err, data);\n    });\n  }\n  saveMissing(languages, namespace, key, fallbackValue, isUpdate) {\n    let options = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : {};\n    let clb = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : () => {};\n    if (this.services.utils && this.services.utils.hasLoadedNamespace && !this.services.utils.hasLoadedNamespace(namespace)) {\n      this.logger.warn(`did not save key \"${key}\" as the namespace \"${namespace}\" was not yet loaded`, 'This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!');\n      return;\n    }\n    if (key === undefined || key === null || key === '') return;\n    if (this.backend && this.backend.create) {\n      const opts = {\n        ...options,\n        isUpdate\n      };\n      const fc = this.backend.create.bind(this.backend);\n      if (fc.length < 6) {\n        try {\n          let r;\n          if (fc.length === 5) {\n            r = fc(languages, namespace, key, fallbackValue, opts);\n          } else {\n            r = fc(languages, namespace, key, fallbackValue);\n          }\n          if (r && typeof r.then === 'function') {\n            r.then(data => clb(null, data)).catch(clb);\n          } else {\n            clb(null, r);\n          }\n        } catch (err) {\n          clb(err);\n        }\n      } else {\n        fc(languages, namespace, key, fallbackValue, clb, opts);\n      }\n    }\n    if (!languages || !languages[0]) return;\n    this.store.addResource(languages[0], namespace, key, fallbackValue);\n  }\n}\n\nconst get = () => ({\n  debug: false,\n  initImmediate: true,\n  ns: ['translation'],\n  defaultNS: ['translation'],\n  fallbackLng: ['dev'],\n  fallbackNS: false,\n  supportedLngs: false,\n  nonExplicitSupportedLngs: false,\n  load: 'all',\n  preload: false,\n  simplifyPluralSuffix: true,\n  keySeparator: '.',\n  nsSeparator: ':',\n  pluralSeparator: '_',\n  contextSeparator: '_',\n  partialBundledLanguages: false,\n  saveMissing: false,\n  updateMissing: false,\n  saveMissingTo: 'fallback',\n  saveMissingPlurals: true,\n  missingKeyHandler: false,\n  missingInterpolationHandler: false,\n  postProcess: false,\n  postProcessPassResolved: false,\n  returnNull: false,\n  returnEmptyString: true,\n  returnObjects: false,\n  joinArrays: false,\n  returnedObjectHandler: false,\n  parseMissingKeyHandler: false,\n  appendNamespaceToMissingKey: false,\n  appendNamespaceToCIMode: false,\n  overloadTranslationOptionHandler: args => {\n    let ret = {};\n    if (typeof args[1] === 'object') ret = args[1];\n    if (isString(args[1])) ret.defaultValue = args[1];\n    if (isString(args[2])) ret.tDescription = args[2];\n    if (typeof args[2] === 'object' || typeof args[3] === 'object') {\n      const options = args[3] || args[2];\n      Object.keys(options).forEach(key => {\n        ret[key] = options[key];\n      });\n    }\n    return ret;\n  },\n  interpolation: {\n    escapeValue: true,\n    format: value => value,\n    prefix: '{{',\n    suffix: '}}',\n    formatSeparator: ',',\n    unescapePrefix: '-',\n    nestingPrefix: '$t(',\n    nestingSuffix: ')',\n    nestingOptionsSeparator: ',',\n    maxReplaces: 1000,\n    skipOnVariables: true\n  }\n});\nconst transformOptions = options => {\n  if (isString(options.ns)) options.ns = [options.ns];\n  if (isString(options.fallbackLng)) options.fallbackLng = [options.fallbackLng];\n  if (isString(options.fallbackNS)) options.fallbackNS = [options.fallbackNS];\n  if (options.supportedLngs && options.supportedLngs.indexOf('cimode') < 0) {\n    options.supportedLngs = options.supportedLngs.concat(['cimode']);\n  }\n  return options;\n};\n\nconst noop = () => {};\nconst bindMemberFunctions = inst => {\n  const mems = Object.getOwnPropertyNames(Object.getPrototypeOf(inst));\n  mems.forEach(mem => {\n    if (typeof inst[mem] === 'function') {\n      inst[mem] = inst[mem].bind(inst);\n    }\n  });\n};\nclass I18n extends EventEmitter {\n  constructor() {\n    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    let callback = arguments.length > 1 ? arguments[1] : undefined;\n    super();\n    this.options = transformOptions(options);\n    this.services = {};\n    this.logger = baseLogger;\n    this.modules = {\n      external: []\n    };\n    bindMemberFunctions(this);\n    if (callback && !this.isInitialized && !options.isClone) {\n      if (!this.options.initImmediate) {\n        this.init(options, callback);\n        return this;\n      }\n      setTimeout(() => {\n        this.init(options, callback);\n      }, 0);\n    }\n  }\n  init() {\n    var _this = this;\n    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    let callback = arguments.length > 1 ? arguments[1] : undefined;\n    this.isInitializing = true;\n    if (typeof options === 'function') {\n      callback = options;\n      options = {};\n    }\n    if (!options.defaultNS && options.defaultNS !== false && options.ns) {\n      if (isString(options.ns)) {\n        options.defaultNS = options.ns;\n      } else if (options.ns.indexOf('translation') < 0) {\n        options.defaultNS = options.ns[0];\n      }\n    }\n    const defOpts = get();\n    this.options = {\n      ...defOpts,\n      ...this.options,\n      ...transformOptions(options)\n    };\n    if (this.options.compatibilityAPI !== 'v1') {\n      this.options.interpolation = {\n        ...defOpts.interpolation,\n        ...this.options.interpolation\n      };\n    }\n    if (options.keySeparator !== undefined) {\n      this.options.userDefinedKeySeparator = options.keySeparator;\n    }\n    if (options.nsSeparator !== undefined) {\n      this.options.userDefinedNsSeparator = options.nsSeparator;\n    }\n    const createClassOnDemand = ClassOrObject => {\n      if (!ClassOrObject) return null;\n      if (typeof ClassOrObject === 'function') return new ClassOrObject();\n      return ClassOrObject;\n    };\n    if (!this.options.isClone) {\n      if (this.modules.logger) {\n        baseLogger.init(createClassOnDemand(this.modules.logger), this.options);\n      } else {\n        baseLogger.init(null, this.options);\n      }\n      let formatter;\n      if (this.modules.formatter) {\n        formatter = this.modules.formatter;\n      } else if (typeof Intl !== 'undefined') {\n        formatter = Formatter;\n      }\n      const lu = new LanguageUtil(this.options);\n      this.store = new ResourceStore(this.options.resources, this.options);\n      const s = this.services;\n      s.logger = baseLogger;\n      s.resourceStore = this.store;\n      s.languageUtils = lu;\n      s.pluralResolver = new PluralResolver(lu, {\n        prepend: this.options.pluralSeparator,\n        compatibilityJSON: this.options.compatibilityJSON,\n        simplifyPluralSuffix: this.options.simplifyPluralSuffix\n      });\n      if (formatter && (!this.options.interpolation.format || this.options.interpolation.format === defOpts.interpolation.format)) {\n        s.formatter = createClassOnDemand(formatter);\n        s.formatter.init(s, this.options);\n        this.options.interpolation.format = s.formatter.format.bind(s.formatter);\n      }\n      s.interpolator = new Interpolator(this.options);\n      s.utils = {\n        hasLoadedNamespace: this.hasLoadedNamespace.bind(this)\n      };\n      s.backendConnector = new Connector(createClassOnDemand(this.modules.backend), s.resourceStore, s, this.options);\n      s.backendConnector.on('*', function (event) {\n        for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n          args[_key - 1] = arguments[_key];\n        }\n        _this.emit(event, ...args);\n      });\n      if (this.modules.languageDetector) {\n        s.languageDetector = createClassOnDemand(this.modules.languageDetector);\n        if (s.languageDetector.init) s.languageDetector.init(s, this.options.detection, this.options);\n      }\n      if (this.modules.i18nFormat) {\n        s.i18nFormat = createClassOnDemand(this.modules.i18nFormat);\n        if (s.i18nFormat.init) s.i18nFormat.init(this);\n      }\n      this.translator = new Translator(this.services, this.options);\n      this.translator.on('*', function (event) {\n        for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n          args[_key2 - 1] = arguments[_key2];\n        }\n        _this.emit(event, ...args);\n      });\n      this.modules.external.forEach(m => {\n        if (m.init) m.init(this);\n      });\n    }\n    this.format = this.options.interpolation.format;\n    if (!callback) callback = noop;\n    if (this.options.fallbackLng && !this.services.languageDetector && !this.options.lng) {\n      const codes = this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);\n      if (codes.length > 0 && codes[0] !== 'dev') this.options.lng = codes[0];\n    }\n    if (!this.services.languageDetector && !this.options.lng) {\n      this.logger.warn('init: no languageDetector is used and no lng is defined');\n    }\n    const storeApi = ['getResource', 'hasResourceBundle', 'getResourceBundle', 'getDataByLanguage'];\n    storeApi.forEach(fcName => {\n      this[fcName] = function () {\n        return _this.store[fcName](...arguments);\n      };\n    });\n    const storeApiChained = ['addResource', 'addResources', 'addResourceBundle', 'removeResourceBundle'];\n    storeApiChained.forEach(fcName => {\n      this[fcName] = function () {\n        _this.store[fcName](...arguments);\n        return _this;\n      };\n    });\n    const deferred = defer();\n    const load = () => {\n      const finish = (err, t) => {\n        this.isInitializing = false;\n        if (this.isInitialized && !this.initializedStoreOnce) this.logger.warn('init: i18next is already initialized. You should call init just once!');\n        this.isInitialized = true;\n        if (!this.options.isClone) this.logger.log('initialized', this.options);\n        this.emit('initialized', this.options);\n        deferred.resolve(t);\n        callback(err, t);\n      };\n      if (this.languages && this.options.compatibilityAPI !== 'v1' && !this.isInitialized) return finish(null, this.t.bind(this));\n      this.changeLanguage(this.options.lng, finish);\n    };\n    if (this.options.resources || !this.options.initImmediate) {\n      load();\n    } else {\n      setTimeout(load, 0);\n    }\n    return deferred;\n  }\n  loadResources(language) {\n    let callback = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : noop;\n    let usedCallback = callback;\n    const usedLng = isString(language) ? language : this.language;\n    if (typeof language === 'function') usedCallback = language;\n    if (!this.options.resources || this.options.partialBundledLanguages) {\n      if (usedLng && usedLng.toLowerCase() === 'cimode' && (!this.options.preload || this.options.preload.length === 0)) return usedCallback();\n      const toLoad = [];\n      const append = lng => {\n        if (!lng) return;\n        if (lng === 'cimode') return;\n        const lngs = this.services.languageUtils.toResolveHierarchy(lng);\n        lngs.forEach(l => {\n          if (l === 'cimode') return;\n          if (toLoad.indexOf(l) < 0) toLoad.push(l);\n        });\n      };\n      if (!usedLng) {\n        const fallbacks = this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);\n        fallbacks.forEach(l => append(l));\n      } else {\n        append(usedLng);\n      }\n      if (this.options.preload) {\n        this.options.preload.forEach(l => append(l));\n      }\n      this.services.backendConnector.load(toLoad, this.options.ns, e => {\n        if (!e && !this.resolvedLanguage && this.language) this.setResolvedLanguage(this.language);\n        usedCallback(e);\n      });\n    } else {\n      usedCallback(null);\n    }\n  }\n  reloadResources(lngs, ns, callback) {\n    const deferred = defer();\n    if (typeof lngs === 'function') {\n      callback = lngs;\n      lngs = undefined;\n    }\n    if (typeof ns === 'function') {\n      callback = ns;\n      ns = undefined;\n    }\n    if (!lngs) lngs = this.languages;\n    if (!ns) ns = this.options.ns;\n    if (!callback) callback = noop;\n    this.services.backendConnector.reload(lngs, ns, err => {\n      deferred.resolve();\n      callback(err);\n    });\n    return deferred;\n  }\n  use(module) {\n    if (!module) throw new Error('You are passing an undefined module! Please check the object you are passing to i18next.use()');\n    if (!module.type) throw new Error('You are passing a wrong module! Please check the object you are passing to i18next.use()');\n    if (module.type === 'backend') {\n      this.modules.backend = module;\n    }\n    if (module.type === 'logger' || module.log && module.warn && module.error) {\n      this.modules.logger = module;\n    }\n    if (module.type === 'languageDetector') {\n      this.modules.languageDetector = module;\n    }\n    if (module.type === 'i18nFormat') {\n      this.modules.i18nFormat = module;\n    }\n    if (module.type === 'postProcessor') {\n      postProcessor.addPostProcessor(module);\n    }\n    if (module.type === 'formatter') {\n      this.modules.formatter = module;\n    }\n    if (module.type === '3rdParty') {\n      this.modules.external.push(module);\n    }\n    return this;\n  }\n  setResolvedLanguage(l) {\n    if (!l || !this.languages) return;\n    if (['cimode', 'dev'].indexOf(l) > -1) return;\n    for (let li = 0; li < this.languages.length; li++) {\n      const lngInLngs = this.languages[li];\n      if (['cimode', 'dev'].indexOf(lngInLngs) > -1) continue;\n      if (this.store.hasLanguageSomeTranslations(lngInLngs)) {\n        this.resolvedLanguage = lngInLngs;\n        break;\n      }\n    }\n  }\n  changeLanguage(lng, callback) {\n    var _this2 = this;\n    this.isLanguageChangingTo = lng;\n    const deferred = defer();\n    this.emit('languageChanging', lng);\n    const setLngProps = l => {\n      this.language = l;\n      this.languages = this.services.languageUtils.toResolveHierarchy(l);\n      this.resolvedLanguage = undefined;\n      this.setResolvedLanguage(l);\n    };\n    const done = (err, l) => {\n      if (l) {\n        setLngProps(l);\n        this.translator.changeLanguage(l);\n        this.isLanguageChangingTo = undefined;\n        this.emit('languageChanged', l);\n        this.logger.log('languageChanged', l);\n      } else {\n        this.isLanguageChangingTo = undefined;\n      }\n      deferred.resolve(function () {\n        return _this2.t(...arguments);\n      });\n      if (callback) callback(err, function () {\n        return _this2.t(...arguments);\n      });\n    };\n    const setLng = lngs => {\n      if (!lng && !lngs && this.services.languageDetector) lngs = [];\n      const l = isString(lngs) ? lngs : this.services.languageUtils.getBestMatchFromCodes(lngs);\n      if (l) {\n        if (!this.language) {\n          setLngProps(l);\n        }\n        if (!this.translator.language) this.translator.changeLanguage(l);\n        if (this.services.languageDetector && this.services.languageDetector.cacheUserLanguage) this.services.languageDetector.cacheUserLanguage(l);\n      }\n      this.loadResources(l, err => {\n        done(err, l);\n      });\n    };\n    if (!lng && this.services.languageDetector && !this.services.languageDetector.async) {\n      setLng(this.services.languageDetector.detect());\n    } else if (!lng && this.services.languageDetector && this.services.languageDetector.async) {\n      if (this.services.languageDetector.detect.length === 0) {\n        this.services.languageDetector.detect().then(setLng);\n      } else {\n        this.services.languageDetector.detect(setLng);\n      }\n    } else {\n      setLng(lng);\n    }\n    return deferred;\n  }\n  getFixedT(lng, ns, keyPrefix) {\n    var _this3 = this;\n    const fixedT = function (key, opts) {\n      let options;\n      if (typeof opts !== 'object') {\n        for (var _len3 = arguments.length, rest = new Array(_len3 > 2 ? _len3 - 2 : 0), _key3 = 2; _key3 < _len3; _key3++) {\n          rest[_key3 - 2] = arguments[_key3];\n        }\n        options = _this3.options.overloadTranslationOptionHandler([key, opts].concat(rest));\n      } else {\n        options = {\n          ...opts\n        };\n      }\n      options.lng = options.lng || fixedT.lng;\n      options.lngs = options.lngs || fixedT.lngs;\n      options.ns = options.ns || fixedT.ns;\n      if (options.keyPrefix !== '') options.keyPrefix = options.keyPrefix || keyPrefix || fixedT.keyPrefix;\n      const keySeparator = _this3.options.keySeparator || '.';\n      let resultKey;\n      if (options.keyPrefix && Array.isArray(key)) {\n        resultKey = key.map(k => `${options.keyPrefix}${keySeparator}${k}`);\n      } else {\n        resultKey = options.keyPrefix ? `${options.keyPrefix}${keySeparator}${key}` : key;\n      }\n      return _this3.t(resultKey, options);\n    };\n    if (isString(lng)) {\n      fixedT.lng = lng;\n    } else {\n      fixedT.lngs = lng;\n    }\n    fixedT.ns = ns;\n    fixedT.keyPrefix = keyPrefix;\n    return fixedT;\n  }\n  t() {\n    return this.translator && this.translator.translate(...arguments);\n  }\n  exists() {\n    return this.translator && this.translator.exists(...arguments);\n  }\n  setDefaultNamespace(ns) {\n    this.options.defaultNS = ns;\n  }\n  hasLoadedNamespace(ns) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    if (!this.isInitialized) {\n      this.logger.warn('hasLoadedNamespace: i18next was not initialized', this.languages);\n      return false;\n    }\n    if (!this.languages || !this.languages.length) {\n      this.logger.warn('hasLoadedNamespace: i18n.languages were undefined or empty', this.languages);\n      return false;\n    }\n    const lng = options.lng || this.resolvedLanguage || this.languages[0];\n    const fallbackLng = this.options ? this.options.fallbackLng : false;\n    const lastLng = this.languages[this.languages.length - 1];\n    if (lng.toLowerCase() === 'cimode') return true;\n    const loadNotPending = (l, n) => {\n      const loadState = this.services.backendConnector.state[`${l}|${n}`];\n      return loadState === -1 || loadState === 0 || loadState === 2;\n    };\n    if (options.precheck) {\n      const preResult = options.precheck(this, loadNotPending);\n      if (preResult !== undefined) return preResult;\n    }\n    if (this.hasResourceBundle(lng, ns)) return true;\n    if (!this.services.backendConnector.backend || this.options.resources && !this.options.partialBundledLanguages) return true;\n    if (loadNotPending(lng, ns) && (!fallbackLng || loadNotPending(lastLng, ns))) return true;\n    return false;\n  }\n  loadNamespaces(ns, callback) {\n    const deferred = defer();\n    if (!this.options.ns) {\n      if (callback) callback();\n      return Promise.resolve();\n    }\n    if (isString(ns)) ns = [ns];\n    ns.forEach(n => {\n      if (this.options.ns.indexOf(n) < 0) this.options.ns.push(n);\n    });\n    this.loadResources(err => {\n      deferred.resolve();\n      if (callback) callback(err);\n    });\n    return deferred;\n  }\n  loadLanguages(lngs, callback) {\n    const deferred = defer();\n    if (isString(lngs)) lngs = [lngs];\n    const preloaded = this.options.preload || [];\n    const newLngs = lngs.filter(lng => preloaded.indexOf(lng) < 0 && this.services.languageUtils.isSupportedCode(lng));\n    if (!newLngs.length) {\n      if (callback) callback();\n      return Promise.resolve();\n    }\n    this.options.preload = preloaded.concat(newLngs);\n    this.loadResources(err => {\n      deferred.resolve();\n      if (callback) callback(err);\n    });\n    return deferred;\n  }\n  dir(lng) {\n    if (!lng) lng = this.resolvedLanguage || (this.languages && this.languages.length > 0 ? this.languages[0] : this.language);\n    if (!lng) return 'rtl';\n    const rtlLngs = ['ar', 'shu', 'sqr', 'ssh', 'xaa', 'yhd', 'yud', 'aao', 'abh', 'abv', 'acm', 'acq', 'acw', 'acx', 'acy', 'adf', 'ads', 'aeb', 'aec', 'afb', 'ajp', 'apc', 'apd', 'arb', 'arq', 'ars', 'ary', 'arz', 'auz', 'avl', 'ayh', 'ayl', 'ayn', 'ayp', 'bbz', 'pga', 'he', 'iw', 'ps', 'pbt', 'pbu', 'pst', 'prp', 'prd', 'ug', 'ur', 'ydd', 'yds', 'yih', 'ji', 'yi', 'hbo', 'men', 'xmn', 'fa', 'jpr', 'peo', 'pes', 'prs', 'dv', 'sam', 'ckb'];\n    const languageUtils = this.services && this.services.languageUtils || new LanguageUtil(get());\n    return rtlLngs.indexOf(languageUtils.getLanguagePartFromCode(lng)) > -1 || lng.toLowerCase().indexOf('-arab') > 1 ? 'rtl' : 'ltr';\n  }\n  static createInstance() {\n    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    let callback = arguments.length > 1 ? arguments[1] : undefined;\n    return new I18n(options, callback);\n  }\n  cloneInstance() {\n    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    let callback = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : noop;\n    const forkResourceStore = options.forkResourceStore;\n    if (forkResourceStore) delete options.forkResourceStore;\n    const mergedOptions = {\n      ...this.options,\n      ...options,\n      ...{\n        isClone: true\n      }\n    };\n    const clone = new I18n(mergedOptions);\n    if (options.debug !== undefined || options.prefix !== undefined) {\n      clone.logger = clone.logger.clone(options);\n    }\n    const membersToCopy = ['store', 'services', 'language'];\n    membersToCopy.forEach(m => {\n      clone[m] = this[m];\n    });\n    clone.services = {\n      ...this.services\n    };\n    clone.services.utils = {\n      hasLoadedNamespace: clone.hasLoadedNamespace.bind(clone)\n    };\n    if (forkResourceStore) {\n      clone.store = new ResourceStore(this.store.data, mergedOptions);\n      clone.services.resourceStore = clone.store;\n    }\n    clone.translator = new Translator(clone.services, mergedOptions);\n    clone.translator.on('*', function (event) {\n      for (var _len4 = arguments.length, args = new Array(_len4 > 1 ? _len4 - 1 : 0), _key4 = 1; _key4 < _len4; _key4++) {\n        args[_key4 - 1] = arguments[_key4];\n      }\n      clone.emit(event, ...args);\n    });\n    clone.init(mergedOptions, callback);\n    clone.translator.options = mergedOptions;\n    clone.translator.backendConnector.services.utils = {\n      hasLoadedNamespace: clone.hasLoadedNamespace.bind(clone)\n    };\n    return clone;\n  }\n  toJSON() {\n    return {\n      options: this.options,\n      store: this.store,\n      language: this.language,\n      languages: this.languages,\n      resolvedLanguage: this.resolvedLanguage\n    };\n  }\n}\nconst instance = I18n.createInstance();\ninstance.createInstance = I18n.createInstance;\n\nconst createInstance = instance.createInstance;\nconst dir = instance.dir;\nconst init = instance.init;\nconst loadResources = instance.loadResources;\nconst reloadResources = instance.reloadResources;\nconst use = instance.use;\nconst changeLanguage = instance.changeLanguage;\nconst getFixedT = instance.getFixedT;\nconst t = instance.t;\nconst exists = instance.exists;\nconst setDefaultNamespace = instance.setDefaultNamespace;\nconst hasLoadedNamespace = instance.hasLoadedNamespace;\nconst loadNamespaces = instance.loadNamespaces;\nconst loadLanguages = instance.loadLanguages;\n\nexport { changeLanguage, createInstance, instance as default, dir, exists, getFixedT, hasLoadedNamespace, init, loadLanguages, loadNamespaces, loadResources, reloadResources, setDefaultNamespace, t, use };\n","import i18n from \"../i18next\";\nimport en from \"./en.json\";\nimport fr from \"./fr.json\";\nimport ru from \"./ru.json\";\n\ni18n.addResourceBundle(\"ru\", \"translations\", ru);\ni18n.addResourceBundle(\"en\", \"translations\", en);\ni18n.addResourceBundle(\"fr\", \"translations\", fr);\n\nexport default i18n;\n","import React, {\n  Dispatch,\n  createContext,\n  useContext,\n  useMemo,\n  useReducer,\n} from \"react\";\nimport { I18nextProvider } from \"react-i18next\";\nimport i18n from \"../translations\";\n\ninterface LanguageState {\n  language: Language;\n}\n\ntype Language = \"ru\" | \"fr\" | \"en\";\n\ntype Action = {\n  type: \"RU\" | \"FR\" | \"EN\";\n  payload: Language;\n};\ninterface LanguageContextI {\n  languageState: LanguageState;\n  dispatchLanguage: Dispatch<Action>;\n}\n\nconst languageWithoutCountry = (): Language => {\n  return i18n.language.substring(0, 2) as Language;\n};\n\nexport const LANGUAGES: Record<string, Language> = {\n  RU: \"ru\",\n  FR: \"fr\",\n  EN: \"en\",\n};\n\nexport const LANGUAGES_ACTIONS = {\n  SET_RUSSIAN: \"SET_RUSSIAN\",\n  SET_ENGLISH: \"SET_ENGLISH\",\n  SET_FRENCH: \"SET_FRENCH\",\n};\n\nconst reducer = (state: LanguageState, action: Action): LanguageState => {\n  switch (action.type) {\n    case LANGUAGES_ACTIONS.SET_ENGLISH:\n      i18n.changeLanguage(\"en\");\n      return { language: LANGUAGES.EN };\n    case LANGUAGES_ACTIONS.SET_FRENCH:\n      i18n.changeLanguage(\"fr\");\n      return { language: LANGUAGES.FR };\n    case LANGUAGES_ACTIONS.SET_RUSSIAN:\n      i18n.changeLanguage(\"ru\");\n      return { language: LANGUAGES.RU };\n    default:\n      return state;\n  }\n};\n\nexport const LanguageContext = createContext({} as LanguageContextI);\n\ninterface AppLanguageProviderProps {\n  children: React.ReactNode;\n}\nexport const AppLanguageProvider: React.FC<AppLanguageProviderProps> = ({\n  children,\n}) => {\n  const [languageState, dispatchLanguage] = useReducer(reducer, {\n    language: languageWithoutCountry(),\n  });\n  const value = useMemo(\n    () => ({ languageState, dispatchLanguage }),\n    [languageState]\n  );\n  return (\n    <LanguageContext.Provider value={value}>\n      <I18nextProvider i18n={i18n}>{children}</I18nextProvider>\n    </LanguageContext.Provider>\n  );\n};\n\nexport const useLanguageValue = () => useContext(LanguageContext);\n","import React from \"react\";\nimport { ChatProps } from \"../../types\"; // TODO: upgrade to latest eslint tooling\n\nimport { ChatProvider } from \"../../context/ChatContext\";\nimport { AppLanguageProvider } from \"../../context/LanguageContext\";\nimport { RestProvider } from \"../../context/RestContext\";\nimport { SocketProvider } from \"../../context/SocketContext\";\nimport { ChatPage } from \"../../pages/chat\";\n\nexport const ChatIndex: React.FC<ChatProps> = ({\n  lang,\n  chatBaseURLApi,\n  baseUrl,\n  chatWsUrl,\n  chatWsPath,\n  token,\n  refreshToken,\n  ...props\n}: ChatProps) => {\n  return (\n    <AppLanguageProvider>\n      <ChatProvider defLang={lang} token={token} refreshToken={refreshToken}>\n        <RestProvider\n          chatBaseURLApi={chatBaseURLApi}\n          pageSize={25}\n          baseUrl={baseUrl}\n        >\n          <SocketProvider\n            wsUrl={chatWsUrl}\n            wsPath={chatWsPath}\n            baseUrl={baseUrl}\n          >\n            <ChatPage {...props} />\n          </SocketProvider>\n        </RestProvider>\n      </ChatProvider>\n    </AppLanguageProvider>\n  );\n};\n"],"names":["MessageStatus","Role","ContextMenuType","isEmpty","value","Object","keys","length","trim","formatTime","time","format","Date","dayjs","add","startOf","isAfter","getChatId","chat","groupId","userId","getChatName","name","username","isGroup","chatRoomComparer","a","b","hasMessagesA","Array","isArray","messages","hasMessagesB","cdate","getTime","getParam","param","QueryString","window","location","search","URLSearchParams","get","combineURLs","baseURL","relativeURL","queryParams","url","replace","includes","toString","useStyles","makeStyles","theme","createStyles","typingText","paddingLeft","spacing","typingDot","display","verticalAlign","width","height","margin","background","palette","primary","main","borderRadius","opacity","animation","&:nth-child(1)","animationDelay","&:nth-child(2)","&:nth-child(3)","@keyframes loadingFade","0%","50%","100%","Typing","props","classes","React","createElement","Typography","color","variant","component","className","message","ContactStatus","t","useTranslation","isTyping","contact","online","star","fontSize","ContactList","apiUrl","contacts","owner","onContactClick","listProps","_objectWithoutPropertiesLoose","_excluded","List","_extends","aria-label","map","ListItemButton","key","onClick","ListItemAvatar","Avatar","alt","src","avatar","ListItemText","StarIcon","secondary","AddContact","onClose","open","_useTranslation","Dialog","aria-labelledby","DialogTitle","id","root","Conference","_ref","regex","lang","conference","_ref$langCode","langCode","ref","useRef","confUrl","RegExp","useEffect","listener","_ref2","source","_ref$current","current","contentWindow","data","type","addEventListener","removeEventListener","title","allowFullScreen","allow","flexDirection","justifyContent","alignItems","pulse","position","&::before","content","border","&::after","footer","alignSelf","paddingTop","@keyframes pulse","transform","ConferenceCall","onAccept","Paper","Button","item","cursor","Emoji","emojiClick","e","onSelect","target","innerText","Item","itemProps","Box","m","emoji","fileIcon","fileBody","File","meta","split","date","size","getFileMeta","_splitFileName","idx","lastIndexOf","ext","slice","splitFileName","toUpperCase","_img","_aspect","img","maxWidth","maxHeight","breakpoints","down","aspect","Image","setViewerData","AspectRatio","ratio","visible","_mediaContent","mediaContent","backgroundColor","Video","isConference","JSON","parse","visitId","controls","muted","preload","MessageContent","messageType","Fragment","_message","rootContact","padding","& span","float","text","& $message","grey","borderTopRightRadius","borderBottomRightRadius","& $firstMessage","borderTopLeftRadius","marginTop","& $lastMessage","borderBottomLeftRadius","marginBottom","rootUser","paddingRight","contrastText","rootNotify","& > *","fontWeight","firstMessage","lastMessage","file","flexWrap","header","flex","overflow","body","wordBreak","status","statusImage","marginRight","Message","memo","forwardRef","user","isGroupMessage","isUserFirst","isUserLast","ListItem","Alert","severity","isRevoke","align","revokeUserName","isMine","onContextMenu","child","Link","underline","href","download","wrapMessage","Done","DoneAll","displayName","runtime","exports","Op","prototype","hasOwn","hasOwnProperty","$Symbol","Symbol","iteratorSymbol","iterator","asyncIteratorSymbol","asyncIterator","toStringTagSymbol","toStringTag","define","obj","defineProperty","enumerable","configurable","writable","err","wrap","innerFn","outerFn","self","tryLocsList","generator","create","Generator","context","Context","_invoke","state","method","arg","Error","undefined","done","delegate","delegateResult","maybeInvokeDelegate","ContinueSentinel","sent","_sent","dispatchException","abrupt","record","tryCatch","makeInvokeMethod","fn","call","GeneratorFunction","GeneratorFunctionPrototype","IteratorPrototype","this","getProto","getPrototypeOf","NativeIteratorPrototype","values","Gp","defineIteratorMethods","forEach","AsyncIterator","PromiseImpl","previousPromise","callInvokeWithMethodAndArg","resolve","reject","invoke","result","__await","then","unwrapped","error","TypeError","info","resultName","next","nextLoc","pushTryEntry","locs","entry","tryLoc","catchLoc","finallyLoc","afterLoc","tryEntries","push","resetTryEntry","completion","reset","iterable","iteratorMethod","isNaN","i","doneResult","isGeneratorFunction","genFun","ctor","constructor","mark","setPrototypeOf","__proto__","awrap","async","Promise","iter","object","reverse","pop","skipTempReset","prev","charAt","stop","rootRecord","rval","exception","handle","loc","caught","hasCatch","hasFinally","finallyEntry","complete","finish","catch","thrown","delegateYield","module","regeneratorRuntime","accidentalStrictMode","globalThis","Function","ALLOWED_FILE_TYPES","image","video","input","inputUpload","attachmentIcon","fill","stroke","Entry","onTyping","onSendMessage","_ref$maxMessageLength","maxMessageLength","fileInputRef","_useState","useState","emojiAnchorEl","setEmojiAnchorEl","textRef","textValueRef","_useState2","setError","_useState3","isUploading","setIsUploading","_useState4","lastTyping","setLastTyping","handleEmojiClose","emojiSelect","useCallback","newValue","handleTyping","now","sendMessage","handleSubmit","currentText","handleFileUpload","_asyncToGenerator","_regeneratorRuntime","_callee","event","_event$target$files","_Object$entries$find","imageSize","_context","files","entries","find","_ref3","URL","createObjectURL","onload","revokeObjectURL","fileName","t0","_x","apply","arguments","TextField","placeholder","autoFocus","disabled","inputRef","slotProps","autoComplete","inputProps","maxLength","disableUnderline","startAdornment","InputAdornment","accept","flat","join","onChange","htmlFor","IconButton","CircularProgress","SvgIcon","d","strokeWidth","strokeLinecap","strokeLinejoin","aria-describedby","Boolean","currentTarget","InsertEmoticon","endAdornment","edge","Send","onKeyDown","shiftKey","preventDefault","Popover","anchorEl","anchorOrigin","vertical","horizontal","transformOrigin","Transition","Slide","direction","ConfirmDialogSlide","setOpen","contentText","callback","handleClose","TransitionComponent","keepMounted","DialogContent","DialogActions","StyledMenu","styled","Menu","elevation","& .MuiPaper-root","minWidth","mode","boxShadow","& .MuiMenu-list","& .MuiMenuItem-root","& .MuiSvgIcon-root","&:active","alpha","action","selectedOpacity","ConferenceButton","_React$useState","setAnchorEl","_React$useState2","setVisitId","_React$useState3","confirmReCreateVisit","setConfirmReCreateVisit","visitData","useMemo","filter","it","contactId","aria-controls","aria-haspopup","aria-expanded","disableElevation","startIcon","VideoCallIcon","endIcon","KeyboardArrowDownIcon","onVideoCall","MenuListProps","MenuItem","conferenceStatus","handleStart","disableRipple","RestartAltIcon","PlayArrowIcon","visit","visitDate","plExamName","duration","AlertDialog","children","_ref$severity","AlertModale","modaleInfo","setModaleInfo","strTime","textAlign","ConferenceTime","finishDate","currTime","finTime","diffTimeSec","Math","round","counter","max","setCounter","counterRef","setInterval","clearInterval","handlerRefresh","useCounter","_hhMmSs","totalSeconds","hours","floor","strHours","minutes","seconds","hhMmSs","paper","avatarGroup","getGroupStatus","group","_group$members","members","onlineCount","reduce","sum","RoomHeader","typing","conferenceJoined","operators","onVideoEnd","onConferencePause","onOperatorAdd","onLeaveGroup","addOperatorOpen","setAddOperatorOpen","confirmFinishConf","setConfirmFinishConf","CardHeader","subheader","_group$members2","closeTimer","handlePopoverIn","clearTimeout","handlePopoverClose","handlePopoverOut","setTimeout","GroupIcon","aria-owns","onMouseEnter","onMouseLeave","sx","pointerEvents","disableRestoreFocus","role","PersonAddIcon","operator","DeleteIcon","whiteSpace","textOverflow","PauseIcon","CallEndIcon","style","marginLeft","MessageDateIndicator","Fade","in","timeout","icon","top","left","mx","zIndex","_arrowDown","arrowDown","bottom","MessageScrollButton","unreadCount","onScrollDown","Fab","KeyboardArrowDown","minHeight","default","messageListOuter","overflowY","scrollbarWidth","scrollbarColor","light","messageList","RoomMessageList","savedCallback","users","loading","pageSize","initialMenuState","onNeedMoreMessages","onMessageDelete","setMenuState","onEnterRoom","scrollableRootRef","chatId","viewerData","isVisible","setIsVisible","_chat$messages","createRef","hasNextPage","noMoreData","_useMessageScroll","scrollDownButton","setScrollDownButton","lastScrollDistanceToBottomRef","lastMessageCount","messageCount","scrollDown","scrollTop","scrollHeight","handleRootScroll","rect","rootNode","scrollDistanceToBottom","_mess$ref","mess","getBoundingClientRect","clientHeight","_messages$cdate","_messages","scrollableRoot","lastScrollDistanceToBottom","_lastScrollDistanceTo","useMessageScroll","_useInfiniteScroll","useInfiniteScroll","onLoadMore","infiniteRef","rootRef","rootRefSetter","node","index","_messages2","_id","canCopy","canDelete","mouseX","clientX","mouseY","clientY","handleMenuPopup","CardContent","onScroll","Backdrop","drawer","roomHeader","flexAll","flexEnd","Room","isMobile","menuState","handleCopy","navigator","clipboard","writeText","handleDelete","Card","Divider","anchorReference","anchorPosition","ListItemIcon","FileCopyIcon","emptyUser","password","emptyChatState","token","refreshToken","activeRoom","chatOld","groupGather","userGather","contactGather","initialContactId","joined","ringPlayed","success","getFreshActiveRoom","getActiveRoom","newActiveRoom","rooms","concat","sort","setUserOnline","newState","_i","_Object$values","member","indexOf","findIndex","contactUnreadGather","predicate","groupUnreadGather","chatReducer","_extends2","payload","_extends3","updateActiveRoom","delGroup","delGroupMember","delContact","_extends4","setActiveRoom","x","addGroupMessage","_newState$activeRoom","addPrivateMessage","userName","msg","revokeMessage","notice","updateGroupInfo","updateUserInfo","isManager","addGroupMember","setConference","_state$conference$dat","pauseConference","_state$conference$dat2","stopConference","updatedValue","markPrivateMessagesRead","addPrivateMessages","userArr","_step","_iterator","_createForOfIteratorHelperLoose","addGroupMessages","setToken","clearUser","ChatContext","createContext","dispatch","ChatProvider","defLang","chatState","_React$useReducer","useReducer","Provider","RestContext","getRefreshToken","_x2","_x3","_getRefreshToken","_callee4","authToken","baseUrl","_context4","localStorage","removeItem","axios","post","setItem","console","log","reload","RestProvider","chatBaseURLApi","_useContext","useContext","fetch","headers","Cache-Control","Pragma","Authorization","withCredentials","interceptors","response","use","errorInterceptor","getPrivateMessages","params","_x4","_x5","getGroupMessages","_callee2","_chat$messages2","_context2","_x6","getUserByMmk","_ref4","_callee3","mmkId","guid","_context3","_x7","_x8","unread","TypingBadge","withStyles","badge","@keyframes ripple","Badge","OnlineBadge","RoomListItem","roomName","overlap","contactAvatar","roomText","getMessageText","roomTime","selected","active","secondaryTypographyProps","Chip","label","searchField","listStyle","filterChats","chats","lowerFilter","toLowerCase","RoomList","groups","onChangeChat","searchFilter","setSearchFilter","allContacts","roomArr","topChatId","getItem","c","k","isTop","unshift","sortChats","getRoomList","fullWidth","ChatAlert","_React$useContext","_React$useContext$sta","Snackbar","autoHideDuration","_root","up","ChatContainer","Container","ChatLayout","conferenceActive","hideRooms","contactsList","chatRoom","onExitRoom","columnGap","my","&:hover","VideocamIcon","RecentActorsIcon","Grid","container","sm","lg","xl","CheckAudiVideoPerm","audio","useMediaQuery","checkPermissions","mediaDevices","getUserMedia","Tooltip","SettingsSuggestIcon","SettingsVoiceIcon","ConferenceControls","ConferenceSection","SocketContext","SocketProvider","wsUrl","wsPath","_useSocket","path","accessToken","socket","setSocket","connectSocket","socketTemp","io","reconnection","extraHeaders","disconnectSocket","disconnect","setOnline","connected","on","emit","useSocket","handleSocketError","res","code","listener1","groupArr","groupData","contactArr","contactData","userData","_step2","_iterator2","operatorData","_step3","_iterator3","conferenceData","listener2","listener3","typingTimer","listener4","listener5","listener6","listener7","listener8","listener10","listener11","listener12","listener13","listener14","listener15","listener16","listener17","listener18","off","_state$activeRoom","_state$activeRoom2","_state$activeRoom3","_res$data","newUser","_groupObj$members2","groupObj","_groupObj$members","ChatPage","activeGroupId","activeChatUserId","_ref$hideRooms","_React$useContext3","onExitActiveRoom","emitSocketEvent","eventName","warn","baseMessage","recreate","onConferenceCallAccept","operatorId","mounted","onlyChat","_chat","initializeChat","renderRoom","onContactInfoClick","isString","defer","rej","promise","makeString","copy","s","lastOfPathSeparatorRegExp","cleanKey","canNotTraverseDeeper","getLastOfPath","Empty","stack","stackIndex","setPath","_getLastOfPath","p","last","getPath","_getLastOfPath3","getPathWithDefaults","defaultData","deepExtend","overwrite","prop","String","regexEscape","str","_entityMap","&","<",">","\"","'","/","escape","chars","looksLikeObjectPathRegExpCache","RegExpCache","capacity","regExpMap","Map","regExpQueue","getRegExp","pattern","regExpFromCache","regExpNew","delete","shift","set","deepFind","keySeparator","tokens","nextPath","j","getCleanedCode","consoleLogger","args","output","baseLogger","Logger","concreteLogger","options","init","_proto2","prefix","logger","debug","_len","_key","forward","_len2","_key2","_len3","_key3","deprecate","_len4","_key4","lvl","debugOnly","moduleName","clone","EventEmitter","observers","_proto3","events","_this4","numListeners","cloned","from","observer","numTimesAdded","ResourceStore","_EventEmitter","_this5","ns","defaultNS","ignoreJSONStructure","_inheritsLoose","_proto4","addNamespaces","removeNamespaces","splice","getResource","lng","_path","_path2","addResource","silent","addResources","resources","addResourceBundle","deep","skipCopy","pack","stringify","removeResourceBundle","hasResourceBundle","getResourceBundle","compatibilityAPI","getDataByLanguage","hasLanguageSomeTranslations","v","toJSON","postProcessor","processors","addPostProcessor","translator","_this6","processor","process","checkedLoadedFor","Translator","_EventEmitter2","services","_this7","_assertThisInitialized","_proto5","changeLanguage","language","exists","interpolation","resolved","extractFromKey","nsSeparator","namespaces","wouldCheckForNsInKey","seemsNaturalLanguage","userDefinedKeySeparator","userDefinedNsSeparator","possibleChars","r","matched","test","ki","substring","looksLikeObjectPath","match","interpolator","nestingRegexp","parts","translate","lastKey","_this8","overloadTranslationOptionHandler","returnDetails","_this$extractFromKey","namespace","appendNamespaceToCIMode","usedKey","exactUsedKey","usedLng","usedNS","usedParams","getUsedParamsDetails","resUsedKey","resExactUsedKey","resType","noObject","joinArrays","handleAsObjectInI18nFormat","i18nFormat","handleAsObject","extendTranslation","usedDefault","needsPluralHandling","count","hasDefaultValue","defaultValueSuffix","pluralResolver","getSuffix","defaultValueSuffixOrdinalFallback","ordinal","needsZeroSuffixLookup","shouldUseIntlApi","defaultValue","pluralSeparator","isValidLookup","missingKeyNoValueFallbackToKey","resForMissing","updateMissing","fk","lngs","fallbackLngs","languageUtils","getFallbackCodes","fallbackLng","saveMissingTo","toResolveHierarchy","send","l","specificDefaultValue","defaultForMissing","missingKeyHandler","backendConnector","saveMissing","saveMissingPlurals","suffixes","getSuffixes","suffix","appendNamespaceToMissingKey","parseMissingKeyHandler","returnObjects","returnedObjectHandler","resTypeIsArray","newKeyToUse","deepKey","_this","defaultVariables","skipInterpolation","nestBef","skipOnVariables","nb","interpolate","na","nest","postProcess","postProcessorNames","applyPostProcessor","postProcessPassResolved","i18nResolved","found","_this9","extracted","fallbackNS","needsContextHandling","codes","utils","hasLoadedNamespace","possibleKey","finalKeys","addLookupKeys","pluralSuffix","zeroSuffix","ordinalPrefix","contextKey","contextSeparator","returnNull","returnEmptyString","resourceStore","optionsKeys","useOptionsReplaceForData","option","capitalize","string","LanguageUtil","supportedLngs","_proto6","getScriptPartFromCode","formatLanguageCode","getLanguagePartFromCode","Intl","getCanonicalLocales","formattedCode","lowerCaseLng","specialCases","part","cleanCode","isSupportedCode","load","nonExplicitSupportedLngs","getBestMatchFromCodes","_this10","cleanedLng","lngOnly","supportedLng","fallbacks","fallbackCode","_this11","fallbackCodes","addCode","fc","sets","nr","_rulesPluralsTypes","1","n","Number","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","nonIntlVersions","intlVersions","suffixesOrder","zero","one","two","few","many","other","createRules","rules","numbers","plurals","PluralResolver","compatibilityJSON","PluralRules","pluralRulesCache","_proto7","addRule","clearCache","getRule","rule","cleanedCode","cacheKey","lngPart","needsPlural","resolvedOptions","pluralCategories","getPluralFormsOfKey","_this12","pluralCategory1","pluralCategory2","pluralCategory","prepend","number","select","getSuffixRetroCompatible","_this13","noAbs","abs","simplifyPluralSuffix","returnSuffix","deepFindWithDefaults","regexSafe","val","Interpolator","_proto8","escapeValue","_options$interpolatio","escape$1","useRawValueToEscape","prefixEscaped","suffixEscaped","formatSeparator","unescapeSuffix","unescapePrefix","nestingPrefix","nestingPrefixEscaped","nestingSuffix","nestingSuffixEscaped","nestingOptionsSeparator","maxReplaces","alwaysFormat","resetRegExp","getOrResetRegExp","existingRegExp","lastIndex","regexp","regexpUnescape","replaces","_this14","handleFormat","interpolationkey","f","missingInterpolationHandler","safeValue","todo","exec","matchedVar","temp","clonedOptions","_this15","handleHasOptions","inheritedOptions","sep","optionsString","matchedSingleQuotes","matchedDoubleQuotes","formatters","doReduce","elem","parseFormatStr","formatStr","formatName","formatOptions","optStr","currency","range","opt","_opt$split","trimmedKey","parseInt","createCachedFormatter","cache","optForCache","formatParams","formatter","Formatter","formats","NumberFormat","datetime","DateTimeFormat","relativetime","RelativeTimeFormat","list","ListFormat","_proto9","addCached","_this16","mem","_parseFormatStr","formatted","valOptions","locale","Connector","_EventEmitter3","backend","store","_this17","waitingReads","maxParallelReads","readingCalls","maxRetries","retryTimeout","queue","_proto10","queueLoad","languages","_this18","toLoad","pending","toLoadLanguages","toLoadNamespaces","hasAllNamespaces","pendingCount","loaded","errors","q","_getLastOfPath2","removePending","loadedKeys","read","fcName","_this19","tried","wait","resolver","bind","prepareLoading","_this20","loadOne","_this21","fallbackValue","isUpdate","clb","opts","initImmediate","partialBundledLanguages","ret","tDescription","transformOptions","noop","bindMemberFunctions","inst","getOwnPropertyNames","I18n","_EventEmitter4","_this22","modules","external","isInitialized","isClone","_proto11","_this23","isInitializing","defOpts","createClassOnDemand","ClassOrObject","lu","languageDetector","detection","storeApi","_this$store","storeApiChained","_this$store2","deferred","initializedStoreOnce","loadResources","_this24","usedCallback","append","resolvedLanguage","setResolvedLanguage","reloadResources","li","lngInLngs","_this25","_this2","isLanguageChangingTo","setLngProps","setLng","cacheUserLanguage","detect","getFixedT","keyPrefix","_this3","fixedT","rest","resultKey","_this$translator","_this$translator2","setDefaultNamespace","_this26","lastLng","loadNotPending","loadState","precheck","preResult","loadNamespaces","_this27","loadLanguages","_this28","preloaded","newLngs","dir","createInstance","cloneInstance","_this29","forkResourceStore","mergedOptions","membersToCopy","instance","i18n","reducer","LanguageContext","AppLanguageProvider","_useReducer","languageState","dispatchLanguage","I18nextProvider","SET_ACTIVE_ROOM","SET_LOADING","SET_ERROR","REVOKE_MESSAGE","MARK_PRIVATE_MESSAGES_READ","chatWsUrl","chatWsPath"],"mappings":"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"}